<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Kelvin R. Lawrence">
<title>GRAPH DATABASES, GREMLIN and TINKERPOP : A TUTORIAL</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
.listingblock .pygments .hll { background-color: #4f424c }
.listingblock .pygments, .listingblock .pygments code { background: #2f1e2e; color: #e7e9db }
.listingblock .pygments .tok-c { color: #776e71 } /* Comment */
.listingblock .pygments .tok-err { color: #ef6155 } /* Error */
.listingblock .pygments .tok-k { color: #815ba4 } /* Keyword */
.listingblock .pygments .tok-l { color: #f99b15 } /* Literal */
.listingblock .pygments .tok-n { color: #e7e9db } /* Name */
.listingblock .pygments .tok-o { color: #5bc4bf } /* Operator */
.listingblock .pygments .tok-p { color: #e7e9db } /* Punctuation */
.listingblock .pygments .tok-ch { color: #776e71 } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #776e71 } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #776e71 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #776e71 } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #776e71 } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #776e71 } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #ef6155 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gh { color: #e7e9db; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #48b685 } /* Generic.Inserted */
.listingblock .pygments .tok-gp { color: #776e71; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #5bc4bf; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-kc { color: #815ba4 } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #815ba4 } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #5bc4bf } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #815ba4 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #815ba4 } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #fec418 } /* Keyword.Type */
.listingblock .pygments .tok-ld { color: #48b685 } /* Literal.Date */
.listingblock .pygments .tok-m { color: #f99b15 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #48b685 } /* Literal.String */
.listingblock .pygments .tok-na { color: #06b6ef } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #e7e9db } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #fec418 } /* Name.Class */
.listingblock .pygments .tok-no { color: #ef6155 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #5bc4bf } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #e7e9db } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #ef6155 } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #06b6ef } /* Name.Function */
.listingblock .pygments .tok-nl { color: #e7e9db } /* Name.Label */
.listingblock .pygments .tok-nn { color: #fec418 } /* Name.Namespace */
.listingblock .pygments .tok-nx { color: #06b6ef } /* Name.Other */
.listingblock .pygments .tok-py { color: #e7e9db } /* Name.Property */
.listingblock .pygments .tok-nt { color: #5bc4bf } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #ef6155 } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #5bc4bf } /* Operator.Word */
.listingblock .pygments .tok-w { color: #e7e9db } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #f99b15 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #f99b15 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #f99b15 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #f99b15 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #f99b15 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #48b685 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #48b685 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #e7e9db } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #48b685 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #776e71 } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #48b685 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #f99b15 } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #48b685 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #f99b15 } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #48b685 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #48b685 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #48b685 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #48b685 } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #e7e9db } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #06b6ef } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #ef6155 } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #ef6155 } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #ef6155 } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #ef6155 } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #f99b15 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article">
<div id="header">
<h1>GRAPH DATABASES, GREMLIN and TINKERPOP : A TUTORIAL</h1>
<div class="details">
<span id="author" class="author">Kelvin R. Lawrence</span><br>
<span id="email" class="email"><a href="mailto:klawrenc@us.ibm.com">klawrenc@us.ibm.com</a></span><br>
<span id="revnumber">version 251,</span>
<span id="revdate">Oct 09, 2017</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. INTRODUCTION</a>
<ul class="sectlevel2">
<li><a href="#_how_this_book_came_to_be">1.1. How this book came to be</a></li>
<li><a href="#_providing_feedback">1.2. Providing feedback</a></li>
<li><a href="#_what_is_this_book_about">1.3. What is this book about?</a></li>
<li><a href="#thanks">1.4. A word of thanks</a></li>
<li><a href="#whygraph">1.5. So what is a graph database and why should I care?</a></li>
</ul>
</li>
<li><a href="#gs">2. GETTING STARTED</a>
<ul class="sectlevel2">
<li><a href="#tpintro">2.1. What is Apache TinkerPop?</a></li>
<li><a href="#gconsole">2.2. The Gremlin console</a>
<ul class="sectlevel3">
<li><a href="#gremlininstall">2.2.1. Downloading, installing and launching the console</a></li>
<li><a href="#gremlinsave">2.2.2. Saving output from the console to a file</a></li>
</ul>
</li>
<li><a href="#tgintro">2.3. Introducing TinkerGraph</a></li>
<li><a href="#air">2.4. Introducing the air-routes graph</a></li>
<li><a href="#mn">2.5. TinkerPop 3 migration notes</a>
<ul class="sectlevel3">
<li><a href="#cr">2.5.1. Creating a TinkerGraph TP2 vs TP3</a></li>
<li><a href="#ld2">2.5.2. Loading a graphML file TP2 vs TP3</a></li>
<li><a href="#sugarplugin">2.5.3. A word about the TinkerPop.sugar plugin</a></li>
</ul>
</li>
<li><a href="#ld">2.6. Loading the air-routes graph using the Gremlin console</a></li>
<li><a href="#off">2.7. Turning off some of the Gremlin console&#8217;s output</a></li>
<li><a href="#_a_word_about_indexes_and_schemas">2.8. A word about indexes and schemas</a></li>
</ul>
</li>
<li><a href="#sq">3. WRITING GREMLIN QUERIES</a>
<ul class="sectlevel2">
<li><a href="#_introducing_gremlin">3.1. Introducing Gremlin</a>
<ul class="sectlevel3">
<li><a href="#_a_quick_look_at_gremlin_and_sql">3.1.1. A quick look at Gremlin and SQL</a></li>
</ul>
</li>
<li><a href="#bq">3.2. Some fairly basic Gremlin queries</a>
<ul class="sectlevel3">
<li><a href="#values">3.2.1. Retrieving property values from a node</a></li>
<li><a href="#exist">3.2.2. Does a specific property exist on a given node or edge?</a></li>
<li><a href="#count">3.2.3. Counting things</a></li>
<li><a href="#count">3.2.4. Counting groups of things</a></li>
<li><a href="#walk">3.2.5. Starting to walk the graph</a></li>
<li><a href="#pathintro">3.2.6. What nodes and edges did I visit? - Introducing <em>path</em></a></li>
<li><a href="#edgeexist">3.2.7. Does an edge exist between two nodes?</a></li>
<li><a href="#limit">3.2.8. Limiting the amount of data returned</a></li>
<li><a href="#_retrieving_a_range_of_nodes">3.2.9. Retrieving a range of nodes</a></li>
<li><a href="#_using_em_as_em_em_select_em_and_em_project_em_to_name_and_refer_back_to_prior_steps">3.2.10. Using <em>as</em>, <em>select</em> and <em>project</em> to name and refer back to prior steps</a></li>
</ul>
</li>
<li><a href="#vm">3.3. Using <em>valueMap</em> to explore the properties of a node or element</a></li>
<li><a href="#var">3.4. Assigning query results to a variable</a></li>
<li><a href="#wid">3.5. Working with IDs</a></li>
<li><a href="#lab">3.6. Working with labels</a></li>
<li><a href="#local">3.7. Using the <em>local</em> step to make sure we get the result we intended</a></li>
<li><a href="#st">3.8. Basic statistical and numerical operations</a>
<ul class="sectlevel3">
<li><a href="#tranges">3.8.1. Testing values and ranges of values</a></li>
<li><a href="#winout">3.8.2. Refining flight routes analysis using <em>not</em>, <em>neq</em>, <em>within</em> and <em>without</em></a></li>
<li><a href="#_using_em_coin_em_and_em_sample_em_to_sample_a_dataset">3.8.3. Using <em>coin</em> and <em>sample</em> to sample a dataset</a></li>
<li><a href="#_using_em_math_random_em_to_more_randomly_select_a_single_node">3.8.4. Using <em>Math.random</em> to more randomly select a single node</a></li>
</ul>
</li>
<li><a href="#sort">3.9. Sorting things</a>
<ul class="sectlevel3">
<li><a href="#_sorting_by_key_or_value">3.9.1. Sorting by key or value</a></li>
</ul>
</li>
<li><a href="#bool">3.10. Boolean operations</a></li>
<li><a href="#wh">3.11. Using <em>where</em> to filter things out of a result</a>
<ul class="sectlevel3">
<li><a href="#whereby">3.11.1. Using <em>where</em> and <em>by</em> to filter results</a></li>
</ul>
</li>
<li><a href="#choose">3.12. Using <em>choose</em> to write if&#8230;&#8203;then&#8230;&#8203;else type queries</a></li>
<li><a href="#option">3.13. Using <em>option</em> to write case/switch type queries</a></li>
<li><a href="#ma">3.14. Using <em>match</em> to do pattern matching</a></li>
<li><a href="#_using_em_union_em_to_combine_query_results">3.15. Using <em>union</em> to combine query results</a></li>
<li><a href="#sideeffect">3.16. Using <em>sideEffect</em> to do things on the side</a></li>
<li><a href="#_using_em_aggregate_em_to_create_a_temporary_collection">3.17. Using <em>aggregate</em> to create a temporary collection</a></li>
<li><a href="#coalesce">3.18. Using <em>coalesce</em> to see which traversal returns a result</a></li>
<li><a href="#otherv">3.19. Other ways to explore nodes and edges using <em>both</em>, <em>bothE</em>, <em>bothV</em> and <em>otherV</em></a></li>
<li><a href="#sp">3.20. Shortest paths (between airports)</a></li>
<li><a href="#nd">3.21. Calculating node degree</a></li>
<li><a href="#sx">3.22. More examples using what we have covered so far</a></li>
</ul>
</li>
<li><a href="#beq">4. BEYOND BASIC QUERIES</a>
<ul class="sectlevel2">
<li><a href="#indents">4.1. A word about layout and indentation</a></li>
<li><a href="#rword">4.2. A warning about reserved word conflicts and collisions</a></li>
<li><a href="#dmodel">4.3. Thinking about your data model</a>
<ul class="sectlevel3">
<li><a href="#_keeping_information_in_two_places_within_the_same_graph">4.3.1. Keeping information in two places within the same graph</a></li>
<li><a href="#_using_a_graph_as_an_index_into_other_data_sources">4.3.2. Using a graph as an index into other data sources</a></li>
<li><a href="#_a_few_words_about_em_supernodes_em">4.3.3. A few words about <em>supernodes</em></a></li>
</ul>
</li>
<li><a href="#grv">4.4. Making Gremlin even Groovier</a>
<ul class="sectlevel3">
<li><a href="#varaus">4.4.1. Using a variable to feed a traversal</a></li>
</ul>
</li>
<li><a href="#addnodes">4.5. Adding nodes, edges and properties</a>
<ul class="sectlevel3">
<li><a href="#_adding_an_airport_node_and_a_route_edge">4.5.1. Adding an airport (node) and a route (edge)</a></li>
<li><a href="#proptraversal">4.5.2. Using a traversal to seed a property with a list</a></li>
<li><a href="#testgraph">4.5.3. Quickly building a graph for testing</a></li>
<li><a href="#addloop">4.5.4. Adding nodes and edges using a loop</a></li>
</ul>
</li>
<li><a href="#deleting">4.6. Deleting nodes, edges and properties</a>
<ul class="sectlevel3">
<li><a href="#_deleting_a_node">4.6.1. Deleting a node</a></li>
<li><a href="#_deleting_an_edge">4.6.2. Deleting an edge</a></li>
<li><a href="#_deleting_a_property">4.6.3. Deleting a property</a></li>
<li><a href="#_removing_all_the_edges_or_nodes_in_the_graph">4.6.4. Removing all the edges or nodes in the graph</a></li>
</ul>
</li>
<li><a href="#pkvrevisited">4.7. Property keys and values revisited</a>
<ul class="sectlevel3">
<li><a href="#vertexprop">4.7.1. The <em>Property</em> and <em>VertexProperty</em> interfaces</a></li>
<li><a href="#propmap">4.7.2. The <em>propertyMap</em> traversal step</a></li>
<li><a href="#propid">4.7.3. Properties have IDs too</a></li>
<li><a href="#listprop">4.7.4. Attaching multiple values (lists or sets) to a single property</a></li>
<li><a href="#metaprop">4.7.5. Adding properties to other properties (meta properties)</a></li>
</ul>
</li>
<li><a href="#lam">4.8. Using Lambda functions</a>
<ul class="sectlevel3">
<li><a href="#mapstep">4.8.1. Introducing the <em>Map</em> step</a></li>
<li><a href="#_using_regular_expressions_to_do_fuzzy_searches">4.8.2. Using regular expressions to do fuzzy searches</a></li>
</ul>
</li>
<li><a href="#pred">4.9. Creating custom tests (predicates)</a>
<ul class="sectlevel3">
<li><a href="#_creating_a_regular_expression_predicate">4.9.1. Creating a regular expression predicate</a></li>
</ul>
</li>
<li><a href="#graphvars">4.10. Using graph variables to associate metadata with a graph</a></li>
<li><a href="#tre">4.11. Turning node values into trees</a></li>
<li><a href="#sub">4.12. Creating a sub graph</a></li>
<li><a href="#sav">4.13. Saving (serializing) a graph as GraphML (XML) or GraphSON (JSON)</a></li>
<li><a href="#reload">4.14. Loading a graph stored as GraphML (XML) or GraphSON (JSON)</a></li>
</ul>
</li>
<li><a href="#msc">5. MISCELLANEOUS QUERIES AND THE RESULTS THEY GENERATE</a>
<ul class="sectlevel2">
<li><a href="#countmore">5.1. Counting more things</a>
<ul class="sectlevel3">
<li><a href="#groupvar">5.1.1. Using groupCount with a traversal variable</a></li>
<li><a href="#eu-usa">5.1.2. Analysis of routes between Europe and the USA</a></li>
<li><a href="#mapreduce">5.1.3. Using <em>fold</em> to do simple Map-Reduce computations</a></li>
<li><a href="#meanmode">5.1.4. Distribution of routes in the graph (mode and mean)</a></li>
<li><a href="#_how_many_routes_are_there_from_airports_in_london_uk">5.1.5. How many routes are there from airports in London (UK)?</a></li>
<li><a href="#topten">5.1.6. What are the top ten airports by route count?</a></li>
<li><a href="#localfold">5.1.7. Using <em>local</em> while counting things</a></li>
</ul>
</li>
<li><a href="#wherefly">5.2. Where can I fly to from here?</a></li>
<li><a href="#_more_analysis_of_distances_between_airports">5.3. More analysis of distances between airports</a>
<ul class="sectlevel3">
<li><a href="#_finding_routes_longer_than_8_000_miles">5.3.1. Finding routes longer than 8,000 miles</a></li>
<li><a href="#_combining_em_aggregate_em_em_union_em_and_em_filter_em_to_compute_distances">5.3.2. Combining <em>aggregate</em>, <em>union</em> and <em>filter</em> to compute distances.</a></li>
<li><a href="#_more_queries_that_analyze_distances">5.3.3. More queries that analyze distances</a></li>
<li><a href="#AUSLHR-OS">5.3.4. How far is it from AUS to LHR with one stop?</a></li>
<li><a href="#_using_em_sack_em_to_calculate_the_shortest_aus_lhr_route_with_one_stop">5.3.5. Using <em>sack</em> to calculate the shortest AUS-LHR route with one stop</a></li>
<li><a href="#_another_example_of_how_em_sack_em_can_be_used">5.3.6. Another example of how <em>sack</em> can be used</a></li>
<li><a href="#_using_latitude_longitude_and_geographical_region_in_queries">5.3.7. Using latitude, longitude and geographical region in queries</a></li>
</ul>
</li>
<li><a href="#_using_em_store_em_and_a_em_sideeffect_em_to_make_a_set_of_unique_values">5.4. Using <em>store</em> and a <em>sideEffect</em> to make a set of unique values</a></li>
<li><a href="#emit">5.5. Using <em>emit</em> to return results during a traversal</a></li>
<li><a href="#btree">5.6. Modelling an ordered binary tree as a graph</a></li>
<li><a href="#mapstr">5.7. Using <em>map</em> to produce a concatenated result string</a></li>
<li><a href="#randwalk">5.8. Randomly walking a graph</a></li>
<li><a href="#unwantededges">5.9. Finding unwanted parallel edges</a></li>
<li><a href="#flr">5.10. Finding the longest flight route between two adjacent airports in the graph</a></li>
<li><a href="#miscq">5.11. Miscellaneous other queries</a>
<ul class="sectlevel3">
<li><a href="#_warning_about_em_path_em_being_memory_intensive">5.11.1. Warning about <em>path</em> being memory intensive</a></li>
<li><a href="#_work_in_progress">5.11.2. Work in progress</a></li>
<li><a href="#pagerank">5.11.3. Experiments with Page Rank</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#beyond">6. MOVING BEYOND THE CONSOLE AND TINKERGRAPH</a>
<ul class="sectlevel2">
<li><a href="#javatinker">6.1. Working with TinkerGraph from Java Application</a>
<ul class="sectlevel3">
<li><a href="#tpinterfaces">6.1.1. The Apache TinkerPop interfaces and classes</a></li>
<li><a href="#javatp1">6.1.2. Writing our first TinkerPop Java program</a></li>
<li><a href="#_compiling_our_code">6.1.3. Compiling our code</a></li>
<li><a href="#_adding_to_our_java_program">6.1.4. Adding to our Java program</a></li>
</ul>
</li>
<li><a href="#groovyapp">6.2. Working with TinkerGraph from a Groovy application</a>
<ul class="sectlevel3">
<li><a href="#groovyc">6.2.1. Compiling our Groovy application</a></li>
<li><a href="#_running_our_groovy_application">6.2.2. Running our Groovy application</a></li>
<li><a href="#_adding_to_our_groovy_application">6.2.3. Adding to our Groovy application</a></li>
</ul>
</li>
<li><a href="#janusintro">6.3. Introducing Janus Graph</a>
<ul class="sectlevel3">
<li><a href="#janusinstall">6.3.1. Installing Janus Graph</a></li>
<li><a href="#janusconsole">6.3.2. Using Janus Graph from the Gremlin Console</a></li>
<li><a href="#janusinmemory">6.3.3. Using Janus Graph with the <em>inmemory</em> option</a></li>
<li><a href="#janustrans">6.3.4. Janus Graph transactions</a></li>
<li><a href="#_loading_air_routes_into_a_janus_graph_instance">6.3.5. Loading air-routes into a Janus Graph instance</a></li>
<li><a href="#janusmgmt">6.3.6. The Janus Graph management API</a></li>
<li><a href="#janusschema">6.3.7. Defining a Janus Graph schema for air-routes</a></li>
<li><a href="#cardlist">6.3.8. Creating a property with cardinality LIST</a></li>
<li><a href="#cardset">6.3.9. Creating a property with cardinality SET</a></li>
<li><a href="#janusgeo">6.3.10. The Janus Graph geospatial API</a></li>
</ul>
</li>
<li><a href="#janusstorage">6.4. Choosing a persistent storage technology for Janus Graph</a>
<ul class="sectlevel3">
<li><a href="#_berkley_db">6.4.1. Berkley DB</a></li>
<li><a href="#_apache_cassandra">6.4.2. Apache Cassandra</a></li>
<li><a href="#_apache_hbase">6.4.3. Apache HBase</a></li>
</ul>
</li>
<li><a href="#_using_an_external_index_with_janus_graph">6.5. Using an external index with Janus Graph</a>
<ul class="sectlevel3">
<li><a href="#_apache_elastic_search">6.5.1. Apache Elastic Search</a></li>
<li><a href="#_apache_solr">6.5.2. Apache Solr</a></li>
<li><a href="#_using_the_management_api_to_control_the_index">6.5.3. Using the Management API to control the index</a></li>
</ul>
</li>
<li><a href="#_using_gremlin_server">6.6. Using Gremlin Server</a>
<ul class="sectlevel3">
<li><a href="#_connecting_the_gremlin_console_to_a_remote_graph">6.6.1. Connecting the Gremlin Console to a remote graph</a></li>
<li><a href="#_using_janus_graph_and_gremlin_from_a_java_program">6.6.2. Using Janus Graph and Gremlin from a Java program</a></li>
<li><a href="#_connecting_to_a_gremlin_server_from_the_command_line">6.6.3. Connecting to a Gremlin Server from the command line</a></li>
<li><a href="#_examples_of_the_json_returned_from_a_gremlin_server">6.6.4. Examples of the JSON returned from a Gremlin Server</a></li>
<li><a href="#_tweaking_queries_to_make_the_json_returned_easier_to_work_with">6.6.5. Tweaking queries to make the JSON returned easier to work with</a></li>
</ul>
</li>
<li><a href="#_using_gremlin_within_a_python_notebook">6.7. Using Gremlin within a Python notebook</a></li>
<li><a href="#_putting_it_all_into_a_docker_container">6.8. Putting it all into a Docker Container</a></li>
</ul>
</li>
<li><a href="#serialize">7. COMMON GRAPH SERIALIZATION FORMATS</a>
<ul class="sectlevel2">
<li><a href="#_comma_separated_values_csv">7.1. Comma Separated Values (CSV)</a>
<ul class="sectlevel3">
<li><a href="#_using_two_csv_files_to_represent_the_air_routes_data">7.1.1. Using two CSV files to represent the air-routes data</a></li>
<li><a href="#_adjacency_matrix_format">7.1.2. Adjacency matrix format</a></li>
<li><a href="#_adjacency_list_format">7.1.3. Adjacency List format</a></li>
<li><a href="#_edge_list_format">7.1.4. Edge List format</a></li>
<li><a href="#_exporting_relational_database_data_to_a_graph_using_csv_format">7.1.5. Exporting relational database data to a graph using CSV format</a></li>
</ul>
</li>
<li><a href="#_graphml">7.2. GraphML</a></li>
<li><a href="#_graphson">7.3. GraphSON</a>
<ul class="sectlevel3">
<li><a href="#_adjacency_list_format_graphson">7.3.1. Adjacency list format GraphSON</a></li>
<li><a href="#_wrapped_adjacency_list_format_graphson">7.3.2. Wrapped adjacency list format GraphSON</a></li>
</ul>
</li>
<li><a href="#_other_formats_you_may_encounter">7.4. Other formats you may encounter</a></li>
</ul>
</li>
<li><a href="#fr">8. FURTHER READING</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. INTRODUCTION</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">This book is a work in progress. Feedback is very much encouraged and welcomed!</div>
<p>The title of this book could equally well be <em>"A getting started guide for users of
graph databases and the Gremlin query language featuring hints, tips and sample
queries"</em>. It turns out that is a bit too too long to fit on one line for a heading
but in a single sentence that describes the focus of this work pretty well.</p>
</div>
<div class="paragraph">
<p>I hope people find what follows useful. It remains a work in progress and more will
be added in the coming weeks and months as time permits. I am hopeful that what is
presented so far is of some use to folks, who like me, are learning to use the
Gremlin query and traversal language and related technologies.</p>
</div>
<div class="sect2">
<h3 id="_how_this_book_came_to_be">1.1. How this book came to be</h3>
<div class="paragraph">
<p>I forget exactly when, but over a year ago I started compiling a list of notes, hints
and tips, initially for my own benefit, of things I had found poorly explained
elsewhere while using graph databases and especially using Apache TinkerPop, Janus
Graph and Gremlin. Over time that document grew (and continues to grow) and has
effectively become a book. After some encouragement from colleagues I have decided to
release it as a living book in an open source venue so that anyone who is interested
can read it. It is aimed at programmers and anyone using the Gremlin query language
to work with graphs. Lots of code examples, sample queries, discussion of best
practices, lessons I learned the hard way etc. are included.</p>
</div>
<div class="paragraph">
<p>Thanks to all those that have encouraged me to keep going with this adventure!</p>
</div>
<div class="paragraph">
<p>Kelvin R. Lawrence<br>
October 5th, 2017</p>
</div>
</div>
<div class="sect2">
<h3 id="_providing_feedback">1.2. Providing feedback</h3>
<div class="paragraph">
<p>Please let me know about any mistakes you find in this material and also please feel
free to send me feedback of any sort. Suggested improvements are especially welcome.
A good way to provide feedback is by opening an issue in the GitHub repository
located at <a href="https://github.com/krlawrence/graph" class="bare">https://github.com/krlawrence/graph</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_this_book_about">1.3. What is this book about?</h3>
<div class="paragraph">
<p>This book introduces the Apache TinkerPop 3 <em>Gremlin</em> graph query
and traversal language via real examples against a real world graph. They are given
as a set of working examples against a graph that is also provided with these notes.
The graph, <em>air-routes.graphml</em>, is a model of the world airline route network
between 3,373 airports including 43,362 routes. The examples presented
will work unmodified with the air-routes.graphml file loaded into the Gremlin
console running with a TinkerGraph.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The examples in this book have now been updated tested using Apache TinkerPop
version 3.3 which introduced a few breaking changes. If you find any I missed please
let me know!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>TinkerGraph is an <em>in-memory</em> graph, meaning
nothing gets saved to disk automatically, that is shipped as part of the Apache
TinkerPop 3 download.  The goal of this tutorial is to allow someone with little to
no prior knowledge to get up and going quickly using the Gremlin console and the
'air-routes&#8217;graph. Later in the document we will discuss using additional
technologies such as Janus Graph, Apache Cassandra and Apache Elastic Search with
Gremlin. We will also discuss writing stand alone Java and Groovy applications as
well as using the Gremlin Console.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In the first four sections of this this document we have mainly focussed on
showing the different types of query that you can issue using Gremlin. We have not
tried to show all of the output that you will get back from entering these queries
but have selectively shown examples of output. We go a lot deeper into things in
chapters 5 and 6.
</td>
</tr>
</table>
</div>
<div class="dlist">
<div class="title">How this book is organized</div>
<dl>
<dt class="hdlist1">Chapter 1 - INTRODUCTION</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>We start off by briefly doing a recap on why Graph databases are of interest to us
and discuss some good use cases for graphs.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Chapter 2 - GETTING STARTED</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In Chapter two we introduce several of the components of Apache TinkerPop 3 and we
also introduce the air-routes.graphml file that will be used as the graph we base
most of our examples on.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Chapter 3 - WRITING GREMLIN QUERIES</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In Chapter three we start discussing how to use the Gremlin graph traversal and
query language to interrogate the air-routes graph. We begin by comparing how we
could have built the air-routes graph using a more traditional relational database
and then look at how SQL and Gremlin are both similar in some ways and very
different in others. For the rest of the Chapter, we introduce several of
the key Gremlin methods, or as they are often called, "steps". We
mostly focus on reading the graph (not adding or deleting things) in this Chapter.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Chapter 4 - BEYOND BASIC QUERIES</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In Chapter four we move beyond just reading the graph and describe how to add nodes,
edges and properties as well as how to delete and update them. We also present a
discussion of various best practices.We also start to explore some slightly more
advanced topics in this chapter.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Chapter 5 - MISCELLANEOUS QUERIES AND THE RESULTS THEY GENERATE</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In Chapter five we focus on using what we have covered in the prior Chapters to write
queries that have a more real world feel. We present a lot more examples of the
output from running queries in this Chapter. We also start to discuss topics such
as analyzing distances, route distribution and writing geospatial queries.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Chapter 6 - MOVING BEYOND THE CONSOLE AND TINKERGRAPH</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In Chapter six we move beyond our focus on the Gremlin Console and TinkerGraph. We
start by looking at how you can write stand alone Java and Groovy applications that
can work with a graph. We then introduce Janus Graph and take a fairly detailed
look at its capabilities such as support for transactions, schemas and external
indexes. We also explore various technology choices for back end persistent store
and index as well as introducing the Gremlin Server.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Chapter 7 - COMMON GRAPH SERIALIZATION FORMATS</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In Chapter seven a discussion is presented of some common Graph serialization file
formats along with coverage of how to use them in the context of TinkerPop 3
enabled graphs.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Chapter 8 - FURTHER READING</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>We finish up by providing several links to useful web sites where you can find
tools and documentation for many of the technologies covered in this document.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="thanks">1.4. A word of thanks</h3>
<div class="paragraph">
<p>I would like to thank my colleagues at IBM, Graham Wallis, Jason Plurad and Adam
Holley for their help in refining and improving several of the queries contained in
this document. Gremlin is definitely a bit of a team sport. We spent many hours over
the last many months discussing the best way to handle different types of queries and
traversals!</p>
</div>
</div>
<div class="sect2">
<h3 id="whygraph">1.5. So what is a graph database and why should I care?</h3>
<div class="paragraph">
<p>This document is mainly intended to be a tutorial in working with graph databases and
related technology using the Gremlin query language. However, it is worth spending
just a few moments to summarize why it is important to understand what a graph
database is, what some good use cases for graphs are and why you should care in a
World that is already full of all kinds of SQL and NoSQL databases. In this document
we are going to be discussing <em>directed property graphs</em>. At the conceptual level
these types of graphs are quite simple to understand. You have three basic building
blocks.  Nodes, edges and properties. Nodes represent "things" such as people or
places. Edges represent connections between those nodes and properties and
information to the nodes and edges as needed. The <em>directed</em> part of the name means
that any edge has a direction. It goes <em>out</em> from one node and <em>in</em> to another. You
will sometimes hear people use the word <em>digraph</em> as shorthand for <em>directed graph</em>.
Consider the relationship "Kelvin knows Jack". This could be modeled as a node for
each of the people and an edge for the relationship as follows.</p>
</div>
<div class="paragraph text-center">
<p>Kelvin&#8201;&#8212;&#8201;knows &#8594; Jack</p>
</div>
<div class="paragraph">
<p>Note the arrow which implies the direction of the relationship. If we wanted to
record the fact that Jack also admits to knowing Kelvin we would need to add a
second edge from Jack to Kelvin. Properties could be added to each person to give
more information about them. For example, my age might be a property on my node.</p>
</div>
<div class="paragraph">
<p>It turns out that Jack really likes cats. We might want to store that in our graph as
well so we could create the relationship:</p>
</div>
<div class="paragraph text-center">
<p>Jack&#8201;&#8212;&#8201;likes &#8594; Cats</p>
</div>
<div class="paragraph">
<p>Now that we have a bit more in our graph we could answer the question "who does
Kelvin know that likes cats?"</p>
</div>
<div class="paragraph text-center">
<p>Kelvin&#8201;&#8212;&#8201;knows &#8594; Jack&#8201;&#8212;&#8201;likes &#8594; Cats</p>
</div>
<div class="paragraph">
<p>This is a simple example but hopefully you can already see that we are modelling our
data the way we think about it in the real world. Armed with this knowledge you now
have all of the basic building blocks you need in order to start thinking about how
you might model things you are familiar with as a graph.</p>
</div>
<div class="paragraph">
<p>So getting back to the question "why should I care?", well, if something looks like a
graph, then wouldn&#8217;t it be great if we could model it that way. Many things in our
everyday lives center around things that can very nicely be represented in a graph.
Things such as your social and business networks, the route you take to get to work,
the phone network, airline route choices for trips you need to take are all great
candidates. There are also many great business applications for graph databases and
algorithms. These include recommendation systems, crime prevention and fraud
detection to name but three.</p>
</div>
<div class="paragraph">
<p>The reverse is also true. If something does not feel like a graph then don&#8217;t try to
force it to be. Your videos are probably doing quite nicely living in the object
store where you currently have them. A sales ledger system built using a relational
database is probably doing just fine where it is and likewise a document store is
quite possibly just the right place to be storing your documents. So "use the right
tool for the job" remains as valid a phrase here as elsewhere". Where graph databases
come into their own is when the data you are storing is intrinsically linked by it&#8217;s
very nature - the air routes network used as the basis for all of the examples in
this document being a perfect example.</p>
</div>
<div class="paragraph">
<p>Those of you that looked at graphs as part of a computer science course are correct
if your reaction was "haven&#8217;t graphs been around for ages?". Indeed Leonard Euler is
credited with demonstrating the first graph problem and inventing the whole concept
of "Graph Theory" all the way back in 1763 when he investigated the now famous
"Seven Bridges of Konigsberg" problem.</p>
</div>
<div class="paragraph">
<p>If you want read a bit more about graph theory and its present day application you
can find a lot of good information on-line. Here&#8217;s a Wikipedia link to get you
started. <a href="https://en.wikipedia.org/wiki/Graph_theory" class="bare">https://en.wikipedia.org/wiki/Graph_theory</a></p>
</div>
<div class="paragraph">
<p>So given Graph Theory is anything but a new idea, why is it that only recently we are
seeing a massive growth in the building and deployment of graph database systems and
applications? At least part of the answer is that computer hardware and software has
reached the point where you can build large big data systems that scale well for a
reasonable price, especially now that using cloud deployments you don&#8217;t even have to
buy the hardware that your system runs on. While you can certainly run a graph
database on your laptop, I do just that every day, the reality is that in production,
at scale, they are big data systems. Large graphs commonly have many billions of
nodes and edges in them taking up petabytes of data on disk. Graph algorithms can be
both compute and memory intensive and it is only fairly recently that deploying the
necessary resources for such big data systems has made financial sense for more
everyday uses in business and not just in government or academia. Graph databases are
becoming much more broadly adopted across the spectrum from high end scientific
research to financial networks and beyond.</p>
</div>
<div class="paragraph">
<p>Another factor that has really helped start this graph database revolution is the
availability of high quality open source technology.  There are a lot of great open
source projects addressing everything from the databases you need to store the graph
data to the query languages used to traverse them all the way up to visually
displaying graphs as part of the user interface layer. In particular, it is so called
<em>property graphs</em> where we are seeing the broadest development and uptake. In a
property graph both nodes and edges can have properties (effectively key,value pairs)
associated with them. There are many styles of graph that you may end up building and
there have been whole books written on these various design patterns but the property
graph technology we will be focussed on in this document can support all of the most
common usage patterns. If you hear phrases such as <em>directed graph</em> and <em>undirected
graph</em> or <em>cyclic</em> and <em>acyclic</em> graph and many more as you work with graph databases
a quick on-line search will get you to a place where you can get familiar with that
terminology. A deep discussion of these patterns is beyond the scope of this document
and it&#8217;s in no way essential to have a full background in graph theory to get
productive quickly.</p>
</div>
<div class="paragraph">
<p>A third, and equally important factor, in the growth we are seeing in graph database
adoption is the low barrier of entry for programmers. As you will see from the
examples in this document, someone wanting to experiment with graph technology can
download the Apache TinkerPop package and as long as Java 8 is installed, be up and
running with zero configuration, other than doing an unzip of the files, in as little
as five minutes.  Graph databases do not force you to define schemas or specify the
layout of tables and columns before you can get going and start building a graph.
Programmers also seem to find the graph style of programming quite intuitive as it
closely models the way they think of the world.</p>
</div>
<div class="paragraph">
<p>Graph database technology should not be viewed as a "rip and replace" technology but
as very much complimentary to other databases that you may already have deployed. One
common use case is for the graph to be uses as a form of smart index into other data
stores. This is sometimes called having a polyglot data architecture.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gs">2. GETTING STARTED</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s take a look at what you will need to have installed and what tools you will
need available to make best use of the examples contained in this guide.  The key
thing that you will need is the Apache TinkerPop project&#8217;s Gremlin Console download.</p>
</div>
<div class="sect2">
<h3 id="tpintro">2.1. What is Apache TinkerPop?</h3>
<div class="paragraph">
<p>Apache TinkerPop is a graph computing framework and top level project hosted by the
Apache Software Foundation. The homepage for the project is located at this URL:
<a href="http://tinkerpop.apache.org/" class="bare">http://tinkerpop.apache.org/</a></p>
</div>
<div class="dlist">
<div class="title">The project includes the following components:</div>
<dl>
<dt class="hdlist1">Gremlin</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A graph traversal (query) language</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Gremlin Console</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>An interactive shell for working with local or remote graphs.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Gremlin Server</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Allows hosting of graphs remotely via an HTTP/Web Sockets connection.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">TinkerGraph</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A small in-memory graph implementation that is great for learning.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Programming Interfaces</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A set of programming interfaces written in Java</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Documentation</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A user guide, a tutorial and programming API documentation.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The programming interfaces allow providers of graph databases to build systems that
are TinkerPop enabled. Any such databases can be accessed using the Gremlin query
language and corresponding API. For most of this document we will be working within
the Gremlin console with a local graph. However in Section 6 we will take a look at
Gremlin Server and some other TinkerPop 3 enabled environments. Most of Apache
Tinkerpop has been developed using Java 8 but there are also bindings available for
many other programming languages such as Groovy and Python. Parts of TinkerPop are
themselves developed in Groovy. Most notably the Gremlin Console and the Gremlin
Server. The nice thing about that is that we can use Groovy syntax along with Gremlin
when entering queries into the Console or sending them via REST API to a Gremlin
Server. We cover all of these topics in detail in this document.</p>
</div>
<div class="paragraph">
<p>We have tested the queries and other examples in this document against Apache
TinkerPop version 3.2.4 using the TinkerGraph graph and the Gremlin console as well
as some other TinkerPop 3 enabled graph stores.</p>
</div>
</div>
<div class="sect2">
<h3 id="gconsole">2.2. The Gremlin console</h3>
<div class="paragraph">
<p>The Gremlin Console is a fairly standard REPL (Read Execute Print Loop) shell.  It is
based on the Groovy console and if you have used any of the other console
environments such as those found with Scala, Python and Ruby you will feel right at
home here. The Console offers a low overhead (you can set it up in seconds) and low
barrier of entry way to start to play with graphs on your local computer.  The
console can actually work with graphs that are running locally or remotely but for
the majority of this document we will keep things simple and focus on local graphs.</p>
</div>
<div class="paragraph">
<p>To follow along with this tutorial you will need to have installed the Gremlin
console or have access to a TinkerPop3/Gremlin enabled graph store such as
TinkerGraph or Janus Graph.</p>
</div>
<div class="paragraph">
<p>Regardless of the environment you use, if you work with Apache TinkerPop enabled
graphs, the Gremlin console should always be installed on your machine!</p>
</div>
<div class="sect3">
<h4 id="gremlininstall">2.2.1. Downloading, installing and launching the console</h4>
<div class="paragraph">
<p>You can download the Gremlin console from the official Apache TinkerPop website:</p>
</div>
<div class="paragraph">
<p><a href="http://tinkerpop.apache.org/" class="bare">http://tinkerpop.apache.org/</a></p>
</div>
<div class="paragraph">
<p>It only takes a few minutes to get the Gremlin Console installed and running.  You
just download the ZIP file and <em>unzip</em> it and you are all set. TinkerPop 3 also
requires a recent version of Java 8 being installed. I have done all of my testing
using Java 8 version 1.8.0_131. The Gremlin Console will not work with versions prior
to 1.8.0_45. If you do not have Java 8 installed it is easy to find and download off
the Web.</p>
</div>
<div class="paragraph">
<p>When you start Gremlin you will be presented with a banner/logo and a prompt that
will look something like this. Don&#8217;t worry about the plugin messages yet we will talk
about those a bit later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin activated: tinkerpop.server
plugin activated: tinkerpop.utilities
plugin activated: tinkerpop.tinkergraph
gremlin&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You can get a list of the available commands by typing <em>:help</em>. Note that all
commands to the console itself are prefixed by a colon <em>":"</em>. This enables the
console to distinguish them as special and different from actual Gremlin and
Groovy commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gremlin&gt; :help

For information about Groovy, visit:
    http://groovy-lang.org

Available commands:
  :help       (:h  ) Display this help message
  ?           (:?  ) Alias to: :help
  :exit       (:x  ) Exit the shell
  :quit       (:q  ) Alias to: :exit
  import      (:i  ) Import a class into the namespace
  :display    (:d  ) Display the current buffer
  :clear      (:c  ) Clear the buffer and reset the prompt counter
  :show       (:S  ) Show variables, classes or imports
  :inspect    (:n  ) Inspect a variable or the last result with the GUI object browser
  :purge      (:p  ) Purge variables, classes, imports or preferences
  :edit       (:e  ) Edit the current buffer
  :load       (:l  ) Load a file or URL into the buffer
  .           (:.  ) Alias to: :load
  :save       (:s  ) Save the current buffer to a file
  :record     (:r  ) Record the current session to a file
  :history    (:H  ) Display, manage and recall edit-line history
  :alias      (:a  ) Create an alias
  :register   (:rc ) Register a new command with the shell
  :doc        (:D  ) Open a browser window displaying the doc for the argument
  :set        (:=  ) Set (or list) preferences
  :uninstall  (:-  ) Uninstall a Maven library and its dependencies from the Gremlin Console
  :install    (:+  ) Install a Maven library and its dependencies into the Gremlin Console
  :plugin     (:pin) Manage plugins for the Console
  :remote     (:rem) Define a remote connection
  :submit     (:&gt;  ) Send a Gremlin script to Gremlin Server

For help on a specific command type:
    :help command</pre>
</div>
</div>
<div class="paragraph">
<p>It is worth noting that as mentioned above, the Gremlin console is based on the
Groovy console and as such you can enter valid Groovy code directly into the console.
So as well as using it to experiment with Graphs and Gremlin you can use it as, for
example, a desktop calculator should you so desire!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">gremlin</span><span class="tok-o">&gt;</span> <span class="tok-mi">2</span><span class="tok-o">+</span><span class="tok-mi">3</span>
<span class="tok-o">==&gt;</span><span class="tok-mi">5</span>

<span class="tok-n">gremlin</span><span class="tok-o">&gt;</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
<span class="tok-o">==&gt;</span><span class="tok-mi">5</span>

<span class="tok-n">gremlin</span><span class="tok-o">&gt;</span> <span class="tok-n">println</span> <span class="tok-s2">&quot;The number is ${a}&quot;</span>
<span class="tok-n">The</span> <span class="tok-n">number</span> <span class="tok-n">is</span> <span class="tok-mi">5</span>

<span class="tok-n">gremlin</span><span class="tok-o">&gt;</span> <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">a</span> <span class="tok-k">in</span> <span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">5</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-n">print</span> <span class="tok-s2">&quot;${a} &quot;</span><span class="tok-o">};</span><span class="tok-n">println</span><span class="tok-o">()</span>
<span class="tok-mi">1</span> <span class="tok-mi">2</span> <span class="tok-mi">3</span> <span class="tok-mi">4</span> <span class="tok-mi">5</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Gremlin Console does a very nice job of only showing you a nice and tidy
set of query results. If you are working with a graph system that supports TinkerPop
3 but not via the Gremlin console (an example of this would be talking to a Gremlin
Server using the HTTP REST API) then what you will get back is going to be a JSON
document that you will need to write some code to parse. We will explore that topic
much later in this document.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to see lots of examples of the output from running various queries you
will find plenty in the "<a href="#msc">MISCELLANEOUS QUERIES AND THE RESULTS THEY GENERATE</a>" section of this document where we have tried to go
into more depth on various topics.</p>
</div>
<div class="paragraph">
<p>Mostly you will run the Gremlin console in its interactive mode. However you can also
pass the name of a file as a command line parameter, preceded by the <em>-e</em> flag and
Gremlin will execute the file and exit. For example if you had a file called
"mycode.groovy" you could execute it directly from your command line window or
terminal window as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gremlin -e mycode.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>If you wanted to have the console run your script and not exit afterwards, you can
use the <em>-i</em> option instead of <em>-e</em>.</p>
</div>
<div class="paragraph">
<p>You can get help on all of the command line options for the Gremlin console by typing
<em>gremlin --help</em>. You should get back some help text that looks like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gremlin --help

usage: gremlin.sh [options] [...]
  -C, --color                               Disable use of ANSI colors
  -D, --debug                               Enabled debug Console output
  -Q, --quiet                               Suppress superfluous Console
                                            output
  -V, --verbose                             Enable verbose Console output
  -e, --execute=SCRIPT ARG1 ARG2 ...        Execute the specified script
                                            (SCRIPT ARG1 ARG2 ...) and
                                            close the console on
                                            completion
  -h, --help                                Display this help message
  -i, --interactive=SCRIPT ARG1 ARG2 ...    Execute the specified script
                                            and leave the console open on
                                            completion
  -l                                        Set the logging level of
                                            components that use standard
                                            logging output independent of
                                            the Console
  -v, --version                             Display the version</pre>
</div>
</div>
<div class="paragraph">
<p>If you ever want to check which version of TinkerPop you have installed you can enter
the following command from inside the Gremlin console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// What version of Gremlin am I running?</span>
<span class="tok-n">Gremlin</span><span class="tok-o">.</span><span class="tok-na">version</span><span class="tok-o">()</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="gremlinsave">2.2.2. Saving output from the console to a file</h4>
<div class="paragraph">
<p>Sometimes it is useful to save part or all of a console session to a file. You can
turn recording to a file on and off using the <em>:record</em> command.</p>
</div>
<div class="paragraph">
<p>In the following example, we turn recording on using <em>:record start mylog.txt</em> which
will force all commands entered and their output to be written to the file
<em>mylog.txt</em> until the command <em>:record stop</em> is entered.  The command
<em>g.V().count().next()</em> just counts how many vertices (nodes) are in the graph. We
will explain the Gremlin graph traversal and query language in detail starting in the
next section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">gremlin</span><span class="tok-o">&gt;</span> <span class="tok-o">:</span><span class="tok-n">record</span> <span class="tok-n">start</span> <span class="tok-n">mylog</span><span class="tok-o">.</span><span class="tok-na">txt</span>
<span class="tok-n">Recording</span> <span class="tok-n">session</span> <span class="tok-nl">to:</span> <span class="tok-s2">&quot;mylog.txt&quot;</span>

<span class="tok-n">gremlin</span><span class="tok-o">&gt;</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span>
<span class="tok-o">==&gt;</span><span class="tok-mi">3618</span>
<span class="tok-n">gremlin</span><span class="tok-o">&gt;</span> <span class="tok-o">:</span><span class="tok-n">record</span> <span class="tok-n">stop</span>
<span class="tok-n">Recording</span> <span class="tok-n">stopped</span><span class="tok-o">;</span> <span class="tok-n">session</span> <span class="tok-n">saved</span> <span class="tok-k">as</span><span class="tok-o">:</span> <span class="tok-s2">&quot;mylog.txt&quot;</span> <span class="tok-o">(</span><span class="tok-mi">157</span> <span class="tok-n">bytes</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we were to look at the <em>mylog.txt</em> file, this is what it now contains.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// OPENED: Tue Sep 12 10:43:40 CDT 2017
// RESULT: mylog.txt
g.V().count().next()
// RESULT: 3618
:record stop
// CLOSED: Tue Sep 12 10:43:50 CDT 2017</pre>
</div>
</div>
<div class="paragraph">
<p>For the remainder of this document I am not going to show the <em>gremlin&gt;</em> prompt or
the <em>=&#8658;</em> output identifier as part of each example, just to reduce clutter a bit.
You can assume that each command was entered and tested using the Gremlin console
however.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you want to learn more about the console itself you can refer to the official
TinkerPop documentation and, even better, have a play with the console and the built
in help.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tgintro">2.3. Introducing TinkerGraph</h3>
<div class="paragraph">
<p>As well as the Gremlin Console, the TinkerPop 3 download includes an implementation
of an in-memory graph store called TinkerGraph. This document was mostly developed
using TinkerGraph but I also tested everything using Janus Graph. We will introduce
Janus Graph later in the "<a href="#janusintro">Introducing Janus Graph</a>" section. The nice thing about TinkerGraph
is that for learning and testing things you can run everything you need on your
laptop or desktop computer and be up and running very quickly. We will explain how to
get started with the Gremlin Console and TinkerGraph a bit later in this document.</p>
</div>
<div class="paragraph">
<p>Tinkerpop 3 defines a number of capabilities that a graph store should support. Some
are optional others are not. You can query any TinkerPop 3 enabled graph store to see
which features are supported. The following list shows the features supported by
TinkerGraph. This is what you would get back should you call the <em>features</em> method
provided by TinkerGraph. We have arranged the list in two columns to aid readability.
Don&#8217;t worry if not all of these terms makes sense right away - we&#8217;ll get there soon!</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; GraphFeatures                          &gt; VertexPropertyFeatures
&gt;-- ConcurrentAccess: false              &gt;-- UserSuppliedIds: true
&gt;-- ThreadedTransactions: false          &gt;-- StringIds: true
&gt;-- Persistence: true                    &gt;-- RemoveProperty: true
&gt;-- Computer: true                       &gt;-- AddProperty: true
&gt;-- Transactions: false                  &gt;-- NumericIds: true
&gt; VariableFeatures                       &gt;-- CustomIds: false
&gt;-- Variables: true                      &gt;-- AnyIds: true
&gt;-- LongValues: true                     &gt;-- UuidIds: true
&gt;-- SerializableValues: true             &gt;-- Properties: true
&gt;-- FloatArrayValues: true               &gt;-- LongValues: true
&gt;-- UniformListValues: true              &gt;-- SerializableValues: true
&gt;-- ByteArrayValues: true                &gt;-- FloatArrayValues: true
&gt;-- MapValues: true                      &gt;-- UniformListValues: true
&gt;-- BooleanArrayValues: true             &gt;-- ByteArrayValues: true
&gt;-- MixedListValues: true                &gt;-- MapValues: true
&gt;-- BooleanValues: true                  &gt;-- BooleanArrayValues: true
&gt;-- DoubleValues: true                   &gt;-- MixedListValues: true
&gt;-- IntegerArrayValues: true             &gt;-- BooleanValues: true
&gt;-- LongArrayValues: true                &gt;-- DoubleValues: true
&gt;-- StringArrayValues: true              &gt;-- IntegerArrayValues: true
&gt;-- StringValues: true                   &gt;-- LongArrayValues: true
&gt;-- DoubleArrayValues: true              &gt;-- StringArrayValues: true
&gt;-- FloatValues: true                    &gt;-- StringValues: true
&gt;-- IntegerValues: true                  &gt;-- DoubleArrayValues: true
&gt;-- ByteValues: true                     &gt;-- FloatValues: true
&gt; VertexFeatures                         &gt;-- IntegerValues: true
&gt;-- AddVertices: true                    &gt;-- ByteValues: true
&gt;-- DuplicateMultiProperties: true       &gt; EdgePropertyFeatures
&gt;-- MultiProperties: true                &gt;-- Properties: true
&gt;-- RemoveVertices: true                 &gt;-- LongValues: true
&gt;-- MetaProperties: true                 &gt;-- SerializableValues: true
&gt;-- UserSuppliedIds: true                &gt;-- FloatArrayValues: true
&gt;-- StringIds: true                      &gt;-- UniformListValues: true
&gt;-- RemoveProperty: true                 &gt;-- ByteArrayValues: true
&gt;-- AddProperty: true                    &gt;-- MapValues: true
&gt;-- NumericIds: true                     &gt;-- BooleanArrayValues: true
&gt;-- CustomIds: false                     &gt;-- MixedListValues: true
&gt;-- AnyIds: true                         &gt;-- BooleanValues: true
&gt;-- UuidIds: true                        &gt;-- DoubleValues: true
&gt; EdgeFeatures                           &gt;-- IntegerArrayValues: true
&gt;-- RemoveEdges: true                    &gt;-- LongArrayValues: true
&gt;-- AddEdges: true                       &gt;-- StringArrayValues: true
&gt;-- UserSuppliedIds: true                &gt;-- StringValues: true
&gt;-- StringIds: true                      &gt;-- DoubleArrayValues: true
&gt;-- RemoveProperty: true                 &gt;-- FloatValues: true
&gt;-- AddProperty: true                    &gt;-- IntegerValues: true
&gt;-- NumericIds: true                     &gt;-- ByteValues: true
&gt;-- CustomIds: false
&gt;-- AnyIds: true
&gt;-- UuidIds: true</pre>
</div>
</div>
<div class="paragraph">
<p>As TinkerGraph is intended mostly for learning and testing it does not support some
of the more advanced features you will find in Janus Graph such as ACID Transactions
and external indexes. We will cover these topics as part of our discussion of Janus
Graph towards the end of the document. One other thing worth noting in the list above
is that <em>UserSuppliedIds</em> is set to true for vertex and edge ID values. This means
that if you load a graph file, such as a GraphML format file, that specifies ID
values for vertices and edges then TinkerGraph will honor those IDs and use them. As
we shall see later this is not the case with most other graph systems.</p>
</div>
<div class="paragraph">
<p>When running in the Gremlin Console, support for TinkerGraph is off by default. You
can enable it by issuing the following command while inside the Gremlin Console.
Console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">:</span><span class="tok-n">plugin</span> <span class="tok-n">use</span> <span class="tok-n">tinkerpop</span><span class="tok-o">.</span><span class="tok-na">tinkergraph</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the TinkerGraph plugin is enabled you will need to close and re-load the Gremlin
console. After doing that, you can create a new TinkerGraph instance from the console
as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span> <span class="tok-o">=</span> <span class="tok-n">TinkerGraph</span><span class="tok-o">.</span><span class="tok-na">open</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In many cases you will want to pass parameters to the <em>open</em> method that give more
information on how the graph is to be configured. We will explore those options later
in the document. Before you can start to issue Gremlin queries against the graph you
also need to establish a graph traversal object by calling the new graph&#8217;s
<em>traversal</em> method as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Throughout the remainder of this document we will follow the convention that we
will always use the variable name <em>graph</em> for any variable that represents a graph
instance and we will always use the variable name <em>g</em> for any variable that
represents an instance of a graph traversal object.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="air">2.4. Introducing the air-routes graph</h3>
<div class="paragraph">
<p>Along with these notes I have provided what is, in big data terms,a very small, but
nonetheless real World, graph that is written in GraphML, a standard XML format for
describing graphs that can be used to move graphs between applications. The graph,
<em>air-routes.graphml</em> is a model I built of the World airline route network that is
fairly accurate. Of course, in the real World, routes are added and deleted by
airlines all the time so please don&#8217;t use this graph to plan your next vacation or
business trip!  However, as a learning tool I hope you will find it useful and easy
to relate to. If you feel so inclined you can load the file into a text editor and
examine how it is laid out. As you work with graphs you will want to become familiar
with popular graph serialization formats. Two common ones are GraphML and GraphSON.
The latter is a JSON format that is defined by Apache TinkerPop and heavily used in
that environment. GraphML is very widely recognized by TinkerPop and many other tools
as well such as Gephi, a popular open source tool for visualizing graph data.  A lot
of graph ingestion algorithms also sill use comma separated values (CSV) format
files.</p>
</div>
<div class="paragraph">
<p>We will briefly look at loading and saving graph data in Sections 2 and 4. We take a
much deeper look at different ways to work with graph data stored in text format
files including importing and exporting graph data in the "<a href="#serialize">COMMON GRAPH SERIALIZATION FORMATS</a>" section at
the end of this document.</p>
</div>
<div class="paragraph">
<p>The air-routes graph contains several node types that are specified using labels. The
most common ones being <em>airport</em> and <em>country</em>. There are also nodes for each of the
seven continents (<em>continent</em>) and a single <em>version</em> node that I provided as a way
to test which version of the graph you are using.</p>
</div>
<div class="paragraph">
<p>Routes between airports are modeled as edges. These edges carry the <em>route</em> label and
include the distance between the two connected airport nodes as a property called
<em>dist</em>.  Connections between countries and airports are modelled using an edge with a
<em>contains</em> label.</p>
</div>
<div class="paragraph">
<p>Each airport node has many properties associated with it giving various details about
that airport including its IATA and ICAO codes, its description, the city it is in
and its geographic location.</p>
</div>
<div class="paragraph">
<p>Specifically, each airport node has a unique ID, a label of <em>airport</em> and contains
the following properties. The word in parenthesis indicates the type of the property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre> type    (string) : The node's type. Will be 'airport' for airport nodes
 code    (string) : The three letter IATA code like AUS or LHR
 icao    (string) : The four letter ICAO code or none. Example KAUS or EGLL
 desc    (string) : A text description of the airport
 region  (string) : The geographical region like US-TX or GB-ENG
 runways (int)    : The number of available runways
 longest (int)    : Length of the longest runway in feet
 elev    (int)    : Elevation in feet above sea level
 country (string) : Two letter ISO country code such as US, FR or DE.
 city    (string) : The name of the city the airport is in
 lat     (double) : Latitude of the airport
 lon     (double) : Longitude of the airport</pre>
</div>
</div>
<div class="paragraph">
<p>We can use Gremlin once the air route graph is loaded to show us what properties an
airport node has. As an example here is what the airport node with an ID of 3 looks
like. We will explain the steps that make up the Gremlin query later in this
document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Query the properties of vertex 3</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">).</span><span class="tok-na">unfold</span><span class="tok-o">()</span>

<span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-mi">3</span>
<span class="tok-n">label</span><span class="tok-o">=</span><span class="tok-n">airport</span>
<span class="tok-n">type</span><span class="tok-o">=[</span><span class="tok-n">airport</span><span class="tok-o">]</span>
<span class="tok-n">code</span><span class="tok-o">=[</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-n">icao</span><span class="tok-o">=[</span><span class="tok-n">KAUS</span><span class="tok-o">]</span>
<span class="tok-n">desc</span><span class="tok-o">=[</span><span class="tok-n">Austin</span> <span class="tok-n">Bergstrom</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span><span class="tok-o">]</span>
<span class="tok-n">region</span><span class="tok-o">=[</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">]</span>
<span class="tok-n">runways</span><span class="tok-o">=[</span><span class="tok-mi">2</span><span class="tok-o">]</span>
<span class="tok-n">longest</span><span class="tok-o">=[</span><span class="tok-mi">12250</span><span class="tok-o">]</span>
<span class="tok-n">elev</span><span class="tok-o">=[</span><span class="tok-mi">542</span><span class="tok-o">]</span>
<span class="tok-n">country</span><span class="tok-o">=[</span><span class="tok-n">US</span><span class="tok-o">]</span>
<span class="tok-n">city</span><span class="tok-o">=[</span><span class="tok-n">Austin</span><span class="tok-o">]</span>
<span class="tok-n">lat</span><span class="tok-o">=[</span><span class="tok-mf">30.1944999694824</span><span class="tok-o">]</span>
<span class="tok-n">lon</span><span class="tok-o">=[-</span><span class="tok-mf">97.6698989868164</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though the airport node label is <em>airport</em> I chose to also have a property
called <em>type</em> that also contains the string <em>airport</em>. This was done to aid with
indexing when working with other graph database systems and is explained in more
detail later in this document.</p>
</div>
<div class="paragraph">
<p>You may have noticed that the values for each property are represented as lists or
arrays if you prefer, even though each list only contains one element. The reasons
for this will be explored later in this document but the quick explanation is that
this is because TinkerPop allows us to associate a list of values with any vertex
property. We will explore ways that you can take advantage of this capability in the
"<a href="#listprop">Attaching multiple values (lists or sets) to a single property</a>" section.</p>
</div>
<div class="paragraph">
<p>The full details of all the features contained in the air-routes graph can be learned
by reading the comments at the start of the <em>air-routes.graphml</em> file or reading the
README.txt file.</p>
</div>
<div class="paragraph">
<p>The graph currently contains a total of 3,612 nodes and 49,894 edges. Of these 3,367
nodes are airports, and 43,160 of the edges represent routes. While in big data terms
this is really a tiny graph, it is plenty big enough for us to build up and
experiment with some very interesting Gremlin queries.</p>
</div>
<div class="paragraph">
<p>Lastly, here is are some statistics and facts about the air-routes graph. If you want
to see a lot more statistics check the README.txt file that is included with the
air-routes graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Air Routes Graph (v0.77, 2017-Oct-06) contains:
  3,374 airports
  43,400 routes
  237 countries (and dependent areas)
  7 continents
  3,619 total nodes
  50,148 total edges

Additional observations:
  Longest route is between DOH and AKL (9,025 miles)
  Shortest route is between WRY and PPW (2 miles)
  Average route distance is 1,164.747 miles.
  Longest runway is 18,045ft (BPX)
  Shortest runway is 1,300ft (SAB)
  Furthest North is LYR (latitude: 78.2461013793945)
  Furthest South is USH (latitude: -54.8433)
  Furthest East is SVU (longitude: 179.341003418)
  Furthest West is TVU (longitude: -179.876998901)
  Closest to the Equator is MDK (latitude: 0.0226000007242)
  Closest to the Greenwich meridian is LDE (longitude: -0.006438999902457)
  Highest elevation is DCY (14,472 feet)
  Lowest elevation is GUW (-72 feet)
  Maximum airport node degree (routes in and out) is 544 (FRA)
  Country with the most airports: United States (579)
  Continent with the most airports: North America (978)
  Average degree (airport nodes) is 25.726
  Average degree (all nodes) is 25.856</pre>
</div>
</div>
<div class="paragraph">
<p>Here are the Top 15 airports sorted by overall number of routes (in and out). In
graph terminology this is often called the degree of the node or just <em>node degree</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    POS   ID  CODE  TOTAL     DETAILS

     1    52   FRA  (544)  out:272 in:272
     2    70   AMS  (541)  out:269 in:272
     3   161   IST  (540)  out:270 in:270
     4    51   CDG  (524)  out:262 in:262
     5    80   MUC  (474)  out:237 in:237
     6    64   PEK  (469)  out:234 in:235
     7    18   ORD  (464)  out:232 in:232
     8     1   ATL  (464)  out:232 in:232
     9    58   DXB  (458)  out:229 in:229
    10     8   DFW  (442)  out:221 in:221
    11   102   DME  (428)  out:214 in:214
    12    67   PVG  (402)  out:201 in:201
    13    50   LGW  (400)  out:200 in:200
    14    13   LAX  (390)  out:195 in:195
    15    74   MAD  (384)  out:192 in:192</pre>
</div>
</div>
<div class="paragraph">
<p>Throughout this document you will find the Gremlin queries that can be used to
generate many of these statistics.</p>
</div>
</div>
<div class="sect2">
<h3 id="mn">2.5. TinkerPop 3 migration notes</h3>
<div class="paragraph">
<p>There are still a large number of examples on the internet that show the TinkerPop 2
way of doing things. Quite a lot of things changed between TinkerPop 2 and TinkerPop
3. If you were an early adopter and are coming from a TinkerPop 2 environment to a
TinkerPop 3 environment you may find some of the tips in this section helpful. As we
we will explain below, using the <em>sugar</em> plugin will make the migration from TinkerPop 2
easier but it is recommended to learn the full TinkerPop 3 Gremlin syntax and get
used to using that as soon as possible. Using the full syntax will make your queries
a lot more portable to other TinkerPop 3 enabled graph systems.</p>
</div>
<div class="paragraph">
<p>TinkerPop 3 requires a minimum of Java 8 v45. It will not run on earlier versions of
Java 8 based on my testing.</p>
</div>
<div class="sect3">
<h4 id="cr">2.5.1. Creating a TinkerGraph TP2 vs TP3</h4>
<div class="paragraph">
<p>The way that you create a TinkerGraph changed between TinkerPop 2 and 3.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TinkerGraph</span><span class="tok-o">()</span>  <span class="tok-c1">// TinkerPop 2</span>
<span class="tok-n">graph</span> <span class="tok-o">=</span> <span class="tok-n">TinkerGraph</span><span class="tok-o">.</span><span class="tok-na">open</span><span class="tok-o">()</span> <span class="tok-c1">// TinkerPop 3</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ld2">2.5.2. Loading a graphML file TP2 vs TP3</h4>
<div class="paragraph">
<p>If you have previous experience with TinkerPop 2 you may also have noticed that the
way a graph is loaded has changed in TinkerPop 3.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">loadGraphML</span><span class="tok-o">(</span><span class="tok-s1">&#39;air-routes.graphml&#39;</span><span class="tok-o">)</span> <span class="tok-c1">// TinkerPop 2</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">(</span><span class="tok-n">graphml</span><span class="tok-o">()).</span><span class="tok-na">readGraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;air-routes.graphml&#39;</span><span class="tok-o">)</span> <span class="tok-c1">// TinkerPop 3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Gremlin language itself changed quite a bit between TinkerPop 2 and TinkerPop 3.
The remainder of this document only shows TinkerPop 3 examples.</p>
</div>
</div>
<div class="sect3">
<h4 id="sugarplugin">2.5.3. A word about the TinkerPop.sugar plugin</h4>
<div class="paragraph">
<p>The Gremlin console has a set of plug in modules that can be independently enabled or
disabled. Depending upon your use case you may or may not need to manage plugins.</p>
</div>
<div class="paragraph">
<p>TinkerPop 2 enabled by default a plugin called <em>Tinkerpop.sugar</em> that allowed
shorthand forms of queries to be entered when using the Gremlin console. In TinkerPop
3 that plugin is off by default and has to be enabled if you want to continue to use
the same shortcuts that TinkerPop 2 allowed by default.</p>
</div>
<div class="paragraph">
<p>You can enable <em>sugar</em> support from the Gremlin console as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">:</span><span class="tok-n">plugin</span> <span class="tok-n">use</span> <span class="tok-n">tinkerpop</span><span class="tok-o">.</span><span class="tok-na">sugar</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The Gremlin Console remembers which plugins are enabled between restarts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the current revision of this document I have tried to remove any dependence on the
<em>TinkerPop.sugar</em> plugin from the examples presented. By not using Sugar, queries
shown in this document should port very easily to other TinkerPop 3 enabled graph
platforms. A few of the queries may not work on versions of TinkerPop prior to 3.2 as
TinkerPop continues to evolve and new features are being added fairly regularly.</p>
</div>
<div class="paragraph">
<p>The <em>Tinkerpop.sugar</em> plugin allows some queries to be expressed in a more shorthand
or lazy form, often leaving out references to <em>values()</em> and leaving out parenthesis.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// With Sugar enabled</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">.</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">code</span>

<span class="tok-c1">// Without Sugar enabled</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>People Migrating from TinkerPop 2 will find the Sugar plugin helps get your existing
queries running more easily but as a general rule it is recommended to become
familiar with the longhand way of writing queries as that will enable your queries to
run as efficiently as possible on graph stores that support TinkerPop 3. Also, due to
changes introduced with TinkerPop 3, using sugar will not be as performant as using
the normal Gremlin syntax.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<em>In earlier versions of this document many of the examples showed the <em>sugar</em>
form. In the current revision I have tried to remove all use of that form. It&#8217;s
possible that I may have missed a few and I will continue to check for, and fix, any
that got missed. Please let me know if you find any that slipped through the net!</em>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ld">2.6. Loading the air-routes graph using the Gremlin console</h3>
<div class="paragraph">
<p>Here is some code you can load the air routes graph using the gremlin console by
putting it into a file and using <em>:load</em> to load and run it or by entering each line
into the console manually.  These commands will setup the console environment, create
a TinkerGraph graph and load the <em>air-routes.graphml</em> file into it. Some extra
console features are also enabled.</p>
</div>
<div class="paragraph">
<p>These commands create an in-memory TinkerGraph which will use LONG values for the
vertex and edge IDs. TinkerPop 3 introduced the concept of a <em>traversal</em>  so as part
of loading a <em>graph</em> we also setup a traversal called <em>g</em> which we will then refer to
in our subsequent queries of the graph.  The <em>max-iteration</em> option tells the Gremlin
console the maximum number of lines of output that we ever want to see in return from
a  query. The default, if this is not specified, is 100.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can use the <em>max-iteration</em> setting to control how much output the Gremlin
Console displays.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using a different graph environment, if GraphML import is supported, you
can still load the <em>air-routes.graphml</em> file by following the instructions specific
to that system.  Once loaded, the queries below should still work either unchanged or
with minor modifications.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">conf</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BaseConfiguration</span><span class="tok-o">()</span>
<span class="tok-n">conf</span><span class="tok-o">.</span><span class="tok-na">setProperty</span><span class="tok-o">(</span><span class="tok-s2">&quot;gremlin.tinkergraph.vertexIdManager&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;LONG&quot;</span><span class="tok-o">)</span>
<span class="tok-n">conf</span><span class="tok-o">.</span><span class="tok-na">setProperty</span><span class="tok-o">(</span><span class="tok-s2">&quot;gremlin.tinkergraph.edgeIdManager&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;LONG&quot;</span><span class="tok-o">)</span>
<span class="tok-n">graph</span> <span class="tok-o">=</span> <span class="tok-n">TinkerGraph</span><span class="tok-o">.</span><span class="tok-na">open</span><span class="tok-o">(</span><span class="tok-n">conf</span><span class="tok-o">)</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">(</span><span class="tok-n">graphml</span><span class="tok-o">()).</span><span class="tok-na">readGraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;air-routes.graphml&#39;</span><span class="tok-o">)</span>
<span class="tok-n">g</span><span class="tok-o">=</span><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">()</span>
<span class="tok-o">:</span><span class="tok-n">set</span> <span class="tok-n">max</span><span class="tok-o">-</span><span class="tok-n">iteration</span> <span class="tok-mi">1000</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you put the commands given above into a file called something like
<em>mygremlin-setup</em>, once the console is up and running you can load that file by
entering the command below.  Doing this will save you a fair bit of time as each time
you restart the console you can just reload your configuration file and the
environment will be configured and the graph loaded and you can get straight to
writing queries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">:</span><span class="tok-n">load</span> <span class="tok-n">mygremlin</span><span class="tok-o">-</span><span class="tok-n">setup</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As a best practice you should use the full path to the location where the
GraphML file  resides if at all possible to make sure that the GraphML reading code
can find it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have the Gremlin Console up and running and have the graph loaded, if
you feel like it you can cut and paste queries from this document directly into
the console to see them run.</p>
</div>
<div class="paragraph">
<p>Once the air-routes graph is loaded you can enter the following command and you will
get back information about the graph. In the case of a TinkerGraph you will get back
a useful message telling you how many nodes and edges the graph contains. Note that
the contents of this message will vary from one graph system to another and should
not be relied upon as a way to keep tack of node and edge counts. We will look at
some other ways of doing that later in the document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Tell me something about my graph</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using TinkerGraph, the message you get back will look something like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">tinkergraph</span><span class="tok-o">[</span><span class="tok-nl">vertices:</span><span class="tok-mi">3610</span> <span class="tok-nl">edges:</span><span class="tok-mi">49490</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="off">2.7. Turning off some of the Gremlin console&#8217;s output</h3>
<div class="paragraph">
<p>Sometimes, especially when assigning a result to a variable and you are not
interested in seeing all the steps that Gremlin took to get there, the Gremlin
console displays more output than is desirable.  An easy way to prevent this is to
just add an empty list ";[]" to the end of your query as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">a</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">toList</span><span class="tok-o">();[]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_a_word_about_indexes_and_schemas">2.8. A word about indexes and schemas</h3>
<div class="paragraph">
<p>Some graph implementations such as IBM-Graph have strict requirements on the use of
an <em>index</em>. This means that a schema and an index must be in place before you can
work with a graph and that you can only begin a traversal by referencing a property
in the graph that is included in the index. While that is beyond the scope of this
document, it should be pointed out that some of the queries included in this material
will not work on any graph system that requires all queries to be backed by an index
and does not allow what are sometimes called <em>full graph searches</em> for cases where a
particular item in a graph is not backed by an index. One example of this is vertex
and edge <em>labels</em> which are typically not indexed but are sometimes very useful items
to specify at the start of a query.  As the examples in this document are intended to
work just fine with a only basic TinkerGraph the subject of indexes is not covered in
more detail until Section 6 "<a href="#beyond">MOVING BEYOND THE CONSOLE AND TINKERGRAPH</a>" where we will take a look at some other
technologies such as Janus Graph and we do discuss indexing as part of that coverage.
You should always refer to the specific documentation for the graph system you are
using to decide what you need to do about creating an index and schema for your
graph.  We will explain what TinkerGraph is in the next section.</p>
</div>
<div class="paragraph">
<p>In general for any graph, regardless of whether it is optional or not,  use of an
index should be considered a best practice. Even TinkerGraph has a way to create an
index should you want to.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In production systems, especially those where the graphs are large, the task of
creating and managing the index is often handed to an additional software component
such as Apache Solr or Apache Elastic Search.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sq">3. WRITING GREMLIN QUERIES</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you hopefully  have the air-routes graph loaded it&#8217;s time to start writing
some queries!</p>
</div>
<div class="paragraph">
<p>In this section we will begin to look at the Gremlin query language. We will start
off with a quick look at how Gremlin and SQL differ and are yet in some ways similar,
then we will look at some fairly basic queries and finally get into some more
advanced concepts. Hopefully each set of examples presented by building upon things
previously discussed will be easy to understand.</p>
</div>
<div class="sect2">
<h3 id="_introducing_gremlin">3.1. Introducing Gremlin</h3>
<div class="paragraph">
<p>Gremlin is the name of the graph traversal and query language that TinkerPop provides
for working with property graphs. Gremlin can be used with any graph store that is
Apache TinkerPop enabled. Gremlin is a fairly imperative language but also has some
more declarative constructs as well. Using Gremlin we can traverse a graph looking
for values, patterns and relationships we can add or delete nodes and edges, we can
create sub-graphs and lots more.</p>
</div>
<div class="sect3">
<h4 id="_a_quick_look_at_gremlin_and_sql">3.1.1. A quick look at Gremlin and SQL</h4>
<div class="paragraph">
<p>While it is not required to know SQL in order to be productive with Gremlin, if you
do have some experience with SQL you will notice many of the same keywords and
phrases being used in Gremlin. As a simple example the SQL and Gremlin examples below
both show how we might count the number of airports there are in each country using
firstly a relational database and secondly a property graph.</p>
</div>
<div class="paragraph">
<p>When working with a relational database, we might decide to store all of the airport
data in a single table called <em>airports</em>.  In a very simple case (the air routes
graph actually stores a lot more data than this about each airport) we could setup
our airports table so that it had entries for each airport as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ID   CODE  ICAO  CITY             COUNTRY
---  ----  ----  ---------------  ----------
1    ATL   KATL  Atlanta          US
3    AUS   KAUS  Austin           US
8    DFW   KDFW  Dallas           US
47   YYZ   CYYZ  Toronto          CA
49   LHR   EGLL  London           UK
51   CDG   LFPG  Paris            FR
52   FRA   EDDF  Frankfurt        DE
55   SYD   YSSY  Sydney           AU</pre>
</div>
</div>
<div class="paragraph">
<p>We could then use a SQL query to count the
distribution of airports in each country as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span class="tok-k">select</span> <span class="tok-n">country</span><span class="tok-p">,</span><span class="tok-k">count</span><span class="tok-p">(</span><span class="tok-n">country</span><span class="tok-p">)</span> <span class="tok-k">from</span> <span class="tok-n">airports</span> <span class="tok-k">group</span> <span class="tok-k">by</span> <span class="tok-n">country</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can do this in Gremlin using the air-routes graph with a query like the one below
(we will explain what all of this means later on in the document).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will discover that Gremlin provides its own flavor of several constructs that you
will be familiar with if you have used SQL before, but again, prior knowledge of SQL
is in no way required to learn Gremlin.</p>
</div>
<div class="paragraph">
<p>One thing you will not find when working with a graph using Gremlin is the concept of
a SQL <em>join</em>.  Graph databases by their very nature avoid the need to join things
together (as things that need to be connected already are connected) and this is a
core reason why, for many use cases, Graph databases are a very good choice and can
be more performant than relational databases.</p>
</div>
<div class="paragraph">
<p>Graph databases are usually a good choice for storing and modelling networks.  The
air-routes graph is an example of a network graph a social network is of course
another good example. Networks can be modelled using relational databases too but as
you explore the network and ask questions like "who are my friends' friends?" in a
social network or "where can I fly to from here with a maximum of two stops?" things
rapidly get complicated and result in the need for multiple <em>joins</em>.</p>
</div>
<div class="paragraph">
<p>As an example, imagine adding a second table to our relational database called
routes. It will contain three columns representing the source airport, the
destination airport and the distance between them in miles (SRC,DEST and DIST). It
would contain entries that looked like this (the real table would of course have
thousands of rows but this gives a good idea of what the table would look like).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SRC  DEST  DIST
---  ----  ----
ATL  DFW   729
ATL  FRA   4600
AUS  DFW   190
AUS  LHR   4901
BOM  AGR   644
BOM  LHR   4479
CDG  DFW   4933
CDG  FRA   278
CDG  LHR   216
DFW  FRA   5127
DFW  LHR   4736
LHR  BOM   4479
LHR  FRA   406
YYZ  FRA   3938
YYZ  LHR   3544</pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to write a SQL query to calculate the ways of travelling from Austin
(AUS) to Agra (AGR) with two stops, we would end up writing a query that looked
something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span class="tok-k">select</span> <span class="tok-n">a1</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">,</span><span class="tok-n">r1</span><span class="tok-p">.</span><span class="tok-n">dest</span><span class="tok-p">,</span><span class="tok-n">r2</span><span class="tok-p">.</span><span class="tok-n">dest</span><span class="tok-p">,</span><span class="tok-n">r3</span><span class="tok-p">.</span><span class="tok-n">dest</span> <span class="tok-k">from</span> <span class="tok-n">airports</span> <span class="tok-n">a1</span>
  <span class="tok-k">join</span> <span class="tok-n">routes</span> <span class="tok-n">r1</span> <span class="tok-k">on</span> <span class="tok-n">a1</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-o">=</span><span class="tok-n">r1</span><span class="tok-p">.</span><span class="tok-n">src</span>
  <span class="tok-k">join</span> <span class="tok-n">routes</span> <span class="tok-n">r2</span> <span class="tok-k">on</span> <span class="tok-n">r1</span><span class="tok-p">.</span><span class="tok-n">dest</span><span class="tok-o">=</span><span class="tok-n">r2</span><span class="tok-p">.</span><span class="tok-n">src</span>
  <span class="tok-k">join</span> <span class="tok-n">routes</span> <span class="tok-n">r3</span> <span class="tok-k">on</span> <span class="tok-n">r2</span><span class="tok-p">.</span><span class="tok-n">dest</span><span class="tok-o">=</span><span class="tok-n">r3</span><span class="tok-p">.</span><span class="tok-n">src</span>
  <span class="tok-k">where</span> <span class="tok-n">a1</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-o">=</span><span class="tok-s1">&#39;AUS&#39;</span> <span class="tok-k">and</span> <span class="tok-n">r3</span><span class="tok-p">.</span><span class="tok-n">dest</span><span class="tok-o">=</span><span class="tok-s1">&#39;AGR&#39;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using our air-routes graph database the query can be expressed quite simply as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AGR&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding or removing hops is as simple as adding or removing one or more of the <em>out()</em>
steps which is a  lot simpler than having to add additional <em>join</em> clauses to our SQL
query. This is a simple example, but as queries get more and more complicated in
heavily connected data sets like networks, the SQL queries get harder and herder to
write whereas, because Gremlin is designed for working with this type of data,
expressing a traversal remains fairly straightforward.</p>
</div>
<div class="paragraph">
<p>We can go one step further with Gremlin and use <em>repeat</em> to express the concept of
<em>three times</em> as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">()).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AGR&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gremlin also has a <em>repeat &#8230;&#8203; until</em> construct that we will see used later in this
document. When combined with the <em>emit</em> step, <em>repeat</em> provides a nice way of getting
back any routes between a source and destination no matter how many hops it might
take to get there.</p>
</div>
<div class="paragraph">
<p>Again, don&#8217;t worry if some of the Gremlin steps shown here are confusing, we will
cover them all in detail a bit later. The key point to take away from this discussion
of SQL and Gremlin is that for data that is very connected, Graph databases provide a
very good way to store that data and Gremlin provides a nice and fairly intuitive way
to traverse that data efficiently.</p>
</div>
<div class="paragraph">
<p>One other point worthy of note is that every node and every edge in a graph has a
unique ID. Unlike in the relational world where you may or may not decide to give a
table an ID column this is not optional with graph databases. In some cases the ID
can be a user provided ID but more commonly it will be generated by the graph system
when a node or edge is first created. If you are familiar with SQL, you can think of
the ID as a primary key of sorts if you want to.  Every node and ID can be accessed
using it&#8217;s ID.  Just as with relational databases, graph databases can be indexed and
any of the properties contained in a node or an edge can be added to the index and
can be used to find things efficiently. In large graph deployments this greatly
speeds up the process of finding things as you would expect. We look more closely at
IDs in the <a href="#wid">Working with IDs</a> section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bq">3.2. Some fairly basic Gremlin queries</h3>
<div class="paragraph">
<p>A graph <em>query</em> is often referred to as a <em>traversal</em> as that is what we are in fact
doing. We are traversing the graph from a starting point to an ending point.
Traversals consist of one or more <em>steps</em> (essentially methods) that are chained
together.</p>
</div>
<div class="paragraph">
<p>As we start to look at some simple traversals here are a few <em>steps</em> that you will
see used a lot. Firstly, you will notice that almost all traversals start with either
a <em>g.V()</em> or a <em>g.E()</em>. Sometimes there will be parameters specified along with those
steps but we will get into that a little later. You may remember from when we looked
at how to load the <em>air-routes</em> graph in Section 2 we used the following instruction
to create a graph traversal object for our loaded <em>graph</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once we have a graph traversal object we can use it to start exploring the graph.
The <em>V</em> step returns vertices and the <em>E</em> step returns edges. You can also use a <em>V</em>
step in the middle of a traversal as well as at the start but we will examine those
uses a little later. The <em>V</em> and <em>E</em> steps can also take parameters indicating which
set of nodes or edges we are interested in. That usage is explained in the "<a href="#wid">Working with IDs</a>"
section.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If it helps with remembering you can think of <em>g.V()</em> as meaning "looking at all
of the nodes in the graph" and <em>g.E()</em> as meaning "looking at all of the edges in the
graph". We then add additional steps to narrow down our search criteria.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The other steps we need to introduce are the <em>has</em> and <em>hasLabel</em> steps. They can be
used to test for a certain label or property having a certain value. We will
introduce a lot of different Gremlin steps as we build up our Gremlin examples
throughout this document, including may other forms of the <em>has</em> step, but these few
are enough to get us started.</p>
</div>
<div class="paragraph">
<p>You can refer to the official Apache TinkerPop documentation for full details on all
of the graph traversal steps that are used in this tutorial.  With this tutorial I
have not tried to teach every possible usage of every Gremlin step and method,
rather, I have tried to provide a good and approachable foundation in writing many
different types of Gremlin query using an interesting and real world graph.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The latest TinkerPop 3 documentation is always available at this URL:
<a href="http://tinkerpop.apache.org/docs/current/reference/" class="bare">http://tinkerpop.apache.org/docs/current/reference/</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Below are some simple queries against the air-routes graph to get us started. It is
assumed that the air-routes graph has been loaded already per the instructions above.
The query below will return any nodes (vertices) that have the <em>airport</em> label.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find nodes that are airports</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query will return the vertex that represents the Dallas Fort Worth (DFW)
airport.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find the DFW node</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next two queries combine the previous two into a single query. The first one just
chains the queries together. The second shows a form of the <em>has</em> step that we have
not looked at before that takes an additional label value as its first parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Combining those two previous queries (two ways that are equivalent)</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what we gt back from the query. Notice that this is the Gremlin Console&#8217;s way
of telling us we got back the <em>Vertex</em> with an ID of 8.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">8</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So, what we actually got back from these queries was a TinkerPop <em>Vertex</em> data
structure.  Later in this document we will look at ways to store that value into a
variable for additional processing. Remember that even though we are working with a
Groovy environment while inside the Gremlin Console, everything we are working with
here, at its core, is Java code. So we can use the <em>getClass</em> method from Java to
introspect the object. Note the call to <em>next</em> which turns the result of the
traversal into an object we can work with. The <em>next</em> step is one of a series of
steps that the Tinkerpop documentation describes as <em>terminal steps</em>. We will see
more of these <em>terminal steps</em> in use throughout this document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">getClass</span><span class="tok-o">()</span>

<span class="tok-kd">class</span> <span class="tok-nc">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">tinkerpop</span><span class="tok-o">.</span><span class="tok-na">gremlin</span><span class="tok-o">.</span><span class="tok-na">tinkergraph</span><span class="tok-o">.</span><span class="tok-na">structure</span><span class="tok-o">.</span><span class="tok-na">TinkerVertex</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could even add a call to <em>getMethods()</em> at the end of the query above to get back
a list of all the methods and their types supported by the <em>TinkerVertex</em> class.</p>
</div>
<div class="sect3">
<h4 id="values">3.2.1. Retrieving property values from a node</h4>
<div class="paragraph">
<p>There are several different ways of working with node properties. We can add, delete
and query properties for any node or edge in the graph. We will explore each of these
topics in detail over the course of this document. Initially, let&#8217;s look at a couple
of simple ways that we can look up the property values of a given node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// What property values are stored in the DFW node?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output that the query returns. Note that we just get back the values of
the properties when using the <em>values</em> step, we do not get back the associated keys.
We will see how to do that later in the document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">US</span>
<span class="tok-n">DFW</span>
<span class="tok-mi">13401</span>
<span class="tok-n">Dallas</span>
<span class="tok-mi">607</span>
<span class="tok-n">KDFW</span>
<span class="tok-o">-</span><span class="tok-mf">97.0380020141602</span>
<span class="tok-n">airport</span>
<span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span>
<span class="tok-mi">7</span>
<span class="tok-mf">32.896800994873</span>
<span class="tok-n">Dallas</span><span class="tok-o">/</span><span class="tok-n">Fort</span> <span class="tok-n">Worth</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>values</em> step can take parameters that tell it to only returned the values for
the provided key names. The queries below return the values of some specific
properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Return just the city name property</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span>

<span class="tok-n">Dallas</span>

<span class="tok-c1">// Return the &#39;runways&#39; and &#39;icao&#39; property values.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">)</span>

<span class="tok-n">KDFW</span>
<span class="tok-mi">7</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="exist">3.2.2. Does a specific property exist on a given node or edge?</h4>
<div class="paragraph">
<p>You can simply test to see if a property exists as well as testing for it containing
a specific value. To do this we can just provide <em>has</em> with the name of the property
we are interested in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find all edges that have a &#39;dist&#39; property</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Find all vertices that have a &#39;region&#39; property</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Find all the vertices that do not have a &#39;region&#39; property</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasNot</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// The above is shorthand for</span>
 <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">not</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">))</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="count">3.2.3. Counting things</h4>
<div class="paragraph">
<p>A common need when working with graphs is to be able to count how "many of something"
there are in the graph. We will look in the next section at other ways to count
groups of things but first of all let&#8217;s look at some examples of using the <em>count</em>
step to count how many of various things there are in our air-routes graph. First of
all lets find out how many nodes in the graph represent airports.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many airports are there in the graph?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">3374</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, looking at edges that have a <em>route</em> label, let&#8217;s find out how many flight
routes are stored in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many routes are there?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">43400</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could shorten the above a little as follows but this would caue more edges to get
looked as as we do not first filter out all nodes that are not airports.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many routes are there?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could also do it this way but generally starting by looking at all the Edges in
the graph is considered bad form as property graphs tend to have a lot more edges
than nodes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many routes are there?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have not yet looked at the <em>outE</em> step used above. We will look at it very soon
however in the "<a href="#walk">Starting to walk the graph</a>" section.</p>
</div>
</div>
<div class="sect3">
<h4 id="count">3.2.4. Counting groups of things</h4>
<div class="paragraph">
<p>Sometimes it is useful to count how many of each type (or group) of things there are
in the graph. This can be done using the <em>group</em> and <em>groupCount</em> steps. While for a
very large graph it is not recommended to run queries that look at all of the nodes
or all of the edges in a graph, for smaller graphs this can be quite useful. For the
air routes graph we could easily count the number of different node and edge types in
the graph as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many of each type of node are there?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we were to run the query we would get back a map where the keys are label names
and the values are the counts for the occurrence of each label in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">continent:</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-nl">country:</span><span class="tok-mi">237</span><span class="tok-o">,</span><span class="tok-nl">version:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">airport:</span><span class="tok-mi">3374</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are other ways we could write the query above that will yield the same result.
One such example is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many of each type of node are there?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">label</span><span class="tok-o">().</span><span class="tok-na">groupCount</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also run a similar query to find out the distribution of edge labels in the
graph. An example of the type of result we would get back is also shown.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many of each type of edge are there?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">contains:</span><span class="tok-mi">6748</span><span class="tok-o">,</span><span class="tok-nl">route:</span><span class="tok-mi">43400</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As before we could rewrite the query as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many of each type of edge are there?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">label</span><span class="tok-o">().</span><span class="tok-na">groupCount</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By way of a side note, the examples above are shorthand ways of writing
something like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// As above but using group()</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">count</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can be more selective in how we specify the groups of things that we want to
count. In the examples below we first count how many airports there are in each
country. This will return a map of key:value pairs where the key is the country code
and the value is the number of airports in that country. As the fourth and fifth
examples show, we can use <em>select</em> to pick just a few values from the whole group
that got counted. Of course if we only wanted a single value we could just count the
airports connected to that country directly but the last two examples are intended to
show that you can count a group of things and still selectively only look at part of
that group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many airports are there in each country?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// How many airports are there in each country? (look at country first)</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can easily find out how many airports there are in each continent using <em>group</em> to
build a map of continent codes and the number of airports in that continent. The
output from running the query is shown below also.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many airports are there in each continent?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span>

<span class="tok-o">[</span><span class="tok-nl">EU:</span><span class="tok-mi">583</span><span class="tok-o">,</span><span class="tok-nl">AS:</span><span class="tok-mi">932</span><span class="tok-o">,</span><span class="tok-nl">NA:</span><span class="tok-mi">978</span><span class="tok-o">,</span><span class="tok-nl">OC:</span><span class="tok-mi">284</span><span class="tok-o">,</span><span class="tok-nl">AF:</span><span class="tok-mi">294</span><span class="tok-o">,</span><span class="tok-nl">AN:</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-nl">SA:</span><span class="tok-mi">303</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These queries show how <em>select</em> can be used to extract specific values from the map
that we have created. Again you can see the results we get from running the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many airports in there in France (having first counted all countries)</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;FR&#39;</span><span class="tok-o">)</span>

<span class="tok-mi">59</span>

<span class="tok-c1">// How many airports are there in France, Greece and Belgium respectively?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;FR&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;GR&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;BE&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">FR:</span><span class="tok-mi">58</span><span class="tok-o">,</span><span class="tok-nl">GR:</span><span class="tok-mi">39</span><span class="tok-o">,</span><span class="tok-nl">BE:</span><span class="tok-mi">5</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>group</em> and <em>groupCount</em> steps are very useful when you want to count
groups of things or collect things into group using a selection criteria.  You
will find a lot more examples of grouping and counting things in the section called
"<a href="#countmore">Counting more things</a>".</p>
</div>
</div>
<div class="sect3">
<h4 id="walk">3.2.5. Starting to walk the graph</h4>
<div class="paragraph">
<p>So far we have mostly just explored queries that look at properties on a node or count
how many things we can find of a certain type. Where the power of a graph really
comes into play is when we start to <em>walk</em> or <em>traverse</em> the graph by looking at the
connections (edges) between nodes. The term <em>walking the graph</em> is used to describe
moving from one node to another node via an edge. Typically when using the phrase
<em>walking a graph</em> the intent is to describe starting at a node traversing one or more
nodes and edges and ending up at a different node or sometimes, back where you
started in the case of a <em>circular walk</em>. It is very easy to traverse a graph in this
way using Gremlin. The journey we took while on our <em>walk</em> is often referred to as
our <em>path</em>. There are also cases when all you want to do is return edges or some
combination of nodes and edges as the result of a query and Gremlin allows this as
well. We will explore a lot of ways to modify the way a graph is traversed in the
upcoming sections.  To get us started, here are some simple examples.</p>
</div>
<div class="paragraph">
<p>The <em>out</em> step is used to find vertices connected by an outgoing edge to that node
and the <em>outE</em> <em>step</em> is used to explore outgoing edges from a given node. Conversely
the <em>in</em> and <em>inE</em> steps can be used to look for incoming nodes and edges. The <em>outE</em>
and <em>inE</em> steps are especially useful when you want to look at the properties of an
edge. There are several other steps that we can use when traversing a graph to move
between nodes and edges. We will encounter those in the "<a href="#otherv">Other ways to explore nodes and edges using <em>both</em>, <em>bothE</em>, <em>bothV</em> and <em>otherV</em></a>" section of this
document.</p>
</div>
<div class="paragraph">
<p>This first query does a few interesting things. Firstly we find the node representing
the Austin airport (the airport with a property of <em>code</em> containing the value <em>AUS</em>).
Having found that node we then go <em>out</em> from there. This will find all of the nodes
connected to Austin by an outgoing edge. Having found those airports we then ask for
the values of their <em>code</em> properties using the <em>values</em> step. Finally the <em>fold</em>
step puts all of the results into a list for us. This just makes it easier for us to
inspect the results in the console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Where can I fly to from Austin?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what you might get back if you were to run this query in your console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">YYZ</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-n">FRA</span><span class="tok-o">,</span> <span class="tok-n">MEX</span><span class="tok-o">,</span> <span class="tok-n">PIT</span><span class="tok-o">,</span> <span class="tok-n">PDX</span><span class="tok-o">,</span> <span class="tok-n">CLT</span><span class="tok-o">,</span> <span class="tok-n">CUN</span><span class="tok-o">,</span> <span class="tok-n">MEM</span><span class="tok-o">,</span> <span class="tok-n">CVG</span><span class="tok-o">,</span> <span class="tok-n">IND</span><span class="tok-o">,</span> <span class="tok-n">MCI</span><span class="tok-o">,</span> <span class="tok-n">DAL</span><span class="tok-o">,</span> <span class="tok-n">STL</span><span class="tok-o">,</span> <span class="tok-n">ABQ</span><span class="tok-o">,</span> <span class="tok-n">MDW</span><span class="tok-o">,</span> <span class="tok-n">LBB</span><span class="tok-o">,</span> <span class="tok-n">HRL</span><span class="tok-o">,</span> <span class="tok-n">GDL</span><span class="tok-o">,</span> <span class="tok-n">PNS</span><span class="tok-o">,</span> <span class="tok-n">VPS</span><span class="tok-o">,</span> <span class="tok-n">SFB</span><span class="tok-o">,</span> <span class="tok-n">BKG</span><span class="tok-o">,</span> <span class="tok-n">PIE</span><span class="tok-o">,</span> <span class="tok-n">ATL</span><span class="tok-o">,</span> <span class="tok-n">BNA</span><span class="tok-o">,</span> <span class="tok-n">BOS</span><span class="tok-o">,</span> <span class="tok-n">BWI</span><span class="tok-o">,</span> <span class="tok-n">DCA</span><span class="tok-o">,</span> <span class="tok-n">DFW</span><span class="tok-o">,</span> <span class="tok-n">FLL</span><span class="tok-o">,</span> <span class="tok-n">IAD</span><span class="tok-o">,</span> <span class="tok-n">IAH</span><span class="tok-o">,</span> <span class="tok-n">JFK</span><span class="tok-o">,</span> <span class="tok-n">LAX</span><span class="tok-o">,</span> <span class="tok-n">MCO</span><span class="tok-o">,</span> <span class="tok-n">MIA</span><span class="tok-o">,</span> <span class="tok-n">MSP</span><span class="tok-o">,</span> <span class="tok-n">ORD</span><span class="tok-o">,</span> <span class="tok-n">PHX</span><span class="tok-o">,</span> <span class="tok-n">RDU</span><span class="tok-o">,</span> <span class="tok-n">SEA</span><span class="tok-o">,</span> <span class="tok-n">SFO</span><span class="tok-o">,</span> <span class="tok-n">SJC</span><span class="tok-o">,</span> <span class="tok-n">TPA</span><span class="tok-o">,</span> <span class="tok-n">SAN</span><span class="tok-o">,</span> <span class="tok-n">LGB</span><span class="tok-o">,</span> <span class="tok-n">SNA</span><span class="tok-o">,</span> <span class="tok-n">SLC</span><span class="tok-o">,</span> <span class="tok-n">LAS</span><span class="tok-o">,</span> <span class="tok-n">DEN</span><span class="tok-o">,</span> <span class="tok-n">MSY</span><span class="tok-o">,</span> <span class="tok-n">EWR</span><span class="tok-o">,</span> <span class="tok-n">HOU</span><span class="tok-o">,</span> <span class="tok-n">ELP</span><span class="tok-o">,</span> <span class="tok-n">CLE</span><span class="tok-o">,</span> <span class="tok-n">OAK</span><span class="tok-o">,</span> <span class="tok-n">PHL</span><span class="tok-o">,</span> <span class="tok-n">DTW</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All edges in a graph have a label. However, one thing we did not do in the previous
query was specify a label for the <em>out</em> step.  If you do not specify a label you will
get back any connected vertex regardless of its edge label. In this case it does not
cause us a problem as airports only have one type of outgoing edge, labeled <em>route</em>.
However, in many cases in graphs you create or are working with your nodes may be
connected to other nodes by edges with edges with differing labels so it is good
practice to get into the habit of specifying edge labels as part of your gremlin
queries. So we could change our query just a bit by adding a label reference on the
<em>out</em> step as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Where can I fly to from Austin?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Despite having just stated consistently referencing labels is a good idea, unless you
truly do want to get back all edges or all connected nodes, I will break my own rule
quite a bit in this document. The reason for this is purely to save space and make
the queries I present shorter.</p>
</div>
<div class="paragraph">
<p>Here are a few more simple queries similar to the previous one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Where can I fly to from Austin, with one stop on the way?</span>
<span class="tok-c1">// Note that, as written, coming back to Austin will be included</span>
<span class="tok-c1">// in the results as this query does not rule it out!</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// What routes come in to LCY?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LCY&#39;</span><span class="tok-o">).</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Flights from London Heathrow (LHR) to airports in the USA</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pathintro">3.2.6. What nodes and edges did I visit? - Introducing <em>path</em></h4>
<div class="paragraph">
<p>A Gremlin method (often called a step) that you will see used a lot in this
document is <em>path</em>. After you have done some graph walking using a query you
can use <em>path</em> to get a summary back of where you went. Here is a simple
example of <em>path</em> being used. Throughout the document you will see numerous
examples of <em>path</em> being used including in conjunction with <em>by</em> to specify
how the path should be formatted. This particular query will return the nodes
and outgoing edges starting at the LCY airport node. You can read this query
like this: "Start at the LCY node, find all outgoing edges and also find all
of the nodes that are on the other ends of those edges".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// This time, for each route, return both nodes and the edge that connects them.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LCY&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run that query as-is you will get back a series of results that look
like this. This shows that there is a route from vertex 88 to vertex 77 via an
edge with an ID of 13208.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">88</span><span class="tok-o">],</span><span class="tok-n">e</span><span class="tok-o">[</span><span class="tok-mi">13208</span><span class="tok-o">][</span><span class="tok-mi">88</span><span class="tok-o">-</span><span class="tok-n">route</span><span class="tok-o">-&gt;</span><span class="tok-mi">77</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">77</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While this is useful, we might want to return something more human readable
such as the IATA codes for each airport and perhaps the distance property from
the edge that tells us how far apart the airports are. We could add some <em>by</em>
modulators to our query to do this. Take a look at the modified query and an
example of the results that it will now return. The <em>by</em> modulators are
processed in a round robin fashion. So even though there are three values we
want to have formatted, we only need to specify two <em>by</em> modulators as both
the first and third values are the same. If all three were different, say for
example that the third value was a different property like a city name then we
would have to provide an explicit <em>by</em> modulator for it. If this is not fully
clear yet don&#8217;t panic. Both <em>path</em> and <em>by</em> are used a lot throughout this
document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LCY&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">LCY</span><span class="tok-o">,</span><span class="tok-mi">468</span><span class="tok-o">,</span><span class="tok-n">GVA</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="edgeexist">3.2.7. Does an edge exist between two nodes?</h4>
<div class="paragraph">
<p>You can use the <em>hasNext</em> step to check if an edge exists between two nodes and
get a Boolean (true or false) value back. The first query below will return
<strong>true</strong> because there is an edge (a route) between AUS and DFW. The second
query will return <strong>false</strong> because there is no route between AUS and SYD.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">hasNext</span><span class="tok-o">()</span>

<span class="tok-kc">true</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SYD&#39;</span><span class="tok-o">).</span><span class="tok-na">hasNext</span><span class="tok-o">()</span>

<span class="tok-kc">false</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="limit">3.2.8. Limiting the amount of data returned</h4>
<div class="paragraph">
<p>It is sometimes useful, especially when dealing with large graphs, to limit
the amount of data that is returned from a query. As shown in the examples
below, this can be done using the <em>limit</em> and <em>tail</em> steps. A little later in
this document we also introduce the <em>coin</em> step that allows a pseudo random
sample of the data to be returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Only return the FIRST 20 results</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">)</span>

<span class="tok-c1">// Only return the LAST 20 results</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">tail</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending upon the implementation, it is probably more efficient to write the
query like this, with <em>limit</em> coming before <em>values</em> to guarantee less airports
are initially returned  but it is also possible that an implementation would
optimize both the same way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Only return the FIRST 20 results</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <em>limit</em> provides a shorthand alternative to <em>range</em>. The first of
the two examples above could have been written as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Only return the FIRST 20 results</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">range</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">20</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also limit based on time taken. The following query has a maximum limit of ten
milliseconds. All of the parts of this query are explained in detail later on in this
document but I think what they do is fairly clear.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Limit the query to however much can be processed within 10 milliseconds</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">)</span>
     <span class="tok-o">.</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">timeLimit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">()).</span><span class="tok-na">until</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">)).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_retrieving_a_range_of_nodes">3.2.9. Retrieving a range of nodes</h4>
<div class="paragraph">
<p>Gremlin provides various ways to return a sequence of nodes. We have already seen the
<em>limit</em> and <em>range</em> steps used in the previous section to return the first 20
elements of a query result. We can also use the <em>range</em> step to select different
range of nodes by giving a non zero starting offset and an ending offset. The <em>range</em>
offsets are zero based, and while the official documentation states that the ranges
are inclusive/inclusive it actually appears from my testing that they are
inclusive/exclusive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Return the first two airport nodes found</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">range</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">)</span>

<span class="tok-c1">// Return the fourth, fifth and sixth airport nodes found (zero based)</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">range</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">)</span>

<span class="tok-c1">// Return all the remaining nodes starting at the 3500th one</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">range</span><span class="tok-o">(</span><span class="tok-mi">3500</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There is no guarantee as to which airport nodes will be selected as
this depends upon how they are stored by the back end graph. Using Tinkergraph the
airports will most likely come back in the order they are put into the graph. This is
not likely to be the case with other graph stores such as Titan and IBM Graph. So do
not rely on any sort of expectation of order when using <em>range</em> to process sets of
nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are many other ways to specify a range of values using Gremlin. You will find
several additional examples in the "<a href="#tranges">Testing values and ranges of values</a>" section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_em_as_em_em_select_em_and_em_project_em_to_name_and_refer_back_to_prior_steps">3.2.10. Using <em>as</em>, <em>select</em> and <em>project</em> to name and refer back to prior steps</h4>
<div class="paragraph">
<p>Sometimes it is useful to be able to remember a point of a traversal and refer back
to it later on. This ability was more essential in TinkerPop 2 than it is in
TinkerPop 3 but it still has many uses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;from&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-CA&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;to&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;from&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;to&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query, while a bit contrived, and in reality a poor substitute for using <em>path</em>
returns the following results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">ONT</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">PSP</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">SJC</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">SAN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">SNA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">OAK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">SMF</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">FAT</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">SBA</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While the prior example was perhaps not ideal, it does show how <em>as</em> and <em>select</em>
work. For completeness, here is the same query but using <em>path</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-CA&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which would produce the following results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">ONT</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">PSP</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">SJC</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">SAN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">SNA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">OAK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">SMF</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">FAT</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">SBA</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also give a point of a traversal multiple names and refer to each later on in
the traversal/query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;type&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the most recent releases of TinkerPop you can also use the new <em>project</em> step and
achieve the same results that you can get from the combination of <em>as</em> and
<em>select</em> steps. The example below shows the previous query, rewritten to use <em>project</em>
instead of <em>as</em> and <em>select</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;type&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">project</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query, and the prior query, would return the following results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">GA</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-mi">232</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ANC</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">AK</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-mi">39</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-mi">59</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">BNA</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TN</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-mi">55</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">BOS</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">MA</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-mi">129</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">BWI</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">MD</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-mi">89</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">DCA</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">DC</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-mi">93</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-mi">221</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">FLL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">FL</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-mi">141</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">IAD</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">VA</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-mi">136</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the prior example we gave our variables simple names like <em>a</em> and <em>b</em>. However, it
is sometimes useful to give our traversal variables more meaningful names and it is
perfectly OK to do that. Let&#8217;s rewrite the query to use some more descriptive variable
names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;type&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">project</span><span class="tok-o">(</span><span class="tok-s1">&#39;IATA&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Routes&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run the modified query, here is the output we get.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">IATA:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">Region:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">GA</span><span class="tok-o">,</span><span class="tok-nl">Routes:</span><span class="tok-mi">232</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">IATA:</span><span class="tok-n">ANC</span><span class="tok-o">,</span><span class="tok-nl">Region:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">AK</span><span class="tok-o">,</span><span class="tok-nl">Routes:</span><span class="tok-mi">39</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">IATA:</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-nl">Region:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">,</span><span class="tok-nl">Routes:</span><span class="tok-mi">59</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">IATA:</span><span class="tok-n">BNA</span><span class="tok-o">,</span><span class="tok-nl">Region:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TN</span><span class="tok-o">,</span><span class="tok-nl">Routes:</span><span class="tok-mi">55</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">IATA:</span><span class="tok-n">BOS</span><span class="tok-o">,</span><span class="tok-nl">Region:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">MA</span><span class="tok-o">,</span><span class="tok-nl">Routes:</span><span class="tok-mi">129</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">IATA:</span><span class="tok-n">BWI</span><span class="tok-o">,</span><span class="tok-nl">Region:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">MD</span><span class="tok-o">,</span><span class="tok-nl">Routes:</span><span class="tok-mi">89</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">IATA:</span><span class="tok-n">DCA</span><span class="tok-o">,</span><span class="tok-nl">Region:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">DC</span><span class="tok-o">,</span><span class="tok-nl">Routes:</span><span class="tok-mi">93</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">IATA:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">Region:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">,</span><span class="tok-nl">Routes:</span><span class="tok-mi">221</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">IATA:</span><span class="tok-n">FLL</span><span class="tok-o">,</span><span class="tok-nl">Region:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">FL</span><span class="tok-o">,</span><span class="tok-nl">Routes:</span><span class="tok-mi">141</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">IATA:</span><span class="tok-n">IAD</span><span class="tok-o">,</span><span class="tok-nl">Region:</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">VA</span><span class="tok-o">,</span><span class="tok-nl">Routes:</span><span class="tok-mi">136</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="vm">3.3. Using <em>valueMap</em> to explore the properties of a node or element</h3>
<div class="paragraph">
<p>A call to <em>valueMap</em> will return all of the properties of a node or element as an
array of key:value pairs. Basically a hash map. Each element in the map can be
addressed using the name of the key. By default the ID and label are not included in
the map unless a parameter of <em>true</em> is provided.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Return all the properties and values the AUS node has</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using the Gremlin console, the output from running the previous command
should look something like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">country:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">],</span> <span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">],</span> <span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">12248</span><span class="tok-o">],</span> <span class="tok-nl">city:</span><span class="tok-o">[</span><span class="tok-n">Austin</span><span class="tok-o">],</span> <span class="tok-nl">elev:</span><span class="tok-o">[</span><span class="tok-mi">542</span><span class="tok-o">],</span> <span class="tok-nl">icao:</span><span class="tok-o">[</span><span class="tok-n">KAUS</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">97.6698989868164</span><span class="tok-o">],</span> <span class="tok-nl">type:</span><span class="tok-o">[</span><span class="tok-n">airport</span><span class="tok-o">],</span> <span class="tok-nl">region:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">],</span> <span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">30.1944999694824</span><span class="tok-o">],</span> <span class="tok-nl">desc:</span><span class="tok-o">[</span><span class="tok-n">Austin</span> <span class="tok-n">Bergstrom</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Notice how each key like <em>country</em> is followed by a value that is returned as
an element of a list. This is because it is possible (for nodes but not for edges) to
provide more than one property value for a given key by encoding them as a list.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here are some more examples of how <em>valueMap</em> can be used. If a parameter of <em>true</em>
is provided, then the results returned will include the ID and label of the element
being examined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// If you also want the ID and label, add a parameter of true</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">country:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">],</span><span class="tok-nl">id:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">12250</span><span class="tok-o">],</span><span class="tok-nl">city:</span><span class="tok-o">[</span><span class="tok-n">Austin</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">97.6698989868164</span><span class="tok-o">],</span><span class="tok-nl">type:</span><span class="tok-o">[</span><span class="tok-n">airport</span><span class="tok-o">],</span><span class="tok-nl">elev:</span><span class="tok-o">[</span><span class="tok-mi">542</span><span class="tok-o">],</span><span class="tok-nl">icao:</span><span class="tok-o">[</span><span class="tok-n">KAUS</span><span class="tok-o">],</span><span class="tok-nl">region:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">],</span><span class="tok-nl">label:</span><span class="tok-n">airport</span><span class="tok-o">,</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">30.1944999694824</span><span class="tok-o">],</span><span class="tok-nl">desc:</span><span class="tok-o">[</span><span class="tok-n">Austin</span> <span class="tok-n">Bergstrom</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also mix use of <em>true</em> along with requesting the map for specific properties.
The next example will just return the ID, label and <em>region</em> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// If you want the ID, label and a specific field like the region, you can do this</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">,</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">id:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">region:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">],</span><span class="tok-nl">label:</span><span class="tok-n">airport</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The last example selects three properties to be in the value map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// You can select specific fields from a value map</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">().</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">],</span><span class="tok-nl">icao:</span><span class="tok-o">[</span><span class="tok-n">KAUS</span><span class="tok-o">],</span><span class="tok-nl">desc:</span><span class="tok-o">[</span><span class="tok-n">Austin</span> <span class="tok-n">Bergstrom</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="var">3.4. Assigning query results to a variable</h3>
<div class="paragraph">
<p>It is extremely useful to be able to assign the results of a query to a variable. The
example below stores the results of the <em>valueMap()</em> call shown above into a variable
called <em>aus</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Store the properties for the AUS aiport in the variable aus.</span>
<span class="tok-n">aus</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
It is necessary to add a call to <em>next</em> to the end of the query in order for
this to work. Forgetting to add the call to <em>next</em> is a very commonly made mistake by
people getting used to the Gremlin query language. The call to <em>next</em> terminates the
traversal part of the query and generates a concrete result that can be stored in a
variable.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have some results in a variable you can refer to it as you would in any
other programming language that supports key:value type maps and dictionaries.  We
will explore mixing Java and Groovy code with your Gremlin queries later in this
document. For now we will just show the Groovy <em>println</em> command being used to
display the results of the query that we stored in <em>aus</em>. We will take a deeper look
at the use of variables with Gremlin later in the document when we look at mixing
Gremlin and Groovy in the "<a href="#grv">Making Gremlin even Groovier</a>" section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// We can now refer to aus using key:value syntax</span>
<span class="tok-n">println</span> <span class="tok-s2">&quot;The AUS airport is located in &quot;</span> <span class="tok-o">+</span> <span class="tok-n">aus</span><span class="tok-o">[</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span>

<span class="tok-n">The</span> <span class="tok-n">AUS</span> <span class="tok-n">airport</span> <span class="tok-n">is</span> <span class="tok-n">located</span> <span class="tok-k">in</span> <span class="tok-n">Austin</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Because properties are stored as arrays of values. Even if there is only one
property value for the given key, we still have to add the <em>[0]</em> when referencing it
otherwise the whole array will be returned if we just used <em>aus['city']</em>. We
will explore why property values are stored in this way in the "<a href="#listprop">Attaching multiple values (lists or sets) to a single property</a>"
section.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="wid">3.5. Working with IDs</h3>
<div class="paragraph">
<p>Every node and every edge in a graph has a unique ID that can be used to reference
them individually or as a group. Beware that the IDs you provide when loading a graph
from a GraphML or GraphSON file may not in many cases end up being the IDs that the
back-end graph store actually uses as it builds up your graph.  Tinkergraph for
example will preserve user provided IDs but most systems like Janus Graph or
IBM-Graph generate their own IDs. The same is true when you add nodes and edges using
a graph traversal or using the TinkerPop API. This is a long winded way of saying
that you should not depend on the IDs in your GraphML or GraphSON file that you just
loaded remaining unchanged once the data has been loaded into the graph store.  When
you add new a node or edge to your graph, the graph system will automatically
generate a new, unique ID for it.  If you need to figure out the ID for a node or an
edge you can always get it from a query of the graph itself!</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Don&#8217;t rely on the graph preserving the ID values you provide. Write code that
can query the graph itself for ID values.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Especially when dealing with large graphs, because using IDs is typically very
efficient, you will find that many of your queries will involve collecting one or
more IDs and then passing those on to other queries or parts of the same query. In
most if not all cases, the underlying graph system will have setup it&#8217;s data
structures, whether on disk or in memory, to be very rapidly accessed by ID value.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s demonstrate the use of ID values using a few simple examples. The query below
finds the ID, which is 8, for the node that represents the DFW airport.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"> <span class="tok-c1">// What is the ID of the &quot;DFW&quot; node?</span>
 <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">id</span><span class="tok-o">()</span>

 <span class="tok-mi">8</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s reverse the query and find the code for the node with an ID of 8.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Simple lookup by ID</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-mi">8</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">DFW</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also have also written the above query as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// which is the same as this</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are some more examples that make use of the ID value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Nodes with an ID between 1 and 5 (note this is inclusive/exclusive)</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">))</span>

<span class="tok-c1">// Which is an alternate form of this</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">))</span>

<span class="tok-c1">// Find routes from the node with an ID of 6 to any node with an ID less than 46</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-mi">6</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-mi">46</span><span class="tok-o">)).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Which is the same as</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-mi">6</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-mi">46</span><span class="tok-o">)).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also pass a single ID or multiple IDs directly into the <em>V()</em> step.
Take a look at the two examples below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// What is the code property for the node with an ID of 3?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">AUS</span>

<span class="tok-c1">// As above but for all of the specified node IDs</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">,</span><span class="tok-mi">15</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">AUS</span>
<span class="tok-n">BWI</span>
<span class="tok-n">DFW</span>
<span class="tok-n">MCO</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also pass a list of ID values into the <em>V</em> step. We take a closer look at
using variables in this way in the "<a href="#varaus">Using a variable to feed a traversal</a>" section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">a</span><span class="tok-o">=[</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">,</span><span class="tok-mi">15</span><span class="tok-o">]</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Every property in the graph also has an ID as we shall explore in the "<a href="#propid">Properties have IDs too</a>"
section.</p>
</div>
</div>
<div class="sect2">
<h3 id="lab">3.6. Working with labels</h3>
<div class="paragraph">
<p>It&#8217;s a good idea when designing a graph to give the nodes and edges meaningful
labels. You can use these to help refine searches. For example in the air-routes
graph, every airport node is labelled <em>airport</em> and every country node, not
surprisingly, is labelled <em>country</em>. Similarly, edges that represent a flight route
are labelled <em>route</em>. You can use labels in many ways. We already saw the hasLabel()
step being used in the basic queries section to test for a particular label. Here are
a few more examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// What label does the LBB node have?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LBB&#39;</span><span class="tok-o">).</span><span class="tok-na">label</span><span class="tok-o">()</span>

<span class="tok-c1">// What airports are located in Australia?  Note that &#39;contains&#39; is an</span>
<span class="tok-c1">// edge label and &#39;country&#39; is a node label.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AU&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// We could also write this query as follows</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AU&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By using labels in this way we can effectively group nodes and edges into classes or
types.  Imagine if we wanted to build a graph containing different types of vehicles.
We might decide to label all the nodes just <em>vehicle</em> but we could decide to use
labels such as <em>car</em>, <em>truck</em> and <em>bus</em>. Ultimately the overall design of your
graph&#8217;s data model will dictate the way you use labels but it is good to be aware of
their value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As useful as labels are, in larger graph deployments when indexing technology
such as Solr or Elastic Search is often used to speed up traversing the graph, node
labels typically do not get indexed. Therefore, it is currently recommended that an
actual node property that can be indexed is used when walking a graph rather than
relying on the node&#8217;s label. This is especially important when working with large
graphs where performance can become an issue.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here are a few more examples of ways we can work with labels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// You can explicitly reference a node&#39;s label using the label() method</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">))).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-c1">// But you would normally just use the hasLabel() method in this case of course</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-c1">// How many non airport nodes are there?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">))).</span><span class="tok-na">count</span>

<span class="tok-c1">// Again, it would be more natural to actually write this query like this:</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">not</span><span class="tok-o">(</span><span class="tok-n">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-c1">// The same basic concepts apply equally to edges</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">))).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course we have already seen another common place where labels might get used.
Namely in the three parameter form of <em>has</em> as in the example below. The first
parameter is the label value. The next two parameters test the properties of all
nodes that have the <em>airport</em> label for a code of "<em>SYD</em>".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SYD&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="local">3.7. Using the <em>local</em> step to make sure we get the result we intended</h3>
<div class="paragraph">
<p>Sometimes it is important to be able to do calculations based on the current state of
a traversal rather than waiting until near the end. A common place where this is
necessary is when calculating the average value of a collection. In the next section
we are going to look at a selection of numerical and statistical operations that
Gremlin allows us to perform. However, for now lets use the <em>mean</em> step to calculate
the average of something and look at the effect the <em>local</em> step has on the
calculation. The <em>mean</em> step works just like you would expect, it returns the mean,
or average, value for a set of numbers.</p>
</div>
<div class="paragraph">
<p>If we wanted to calculate the average number of routes from an airport, the first
query that we would write might look like the one below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">mean</span><span class="tok-o">()</span>

<span class="tok-mf">43400.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the answer we got back, <em>42760.0</em> looks wrong, and indeed it is. That
number is in fact the total number of outgoing routes in the entire graph. This is
because as written the query counts all of the routes, adds them all up, but does not
keep track of how many airports it visited. This means that calling the <em>mean</em> step
is essentially the same as dividing the count by one.</p>
</div>
<div class="paragraph">
<p>So how do we fix this? The answer is to use the <em>local</em> step. What we really want to
do is to create, in essence, a collection of values, where each value is the route
count for just one airport. Having done that, we want to divide the sum of all of
these numbers by the number of members ,airports in this case, int the collection.</p>
</div>
<div class="paragraph">
<p>Take a look at the modified query below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Average number of outgoing routes from an airport.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">local</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">mean</span><span class="tok-o">()</span>

<span class="tok-mf">12.863070539419088</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The result this time is a much more believable answer. Notice how this time we placed
the <em>out().(<em>'route</em>').count()</em> steps inside a <em>local</em> step. The query below,
with the mean step removed, shows what is happening during the traversal as this
query runs. I truncated the output to just show a few lines.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">local</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>

<span class="tok-mi">232</span>
<span class="tok-mi">38</span>
<span class="tok-mi">59</span>
<span class="tok-mi">55</span>
<span class="tok-mi">129</span>
<span class="tok-mi">87</span>
<span class="tok-mi">93</span>
<span class="tok-mi">220</span>
<span class="tok-mi">141</span>
<span class="tok-mi">135</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What this shows is that for the first ten airports the collection that we are
building up contains one entry for each airport that represents the number of
outgoing routes that airport has. Then, when we eventually apply the <em>mean</em> step it
will calculate the average value of our entire collection and give us back the result
that we were looking for.</p>
</div>
<div class="paragraph">
<p>There are other ways that <em>local</em> can be used. We will see examples of those
throughout the document including how local can be used as a parameter to the <em>order</em>
step when we dig deeper into route analysis in the ""<a href="#meanmode">Distribution of routes in the graph (mode and mean)</a> section of the
document.</p>
</div>
</div>
<div class="sect2">
<h3 id="st">3.8. Basic statistical and numerical operations</h3>
<div class="paragraph">
<p>The following queries demonstrate concepts such as calculating the number of a
particular item that is present in the graph, calculating the average (mean) of a set
of values and calculating a maximum or minimum value. We will dig a bit deeper into
some of these capabilities and explain in more detail in the "<a href="#meanmode">Distribution of routes in the graph (mode and mean)</a>" section
of the document. Some of these examples also take advantage of the <em>local</em> step that
was introduced in the previous section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many routes are there from Austin?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;AUS&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-c1">// Sum of values - total runways of all airports</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">sum</span><span class="tok-o">()</span>

<span class="tok-c1">// Statistical mean (average) value - average number of runways per airport</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">mean</span><span class="tok-o">()</span>

<span class="tok-c1">// Average number of routes to and from an airport</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">local</span><span class="tok-o">(</span><span class="tok-n">both</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">mean</span><span class="tok-o">()</span>

<span class="tok-c1">//maximum value - longest runway</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">).</span><span class="tok-na">max</span><span class="tok-o">()</span>

<span class="tok-c1">// What is the biggest number of outgoing routes any airport has?</span>
 <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">local</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">max</span><span class="tok-o">()</span>

<span class="tok-c1">//minimum value - shortest runway</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">).</span><span class="tok-na">min</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="tranges">3.8.1. Testing values and ranges of values</h4>
<div class="paragraph">
<p>We have already seen some ways of testing whether a value is within a certain range.
Gremlin provides a number of different steps that we can use to do range testing. The
list below provides a summary of the available steps. We will see each of these in use
throughout this document.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Steps that test values or ranges of values</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">eq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">neq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">gt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">gte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than or equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">lt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">lte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than or equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">inside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inside a lower and upper bound, neither bound is included.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside a lower and upper bound, neither bound is included.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">between</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Between two values inclusive/exclusive (upper bound is excluded)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">within</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must match at least one of the values provided. Can be a range or a list</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">without</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must not match any of the values provided. Can be a range or a list</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following queries demonstrate these capabilities being used in different ways.
First of all, here are some examples of some of the direct compare steps such as <em>gt</em>
and <em>gte</em> being used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Airports with at least 5 runways</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">gte</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-c1">// Airports with less than 3 runways</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-c1">// How many airports have 3 runways?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-c1">// How many airports have anything but just 1 runway?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are examples of <em>inside</em> and <em>outside</em> being used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Airports with greater than 3 but less than 6 runways.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">inside</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Airports with less than  3 or more than 6 runways.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">outside</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples of <em>within</em> and <em>without</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Airports with at least 3 but not more than 6 runways</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">..</span><span class="tok-mi">6</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">15</span><span class="tok-o">)</span>

<span class="tok-c1">// Airports with 1,2 or 3 runways.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">15</span><span class="tok-o">)</span>

<span class="tok-c1">// Airports with less than 3 or more than 6 runways.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">without</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">..</span><span class="tok-mi">6</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">15</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>between</em> step lets us test the provided value for being greater than or equal to
a lower bound but less than an upper bound. The query below will find any airport
that has 5,6 or 7 runways. In other words, any airport that has at least 5 but less
than 8 runways.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Airports with at least 5 runways but less than 8</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with many queries we may build, there are several ways to get the same answer.
Each of the following queries will return the same result. To an extent which one
you use comes down to personal preference although in some cases one form of a query
may be better than another for reasons of performance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)).</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">lte</span><span class="tok-o">(</span><span class="tok-mi">46</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">lte</span><span class="tok-o">(</span><span class="tok-mi">46</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">46</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">lte</span><span class="tok-o">(</span><span class="tok-mi">46</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">46</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-mi">1L</span><span class="tok-o">..</span><span class="tok-mi">46L</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">47</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">lte</span><span class="tok-o">(</span><span class="tok-mi">46</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">46</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">47</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">inside</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">47</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">lte</span><span class="tok-o">(</span><span class="tok-mi">46</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The values do not have to be numbers. We could also compare strings for
example.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s now look at a query that compares strings rather than numbers. The following
query finds all airports located in the state of Texas in the United States but only
returns their code if the name of the city the airport is located in is not <em>Houston</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;Houston&#39;</span><span class="tok-o">)).</span>
      <span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query can be used to find routes between Austin and Las Vegas. We use a
<em>within</em> step to limit the results we get back to just routes that have a plane
change in Dallas, San Antonio or Houston airports.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span>
       <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DAL&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;IAH&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;HOU&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SAT&#39;</span><span class="tok-o">)).</span>
       <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAS&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what the query returns. Looks like we can change planes in Dallas or Houston
but nothing goes via San Antonio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">DAL</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">HOU</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Conversely, if we wanted to avoid certain airports we could use <em>without</em> instead.
This query again finds routes from Austin to Las Vegas but avoids any routes that go
via Phoenix (PHX) or Los Angeles (LAX).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span>
       <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">without</span><span class="tok-o">(</span><span class="tok-s1">&#39;PHX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">)).</span>
       <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAS&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly this query uses both within and without to modify the previous query to just
airports within the United States or Canada as Austin now has a direct flight to
London in England we probably don&#8217;t want to go that way if we are headed to Vegas!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;CA&#39;</span><span class="tok-o">)).</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">without</span><span class="tok-o">(</span><span class="tok-s1">&#39;PHX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAS&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>within</em> and <em>without</em> steps can take a variety of input types. For example, each
of these queries will yield the same results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Range of values (inclusive, inclusive)</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">3</span><span class="tok-o">))</span>

<span class="tok-c1">// Explicit set of values</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">))</span>

<span class="tok-c1">// List of values</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">within</span><span class="tok-o">([</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">]))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will find more examples of these types of queries in the next section.</p>
</div>
</div>
<div class="sect3">
<h4 id="winout">3.8.2. Refining flight routes analysis using <em>not</em>, <em>neq</em>, <em>within</em> and <em>without</em></h4>
<div class="paragraph">
<p>As we saw in the previous section, it is often useful to be able to specifically
include or exclude values from a query.  We have already seen a few examples of
<em>within</em> and <em>without</em> being used in the section above. The following examples show
additional queries that use <em>within</em> and <em>without</em> as well as some examples that use
the <em>neq</em> (not equal) and <em>not</em> steps to exclude certain airports from query results.</p>
</div>
<div class="paragraph">
<p>The following query finds routes from AUS to SYD with only one stop but ignores any
routes that stop in DFW.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">)).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SYD&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also have written the query using <em>not</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">not</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">)).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SYD&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to the above but adding an <em>and</em> clause to also avoid LAX</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">and</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">)),</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">))).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SYD&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also have written the prior query this way replacing <em>and</em> with <em>without</em>
This approach feels a lot cleaner and it is easy to add more airports to the
<em>without</em> test as needed. We will look more at steps like <em>and</em> in the "<a href="#bool">Boolean operations</a>"
section that is coming up soon.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Flights to Sydney avoiding DFW and LAX</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">without</span><span class="tok-o">(</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">)).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SYD&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <em>without</em> is especially useful when you want to exclude a list of items from a
query. This next query finds routes from San Antonio to Salt Lake City with one stop
but avoids any routes that pass through a list of specified airports.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How can I get from SAT to SLC but avoiding DFW,LAX,PHX and JFK ?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SAT&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">without</span><span class="tok-o">(</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;PHX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;JFK&#39;</span><span class="tok-o">)).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SLC&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In a similar way, <em>within</em> allows us to specifically give a list of things that we
are interested in. The query below again looks from routes from SAT to SLC with one
stop but this time only returns routes that stop in one of the designated airports.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// From AUS to SLC with a stop in any one of DFW,LAX,PHX or TUS</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SAT&#39;</span><span class="tok-o">).</span>
       <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;PHX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;TUS&#39;</span><span class="tok-o">)).</span>
       <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SLC&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what the query returns.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">SAT</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-n">SLC</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SAT</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">SLC</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are two more examples that use <em>without</em> and <em>within</em> to find routes based on
countries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Flights from Austin to countries outside (without) the US and Canada</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-n">without</span><span class="tok-o">(</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;CA&#39;</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output from running the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">London</span>
<span class="tok-n">Frankfurt</span>
<span class="tok-n">Mexico</span> <span class="tok-n">City</span>
<span class="tok-n">Cancun</span>
<span class="tok-n">Guadalajara</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a twist on the previous query that looks for destinations in Mexico or Canada
that you can fly to non stop from Austin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Flights from Austin to airports in (within) Mexico or Canada</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;MX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;CA&#39;</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is what we get back from our new query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Toronto</span>
<span class="tok-n">Mexico</span> <span class="tok-n">City</span>
<span class="tok-n">Cancun</span>
<span class="tok-n">Guadalajara</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_em_coin_em_and_em_sample_em_to_sample_a_dataset">3.8.3. Using <em>coin</em> and <em>sample</em> to sample a dataset</h4>
<div class="paragraph">
<p>In any sort of analysis work it is often useful to be able to take a sample, perhaps
a pseudo random sample, of the data set contained within your graph. The <em>coin</em> step
allows you to do just that. It simulates a biased coin toss. You give <em>coin</em> a value
indicating how biased the toss should be. The value should be between 0 and 1, where
0 means there is no chance something will get picked (not that useful!), 1 means
everything will get picked (also not that useful!) and 0.5 means there is an even
50/50 chance that an item will get selected.</p>
</div>
<div class="paragraph">
<p>The following query simply picks airports with a 50/50 coin toss and returns the
airport code for the first 20found.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Pick 20 airports at random with an evenly biased coin (50% chance).</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">coin</span><span class="tok-o">(</span><span class="tok-mf">0.5</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query is similar to the first but takes a subtly different approach.
It will select a pseudo random sample of nodes from the graph and for each one
picked return its code and its elevation. Note that a very small value of
0.05 (or 5% chance of success) is used for the <em>coin</em> bias parameter this
time.  This has the effect that only a small number of nodes are likely to get
selected but there is a better chance they will come from all parts of the
graph and avoids needing a <em>limit</em> step. Of course, there is no guarantee how
many airports this query will pick!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Select some nodes at random and return them with their elevation.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">coin</span><span class="tok-o">(</span><span class="tok-mf">0.05</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;elev&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see how fairly the <em>coin</em> step is working by counting the number of nodes
returned. The following query should always return a count representing approximately
half of the airports in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">coin</span><span class="tok-o">(</span><span class="tok-mf">0.5</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If all you want is, say 20 randomly selected nodes, without worrying about
setting the value of the coin yourself, you can use the <em>sample</em>
step instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">sample</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_em_math_random_em_to_more_randomly_select_a_single_node">3.8.4. Using <em>Math.random</em> to more randomly select a single node</h4>
<div class="paragraph">
<p>While the <em>sample</em> step allows you to select one or more vertices at random, in my
testing, at least when using a TinkerGraph,  it tends to favor vertices with lower
index values. So for example, in a test I ran this query 1000 times.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">sample</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">).</span><span class="tok-na">id</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What I found was that I always got back an ID of less than 200. This leads me to
believe that the <em>sample(1)</em> call is doing something similar to this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">coin</span><span class="tok-o">(</span><span class="tok-mf">0.01</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Look at the code below. Even if I run that simple experiment many times always gives
results similar to these.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">each</span> <span class="tok-o">{</span> <span class="tok-n">println</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">sample</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">).</span><span class="tok-na">id</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()}</span>

<span class="tok-mi">69</span>
<span class="tok-mi">143</span>
<span class="tok-mi">94</span>
<span class="tok-mi">115</span>
<span class="tok-mi">36</span>
<span class="tok-mi">47</span>
<span class="tok-mi">23</span>
<span class="tok-mi">22</span>
<span class="tok-mi">129</span>
<span class="tok-mi">67</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the air routes graph has over 3,300 airport nodes I wanted to come up with a
query that gave a more likely result of picking any one airport from across all of
the possible airports in the graph. By taking advantage of the Java Math class we can
do something that does seem to much more <em>randomly</em> pick one airport from across all
of the possible airports. Take a look at the snippets of Groovy/Gremlin code below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
More examples of using variables to store values and other ways to use
additional Groovy classes and methods with Gremlin are provided in the "<a href="#grv">Making Gremlin even Groovier</a>" and
"<a href="#varaus">Using a variable to feed a traversal</a>" sections.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many airports are there?</span>
<span class="tok-n">numAirports</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-mi">3374</span>

<span class="tok-c1">// Pick a random airport ID</span>
<span class="tok-n">x</span><span class="tok-o">=</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">round</span><span class="tok-o">(</span><span class="tok-n">numAirports</span><span class="tok-o">*</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">())</span> <span class="tok-k">as</span> <span class="tok-n">Integer</span>

<span class="tok-mi">2359</span>

<span class="tok-c1">// Get the code for our randomly selected airport</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">x</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">PHO</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This simple experiment shows that the numbers being generated using the <em>Math.random</em>
approach appears to be a lot more evenly distributed across all of the possible airports.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">each</span> <span class="tok-o">{</span> <span class="tok-n">println</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">round</span><span class="tok-o">(</span><span class="tok-n">numAirports</span><span class="tok-o">*</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">())</span> <span class="tok-k">as</span> <span class="tok-n">Integer</span><span class="tok-o">}</span>

<span class="tok-mi">1514</span>
<span class="tok-mi">18</span>
<span class="tok-mi">3087</span>
<span class="tok-mi">1292</span>
<span class="tok-mi">3062</span>
<span class="tok-mi">2772</span>
<span class="tok-mi">2401</span>
<span class="tok-mi">400</span>
<span class="tok-mi">2084</span>
<span class="tok-mi">3028</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this approach only works unmodified with the air-routes graph loaded into a
TinkerGraph. This is because we know that the TinkerGraph implementation honors user
provided IDs and that in the air routes graph, airport IDs begin at one and are
sequential with no gaps. However, you could easily modify this approach to work with
other graphs without relying on knowing that the index values are sequential. For
example you could extract all of the IDs into a list and then select one randomly
from that list.</p>
</div>
<div class="paragraph">
<p>It is likely that this apparent lack of randomness is more specific to TinkerGraph
and the fact that it will respect user provided ID values whereas other graph systems
will probably store nodes in a more random order to begin with.  Indeed when I ran
these queries on Janus graph the <em>sample</em> step did indeed yield a better selection of
airports from across the graph.</p>
</div>
<div class="paragraph">
<p>If the airport IDs were not all known to be in a sequential order one after the
other, we could create a list of all the airport IDs and then select one at random by
doing do something like this if we wanted to use our <em>Math.random</em> technique.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">airports</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">id</span><span class="tok-o">().</span><span class="tok-na">toList</span><span class="tok-o">()</span>

<span class="tok-n">numAirports</span> <span class="tok-o">=</span> <span class="tok-n">airports</span><span class="tok-o">.</span><span class="tok-na">size</span>

<span class="tok-mi">3374</span>

<span class="tok-n">x</span><span class="tok-o">=</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">round</span><span class="tok-o">(</span><span class="tok-n">numAirports</span><span class="tok-o">*</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">())</span> <span class="tok-k">as</span> <span class="tok-n">Integer</span>

<span class="tok-mi">859</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">airports</span><span class="tok-o">[</span><span class="tok-n">x</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">])</span>

<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">859</span><span class="tok-o">]</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">airports</span><span class="tok-o">[</span><span class="tok-n">x</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">]).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">OSR</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sort">3.9. Sorting things</h3>
<div class="paragraph">
<p>You can use <em>order</em> to sort things in either ascending (the default) or descending
order.Note that the sort does not have to be the last step of a query. It is
perfectly OK to sort things in the middle of a query before moving on to a further
step. We can see examples of that in the first two queries below. Note that the first
query will return different results than the second one. I used <em>fold</em> at the end of
the query to collect all of the results into a nice list. The <em>fold</em> step can also do
more than this. It provides a way of doing the <em>reduce</em> part of map-reduce
operations. We will see some other examples of its use elsewhere in this document
such as in the "<a href="#mapreduce">Using <em>fold</em> to do simple Map-Reduce computations</a>" section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Sort the first 20 airports returned in ascending order</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-n">ANC</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">BNA</span><span class="tok-o">,</span><span class="tok-n">BOS</span><span class="tok-o">,</span><span class="tok-n">BWI</span><span class="tok-o">,</span><span class="tok-n">DCA</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">FLL</span><span class="tok-o">,</span><span class="tok-n">IAD</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-n">LGA</span><span class="tok-o">,</span><span class="tok-n">MCO</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">,</span><span class="tok-n">MSP</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">,</span><span class="tok-n">PBI</span><span class="tok-o">,</span><span class="tok-n">PHX</span><span class="tok-o">]</span>


<span class="tok-c1">// Sort all of the airports in the graph by their code and then return the first 20</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-n">AAE</span><span class="tok-o">,</span><span class="tok-n">AAL</span><span class="tok-o">,</span><span class="tok-n">AAN</span><span class="tok-o">,</span><span class="tok-n">AAQ</span><span class="tok-o">,</span><span class="tok-n">AAR</span><span class="tok-o">,</span><span class="tok-n">AAT</span><span class="tok-o">,</span><span class="tok-n">AAX</span><span class="tok-o">,</span><span class="tok-n">AAY</span><span class="tok-o">,</span><span class="tok-n">ABA</span><span class="tok-o">,</span><span class="tok-n">ABB</span><span class="tok-o">,</span><span class="tok-n">ABD</span><span class="tok-o">,</span><span class="tok-n">ABE</span><span class="tok-o">,</span><span class="tok-n">ABI</span><span class="tok-o">,</span><span class="tok-n">ABJ</span><span class="tok-o">,</span><span class="tok-n">ABL</span><span class="tok-o">,</span><span class="tok-n">ABM</span><span class="tok-o">,</span><span class="tok-n">ABQ</span><span class="tok-o">,</span><span class="tok-n">ABR</span><span class="tok-o">,</span><span class="tok-n">ABS</span><span class="tok-o">,</span><span class="tok-n">ABT</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default a sort performed using <em>order</em> is performed in ascending order. If we
wanted to sort in descending order instead we can specify <em>decr</em> as a parameter to
<em>order</em>. We can also specify <em>incr</em> if we want to be clear that we intend an
ascending order sort.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Sort the first 20 airports returned in descending order</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-n">PHX</span><span class="tok-o">,</span><span class="tok-n">PBI</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">,</span><span class="tok-n">MSP</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">,</span><span class="tok-n">MCO</span><span class="tok-o">,</span><span class="tok-n">LGA</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-n">IAD</span><span class="tok-o">,</span><span class="tok-n">FLL</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">DCA</span><span class="tok-o">,</span><span class="tok-n">BWI</span><span class="tok-o">,</span><span class="tok-n">BOS</span><span class="tok-o">,</span><span class="tok-n">BNA</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">ANC</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also sort things into a random order using <em>shuffle</em>. Take a look at the
example below and the output it produces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">shuffle</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-n">MCO</span><span class="tok-o">,</span><span class="tok-n">LGA</span><span class="tok-o">,</span><span class="tok-n">BWI</span><span class="tok-o">,</span><span class="tok-n">IAD</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">BOS</span><span class="tok-o">,</span><span class="tok-n">DCA</span><span class="tok-o">,</span><span class="tok-n">BNA</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">,</span><span class="tok-n">MSP</span><span class="tok-o">,</span><span class="tok-n">ANC</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">,</span><span class="tok-n">PBI</span><span class="tok-o">,</span><span class="tok-n">FLL</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-n">PHX</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is an example where we combine the field we want to sort by <em>longest</em>
and the direction we want the sort to take, <em>decr</em> into a single <em>by</em> instruction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// List the 10 airports with the longest runways in decreasing order.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">,</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">().</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output from running the query. To save space I have split the results
into two columns.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">BPX</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">18045</span><span class="tok-o">]]</span>    <span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">DOH</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">15912</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">RKZ</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">16404</span><span class="tok-o">]]</span>    <span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">GOQ</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">15748</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">ULY</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">16404</span><span class="tok-o">]]</span>    <span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">HRE</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">15502</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">UTN</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">16076</span><span class="tok-o">]]</span>    <span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">FIH</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">15420</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">DEN</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">16000</span><span class="tok-o">]]</span>    <span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">ZIA</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">15092</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, let&#8217;s look at another way we could have coded the query we used earlier to
find the longest runway in the graph. As you may recall, we used the following
query.While the query does indeed find the longest runway in the graph. If we wanted
to know which airport or airports had runways of that length we would have to run a
second query to find them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">).</span><span class="tok-na">max</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we know how to sort things we could write a slightly more complex query that
sorts all the airports by longest runway in descending order and returns the
<em>valueMap</em> for the first of those. While this query could probably be written more
efficiently and also improved to handle cases where more than one airport has the
longest runway, it provides a nice example of using <em>order</em> to find an airport that
we are interested in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">),</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of the air-routes graph there is only one airport with the longest
runway. The runway at the Chinese city of Bangda is 18,045 feet long. The reason the
runway is so long is due to the altitude of the airport which is located 14,219 feet
above sea level. Aircraft need a lot more runway to operate safely at that altitude!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">country:</span><span class="tok-o">[</span><span class="tok-n">CN</span><span class="tok-o">],</span> <span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">BPX</span><span class="tok-o">],</span> <span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">18045</span><span class="tok-o">],</span> <span class="tok-nl">city:</span><span class="tok-o">[</span><span class="tok-n">Bangda</span><span class="tok-o">],</span> <span class="tok-nl">elev:</span><span class="tok-o">[</span><span class="tok-mi">14219</span><span class="tok-o">],</span> <span class="tok-nl">icao:</span><span class="tok-o">[</span><span class="tok-n">ZUBD</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-mf">97.1082992553711</span><span class="tok-o">],</span> <span class="tok-nl">type:</span><span class="tok-o">[</span><span class="tok-n">airport</span><span class="tok-o">],</span> <span class="tok-nl">region:</span><span class="tok-o">[</span><span class="tok-n">CN</span><span class="tok-o">-</span><span class="tok-mi">54</span><span class="tok-o">],</span> <span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">30.5536003112793</span><span class="tok-o">],</span> <span class="tok-nl">desc:</span><span class="tok-o">[</span><span class="tok-n">Qamdo</span> <span class="tok-n">Bangda</span> <span class="tok-n">Airport</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_sorting_by_key_or_value">3.9.1. Sorting by key or value</h4>
<div class="paragraph">
<p>Sometimes, when the results of a query are a set of one or more key:value pairs, we
need to sort by either the key or the value in either ascending or descending order.
Gremlin offers us four ways that we can control the sort in these cases. The four
keywords are <em>keyIncr</em>, <em>keyDecr</em>, <em>valueIncr</em> and <em>valueDecr</em>.</p>
</div>
<div class="paragraph">
<p>The following shows the difference between running the query with and without the use
of <em>order</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">BNA:</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">],</span><span class="tok-nl">ANC:</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">],</span><span class="tok-nl">BOS:</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">],</span><span class="tok-nl">ATL:</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">],</span><span class="tok-nl">AUS:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]]</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">keyIncr</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">ANC:</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">],</span><span class="tok-nl">ATL:</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">],</span><span class="tok-nl">AUS:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">],</span><span class="tok-nl">BNA:</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">],</span><span class="tok-nl">BOS:</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we make the numbers of runways the key field and sort on it in
descending order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">keyDecr</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">:[</span><span class="tok-n">DFW</span><span class="tok-o">],</span><span class="tok-mi">6</span><span class="tok-o">:[</span><span class="tok-n">BOS</span><span class="tok-o">],</span><span class="tok-mi">5</span><span class="tok-o">:[</span><span class="tok-n">ATL</span><span class="tok-o">],</span><span class="tok-mi">4</span><span class="tok-o">:[</span><span class="tok-n">BNA</span><span class="tok-o">,</span><span class="tok-n">IAD</span><span class="tok-o">],</span><span class="tok-mi">3</span><span class="tok-o">:[</span><span class="tok-n">ANC</span><span class="tok-o">,</span><span class="tok-n">BWI</span><span class="tok-o">,</span><span class="tok-n">DCA</span><span class="tok-o">],</span><span class="tok-mi">2</span><span class="tok-o">:[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">FLL</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bool">3.10. Boolean operations</h3>
<div class="paragraph">
<p>Gremlin provides a set of logical operators such as <em>and</em>, <em>or</em> and <em>not</em> that can be
used to form Boolean (true/false) type queries. In a lot of cases I find that <em>or</em>
can be avoided by using <em>within</em> for example and that <em>not</em> can be sometimes avoided
by using <em>without</em> but it is still good to know that these operators exist.  The
<em>and</em> operator can sometimes be avoided by chaining <em>has</em> steps together. That said
there are always cases where having these boolean steps available is extremely
useful.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Simple example of doing a Boolean AND operation</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">and</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">),</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;KAUS&#39;</span><span class="tok-o">))</span>

<span class="tok-c1">// Simple example of doing a Boolean OR operation</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">or</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">),</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;KDFW&#39;</span><span class="tok-o">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <em>and</em> in an infix way as follows so long as you only want to <em>and</em>
two traversals together.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">and</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;KAUS&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you would probably expect, an <em>or</em> step can have more than two choices. This one
below has four. Also, note that in practice, for this query, using <em>within</em> would be
a better approach but this suffices as an example of a bigger <em>or</em> expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">or</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">),</span>
                             <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-LA&#39;</span><span class="tok-o">),</span>
                             <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-AZ&#39;</span><span class="tok-o">),</span>
                             <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-OK&#39;</span><span class="tok-o">))</span>
                          <span class="tok-o">.</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-n">incr</span><span class="tok-o">)</span>
                          <span class="tok-o">.</span><span class="tok-na">valueMap</span><span class="tok-o">().</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <em>within</em> the example above could be written like this so always keep in mind
that using <em>or</em> may not always be the best approach to use for a given query.  We
will look more closely at the <em>within</em> and <em>without</em> steps in the following section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-LA&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-AZ&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-OK&#39;</span><span class="tok-o">)).</span>
                          <span class="tok-n">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-n">incr</span><span class="tok-o">).</span>
                          <span class="tok-n">valueMap</span><span class="tok-o">().</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next example uses an <em>and</em> step to find airports in Texas with a runway at least
12,000 feet long.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">and</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">),</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">,</span><span class="tok-n">gte</span><span class="tok-o">(</span><span class="tok-mi">12000</span><span class="tok-o">))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the <em>or</em> step, using <em>and</em> is not always necessary. We could rewrite the
previous query as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">,</span><span class="tok-n">gte</span><span class="tok-o">(</span><span class="tok-mi">12000</span><span class="tok-o">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gremlin also provides a <em>not</em> step which works as you would expect. This query finds
nodes that are not airports?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">not</span><span class="tok-o">(</span><span class="tok-n">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This previous query could also be written as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Depending on the model of your graph and the query itself it may or may not make
sense to use the boolean steps. Sometimes, as described above chaining <em>has</em> steps
together may be more efficient or using <em>within</em> and <em>without</em> my make more sense.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Boolean steps such as <em>and</em> can also be dot combined as the example below shows. This
query finds all the airports that have less than 100 outbound routes but more than 95
and returns them grouped by airport code and route count. Notice how in this case the
<em>and</em> step is added to the <em>lt</em> step using a dot rather than having the <em>and</em> be the
containing step for the whole test. The results from running the query are shown
below as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">).</span><span class="tok-na">and</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">95</span><span class="tok-o">)))).</span>
      <span class="tok-n">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span>

<span class="tok-o">[</span><span class="tok-nl">BUD:</span><span class="tok-mi">96</span><span class="tok-o">,</span><span class="tok-nl">SZX:</span><span class="tok-mi">99</span><span class="tok-o">,</span><span class="tok-nl">AUH:</span><span class="tok-mi">97</span><span class="tok-o">,</span><span class="tok-nl">BGY:</span><span class="tok-mi">99</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The query we just looked at could also be written as follows but in this case using
the <em>and</em> step inline by dot combining it (as above) feels cleaner to me. As you can
see we get the same result as before.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">and</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">)),</span>
                <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">95</span><span class="tok-o">)))).</span>
      <span class="tok-n">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span>

<span class="tok-o">[</span><span class="tok-nl">BUD:</span><span class="tok-mi">96</span><span class="tok-o">,</span><span class="tok-nl">SZX:</span><span class="tok-mi">99</span><span class="tok-o">,</span><span class="tok-nl">AUH:</span><span class="tok-mi">97</span><span class="tok-o">,</span><span class="tok-nl">BGY:</span><span class="tok-mi">99</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a side note, if we wanted to reverse the grouping so that the airports were
grouped by the counts rather than the codes we could do that as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">).</span><span class="tok-na">and</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">95</span><span class="tok-o">)))).</span>
      <span class="tok-n">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-mi">96</span><span class="tok-o">:[</span><span class="tok-n">BUD</span><span class="tok-o">],</span><span class="tok-mi">97</span><span class="tok-o">:[</span><span class="tok-n">AUH</span><span class="tok-o">],</span><span class="tok-mi">99</span><span class="tok-o">:[</span><span class="tok-n">SZX</span><span class="tok-o">,</span><span class="tok-n">BGY</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also add additional inline <em>and</em> steps to a query as shown below. Notice that
this time <em>AUH</em> is not part of the result set as it has 97 routes which our new <em>and</em>
test eliminates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">).</span><span class="tok-na">and</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">95</span><span class="tok-o">)).</span><span class="tok-na">and</span><span class="tok-o">(</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-mi">97</span><span class="tok-o">)))).</span>
      <span class="tok-n">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-mi">96</span><span class="tok-o">:[</span><span class="tok-n">BUD</span><span class="tok-o">],</span><span class="tok-mi">99</span><span class="tok-o">:[</span><span class="tok-n">SZX</span><span class="tok-o">,</span><span class="tok-n">BGY</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We used the <em>where</em> step a lot in the examples above. We will explain in more detail
how the <em>where</em> step works in the "<a href="#wh">Using <em>where</em> to filter things out of a result</a>" section which is coming up soon.</p>
</div>
</div>
<div class="sect2">
<h3 id="wh">3.11. Using <em>where</em> to filter things out of a result</h3>
<div class="paragraph">
<p>We have already seen the <em>where</em> step used in some of the prior examples. In this
section we will take a slightly more focussed look at the <em>where</em> step. The <em>where</em>
step is an example of a <em>filter</em>. It takes the current state of a traversal and only
allows anything that matches the specified constraint to pass on to any following
steps. <em>Where</em> can be used by itself, or as we shall see later, in conjunction with a
<em>by</em> modulator or following a <em>match</em> or a <em>choose</em> step.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
It is worth noting that some queries that use <em>where</em> can also be written using <em>has</em>
instead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s start by looking at a simple example of how <em>has</em> and <em>where</em> can be
used to achieve the same result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find airports with more than five runways</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">))</span>

<span class="tok-c1">// Find airports with more than five runways</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In examples like the one above, both queries will yield the exact same results but
the <em>has</em> step feels simpler and cleaner for such cases. The next example starts to
show the power of the <em>where</em> step. We can include a traversal inside of the <em>where</em>
step that does some filtering for us. In this case, we first find all nodes that are
airports and then use a <em>where</em> step to only keep airports that have more than 60
outgoing routes. Finally we count how many such airports we found.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Airports with more than 60 unique routes from them</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">60</span><span class="tok-o">))).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">179</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In our next example, we want to find routes between airports that have an ID of less
than 47 but only return routes that are longer than 4,000 miles. Again, notice how we
are able to look at the incoming vertex ID values by placing a reference to <em>inV</em> at
the start of the <em>where</em> expression. The <em>where</em> step is placed inside of an <em>and</em>
step so that we can also examine the <em>dist</em> property of the edge. Finally we return
the path as the result of our query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Routes longer than 4,000 miles between airports with and ID less than 47</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-mi">47</span><span class="tok-o">)).</span><span class="tok-na">outE</span><span class="tok-o">().</span>
      <span class="tok-n">and</span><span class="tok-o">(</span><span class="tok-n">where</span><span class="tok-o">(</span><span class="tok-n">inV</span><span class="tok-o">().</span><span class="tok-na">id</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-mi">47</span><span class="tok-o">))),</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">4000</span><span class="tok-o">))).</span><span class="tok-na">inV</span><span class="tok-o">().</span>
      <span class="tok-n">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is what we get back as a result of running the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-mi">4502</span><span class="tok-o">,</span><span class="tok-n">HNL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-mi">4970</span><span class="tok-o">,</span><span class="tok-n">HNL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ORD</span><span class="tok-o">,</span><span class="tok-mi">4230</span><span class="tok-o">,</span><span class="tok-n">HNL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-mi">4950</span><span class="tok-o">,</span><span class="tok-n">HNL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">HNL</span><span class="tok-o">,</span><span class="tok-mi">4502</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">HNL</span><span class="tok-o">,</span><span class="tok-mi">4970</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">HNL</span><span class="tok-o">,</span><span class="tok-mi">4230</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">HNL</span><span class="tok-o">,</span><span class="tok-mi">4950</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Our last example in this section uses a <em>where</em> step to make sure we don&#8217;t end up
back where we started when looking at airline routes with one stop. We find routes
that start in Austin, with one intermediate stop, that then continue to another
airport, but never end up back in Austin. A <em>limit</em> step is used to just return the
first 10 results that match this criteria. Notice how the <em>as</em> step is used to label
the <em>AUS</em> airport so that we can refer to it later in our <em>where</em> step. The effect of
this query is that routes such as AUS&#8594;DFW&#8594;AUS will not be returned but
AUS&#8594;DFW&#8594;LHR will be as it does not end up back in Austin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// List 10 places you can fly to with one stop, starting at Austin but</span>
<span class="tok-c1">// never ending up back in Austin</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)).</span>
              <span class="tok-n">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="whereby">3.11.1. Using <em>where</em> and <em>by</em> to filter results</h4>
<div class="paragraph">
<p>A new capability was added in the Tinkerpop 3.2.4 release that allows a <em>where</em> step
to be followed with a <em>by</em> modulator. This makes writing certain types of queries a
lot easier than it was before. The query below starts at the Austin airport and finds
all the airports that you can fly to from there. A <em>where</em> <em>by</em> step is then used to
filter the results to just those airports that have the same number of runways that
Austin has.  What is really nice about this is that we do not have to know ahead of
time how many runways Austin itself has as that is handled for us by the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span>
       <span class="tok-n">where</span><span class="tok-o">(</span><span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Combining the <em>where</em> and <em>by</em> steps allows you to write powerful queries in a
nice and simple way.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you were to run the query in the Gremlin Console, these are the results that you
should see. Note that all the airports returned have two runways. This is the same
number of runways that the Austin airport has.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">MEX</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">CUN</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">GDL</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">PNS</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">VPS</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">FLL</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">SNA</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">MSY</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="choose">3.12. Using <em>choose</em> to write if&#8230;&#8203;then&#8230;&#8203;else type queries</h3>
<div class="paragraph">
<p>The <em>choose</em> step allows the creation of queries that are a lot like the "if then
else" constructs found in most programming languages. If we were programming in Java
we might find ourselves writing something like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">longest</span> <span class="tok-o">&gt;</span> <span class="tok-mi">12000</span><span class="tok-o">)</span>
<span class="tok-o">{</span>
  <span class="tok-k">return</span><span class="tok-o">(</span><span class="tok-n">code</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">else</span>
<span class="tok-o">{</span>
  <span class="tok-k">return</span><span class="tok-o">(</span><span class="tok-n">desc</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gremlin offers us a way to do the same thing. The query below finds all the airports
in Texas and then will return the value of the <em>code</em> property if an airport has a
runway longer than 12,000 feet otherwise it will return the value of the <em>desc</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// If an airport has a runway &gt; 12,000 feet return its code else return its description</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">).</span><span class="tok-na">choose</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">12000</span><span class="tok-o">)),</span>
                                   <span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">),</span>
                                   <span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is another example that uses the same constructs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// If an airport has a code of AUS or DFW report its region else report its country</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">choose</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">)),</span>
                                 <span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">),</span>
                                 <span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">)).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">15</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes it is very useful, as the query below demonstrates, to return constant
rather than derived values as part of a query. This query will return the string
"some" if an airport has less than four runways or "lots" if it has more than four.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// You can also return constants using the constant() step</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span>
      <span class="tok-n">choose</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">)),</span>
             <span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s1">&#39;some&#39;</span><span class="tok-o">),</span>
             <span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s1">&#39;lots&#39;</span><span class="tok-o">))</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The <em>constant</em> step can be used to return a constant value as part of a query.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is one more example that uses a <em>sample</em> step to pick 10 airports and then
return either "lots" or "not so many" depending on whether the airport has more than
50 routes or not. Note also how <em>as</em> and <em>select</em> are used to combine the both the
derived and constant parts of the query result that we will ultimately return.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">sample</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">choose</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">50</span><span class="tok-o">)),</span>
             <span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s1">&#39;lots&#39;</span><span class="tok-o">),</span>
             <span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s1">&#39;not so many&#39;</span><span class="tok-o">)).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of what the output from running this query might look like.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">YYT</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">not</span> <span class="tok-n">so</span> <span class="tok-n">many</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">YEG</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">not</span> <span class="tok-n">so</span> <span class="tok-n">many</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">LGA</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">lots</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">lots</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">BLR</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">not</span> <span class="tok-n">so</span> <span class="tok-n">many</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">CGN</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">lots</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">BOM</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">lots</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">SIN</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">lots</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">TSF</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">not</span> <span class="tok-n">so</span> <span class="tok-n">many</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">lots</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could go one step further if you don&#8217;t want the <em>a:</em> and <em>b:</em> keys returned as
part of the result by adding a <em>select(values)</em> to the end of the query as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">sample</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">choose</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">50</span><span class="tok-o">)),</span>
             <span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s1">&#39;lots&#39;</span><span class="tok-o">),</span>
             <span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s1">&#39;not so many&#39;</span><span class="tok-o">)).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">().</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what the output from the modified form of the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">YYT</span><span class="tok-o">,</span><span class="tok-n">not</span> <span class="tok-n">so</span> <span class="tok-n">many</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">YEG</span><span class="tok-o">,</span><span class="tok-n">not</span> <span class="tok-n">so</span> <span class="tok-n">many</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGA</span><span class="tok-o">,</span><span class="tok-n">lots</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-n">lots</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">BLR</span><span class="tok-o">,</span><span class="tok-n">not</span> <span class="tok-n">so</span> <span class="tok-n">many</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">CGN</span><span class="tok-o">,</span><span class="tok-n">lots</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">BOM</span><span class="tok-o">,</span><span class="tok-n">lots</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SIN</span><span class="tok-o">,</span><span class="tok-n">lots</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">TSF</span><span class="tok-o">,</span><span class="tok-n">not</span> <span class="tok-n">so</span> <span class="tok-n">many</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-n">lots</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="option">3.13. Using <em>option</em> to write case/switch type queries</h3>
<div class="paragraph">
<p>When <em>option</em> is combined with <em>choose</em> the result is similar to the <em>case</em> or
<em>switch</em> style construct found in most programming languages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// You can combine choose and option to generate a more &quot;case statement&quot; like query</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">choose</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)).</span>
                            <span class="tok-n">option</span><span class="tok-o">(</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">,</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">)).</span>
                            <span class="tok-n">option</span><span class="tok-o">(</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">,</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">)).</span>
                            <span class="tok-n">option</span><span class="tok-o">(</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">,</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">))</span>


<span class="tok-c1">// This example has three options - note the default case of &#39;none&#39; used as the catchall</span>
<span class="tok-c1">// Note how for ease of reading the query can be split across multiple lines.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">choose</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">)).</span>
                                      <span class="tok-n">option</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s1">&#39;just one&#39;</span><span class="tok-o">)).</span>
                                      <span class="tok-n">option</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s1">&#39;a couple&#39;</span><span class="tok-o">)).</span>
                                      <span class="tok-n">option</span><span class="tok-o">(</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s1">&#39;lots&#39;</span><span class="tok-o">)).</span>
                                      <span class="tok-n">option</span><span class="tok-o">(</span><span class="tok-n">none</span><span class="tok-o">,</span><span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s1">&#39;quite a few&#39;</span><span class="tok-o">))</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ma">3.14. Using <em>match</em> to do pattern matching</h3>
<div class="paragraph">
<p><em>Match</em> was added in TinkerPop 3 and allows a more declarative style of pattern based
query to be expressed in Gremlin. <em>Match</em> can be a bit hard to master but once you
figure it out it can be a very powerful way of traversing a graph looking for
specific patterns.</p>
</div>
<div class="paragraph">
<p>Below is an example that uses <em>match</em> to look for airline route patterns where there
is a flight from one airport to another but no return flight back to the original
airport. The first query looks for such patterns involving the JFK airport as the
starting point. You can see the output from running the query below it. This is the
correct answer as, currently, the British Airways Airbus A318 flight from London City
(LCY) airport stops in Dublin (DUB) to take on more fuel on the way to JFK but does
not need to stop on the way back because of the trailing wind.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find any cases of where you can fly from JFK non stop to a place you cannot get back from</span>
<span class="tok-c1">// there non stop.This query should return LCY, as the return flight stops in DUB to refuel.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;JFK&#39;</span><span class="tok-o">).</span><span class="tok-na">match</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">),</span>
                              <span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">not</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">))).</span>
                        <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">s:</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-nl">d:</span><span class="tok-n">LCY</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can expand the query by leaving off the specific starting point of JFK and look
for this pattern anywhere in the graph. This really starts to show how important and
useful the <em>match</em> Gremlin step is. We don&#8217;t have any idea what we might find, but by
using <em>match</em>, we are able to describe the pattern of behavior that we are looking
for and Gremlin does the rest.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Same as above but from any airport in the graph.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">match</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">),</span>
                                <span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">not</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">))).</span>
                          <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you were to run the query you would find that there are in fact over 200 places in
the graph where this situation applies. We can add a <em>count</em> to the end of query to
find out just how many there are.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many occurrences of the pattern in the graph are there?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">match</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">),</span>
                                <span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">not</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">))).</span>
                          <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>


<span class="tok-mi">238</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next query looks for routes that follow the pattern A&#8594;B&#8594;C but where there is no
direct flight of the form A&#8594;C. In other words it looks for all routes between two
airports with one intermediate stop where there is no direct flight alternative
available. Note that the query also eliminates any routes that would end up back at
the airport of origin. To achieve the requirement that we not end up back where we
started, a <em>where</em> step is included to make sure we do not match any routes of the
form A&#8594;B&#8594;A.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">match</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">)</span>
                               <span class="tok-o">,</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">)</span>
                               <span class="tok-o">,</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">not</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">))).</span>
                          <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are, of course a lot of places in the air-routes graph where this pattern can
be found. Here are just a few examples of the results you might get from running the
query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">MLB</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-n">ISP</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">MLB</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-n">BIM</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">MLB</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-n">YTZ</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">PHF</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-n">SFB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">SBN</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-n">SFB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">SBN</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-n">AZA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">SBN</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-n">PIE</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">SBN</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-n">PGD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">TRI</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-n">SFB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">TRI</span><span class="tok-o">,</span><span class="tok-nl">c:</span><span class="tok-n">PIE</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is another example of using <em>match</em> along with a <em>where</em>. This query starts out
by looking at how many runways Austin has and then looks at every airport that you
can fly to from Austin and then looks at how many runways those airports have. Only
airports with the same number as Austin are returned. While this is a bit of a
contrived query, it does show the power of <em>match</em> and also illustrates using values
calculated in one part of a query later on in that same query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">match</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;ausr&#39;</span><span class="tok-o">),</span>
            <span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;outa&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;outr&#39;</span><span class="tok-o">)</span>
              <span class="tok-o">.</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s1">&#39;ausr&#39;</span><span class="tok-o">,</span><span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-s1">&#39;outr&#39;</span><span class="tok-o">))).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;outa&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">().</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As I mentioned, the example above is a bit contrived and it could actually be done
without using a <em>match</em> step at all and just using a <em>where</em> step as shown below.
Hopefully, however, these examples give you an idea of what <em>match</em> can do.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;ausr&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;outa&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;outr&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">where</span><span class="tok-o">(</span><span class="tok-s1">&#39;ausr&#39;</span><span class="tok-o">,</span><span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-s1">&#39;outr&#39;</span><span class="tok-o">)).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;outa&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">().</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_em_union_em_to_combine_query_results">3.15. Using <em>union</em> to combine query results</h3>
<div class="paragraph">
<p>The <em>union</em> step works just as you would expect from its name. It allows to to
combine parts of a query into a single result. Just as with the boolean <em>and</em> and
<em>or</em> steps it is sometimes possible to find other ways to do the same thing without
using <em>union</em> but it does offer some very useful capability.</p>
</div>
<div class="paragraph">
<p>By way of a simple example, the following query returns flights that arrive in AUS
from the UK of that leave AUS and arrive in Mexico.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Flights to AUS from the UK or from AUS to Mexico</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">union</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;UK&#39;</span><span class="tok-o">)</span>
                              <span class="tok-o">,</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;MX&#39;</span><span class="tok-o">)).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run that query, we get the following results</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">MEX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">CUN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">GDL</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query solves the problem "Find all routes that start in London, England and end
up in Paris or Berlin with no stops". Because city names are used and not airport
codes, all airports in the respective cities are considered.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;GB-ENG&#39;</span><span class="tok-o">).</span>
         <span class="tok-n">union</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Paris&#39;</span><span class="tok-o">),</span>
              <span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Berlin&#39;</span><span class="tok-o">)).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the results we get back from running the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">ORY</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">TXL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-n">SXF</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LCY</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LCY</span><span class="tok-o">,</span><span class="tok-n">ORY</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">STN</span><span class="tok-o">,</span><span class="tok-n">TXL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">STN</span><span class="tok-o">,</span><span class="tok-n">SXF</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LTN</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LTN</span><span class="tok-o">,</span><span class="tok-n">SXF</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned above, sometimes, especially for fairly simple queries, there are
alternatives to using <em>union</em>. The previous query could have been written as follows
using the <em>within</em> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// The above query could have been written without using union() as follows</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;GB-ENG&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;Paris&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Berlin&#39;</span><span class="tok-o">)).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query is more interesting. We again start from any airport in London, but then
we want routes that meet any of the criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to Berlin and then to Lisbon</p>
</li>
<li>
<p>Go to Paris and then Barcelona</p>
</li>
<li>
<p>Go to Edinburgh and then Rome</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We also want to return the distances in each case. Note that you can union together as
many sets of operations as you need to. In this example we combine the results of three
sets of traversals.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Returns any paths found along with the distances between airport pairs.</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;GB-ENG&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">union</span><span class="tok-o">(</span><span class="tok-n">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Berlin&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Lisbon&#39;</span><span class="tok-o">).</span>
            <span class="tok-n">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">),</span>
            <span class="tok-n">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Paris&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Barcelona&#39;</span><span class="tok-o">).</span>
            <span class="tok-n">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">),</span>
            <span class="tok-n">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Edinburgh&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Rome&#39;</span><span class="tok-o">).</span>
            <span class="tok-n">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what we get back when we run our query</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-mi">227</span><span class="tok-o">,</span><span class="tok-n">ORY</span><span class="tok-o">,</span><span class="tok-mi">513</span><span class="tok-o">,</span><span class="tok-n">BCN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-mi">216</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">,</span><span class="tok-mi">533</span><span class="tok-o">,</span><span class="tok-n">BCN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-mi">591</span><span class="tok-o">,</span><span class="tok-n">SXF</span><span class="tok-o">,</span><span class="tok-mi">1432</span><span class="tok-o">,</span><span class="tok-n">LIS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-mi">191</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">,</span><span class="tok-mi">533</span><span class="tok-o">,</span><span class="tok-n">BCN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LCY</span><span class="tok-o">,</span><span class="tok-mi">227</span><span class="tok-o">,</span><span class="tok-n">ORY</span><span class="tok-o">,</span><span class="tok-mi">513</span><span class="tok-o">,</span><span class="tok-n">BCN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">STN</span><span class="tok-o">,</span><span class="tok-mi">563</span><span class="tok-o">,</span><span class="tok-n">SXF</span><span class="tok-o">,</span><span class="tok-mi">1432</span><span class="tok-o">,</span><span class="tok-n">LIS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LTN</span><span class="tok-o">,</span><span class="tok-mi">589</span><span class="tok-o">,</span><span class="tok-n">SXF</span><span class="tok-o">,</span><span class="tok-mi">1432</span><span class="tok-o">,</span><span class="tok-n">LIS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LTN</span><span class="tok-o">,</span><span class="tok-mi">236</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">,</span><span class="tok-mi">533</span><span class="tok-o">,</span><span class="tok-n">BCN</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is one last example of using union. This query finds the total distance
of all routes from any airport in Madrid to any airport anywhere and also does
the same calculation but minus any routes that end up in any Paris airport.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Madrid&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">union</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">sum</span><span class="tok-o">(),</span>
            <span class="tok-n">filter</span><span class="tok-o">(</span><span class="tok-n">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;Paris&#39;</span><span class="tok-o">))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">sum</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output from running the query. As you can see the first number is
slightly larger than the second as all routes involving Paris have been
filtered out from the calculation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-mi">397708</span>
<span class="tok-mi">396410</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sideeffect">3.16. Using <em>sideEffect</em> to do things on the side</h3>
<div class="paragraph">
<p>The <em>sideEffect</em> step allows you to do some additional processing as part of a query
without changing what gets passed on to the next stage of the query. The example
below finds the airport vertex V(3) and then uses a <em>sideEffect</em> to count the number of
places that you can fly to from there and stores it in a traversal variable named <em>a</em>
before counting how many places you can get towith one stop and storing that value in
<em>b</em>. Note that there are other ways we could write this query but it demonstrates
quite well how <em>sideEffect</em> works.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">sideEffect</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-o">[</span><span class="tok-mi">59</span><span class="tok-o">],</span><span class="tok-nl">b:</span><span class="tok-mi">5911</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Later in the document we will discuss lambda functions, sometimes called closures and
how they can be used. The example below combines a closure with a <em>sideEffect</em> to
print a message before displaying information about the node that was found. Again
notice how the <em>sideEffect</em> step has no effect on what is seen by the subsequent
steps. You can see the output generated below the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SFO&#39;</span><span class="tok-o">).</span><span class="tok-na">sideEffect</span><span class="tok-o">{</span><span class="tok-n">println</span> <span class="tok-s2">&quot;I&#39;m working on it&quot;</span><span class="tok-o">}.</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">)</span>

<span class="tok-n">I</span><span class="tok-err">&#39;</span><span class="tok-n">m</span> <span class="tok-n">working</span> <span class="tok-n">on</span> <span class="tok-n">it</span>
<span class="tok-n">San</span> <span class="tok-n">Francisco</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Later in the document will will look at other ways that side effects can be used to
solve more interesting problems.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_em_aggregate_em_to_create_a_temporary_collection">3.17. Using <em>aggregate</em> to create a temporary collection</h3>
<div class="paragraph">
<p>At the time of writing this document, there were 59 places you could fly to directly
(non stop) from Austin. We can verify this fact using the following query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">59</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to count how many places we could go to from Austin with one stop, we
could use the following query. The <em>dedup</em> step is used as we only want to know how
many unique places we can go to, not how many different ways of getting to all of
those places there are.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">865</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is however a problem with this query. The 865 places is going to include (some
or possibly all of) the places we can also get to non stop from Austin. What we
really want to find are all the places that you can only get to from Austin with one
stop. So what we need is a way to remember all of those places and remove them from
the 865 some how. This is where <em>aggregate</em> is useful. Take a look at the modified
query below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">aggregate</span><span class="tok-o">(</span><span class="tok-s1">&#39;nonstop&#39;</span><span class="tok-o">).</span>
     <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">without</span><span class="tok-o">(</span><span class="tok-s1">&#39;nonstop&#39;</span><span class="tok-o">)).</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">806</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the first <em>out</em> step. all of the nodes that were found are stored in a
collection I chose to  call <em>nonstop</em>. Then, after the second <em>out</em> we can add a
<em>where</em> step that essentially says "only keep the nodes that are not part of the
nonstop collection". We still do the <em>dedup</em> step as otherwise we will still end up
counting a lot of the remaining airports more than once.</p>
</div>
<div class="paragraph">
<p>Notice that 806 is precisely 59 less than the 865 number returned by the previous
query which shows the places you can get to non stop were all correctly removed from
the second query.  This also tells us there are no flights from Austin to places that
you cannot get to from anywhere else!</p>
</div>
</div>
<div class="sect2">
<h3 id="coalesce">3.18. Using <em>coalesce</em> to see which traversal returns a result</h3>
<div class="paragraph">
<p>Sometimes, when you are uncertain as to which traversal of a set you are interested
in will return a result you can have them evaluated in order by the <em>coalesce</em> step.
The first of the traversals that you specify that returns a result will cause that
result to be the one that is returned to your query.</p>
</div>
<div class="paragraph">
<p>Look at the example below. Starting from the vertex with an ID of 3 it uses
<em>coalesce</em> to first see if there are any outgoing edges with a label of <em>fly</em>. If
there are any the vertices connected to those edges will be returned. If there are
not any, any vertices on any incoming edges labelled <em>contains</em> will be returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Return the first step inside coalesce that returns a node</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">coalesce</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;fly&#39;</span><span class="tok-o">),</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">)).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As there are not any edges labelled <em>fly</em> in the air-routes graph, the second
traversal will be the one whose results are returned.</p>
</div>
<div class="paragraph">
<p>If we were to run the above query using the air-routes graph, this is what would be
returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">NA</span><span class="tok-o">],</span><span class="tok-nl">type:</span><span class="tok-o">[</span><span class="tok-n">continent</span><span class="tok-o">],</span><span class="tok-nl">desc:</span><span class="tok-o">[</span><span class="tok-n">North</span> <span class="tok-n">America</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">],</span><span class="tok-nl">type:</span><span class="tok-o">[</span><span class="tok-n">country</span><span class="tok-o">],</span><span class="tok-nl">desc:</span><span class="tok-o">[</span><span class="tok-n">United</span> <span class="tok-n">States</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can put more than two traversals inside of a <em>coalesce</em> step. In the following
example there are now three. Because some <em>contains</em> edges do exist for this vertex,
the <em>route</em> edges will not be looked at as the traversals are evaluated in left to
right order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">coalesce</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;fly&#39;</span><span class="tok-o">),</span>
              <span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">),</span>
                <span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">)).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see the results returned are still the same.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">NA</span><span class="tok-o">],</span><span class="tok-nl">type:</span><span class="tok-o">[</span><span class="tok-n">continent</span><span class="tok-o">],</span><span class="tok-nl">desc:</span><span class="tok-o">[</span><span class="tok-n">North</span> <span class="tok-n">America</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">],</span><span class="tok-nl">type:</span><span class="tok-o">[</span><span class="tok-n">country</span><span class="tok-o">],</span><span class="tok-nl">desc:</span><span class="tok-o">[</span><span class="tok-n">United</span> <span class="tok-n">States</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="otherv">3.19. Other ways to explore nodes and edges using <em>both</em>, <em>bothE</em>, <em>bothV</em> and <em>otherV</em></h3>
<div class="paragraph">
<p>We have already looked at examples of how you can walk a graph and examine nodes and
edges using steps such as <em>out</em>, <em>in</em>, <em>outE</em> and <em>inE</em>. In this section we
introduce some additional ways to explore nodes and edges.</p>
</div>
<div class="paragraph">
<p>As a quick recap, we have already seen examples of queries like the one below that
simply counts the number of outgoing edges from the node with an ID of 3.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">59</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Likewise, this query counts the number of incoming edges to that same node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">inE</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">61</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query introduces the <em>bothE</em> step. What this step does is return all of
the edges connected to this node whether they are outgoing or incoming. As we can see
the count of 120 lines up with the values we got from counting the number of
outgoing and incoming edges. We might want to retrieve the edges, as a simple example, to
examine a property on each of them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">bothE</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">120</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to return vertices instead of edges, we could use the <em>both</em> step. This
will return all of the vertices connected to the node with an ID of 3 regardless of
whether they are connected by an outgoing or an incoming edge.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">both</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">120</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query can be used to show us the 120 vertices that we just counted in the
previous query. I sorted the results and used <em>fold</em> to build them into a list to
make the results easier to read. Note how vertex 3 is <strong>not</strong> returned as part of the
results. This is important, for as we shall see in a few examples time, this is not
always the case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">both</span><span class="tok-o">().</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">8</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">8</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">11</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">11</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">12</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">12</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">13</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">13</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">15</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">15</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">16</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">16</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">17</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">17</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">18</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">18</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">20</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">20</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">21</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">21</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">22</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">22</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">23</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">23</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">24</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">24</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">25</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">25</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">26</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">26</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">27</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">27</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">28</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">28</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">29</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">29</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">30</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">30</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">31</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">31</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">34</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">34</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">35</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">35</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">38</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">38</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">39</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">39</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">41</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">41</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">42</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">42</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">45</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">45</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">46</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">46</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">47</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">47</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">49</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">49</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">52</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">52</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">136</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">136</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">147</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">147</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">149</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">149</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">178</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">178</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">180</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">180</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">182</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">182</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">183</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">183</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">184</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">184</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">185</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">185</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">186</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">186</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">187</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">187</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">188</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">188</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">190</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">190</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">273</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">273</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">278</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">278</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">389</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">389</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">416</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">416</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">430</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">430</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">549</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">549</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">929</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">929</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1274</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1274</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3591</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3605</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You probably also noticed that most of the vertices appear twice. This is because
for most air routes there is an outgoing and an incoming edge. If we wanted to
eliminate any duplicate results we can do that by adding a <em>dedup</em> step to our query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">both</span><span class="tok-o">().</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">8</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">11</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">12</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">13</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">15</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">16</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">17</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">18</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">20</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">21</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">22</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">23</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">24</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">25</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">26</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">27</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">28</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">29</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">30</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">31</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">34</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">35</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">38</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">39</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">41</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">42</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">45</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">46</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">47</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">49</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">52</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">136</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">147</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">149</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">178</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">180</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">182</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">183</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">184</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">185</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">186</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">187</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">188</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">190</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">273</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">278</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">389</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">416</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">430</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">549</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">929</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1274</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3591</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3605</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can do another count using our modified query to check we got the expected number
of results back.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">both</span><span class="tok-o">().</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">61</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a similar set of things we can do when working with edges using the <em>bothV</em>
and <em>otherV</em> steps. The <em>bothV</em> step returns the vertices at both ends of an edge and
the <em>otherV</em> step returns the vertex at the other end of the edge. This is relative to
how we are looking at the edge.</p>
</div>
<div class="paragraph">
<p>The query below starts with our same node with the ID of 3 and then looks at all the
edges no matter whether they are incoming or outgoing and retrieves all of the
vertices at each end of those edges using the <em>bothV</em> step. Notice that this time our
count is 240. This is because for every one of the 120 edges, we asked for the node
at each end so we ended up with 240 of them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">bothE</span><span class="tok-o">().</span><span class="tok-na">bothV</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">240</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can again add a <em>dedup</em> step to get rid of duplicate vertices as we did before and
re-do the count but notice this time we get back 62 instead of the 61 we got before. So what is going on here?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">bothE</span><span class="tok-o">().</span><span class="tok-na">bothV</span><span class="tok-o">().</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">62</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s run another query and take a look at all of the vertices that we got back this
time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">bothE</span><span class="tok-o">().</span><span class="tok-na">bothV</span><span class="tok-o">().</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">()).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">8</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">11</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">12</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">13</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">15</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">16</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">17</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">18</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">20</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">21</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">22</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">23</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">24</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">25</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">26</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">27</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">28</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">29</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">30</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">31</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">34</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">35</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">38</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">39</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">41</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">42</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">45</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">46</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">47</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">49</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">52</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">136</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">147</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">149</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">178</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">180</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">182</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">183</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">184</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">185</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">186</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">187</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">188</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">190</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">273</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">278</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">389</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">416</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">430</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">549</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">929</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1274</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3591</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3605</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Can you spot the difference? This time, vertex 3 (v[3])  <strong>is</strong> included in our
results. This is because we started out by looking at all of the edges and then asked
for all the vertices connected to those edges. Vertex 3 gets included as part of that
computation. So beware of this subtle difference between using <em>both</em> and the
<em>bothE().bothV()</em> pattern.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s rewrite the queries we just used again but replace <em>bothV</em> with <em>otherV</em>.
Notice that when we count the number of results we are back to 61 again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">bothE</span><span class="tok-o">().</span><span class="tok-na">otherV</span><span class="tok-o">().</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>
<span class="tok-mi">61</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So let&#8217;s again look at the returned vertices and see what the difference is.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">bothE</span><span class="tok-o">().</span><span class="tok-na">otherV</span><span class="tok-o">().</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">()).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">8</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">11</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">12</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">13</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">15</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">16</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">17</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">18</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">20</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">21</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">22</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">23</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">24</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">25</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">26</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">27</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">28</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">29</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">30</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">31</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">34</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">35</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">38</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">39</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">41</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">42</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">45</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">46</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">47</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">49</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">52</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">136</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">147</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">149</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">178</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">180</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">182</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">183</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">184</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">185</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">186</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">187</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">188</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">190</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">273</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">278</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">389</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">416</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">430</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">549</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">929</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1274</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3591</span><span class="tok-o">],</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3605</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, when we use <em>otherV</em> we do not get <em>v[3]</em> returned as we are only
looking at the other vertices relative to where we started from, which was <em>v[3]</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="sp">3.20. Shortest paths (between airports)</h3>
<div class="paragraph">
<p>We can use a repeat&#8230;&#8203;until looping construct to look for paths between two airports
without having to specify an explicit number of <em>out</em> steps to try.</p>
</div>
<div class="paragraph">
<p>The use of <em>simplePath</em> prevents paths already taken from being taken again and
greatly speeds up this query.  Without the <em>simplePath</em> step being used this query
could take HOURS!!  The <em>limit</em> step is also important as without it this query will
run for a LONG time looking for every possible path!!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// What are some of the shortest routes (paths) from AUS to AGR?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">simplePath</span><span class="tok-o">()).</span><span class="tok-na">until</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AGR&#39;</span><span class="tok-o">)).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>

<span class="tok-c1">// Another shortest path example using until...repeat instead</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">until</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SYD&#39;</span><span class="tok-o">)).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">simplePath</span><span class="tok-o">()).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// We can also specify an explicit number of out steps to try using a repeat...times loop but this of course</span>
<span class="tok-c1">// assumes that we know ahead of time how many stops we want to look for between airports.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">()).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SYD&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// This is the same as the prior query (but less flexible in that we can less easily vary the number of out steps()):</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SYD&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="nd">3.21. Calculating node degree</h3>
<div class="paragraph">
<p>While working with graphs, the word <em>degree</em> is used when discussing the number of
edges coming into a node, going out from a node or potentially both coming in and
going out. It&#8217;s quite simple with Gremlin to calculate various measures of degree as
the examples below show.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Out degree (number of routes) from each node (airport)</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// what is the out degree (number of unique outbound routes) from LHR, JFK and DFW?</span>
 <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;JFK&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Calculate degree (in and out) for each node (so counts edges going both ways)</span>
<span class="tok-c1">// Note the project() step was introduced in gremlin 3.2 and is ideal for this!</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">project</span><span class="tok-o">(</span><span class="tok-s2">&quot;v&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;degree&quot;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">bothE</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span>

<span class="tok-c1">// We could also write the same query like this.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">bothE</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sx">3.22. More examples using what we have covered so far</h3>
<div class="paragraph">
<p>The queries in this section build upon the topics that we have covered so far.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Which cities can I fly to from any airport in the Hawaiian islands?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-HI&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Find all the airports that are in Europe (The graph stores continent information</span>
<span class="tok-c1">// as &quot;contains&quot; edges connected from a &quot;continent&quot; node to each airport node.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">fold</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next queries show two ways of finding airports with 6 or more runways.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gte</span><span class="tok-o">(</span><span class="tok-mi">6</span><span class="tok-o">))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">gte</span><span class="tok-o">(</span><span class="tok-mi">6</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, let&#8217;s look at two ways of finding flights from airports in South America to
Miami. The first query uses <em>select</em> which is what we would have had to do in the
TinkerPop 2 days. The second query, which feels cleaner to me, uses the <em>path</em> and
<em>by</em> step combination introduced in TinkerPop 3.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SA&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;y&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;MIA&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;y&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SA&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;MIA&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query finds the edge that connects Austin (AUS) with Dallas Ft. Worth (DFW) and
returns the <em>dist</em> property of that edge so we know how far that journey is.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How far is it from DFW to AUS?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-mi">190</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative approach, we could return a path that would include both airport
codes and the distance. Notice how we need to use <em>outE</em> and <em>inV</em> rather than just
<em>out</em> as we still need the edge to be part of our path so that we can get its <em>dist</em>
property using a <em>by</em> step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">190</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to find out if there are any ways to get from Brisbane to Austin with
only one stop, this query will do nicely!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Routes from BNE to AUS with only one stop</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;BNE&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">BNE</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is another way of doing the same thing but, once again, to me using <em>path</em> feels
more concise. The only advantage of this query is that if all you want is the name
of any intermediate airports then that&#8217;s all you get!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;BNE&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;stop&#39;</span><span class="tok-o">).</span>
                        <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;stop&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">LAX</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A common thing you will find yourself doing when working with a graph is counting
things. This next query looks for all the airports that have less than five outgoing
routes and counts them. It does this by counting the number of airports that have
less than five outgoing edges with a <em>route</em> label. There are a surprisingly high
number of airports that offer this small number of destinations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Airports with less than 5 outgoing edges</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">))).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">2058</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In a similar vein this query finds the airports with more than 200 outgoing routes.
The second query shows that <em>where</em> is a synonym for <em>filter</em> in many cases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-o">).</span><span class="tok-na">filter</span><span class="tok-o">(</span><span class="tok-n">outE</span><span class="tok-o">(</span><span class="tok-s2">&quot;route&quot;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are two more queries that look for things that meet a specific criteria. The
first finds routes where the distance is exactly 100 miles. The second one looks for
the airports that have an elevation above 10,000 feet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// List ten (or less) routes where the distance is exactly 100 miles</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">)).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Airports above 10,000ft sorted by ascending elevation</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;elev&#39;</span><span class="tok-o">,</span> <span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">10000</span><span class="tok-o">)).</span>
      <span class="tok-n">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;elev&#39;</span><span class="tok-o">,</span><span class="tok-n">incr</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;elev&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next query finds any routes between Austin and Sydney that only require one
stop.The <em>by</em> step offers a clean way of doing this query by combining it with
<em>path</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SYD&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following three queries all achieve the same result. They find flights from any
airport in Africa to any airport in the United States.  These queries are intresting
as the continent information is represented in the graph as edges connecting an
airport node with a continent node. This is about as close as Gremlin gets to a SQL
join statement!</p>
</div>
<div class="paragraph">
<p>The first query starts by looking at airports the second starts from the node that
represents Africa. The third query uses <em>where</em> to show an alternate way of achieving
the same result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AF&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AF&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AF&#39;</span><span class="tok-o">)).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we run the query we should get results that look like this. I have laid them out
in two columns to save space.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">JNB</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">ATL</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ACC</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">JNB</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">JFK</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">CMN</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">IAD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">CAI</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">JFK</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">CMN</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ADD</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">IAD</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">GCK</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ADD</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">EWR</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">DKR</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">IAD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">LOS</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">ATL</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">DKR</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">LOS</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">IAH</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">LFW</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">LOS</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">JFK</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">RAI</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">BOS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">ACC</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-n">IAD</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The query below shows how to use the <em>project</em> step that was introduced in TinkerPop
3, along with <em>order</em> and <em>select</em> to produce a sorted table of airports you can fly
to from AUSTIN along with their runway counts. The <em>limit</em> step is used to only
return the top ten results. You will find several examples elsewhere in this document
that use variations of this collection of steps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">project</span><span class="tok-o">(</span><span class="tok-s1">&#39;ap&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;rw&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;rw&#39;</span><span class="tok-o">),</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the results we get from running the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">ORD</span><span class="tok-o">,</span> <span class="tok-nl">rw:</span><span class="tok-mi">8</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">DFW</span><span class="tok-o">,</span> <span class="tok-nl">rw:</span><span class="tok-mi">7</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">BOS</span><span class="tok-o">,</span> <span class="tok-nl">rw:</span><span class="tok-mi">6</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">DEN</span><span class="tok-o">,</span> <span class="tok-nl">rw:</span><span class="tok-mi">6</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">DTW</span><span class="tok-o">,</span> <span class="tok-nl">rw:</span><span class="tok-mi">6</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">YYZ</span><span class="tok-o">,</span> <span class="tok-nl">rw:</span><span class="tok-mi">5</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">MDW</span><span class="tok-o">,</span> <span class="tok-nl">rw:</span><span class="tok-mi">5</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">ATL</span><span class="tok-o">,</span> <span class="tok-nl">rw:</span><span class="tok-mi">5</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">IAH</span><span class="tok-o">,</span> <span class="tok-nl">rw:</span><span class="tok-mi">5</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">FRA</span><span class="tok-o">,</span> <span class="tok-nl">rw:</span><span class="tok-mi">4</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="beq">4. BEYOND BASIC QUERIES</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far we have looked mostly at querying the graph. In the following sections we will
look at some other topics that it is also important to be familiar with when working
with Gremlin such as mixing in some Groovy or Java code with your queries, adding
nodes (vertices),and edges and properties to a graph and also how to delete them. We
will also look at how to create a sub-graph and how to save a graph to and XML or
JSON file.</p>
</div>
<div class="sect2">
<h3 id="indents">4.1. A word about layout and indentation</h3>
<div class="paragraph">
<p>As you begin to write more complex Gremlin queries they can get quite lengthy.  In
order to make them easier for others to read it is recommended to spread them over
multiple lines and indent them in a way that makes sense. I am not going to propose
an indentation standard, I believe this should be left to personal preference however
there are a few things I want to mention in passing. When working with the Gremlin
console, if you want to spread a query over multiple lines then you will need to end
each line with a backslash character or with a character such as a period or a comma
that tells the Gremlin parser that there is more to come.</p>
</div>
<div class="paragraph">
<p>The following example shows the query we already looked at in the Boolean operations
section of this document but this time edited so that it could be copy and pasted
directly into the Gremlin console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-LA&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-AZ&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-OK&#39;</span><span class="tok-o">))</span>   <span class="tok-err">\</span>
                         <span class="tok-o">.</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-n">incr</span><span class="tok-o">)</span>   <span class="tok-err">\</span>
                         <span class="tok-o">.</span><span class="tok-na">valueMap</span><span class="tok-o">().</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can avoid the use of backslash characters if we lay the query out as follows. Each
line ends with a period which tells the parser that there are more steps coming.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-LA&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-AZ&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-OK&#39;</span><span class="tok-o">)).</span>
                          <span class="tok-n">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-n">incr</span><span class="tok-o">).</span>
                          <span class="tok-n">valueMap</span><span class="tok-o">().</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we do not give the parser one of these clues that there is more to come, the
Gremlin console will try and execute each line without waiting for the next line.</p>
</div>
<div class="paragraph">
<p>Whether you decide to use the backslash as a continuation character or leave the
period on the previous line is really a matter of personal preference. Just be sure
to do one or the other if you want to use multiple line queries within the Gremlin
console.</p>
</div>
</div>
<div class="sect2">
<h3 id="rword">4.2. A warning about reserved word conflicts and collisions</h3>
<div class="paragraph">
<p>Most of the time the issue I am about to describe will not be a problem. However,
there are cases where names of Gremlin steps conflict with reserved words and method
names in Groovy. Remember that Gremlin is coded in Groovy and Java. If you hit one of
these cases, often the error message that you will get presented with does not make
it at all clear that you have run into this particular issue. Let&#8217;s look at some
examples. One step name in Gremlin that can sometimes run into this naming conflict
is the <em>in</em> step. However, you do not have to worry about this in all cases. First
take a look at the following query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">in</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That query does not cause an error and correctly returns all of the nodes that are
connected by an incoming edge, to the <em>AUS</em> node. There is no conflict of names here
because it is clear that the <em>in()</em> reference applies to the result of the has step.
However, now take a look at this query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">union</span><span class="tok-o">(</span><span class="tok-k">in</span><span class="tok-o">(),</span><span class="tok-n">out</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the <em>in()</em> is on it&#8217;s own and not <em>dot connected</em> to a previous step.
The Gremlin runtime (which remember is written in Groovy) will try to interpret this
and will throw an error because it thinks this is a reference to its own <em>in</em> method.
To make this query work we have to adjust the syntax slightly as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">union</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">(),</span><span class="tok-n">out</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that I added the <em>"__."</em> (underscore underscore period) in front of the <em>in()</em>.
This is shorthand for <em>"the thing we are currently looking at"</em>, so in this case, the
result of the <em>has</em> step.</p>
</div>
<div class="paragraph">
<p>There are currently not too many Groovy reserved words to worry about. The three that
you have to watch out for are <em>in</em>, <em>not</em> and <em>as</em> which have special meanings in
both Gremlin and Groovy. Remember though, you will only need to use the <em>"__."</em>
notation when it is not clear what the reserved word, like <em>in</em>, applies to.</p>
</div>
<div class="paragraph">
<p>You will find an example of <em>not</em> being used with the <em>"__."</em> prefix in the
"<a href="#btree">Modelling an ordered binary tree as a graph</a>" section a bit later on.</p>
</div>
</div>
<div class="sect2">
<h3 id="dmodel">4.3. Thinking about your data model</h3>
<div class="paragraph">
<p>As important as it is to become good at writing effective Gremlin queries, it
is equally important, if not more so, to put careful consideration into how
you model your data as a graph. Ideally you want to arrange your graph so that
it can efficiently support the most common queries that you foresee it needing
to handle.</p>
</div>
<div class="paragraph">
<p>Consider this query description. "Find all flight routes that exist between airports
anywhere in the continent of Africa and the United States". When putting the
air-routes graph together I decided to model continents as their own nodes. So each
of the seven continents has a node. Each node is connected to airports within that
continent by an edge labeled "contains".</p>
</div>
<div class="paragraph">
<p>I could have chosen to just make the continent a property of each airport node but
had I done that, to answer the question about "routes starting in Africa" I would
have to look at every single airport node in the graph just to figure out which
continent contained it. By giving each continent it&#8217;s own node I am able to greatly
simplify the query we need to write.</p>
</div>
<div class="paragraph">
<p>Take a look at the query below. We first look just for nodes that are continents. We
then only look at the Africa node and the connections it has (each will be to a
different airport). By starting the query in this way, we have very efficiently
avoided looking at a large number of the airports in the graph altogether. Finally we
look at any routes from airports in Africa that end up in the United States. This
turns out to yield a nice and simple query in no small part because our data model in
the graph made it so easy to do.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Flights from any Airport in Africa to any airport in the United States</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AF&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)</span>
     <span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also have started our query by looking at each airport and looking to
see if it is in Africa but that would involve looking at a lot more nodes. The
point to be made here is that even if our data model is good we still need to
always be thinking about the most efficient way to write our queries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Gives same results but not as efficient</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AF&#39;</span><span class="tok-o">)</span>
     <span class="tok-o">.</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now for a fairly simple graph, like air-routes, this discussion of efficiency is
perhaps not such a big deal, but as you start to work with large graphs,
getting the data model right can be the difference between good and bad query
response times. If the data model is bad you won&#8217;t always be able to work
around that deficiency simply by writing clever queries!</p>
</div>
<div class="sect3">
<h4 id="_keeping_information_in_two_places_within_the_same_graph">4.3.1. Keeping information in two places within the same graph</h4>
<div class="paragraph">
<p>Sometimes, to improve query efficiency I find it is actually worth having the
data available more than one place within the same graph. An example of this
in the air routes graph would be the way I decided to model countries. I have
a unique node for each country but I also store the country code as a property
of each airport node. In a small graph this perhaps is overkill but I did it
to make a point. Look at the following two queries that return the same
results - the cities in Portugal that have airports in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;PT&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s2">&quot;contains&quot;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;PT&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first query finds the country node for Portugal and then, finds all of the
countries connected to it. The second query looks at all airport nodes and
looks to see if they contain <em>PT</em> as the country property.</p>
</div>
<div class="paragraph">
<p>In the first example it is likely that a lot less nodes will get looked at
than the first even though a few edges will also get walked as there are over
3,000 airport nodes but less than 300 country nodes. Also, in a production
system with an index in place finding the <em>Portugal</em> node should be very fast.</p>
</div>
<div class="paragraph">
<p>Conversely, if we were already looking at an airport node for some other
reason and just wanted to see what country it is in, it is more convenient to
just look at the <em>country</em> property of that node.</p>
</div>
<div class="paragraph">
<p>So there is no golden rule here but it is something to think about while
designing your data model.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_a_graph_as_an_index_into_other_data_sources">4.3.2. Using a graph as an index into other data sources</h4>
<div class="paragraph">
<p>While on the topic of what to keep in the graph, something to resist being
drawn into in many cases is the desire to keep absolutely everything in the
graph. For example, in the air routes graph I do not keep every single detail
about an airport (radio frequencies, runway names, weather information etc.)
in the airport nodes. That information is available in other places and easy
to find. In a production system you should consider carefully what needs to be
in your graph and what more naturally belongs elsewhere. One thing I could do
is add a URL as a property of each airport node that points to the airports
home page or some other resource that has all of the information. In this way
the graph becomes a high quality index into other data sources. This is a
common and useful pattern when working with graphs. This model of having
multiple data sources working together is sometimes referred to as <em>Polyglot
storage</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_few_words_about_em_supernodes_em">4.3.3. A few words about <em>supernodes</em></h4>
<div class="paragraph">
<p>When a node in a graph has a large number of edges and is disproportionately
connected to many of the other nodes in the graph it is likely that many, if not all,
graph traversals of any consequence will include that node. Such nodes are often
referred to as <em>supernodes</em>. In some cases the presence of <em>supernodes</em> may be
unavoidable but with careful planning as you design your graph model you can reduce
the likelihood that nodes become <em>supernodes</em>. The reason we worry about <em>supernodes</em>
is that they can significantly impact the performance of graph traversals. This is
because it is likely that any graph traversal that goes via such a node will have to
look at most if not all of the edges connected to that node as part of a traversal.</p>
</div>
<div class="paragraph">
<p>The air-routes graph does not really have anything that could be classed as a
<em>supernode</em>. The node with the most edges is the continent node for North America
that has approximately 980 edges. The busiest airports are IST and AMS and they both
have just over 530 total edges. So in the case of the air-routes graph we do not have
to worry too much.</p>
</div>
<div class="paragraph">
<p>If we were building a graph of a social network that included famous people we might
have to worry. Consider some of the people on Twitter with millions of followers.
Without taking some precautions, such a social network, modelled as a graph, could
face issues.</p>
</div>
<div class="paragraph">
<p>As you design your graph model it is worth considering that some things are perhaps
better modelled as a node property than as a node with lots of edges needing to
connect to it. For example in the air routes graph there are country nodes and each
airport is connected to one of the country nodes. In the air routes graph this is not
a problem as even if all of the airports in the graph were in the same country that
would still give us less than 3,500 edges connected to that node.  However, imagine
if we were building a graph of containing a very large number  of people. If we had
several million people in the graph all living in same the country that would be a
guaranteed way to get a <em>supernode</em> if we modelled that relationship by connecting
every person node to a country node using a <em>lives in</em> edge. In such situations, it
would be far more sensible to make the country where a person lives a property of
their own node.</p>
</div>
<div class="paragraph">
<p>A detailed discussion of <em>supernode</em> mitigation is beyond the scope of this document
but I encourage you to always be thinking about their possibility as you design your
graph and also be thinking about how you can prevent them becoming a big issue for
you.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="grv">4.4. Making Gremlin even Groovier</h3>
<div class="paragraph">
<p>As we have already discussed, the Gremlin console builds upon the Groovy console, and
Groovy itself is coded in Java. This means that all of the classes and  methods that
you would expect to have available while writing Groovy or Java programs are also
available to you as you work with the Gremlin Console. You can intermix additional
features from Groovy and Java classes along with the features provided by the
TinkerPop 3 classes as needed. This capability makes Gremlin additionally powerful.
You can also take advantages of these features when working with Gremlin Server over HTTP and with
other TinkerPop based Graph services like IBM Graph with the caveat that some
features may be blocked if viewed as a potential security risk to the server.</p>
</div>
<div class="paragraph">
<p>Every Gremlin query we have demonstrated so far is also, in reality, valid Groovy. We
have already shown examples of storing values into variables and looping using Groovy
constructs as part of a single or multi part Gremlin query.</p>
</div>
<div class="paragraph">
<p>In this section we are going to go one step further and actualaly define some
methods, using Groovy syntax, that can be run while still inside the Gremlin Console.
By way of a simple example, let&#8217;s define a method that will tell us how far apart two
airports are and then invoke it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// A simple function to return the distance between two airports</span>
<span class="tok-kt">def</span> <span class="tok-nf">dist</span><span class="tok-o">(</span><span class="tok-n">g</span><span class="tok-o">,</span><span class="tok-n">from</span><span class="tok-o">,</span><span class="tok-n">to</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-n">d</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">from</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">to</span><span class="tok-o">)</span>
         <span class="tok-o">.</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>
  <span class="tok-k">return</span> <span class="tok-n">d</span> <span class="tok-o">}</span>

<span class="tok-c1">// Can be called like this</span>
<span class="tok-n">dist</span><span class="tok-o">(</span><span class="tok-n">g</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;MEX&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next example shows how to define a slightly longer method that prints out
information about the degree of a node in a nice, human readable, form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Groovy function to display node degree</span>
<span class="tok-kt">def</span> <span class="tok-nf">degree</span><span class="tok-o">(</span><span class="tok-n">g</span><span class="tok-o">,</span><span class="tok-n">s</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-n">v</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">s</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">();</span>
  <span class="tok-n">o</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">v</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">();</span>
  <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">v</span><span class="tok-o">).</span><span class="tok-na">in</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span> <span class="tok-o">;</span>
  <span class="tok-n">println</span> <span class="tok-s2">&quot;Edges in  : &quot;</span> <span class="tok-o">+</span> <span class="tok-n">i</span><span class="tok-o">;</span>
  <span class="tok-n">println</span> <span class="tok-s2">&quot;Edges out : &quot;</span> <span class="tok-o">+</span> <span class="tok-n">o</span><span class="tok-o">;</span>
  <span class="tok-n">println</span> <span class="tok-s2">&quot;Total     : &quot;</span> <span class="tok-o">+(</span><span class="tok-n">i</span><span class="tok-o">+</span><span class="tok-n">o</span><span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-c1">// Can be called like this</span>
<span class="tok-n">degree</span><span class="tok-o">(</span><span class="tok-n">g</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example that shows how we can query the graph, get back a list of values
and then use a <em>for</em> loop to display them. Notice this time how we initially store
the results of the query into the variable <em>x</em>. The call to <em>toList</em> ensures that <em>x</em>
will contain a list (array) of the returned values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Using a Groovy for() loop to iterate over a list returned by Gremlin</span>
<span class="tok-n">x</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">()</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">a</span> <span class="tok-k">in</span> <span class="tok-n">x</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-n">println</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()+</span><span class="tok-s2">&quot; &quot;</span><span class="tok-o">+</span><span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()+</span><span class="tok-s2">&quot; &quot;</span><span class="tok-o">+</span><span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">())}</span>

<span class="tok-c1">// We can also do this just using a &#39;for&#39; loop and not storing anything into a variable.</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">a</span> <span class="tok-k">in</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">())</span> <span class="tok-o">{</span><span class="tok-n">println</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()+</span><span class="tok-s2">&quot;&quot;</span><span class="tok-o">+</span><span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">())}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes (as you have seen above) it is necessary to make a call to <em>next</em> to get
the result you expect returned to your variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span>
<span class="tok-n">println</span> <span class="tok-s2">&quot;The number of airports in the graph is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">number</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is another example that makes a Gremlin query inside a <em>for</em> loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">a</span> <span class="tok-k">in</span> <span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">10</span><span class="tok-o">)</span> <span class="tok-n">print</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span><span class="tok-n">a</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()+</span><span class="tok-s2">&quot; &quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example returns a hash of nodes, with  node labels as the keys and the
code property as the values. It then uses the label names to access the returned
hash.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">a</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>
<span class="tok-n">println</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-s2">&quot;country&quot;</span><span class="tok-o">].</span><span class="tok-na">size</span><span class="tok-o">())</span>
<span class="tok-n">println</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-s2">&quot;country&quot;</span><span class="tok-o">][</span><span class="tok-mi">5</span><span class="tok-o">])</span>
<span class="tok-n">println</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is another example. This time we define a method that takes as input a traversal
object and the code for an airport. It then uses those parameters to run a simple
Gremlin query to retrieve all of the places that you can fly to from that airport.
It then uses a simple <em>for</em> loop to print the results in a table. Note the use of
<em>next</em> as part of the <em>println</em>. This is needed in order to get the actual values
that we are looking for. If we did not include the calls to <em>next</em> we would actually
get back the iterator object itself and not the actual values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Given a traversal and an airport code print a list of all the places you can</span>
<span class="tok-c1">// fly to from there including the IATA code and airport description.</span>
<span class="tok-kt">def</span> <span class="tok-nf">from</span><span class="tok-o">(</span><span class="tok-n">g</span><span class="tok-o">,</span><span class="tok-n">a</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-n">places</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">a</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">toList</span><span class="tok-o">();</span>
  <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">x</span> <span class="tok-k">in</span> <span class="tok-n">places</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-n">println</span> <span class="tok-n">x</span><span class="tok-o">.</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()+</span><span class="tok-s2">&quot; &quot;</span><span class="tok-o">+</span><span class="tok-n">x</span><span class="tok-o">.</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()}</span>
<span class="tok-o">}</span>

<span class="tok-c1">// Call like this</span>
<span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-n">g</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example creates a hash map of all the airports, using their IATA code as the
key. We can then access the map using the IATA code to query information about those
airports. Remember that the <em>;[]</em> at the end of the query just stops the console from
displaying unwanted output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Create a map (a) of all nodes with the code property as the key</span>
<span class="tok-n">a</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">();[]</span>

<span class="tok-c1">// Show the description stored in the JFK node</span>
<span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-s1">&#39;JFK&#39;</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another useful way to work with veriables is to establish the variable and then use
the <em>fill</em> step to place the results of a query into it. The example below creates an
empty lisy called <em>german</em>. The query then finds all the vertices for airports
located in Germany and uses the <em>fill</em> step to place them into the variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">german</span> <span class="tok-o">=</span> <span class="tok-o">[]</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DE&#39;</span><span class="tok-o">).</span><span class="tok-na">fill</span><span class="tok-o">(</span><span class="tok-n">german</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then use our list as you would expect. Remember that as we are running inside
the Gremlin console we do not have to explicitly iterate through the list as you
would if you were writing a stand alone Groovy application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many results did we get back?</span>
<span class="tok-n">german</span><span class="tok-o">.</span><span class="tok-na">size</span>

<span class="tok-mi">32</span>

<span class="tok-c1">// Query some values from one of the airports in the list</span>
<span class="tok-n">german</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">FRA</span>
<span class="tok-n">Frankfurt</span>

<span class="tok-c1">// Feed an entry from our list back into a traversal</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">german</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span>

<span class="tok-n">Munich</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">german</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">237</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Towards the end of the document, in the "<a href="#groovyapp">Working with TinkerGraph from a Groovy application</a>" section, we will explore
writing some stand alone Groovy code that can use the TinkerPop API and issue Gremlin
queries while running outside of the Gremlin Console as a stand alone application.</p>
</div>
<div class="sect3">
<h4 id="varaus">4.4.1. Using a variable to feed a traversal</h4>
<div class="paragraph">
<p>Sometimes it is very useful to store the result of a query in a variable and
then, later on, use that variable to start a new traversal. You may have noticed we
did that in the very last example of the prior section where we fed the <em>german</em>
variable back in to a traversal. By way of another simple
example, the code below stores the result of the first query in the variable
<em>austin</em> and then uses it to look for routes from Austin in second query.
Notice how we do this by passing the variable containing the Austin vertex
into the <em>V()</em> step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"> <span class="tok-n">austin</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>
 <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">austin</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can take this technique one step further and pass an entire saved list of
vertices to <em>V()</em>. In the next example we first generate a list of all
airports that are in Scotland and then pass that entire list into <em>V()</em> to
first of all count how many routes there are from those airports and then we
start another query that looks for any route from those airports to airports
in Germany.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find all airports in Scotland</span>
<span class="tok-n">a</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;GB-SCT&#39;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">()</span>

<span class="tok-c1">// How many routes from these airports?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-c1">// How many of those routes end up in Germany?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DE&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example of using with variables to drive traversals, we again
create a list of airports. This time we find all the airports in Texas. We
then use a Groovy <em>each</em> loop to iterate through the list. For each airport in
the list we print the code of the starting airport and then the codes of every
airport that you can fly to from there.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find all of the airports in Texas</span>
<span class="tok-n">texas</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">()</span>

<span class="tok-c1">// For each airport, print a list of all the airports that you can fly to from there.</span>
<span class="tok-n">texas</span><span class="tok-o">.</span><span class="tok-na">each</span> <span class="tok-o">{</span><span class="tok-n">println</span> <span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;===&gt;&quot;</span> <span class="tok-o">+</span>
                    <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">it</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">()}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example, which is admittedly a bit contrived, we use a variable inside of a
<em>has</em> step. We initially create a list containing all of the IATA codes for each
airport in the graph. We then iterate through that list and calculate how many
outgoing routes there are from each place and print out a string containing the
airport IATA code and the count for that airport.Note that this could easily be done
just using a Gremlin query with no additional Groovy code. The point of this example
is more to show another example of mixing Gremlin, Groovy and variables.
Knowing that you can do this kind of thing may come in useful as you start to write
more complicated graph database applications that use Gremlin.  You will see this
type of query done using just Gremlin in the section called "<a href="#unwantededges">Finding unwanted parallel edges</a>""
later in this document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">m</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">()</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">a</span> <span class="tok-k">in</span> <span class="tok-n">m</span><span class="tok-o">)</span> <span class="tok-n">println</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; : &quot;</span> <span class="tok-o">+</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">a</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, here is an example that uses an array of values to seed a query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;RDU&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;MCO&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">].</span>
     <span class="tok-n">each</span> <span class="tok-o">{</span><span class="tok-n">println</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;JFK&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span>
                         <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">it</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output from running the code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">JFK</span><span class="tok-o">,</span> <span class="tok-mi">1520</span><span class="tok-o">,</span> <span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JFK</span><span class="tok-o">,</span> <span class="tok-mi">427</span><span class="tok-o">,</span> <span class="tok-n">RDU</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JFK</span><span class="tok-o">,</span> <span class="tok-mi">945</span><span class="tok-o">,</span> <span class="tok-n">MCO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JFK</span><span class="tok-o">,</span> <span class="tok-mi">3440</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JFK</span><span class="tok-o">,</span> <span class="tok-mi">1390</span><span class="tok-o">,</span> <span class="tok-n">DFW</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="addnodes">4.5. Adding nodes, edges and properties</h3>
<div class="paragraph">
<p>So far in this document we have largely focussed on loading a graph from a file and
running queries against it. As you start to build your own graphs you will not always
start with a graph saved as a text file in GraphML, CSV, GraphSON or some other
format. You may start with an empty graph and incrementally add nodes and edges. Just
as likely you may start with a graph like the air routes graph, read from a file, but
want to add nodes, edges and properties to it over time. In this section we will
explore various ways of doing just that.</p>
</div>
<div class="paragraph">
<p>Nodes and edges can be added directly to the graph using the <em>graph</em> object or as
part of a graph traversal. We will look at both of these techniques over course of
the following pages.</p>
</div>
<div class="sect3">
<h4 id="_adding_an_airport_node_and_a_route_edge">4.5.1. Adding an airport (node) and a route (edge)</h4>
<div class="paragraph">
<p>The following code uses the <em>graph</em> object that we created when we fist loaded the
air-routes graph to create a new airport node (vertex) and then adds a route (edge)
from it to the existing DFW node. We can specify the label name (<em>airport</em>) and as
many properties as we wish to while creating the node.  In this case we just provide
three. We can additionally add and delete node properties after a node has been
created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Add an imaginary airport with a code of &#39;XYZ&#39; and connect it to DFW</span>
<span class="tok-n">xyz</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">addVertex</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span>
                      <span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;XYZ&#39;</span><span class="tok-o">,</span>
                      <span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;KXYZ&#39;</span><span class="tok-o">,</span>
                      <span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;This is not a real airport&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Find the DFW node</span>
<span class="tok-n">dfw</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-c1">// Create a route from our new airport to DFW</span>
<span class="tok-n">xyz</span><span class="tok-o">.</span><span class="tok-na">addEdge</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">,</span><span class="tok-n">dfw</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In many cases it is more convenient to perform each of the previous operations using
just the traversal object <em>g</em>. The following example does just that. We first create
a new aiport node for our imaginary airport and store it&#8217;s vertex in the variable
<em>xyz</em>. We can then use that stored value when we create the edge also using a
traversal. As with many parts of the Gremlin language, there is more than one way to
achieve the same results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Add an imaginary airport with a code of &#39;XYZ&#39; and connect it to DFW</span>
<span class="tok-n">xyz</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;XYZ&#39;</span><span class="tok-o">).</span>
                        <span class="tok-n">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;KXYZ&#39;</span><span class="tok-o">).</span>
                        <span class="tok-n">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;This is not a real airport&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice, in the code above, how each property step can be chained to the previous one
when adding multiple properties. Whether you need to do it while creating a node or
to add and edit properties on a node at a later date you can use the same <em>property</em>
step.</p>
</div>
<div class="paragraph">
<p>We can now add a route from DFW to XYZ. We are able
to use our <em>xyz</em> variable to specify the destination of the new route using a <em>to</em>
step and wrapping the variable inside of a <em>V</em> step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Add a route from DFW to XYZ</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-n">V</span><span class="tok-o">(</span><span class="tok-n">xyz</span><span class="tok-o">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could have written the previous line like this if we had not previously saved
anything in a variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-n">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;XYZ&#39;</span><span class="tok-o">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We might also want to add a returning route from XYZ back to DFW. We can do this
using the <em>from</em> step in a similar way as we used the <em>to</em> step above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Add the return route back to DFW</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-n">V</span><span class="tok-o">(</span><span class="tok-n">xyz</span><span class="tok-o">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way that we could have chosen to create our edge is by naming things using
<em>as</em> steps. Note also there is more than one way to define the direction of an edge.
Two examples are shown below. One uses the <em>addOutE</em> step and the other uses the
<em>outE</em> and <em>to</em> combination. Notice also how the <em>V</em> step was used below to
essentially start a new traversal midway through the current one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;XYZ&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">addOutE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;XYZ&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see a bigger example that uses <em>as</em> to name steps in the "<a href="#testgraph">Quickly building a graph for testing</a>"
section that is coming up soon.</p>
</div>
</div>
<div class="sect3">
<h4 id="proptraversal">4.5.2. Using a traversal to seed a property with a list</h4>
<div class="paragraph">
<p>You can use the results of a traversal to create or update properties. The example
below creates a new property called <em>places</em> for the Austin airport vertex. The
values of the property are the results of finding all of the places that you can
travel to from that airport and folding their <em>code</em> values into a list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Add a list as a property value</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;places&#39;</span><span class="tok-o">,</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use a <em>valueMap</em> step to make sure the property was created as we expected it
to be. As you can see a new property called <em>places</em> has been created containing as
it&#8217;s value a list of codes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;places&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">places:</span><span class="tok-o">[[</span><span class="tok-n">YYZ</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-n">FRA</span><span class="tok-o">,</span> <span class="tok-n">MEX</span><span class="tok-o">,</span> <span class="tok-n">PIT</span><span class="tok-o">,</span> <span class="tok-n">PDX</span><span class="tok-o">,</span> <span class="tok-n">CLT</span><span class="tok-o">,</span> <span class="tok-n">CUN</span><span class="tok-o">,</span> <span class="tok-n">MEM</span><span class="tok-o">,</span> <span class="tok-n">CVG</span><span class="tok-o">,</span> <span class="tok-n">IND</span><span class="tok-o">,</span> <span class="tok-n">MCI</span><span class="tok-o">,</span> <span class="tok-n">DAL</span><span class="tok-o">,</span> <span class="tok-n">STL</span><span class="tok-o">,</span> <span class="tok-n">ABQ</span><span class="tok-o">,</span> <span class="tok-n">MDW</span><span class="tok-o">,</span> <span class="tok-n">LBB</span><span class="tok-o">,</span> <span class="tok-n">HRL</span><span class="tok-o">,</span> <span class="tok-n">GDL</span><span class="tok-o">,</span> <span class="tok-n">PNS</span><span class="tok-o">,</span> <span class="tok-n">VPS</span><span class="tok-o">,</span> <span class="tok-n">SFB</span><span class="tok-o">,</span> <span class="tok-n">BKG</span><span class="tok-o">,</span> <span class="tok-n">PIE</span><span class="tok-o">,</span> <span class="tok-n">ATL</span><span class="tok-o">,</span> <span class="tok-n">BNA</span><span class="tok-o">,</span> <span class="tok-n">BOS</span><span class="tok-o">,</span> <span class="tok-n">BWI</span><span class="tok-o">,</span> <span class="tok-n">DCA</span><span class="tok-o">,</span> <span class="tok-n">DFW</span><span class="tok-o">,</span> <span class="tok-n">FLL</span><span class="tok-o">,</span> <span class="tok-n">IAD</span><span class="tok-o">,</span> <span class="tok-n">IAH</span><span class="tok-o">,</span> <span class="tok-n">JFK</span><span class="tok-o">,</span> <span class="tok-n">LAX</span><span class="tok-o">,</span> <span class="tok-n">MCO</span><span class="tok-o">,</span> <span class="tok-n">MIA</span><span class="tok-o">,</span> <span class="tok-n">MSP</span><span class="tok-o">,</span> <span class="tok-n">ORD</span><span class="tok-o">,</span> <span class="tok-n">PHX</span><span class="tok-o">,</span> <span class="tok-n">RDU</span><span class="tok-o">,</span> <span class="tok-n">SEA</span><span class="tok-o">,</span> <span class="tok-n">SFO</span><span class="tok-o">,</span> <span class="tok-n">SJC</span><span class="tok-o">,</span> <span class="tok-n">TPA</span><span class="tok-o">,</span> <span class="tok-n">SAN</span><span class="tok-o">,</span> <span class="tok-n">LGB</span><span class="tok-o">,</span> <span class="tok-n">SNA</span><span class="tok-o">,</span> <span class="tok-n">SLC</span><span class="tok-o">,</span> <span class="tok-n">LAS</span><span class="tok-o">,</span> <span class="tok-n">DEN</span><span class="tok-o">,</span> <span class="tok-n">MSY</span><span class="tok-o">,</span> <span class="tok-n">EWR</span><span class="tok-o">,</span> <span class="tok-n">HOU</span><span class="tok-o">,</span> <span class="tok-n">ELP</span><span class="tok-o">,</span> <span class="tok-n">CLE</span><span class="tok-o">,</span> <span class="tok-n">OAK</span><span class="tok-o">,</span> <span class="tok-n">PHL</span><span class="tok-o">,</span> <span class="tok-n">DTW</span><span class="tok-o">]]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To gain access to these values from your code or Gremlin console queries, we can use
the <em>next</em> step. A simple example is given below where <em>values</em> is used to retrieve
the values of the <em>places</em> property and then we use <em>size</em> to see how many entries
there are in the list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;places&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">size</span><span class="tok-o">()</span>

<span class="tok-mi">59</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once we have access to the list of values we can access them using the normal Groovy
array syntax. The example below returns the three values with an index between 2 and
4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;places&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()[</span><span class="tok-mi">2</span><span class="tok-o">..</span><span class="tok-mi">4</span><span class="tok-o">]</span>

<span class="tok-n">FRA</span>
<span class="tok-n">MEX</span>
<span class="tok-n">PIT</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="testgraph">4.5.3. Quickly building a graph for testing</h4>
<div class="paragraph">
<p>Sometimes for testing and for when you want to report a problem or ask for help on a
mailing list it is handy to have a small stand alone graph that you can use. The code
below will create a mini version of the air routes graph in the Gremlin Console. Note
how all of the nodes and edges are created in a single query with each step joined
together.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span><span class="tok-o">=</span><span class="tok-n">TinkerGraph</span><span class="tok-o">.</span><span class="tok-na">open</span><span class="tok-o">()</span>
<span class="tok-n">g</span><span class="tok-o">=</span><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">()</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;lax&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;JFK&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;jfk&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;ATL&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;atl&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;atl&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;atl&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;atl&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;jfk&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;jfk&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;lax&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;lax&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;jfk&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;lax&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;lax&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="addloop">4.5.4. Adding nodes and edges using a loop</h4>
<div class="paragraph">
<p>Sometimes it is more efficient to define the details of the nodes or edges that
you plan to add to the graph in an array and then add each node or edge using a
simple <em>for</em> loop that iterates over it. The following  example adds our
imaginary airports directly to the graph using such a loop. Notice that we do
not have to specify the ID that we want each vertex to have. The graph will
assign a unique ID to each new node for us.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">nodes</span> <span class="tok-o">=</span> <span class="tok-o">[[</span><span class="tok-s2">&quot;WYZ&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;KWYZ&quot;</span><span class="tok-o">],[</span><span class="tok-s2">&quot;XYZ&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;KXYZ&quot;</span><span class="tok-o">]]</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">a</span> <span class="tok-k">in</span> <span class="tok-n">nodes</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">addVertex</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">],</span><span class="tok-s2">&quot;iata&quot;</span><span class="tok-o">,</span><span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">])}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also have added the nodes using the traversal object <em>g</em> as follows. Notice
the call to <em>next()</em>.  Without this the node creation will not work as expected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">nodes</span> <span class="tok-o">=</span> <span class="tok-o">[[</span><span class="tok-s2">&quot;WYZ&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;KWYZ&quot;</span><span class="tok-o">],[</span><span class="tok-s2">&quot;XYZ&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;KXYZ&quot;</span><span class="tok-o">]]</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">a</span> <span class="tok-k">in</span> <span class="tok-n">nodes</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">],</span><span class="tok-s2">&quot;iata&quot;</span><span class="tok-o">,</span><span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]).</span><span class="tok-na">next</span><span class="tok-o">()}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This technique of creating nodes and/or edges using a <em>for</em> loop can also be useful
when working with graphs remotely over HTTP connections. It is a very convenient way
to combine a set of creation steps into a single REST API call.</p>
</div>
<div class="paragraph">
<p>If you prefer a more Groovy like syntax you can also do this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">nodes</span> <span class="tok-o">=</span> <span class="tok-o">[[</span><span class="tok-s2">&quot;WYZ&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;KWYZ&quot;</span><span class="tok-o">],[</span><span class="tok-s2">&quot;XYZ&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;KXYZ&quot;</span><span class="tok-o">]]</span>
<span class="tok-n">nodes</span><span class="tok-o">.</span><span class="tok-na">each</span> <span class="tok-o">{</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-n">it</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">],</span><span class="tok-s2">&quot;iata&quot;</span><span class="tok-o">,</span><span class="tok-n">it</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]).</span><span class="tok-na">next</span><span class="tok-o">()}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deleting">4.6. Deleting nodes, edges and properties</h3>
<div class="paragraph">
<p>So far in this document we have looked at several examples where we created new
nodes, edges and properties but we have not yet looked at how we can delete them.
Gremlin provides the <em>drop</em> step that we can use to remove things from a graph.</p>
</div>
<div class="sect3">
<h4 id="_deleting_a_node">4.6.1. Deleting a node</h4>
<div class="paragraph">
<p>In some of our earlier examples we created a fictitious airport node with a code of
<em>XYZ</em> and added it to the air routes graph. If we now wanted to delete it we could
use the following Gremlin code. Note that removing the node will also remove any
edges we created connected to that node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Remove the XYZ node</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;XYZ&#39;</span><span class="tok-o">).</span><span class="tok-na">drop</span><span class="tok-o">()</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deleting_an_edge">4.6.2. Deleting an edge</h4>
<div class="paragraph">
<p>We can also use <em>drop</em> to remove specific edges. The following code
will remove the flights, in both directions between AUS and LHR.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Remove the flight from AUS to LHR  (both directions).</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">drop</span><span class="tok-o">()</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">drop</span><span class="tok-o">()</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deleting_a_property">4.6.3. Deleting a property</h4>
<div class="paragraph">
<p>Lastly, we can use <em>drop</em> to delete a specific property value from a specific node.
Let&#8217;s start by querying the properties defined by the air-routes graph for the San
Francisco airport.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SFO&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-nl">country:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">SFO</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">11870</span><span class="tok-o">],</span><span class="tok-nl">city:</span><span class="tok-o">[</span><span class="tok-n">San</span> <span class="tok-n">Francisco</span><span class="tok-o">],</span><span class="tok-nl">elev:</span><span class="tok-o">[</span><span class="tok-mi">13</span><span class="tok-o">],</span><span class="tok-nl">icao:</span><span class="tok-o">[</span><span class="tok-n">KSFO</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">122.375</span><span class="tok-o">],</span><span class="tok-nl">type:</span><span class="tok-o">[</span><span class="tok-n">airport</span><span class="tok-o">],</span><span class="tok-nl">region:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">CA</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">37.6189994812012</span><span class="tok-o">],</span><span class="tok-nl">desc:</span><span class="tok-o">[</span><span class="tok-n">San</span> <span class="tok-n">Francisco</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s now drop the <em>desc</em> property and re-query the property values to prove that it has
been deleted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SFO&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">).</span><span class="tok-na">drop</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SFO&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-nl">country:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">SFO</span><span class="tok-o">],</span><span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">11870</span><span class="tok-o">],</span><span class="tok-nl">city:</span><span class="tok-o">[</span><span class="tok-n">San</span> <span class="tok-n">Francisco</span><span class="tok-o">],</span><span class="tok-nl">elev:</span><span class="tok-o">[</span><span class="tok-mi">13</span><span class="tok-o">],</span><span class="tok-nl">icao:</span><span class="tok-o">[</span><span class="tok-n">KSFO</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">122.375</span><span class="tok-o">],</span><span class="tok-nl">type:</span><span class="tok-o">[</span><span class="tok-n">airport</span><span class="tok-o">],</span><span class="tok-nl">region:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">CA</span><span class="tok-o">],</span><span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">37.6189994812012</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to delete all of the properties currently associated with the SFO
airport node we could do that as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SFO&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">drop</span><span class="tok-o">()</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_removing_all_the_edges_or_nodes_in_the_graph">4.6.4. Removing all the edges or nodes in the graph</h4>
<div class="paragraph">
<p>This may not be something you want to do very often, but should you wish to remove
every edge in the graph you could do it, using the traversal object, <em>g</em>, as follows.
Note that for very large graphs this may not be the most efficient way of doing it
depending upon how the graph store handles this request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Remove all the edges from the graph</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">drop</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could also use the <em>graph</em> object to do this. The code below uses the graph
object to retrieve all of the edges and then iterates over them dropping them one by
one. Again for very large graphs this may not be an ideal approach is this requires
reading all of the edge definitions into memory. Note that in this case we call the
<em>remove</em> method rather than use <em>drop</em> as we are not using a graph traversal in this
case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Remove all the edges from the graph</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">edges</span><span class="tok-o">().</span><span class="tok-na">each</span><span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">remove</span><span class="tok-o">()}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could also delete the whole graph, nodes and edges, by deleting all of the
nodes!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Delete the entire graph!</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">drop</span><span class="tok-o">()</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pkvrevisited">4.7. Property keys and values revisited</h3>
<div class="paragraph">
<p>We have already looked, earlier in the document,  at numerous queries that retrieve,
create or manipulate in some way the value of a given property. There are still
however a few things that we have not covered in any detail concerning properties.
Most of the property values we have looked at so far have been simple types such as a
String or an Integer. In this section we shall look more closely at properties and
explain how they can in fact be used to store lists and sets of values. We will also
introduce in this section the concept of a property ID.</p>
</div>
<div class="sect3">
<h4 id="vertexprop">4.7.1. The <em>Property</em> and <em>VertexProperty</em> interfaces</h4>
<div class="paragraph">
<p>In a TinkerPop 3 enabled graph, all properties are implementations of the
Property interface. Vertices implement the <em>VertexProperty</em> interface which itself
implements <em>Property</em>. These interfaces are documented as part of the Apache
TinkerPop 3 JavaDoc.  The interface defines the methods that you can use when working
with a vertex property object in your code. One important thing to note about vertex
properties is that they are immutable. You can create them but once created they
cannot be updated.</p>
</div>
<div class="paragraph">
<p>We will look more closely at the Java interfaces that TinkerPop 3 defines in the
"<a href="#javatinker">Working with TinkerGraph from Java Application</a>" section a bit later in this document.</p>
</div>
<div class="paragraph">
<p>The VertexProperty interface does not define any "setter" methods
beyond the basic constructor itself. Your immediate reaction to this is likely to be
"but I know you can change a property&#8217;s value using the <em>property</em> step". Indeed we
have already discussed doing just that in this document. However, behind the scenes,
what actually happens when you change a property, is that a new property object is
created and used to replace the prior one. We will examine this more in a minute but
first let&#8217;s revisit a few of the basic concepts of properties.</p>
</div>
<div class="paragraph">
<p>In a <em>property graph</em> both nodes and edges can contain one or more properties. We
have already seen a query like the one below that retrieves the values from each of
the property keys associated with the DFW airport node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">()</span>

<span class="tok-n">US</span>
<span class="tok-n">DFW</span>
<span class="tok-mi">13401</span>
<span class="tok-n">Dallas</span>
<span class="tok-mi">607</span>
<span class="tok-n">KDFW</span>
<span class="tok-o">-</span><span class="tok-mf">97.0380020141602</span>
<span class="tok-n">airport</span>
<span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span>
<span class="tok-mi">7</span>
<span class="tok-mf">32.896800994873</span>
<span class="tok-n">Dallas</span><span class="tok-o">/</span><span class="tok-n">Fort</span> <span class="tok-n">Worth</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What we have not mentioned so far, however, is that the previous query is a shortened
form of this one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">value</span><span class="tok-o">()</span>

<span class="tok-n">US</span>
<span class="tok-n">DFW</span>
<span class="tok-mi">13401</span>
<span class="tok-n">Dallas</span>
<span class="tok-mi">607</span>
<span class="tok-n">KDFW</span>
<span class="tok-o">-</span><span class="tok-mf">97.0380020141602</span>
<span class="tok-n">airport</span>
<span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span>
<span class="tok-mi">7</span>
<span class="tok-mf">32.896800994873</span>
<span class="tok-n">Dallas</span><span class="tok-o">/</span><span class="tok-n">Fort</span> <span class="tok-n">Worth</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to retrieve the VertexProperty (<em>vp</em>) objects for each of the properties
associated with the DFW node we could do that too. In a lot of cases it will be
sufficient just to use <em>values</em> or <em>valueMap</em> to access the values of one or more
properties but there are some cases, as we shall see when we look at property IDs,
where having access to the vertex property object itself is useful.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">()</span>

<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">country</span><span class="tok-o">-&gt;</span><span class="tok-n">US</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">code</span><span class="tok-o">-&gt;</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">longest</span><span class="tok-o">-&gt;</span><span class="tok-mi">13401</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">city</span><span class="tok-o">-&gt;</span><span class="tok-n">Dallas</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">elev</span><span class="tok-o">-&gt;</span><span class="tok-mi">607</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">icao</span><span class="tok-o">-&gt;</span><span class="tok-n">KDFW</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">lon</span><span class="tok-o">-&gt;-</span><span class="tok-mf">97.0380020141602</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">type</span><span class="tok-o">-&gt;</span><span class="tok-n">airport</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">region</span><span class="tok-o">-&gt;</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">runways</span><span class="tok-o">-&gt;</span><span class="tok-mi">7</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">lat</span><span class="tok-o">-&gt;</span><span class="tok-mf">32.896800994873</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">desc</span><span class="tok-o">-&gt;</span><span class="tok-n">Dallas</span><span class="tok-o">/</span><span class="tok-n">Fort</span> <span class="tok-n">Worth</span> <span class="tok-n">In</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have already seen how each property on a vertex or edge is represented as a key
and value pair. If we wanted to retrieve a list of all of the property keys
associated with a given node we could write a query like the one below that finds all
of the property keys associated with the DFW node in the air-routes graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">key</span><span class="tok-o">()</span>

<span class="tok-n">country</span>
<span class="tok-n">code</span>
<span class="tok-n">longest</span>
<span class="tok-n">city</span>
<span class="tok-n">elev</span>
<span class="tok-n">icao</span>
<span class="tok-n">lon</span>
<span class="tok-n">type</span>
<span class="tok-n">region</span>
<span class="tok-n">runways</span>
<span class="tok-n">lat</span>
<span class="tok-n">desc</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could likewise find the names, with duplicates removed, of any property keys
associated with any outgoing edges from the DFW node using this query. Note that edge
properties are implementations of <em>Property</em> and not <em>VertexProperty</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">key</span><span class="tok-o">().</span><span class="tok-na">dedup</span><span class="tok-o">()</span>

<span class="tok-n">dist</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the fact that we now know how to specifically reference both the key and
value parts of any property to construct a query like the one below that adds up the
total length of all the longest runway values and number of runways in the graph and
groups them by property key first and sum of the values second.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s2">&quot;runways&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;longest&quot;</span><span class="tok-o">).</span>
                          <span class="tok-n">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">key</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">value</span><span class="tok-o">().</span><span class="tok-na">sum</span><span class="tok-o">())</span>

<span class="tok-o">[</span><span class="tok-nl">longest:</span><span class="tok-mi">25497644</span><span class="tok-o">,</span> <span class="tok-nl">runways:</span><span class="tok-mi">4816</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="propmap">4.7.2. The <em>propertyMap</em> traversal step</h4>
<div class="paragraph">
<p>We have previously used the <em>valueMap</em> step to produce a map of key/value pairs for
all of the properties associated with a node or edge. There is also a <em>propertyMap</em>
step that can be used that yields a similar result but the map includes the vertex
property objects for each property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">propertyMap</span><span class="tok-o">()</span>
<span class="tok-o">[</span><span class="tok-nl">country:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">country</span><span class="tok-o">-&gt;</span><span class="tok-n">US</span><span class="tok-o">]],</span> <span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">code</span><span class="tok-o">-&gt;</span><span class="tok-n">AUS</span><span class="tok-o">]],</span> <span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">longest</span><span class="tok-o">-&gt;</span><span class="tok-mi">12250</span><span class="tok-o">]],</span> <span class="tok-nl">city:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">city</span><span class="tok-o">-&gt;</span><span class="tok-n">Austin</span><span class="tok-o">]],</span> <span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">lon</span><span class="tok-o">-&gt;-</span><span class="tok-mf">97.6698989868164</span><span class="tok-o">]],</span> <span class="tok-nl">type:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">type</span><span class="tok-o">-&gt;</span><span class="tok-n">airport</span><span class="tok-o">]],</span> <span class="tok-nl">places:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">places</span><span class="tok-o">-&gt;[</span><span class="tok-n">YYZ</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-n">FRA</span><span class="tok-o">,</span> <span class="tok-n">MEX</span><span class="tok-o">,]],</span> <span class="tok-nl">elev:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">elev</span><span class="tok-o">-&gt;</span><span class="tok-mi">542</span><span class="tok-o">]],</span> <span class="tok-nl">icao:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">icao</span><span class="tok-o">-&gt;</span><span class="tok-n">KAUS</span><span class="tok-o">]],</span> <span class="tok-nl">region:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">region</span><span class="tok-o">-&gt;</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">]],</span> <span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">runways</span><span class="tok-o">-&gt;</span><span class="tok-mi">2</span><span class="tok-o">]],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">lat</span><span class="tok-o">-&gt;</span><span class="tok-mf">30.1944999694824</span><span class="tok-o">]],</span> <span class="tok-nl">desc:</span><span class="tok-o">[</span><span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">desc</span><span class="tok-o">-&gt;</span><span class="tok-n">Austin</span> <span class="tok-n">Bergstrom</span> <span class="tok-n">Int</span><span class="tok-o">]]]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="propid">4.7.3. Properties have IDs too</h4>
<div class="paragraph">
<p>We have seen many examples already that show how both nodes and edges have a unique
ID. What may not have been obvious however is that properties also an ID. Unlike node
and edge IDs property IDs are not guaranteed to be unique across the graph. Certainly
with TinkerGraph I have encountered cases where a node and a property share the same
ID. This is not really an issue because they are used in different ways to access
their associated graph element.</p>
</div>
<div class="paragraph">
<p>The query below returns the vertex property object (vp) for any property in the graph
that has a value of <em>London</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasValue</span><span class="tok-o">(</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">)</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">city</span><span class="tok-o">-&gt;</span><span class="tok-n">London</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">city</span><span class="tok-o">-&gt;</span><span class="tok-n">London</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">city</span><span class="tok-o">-&gt;</span><span class="tok-n">London</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">city</span><span class="tok-o">-&gt;</span><span class="tok-n">London</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">city</span><span class="tok-o">-&gt;</span><span class="tok-n">London</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">city</span><span class="tok-o">-&gt;</span><span class="tok-n">London</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At first glance, each of the values returned above looks identical. However, let&#8217;s
now query their ID values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasValue</span><span class="tok-o">(</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">).</span><span class="tok-na">id</span><span class="tok-o">()</span>

<span class="tok-mi">583</span>
<span class="tok-mi">595</span>
<span class="tok-mi">1051</span>
<span class="tok-mi">1123</span>
<span class="tok-mi">2467</span>
<span class="tok-mi">7783</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see each property has a different, and unique, ID. We can use these ID
values in other queries in the same way as we have for nodes and edges in some of our
earlier examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-mi">583</span><span class="tok-o">)</span>

<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">city</span><span class="tok-o">-&gt;</span><span class="tok-n">London</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can query the value of this property as you would expect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-mi">583</span><span class="tok-o">).</span><span class="tok-na">value</span><span class="tok-o">()</span>

<span class="tok-n">London</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can retrieve the name of the property key as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-mi">583</span><span class="tok-o">).</span><span class="tok-na">key</span><span class="tok-o">()</span>

<span class="tok-n">city</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also have used <em>label</em> instead of <em>key</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-mi">583</span><span class="tok-o">).</span><span class="tok-na">label</span><span class="tok-o">()</span>

<span class="tok-n">city</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also find out which element (node or edge) that this property belongs to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-mi">583</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">element</span><span class="tok-o">()</span>

<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">49</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also look at other property values of the element containing our property with
an ID of 583.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-mi">583</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">element</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">)</span>

<span class="tok-n">London</span> <span class="tok-n">Heathrow</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Should you need to you can also find out which graph this property is part of. In
this case it is part of a TinkerGraph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">graph</span><span class="tok-o">()</span>

<span class="tok-n">tinkergraph</span><span class="tok-o">[</span><span class="tok-nl">vertices:</span><span class="tok-mi">3619</span> <span class="tok-nl">edges:</span><span class="tok-mi">50148</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To further show that each property has an ID the following code retrieves a list of
all the vertex properties associated with vertex <em>V(3)</em> and prints out the property
key along with its corresponding ID.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">p</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">toList</span><span class="tok-o">()</span>
<span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">each</span> <span class="tok-o">{</span><span class="tok-n">println</span> <span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">key</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;\t:&quot;</span> <span class="tok-o">+</span> <span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">}</span>

<span class="tok-n">country</span> <span class="tok-o">:</span><span class="tok-mi">28</span>
<span class="tok-n">code</span>    <span class="tok-o">:</span><span class="tok-mi">29</span>
<span class="tok-n">longest</span> <span class="tok-o">:</span><span class="tok-mi">30</span>
<span class="tok-n">city</span>    <span class="tok-o">:</span><span class="tok-mi">31</span>
<span class="tok-n">elev</span>    <span class="tok-o">:</span><span class="tok-mi">32</span>
<span class="tok-n">icao</span>    <span class="tok-o">:</span><span class="tok-mi">33</span>
<span class="tok-n">lon</span>     <span class="tok-o">:</span><span class="tok-mi">34</span>
<span class="tok-n">type</span>    <span class="tok-o">:</span><span class="tok-mi">35</span>
<span class="tok-n">region</span>  <span class="tok-o">:</span><span class="tok-mi">36</span>
<span class="tok-n">runways</span> <span class="tok-o">:</span><span class="tok-mi">37</span>
<span class="tok-n">lat</span>     <span class="tok-o">:</span><span class="tok-mi">38</span>
<span class="tok-n">desc</span>    <span class="tok-o">:</span><span class="tok-mi">39</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you update a property, its ID value will also be changed as you have in
reality replaced the property with a new one which is allocated a new ID.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Take a look at the example below. First of all we query the ID of the <em>city</em> property
from vertex <em>V(4)</em>. Next we change its value to be <em>newname</em> and then query the
property ID again. Note that the ID has changed. As mentioned above, vertex
properties are immutable. When you update a property value using the <em>property</em> step,
a new property object is created that replaces the prior one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">id</span><span class="tok-o">()</span>

<span class="tok-mi">43</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;newname&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">id</span><span class="tok-o">()</span>

<span class="tok-mi">53361</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The fact that every property in a graph has an ID can improve performance of
accessing properties, especially in large graphs.</p>
</div>
</div>
<div class="sect3">
<h4 id="listprop">4.7.4. Attaching multiple values (lists or sets) to a single property</h4>
<div class="paragraph">
<p>A node property value can be a basic type such as a String or an Integer but it can
also be something more sophisticated such as a Set or a List containing multiple
values.  You can think of these values as being an array but depending on how you
create them you have to work with them differently. In this section we will look at
how we can create multiple values for a single property key.  Such values can be
setup when the node is first created or added afterwards. These more complex type of
property values are not supported on edges.</p>
</div>
<div class="paragraph">
<p>If we wanted to store the IATA amd ICAO codes for the Austin airport in a list
associated with a single property rather than as separate properties we could have
created them when we created the Austin node follows. You can also add properties to
an existing node that have lists of values. We will look at how to do that later in
this section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;KAUS&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By creating the <em>code</em> property in this way, its cardinality type is now effectively
<em>LIST</em> rather than <em>SINGLE</em>. While working with TinkerGraph we do not need to setup
explicit schemas for our property types. However, once we start working with a more
sophisticated graph system such as Janus Graph, that is something that we will both
want and need to be able to do. We cover the topic of cardinality in detail in the
"<a href="#janusmgmt">The Janus Graph management API</a>" section later in the document.</p>
</div>
<div class="paragraph">
<p>Now that we have created the <em>code</em> property to have a list of values we can query
either one of the values in the list. If we look at the value map we get back from
the following example queries you can see both values in the list we associated with
the property <em>code</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">KAUS</span><span class="tok-o">]]</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;KAUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">KAUS</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also query the values as normal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">()</span>
<span class="tok-n">AUS</span>
<span class="tok-n">KAUS</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also use the <em>properties</em> step to get the result back as vertex properties
(vp).  We discuss vertex properties in detail in the "<a href="#vertexprop">The <em>Property</em> and <em>VertexProperty</em> interfaces</a>" section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">()</span>

<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">code</span><span class="tok-o">-&gt;</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">code</span><span class="tok-o">-&gt;</span><span class="tok-n">KAUS</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For completeness we could also do this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasValue</span><span class="tok-o">(</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">)</span>

<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">code</span><span class="tok-o">-&gt;</span><span class="tok-n">AUS</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So now we know how to create a node with property values in a list we need a way to
update those properties. We can do this using a special form of the <em>property</em> step
where the first paramter is <em>list</em> to show that what follows are updates to the
existing list and not replacements for the whole list.</p>
</div>
<div class="paragraph">
<p>The example below adds another code that is sometimes used when talking about the
Austin airport to our list of codes. If we left off the <em>list</em> parameter the whole
property would be overwritten with a value of <em>ABIA</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-n">list</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;ABIA&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we query the properties again we can see that there are now three values for the
<em>code</em> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">()</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">code</span><span class="tok-o">-&gt;</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">code</span><span class="tok-o">-&gt;</span><span class="tok-n">KAUS</span><span class="tok-o">]</span>
<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">code</span><span class="tok-o">-&gt;</span><span class="tok-n">ABIA</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can observe the same thing by looking at our <em>valueMap</em> results again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">KAUS</span><span class="tok-o">,</span><span class="tok-n">ABIA</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to delete one of the properties from the list we can do it using <em>drop</em>.
If we look the value map after dropping <em>ABIA</em> we can indeed see that it is gone from
the list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasValue</span><span class="tok-o">(</span><span class="tok-s1">&#39;ABIA&#39;</span><span class="tok-o">).</span><span class="tok-na">drop</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">KAUS</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to drop an entire property containing one or more values we can do it as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">drop</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To add multiple values to the same property key in the same query we just need to
chain the <em>property</em> steps together as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">property</span><span class="tok-o">(</span><span class="tok-n">list</span><span class="tok-o">,</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Austin Airport&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">property</span><span class="tok-o">(</span><span class="tok-n">list</span><span class="tok-o">,</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Bergstrom&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This technique can be used to update an existing property that already has a list
of values or to add a new property with a list of values.</p>
</div>
<div class="paragraph">
<p>The same value can appear more than once with a property that has LIST cardinality.
The code fragment below creates a new node, with some duplicate values associated
with the <em>dups</em> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;test&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;dups&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;one&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;dups&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;two&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;dups&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;one&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;test&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-nl">dups:</span><span class="tok-o">[</span><span class="tok-n">one</span><span class="tok-o">,</span><span class="tok-n">two</span><span class="tok-o">,</span><span class="tok-n">one</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can add additional duplicate values after the node has been created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;test&#39;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-n">list</span><span class="tok-o">,</span><span class="tok-s1">&#39;dups&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;two&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;test&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-nl">dups:</span><span class="tok-o">[</span><span class="tok-n">one</span><span class="tok-o">,</span><span class="tok-n">two</span><span class="tok-o">,</span><span class="tok-n">one</span><span class="tok-o">,</span><span class="tok-n">two</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So far we have just created values in a list that have <em>LIST</em> cardinality which means
that duplicate values are allowed. If we wanted to prevent that from
happening we can use the <em>set</em> keyword when adding properties to force a cardinality
of <em>SET</em>.</p>
</div>
<div class="paragraph">
<p>In the example below we create a new property called <em>hw</em> for vertex <em>V(3)</em> with
multiple values but using the <em>set</em> keyword rather than the <em>list</em> keyword that we
have used previously. We then look at the valueMap for the <em>hw</em> property to check
that inded our set was created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-n">set</span><span class="tok-o">,</span><span class="tok-s1">&#39;hw&#39;</span><span class="tok-o">,</span><span class="tok-s2">&quot;hello&quot;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-n">set</span><span class="tok-o">,</span><span class="tok-s1">&#39;hw&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;world&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;hw&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">hw:</span><span class="tok-o">[</span><span class="tok-n">hello</span><span class="tok-o">,</span><span class="tok-n">world</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s now test that our set is really working as a set by adding a couple of
additional values. Note that we have already added the value <em>hello</em> in the prior
steps so with the cardinality being <em>SET</em> we expect that value to be ignored as there
is aready a value of <em>hello</em> in the set. We again display the valueMap to prove that
the set only has unique values in it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-n">set</span><span class="tok-o">,</span><span class="tok-s1">&#39;hw&#39;</span><span class="tok-o">,</span><span class="tok-s2">&quot;hello&quot;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-n">set</span><span class="tok-o">,</span><span class="tok-s1">&#39;hw&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;apple&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;hw&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">hw:</span><span class="tok-o">[</span><span class="tok-n">hello</span><span class="tok-o">,</span><span class="tok-n">world</span><span class="tok-o">,</span><span class="tok-n">apple</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the other examples we have shown in this section are not the same as just
adding a list directly as a property value. In the example below the entire list is
treated as a single value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">,[</span><span class="tok-s1">&#39;AAAA&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;BBBB&#39;</span><span class="tok-o">])</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">x:</span><span class="tok-o">[[</span><span class="tok-n">AAAA</span><span class="tok-o">,</span><span class="tok-n">BBBB</span><span class="tok-o">]]]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="metaprop">4.7.5. Adding properties to other properties (meta properties)</h4>
<div class="paragraph">
<p>TinkerPop 3 introduced the ability to add a property to another property. Think of
this in a way as being able to add a bit of metadata about a property to the property
itself. This capability, not surprisingly, is often referred to as <em>"adding a meta
property to a property"</em>. There are a number of use cases where this capability can
be extremely useful. Common ones might be adding a date that a property was last
updated or perhaps adding access control information to a property.</p>
</div>
<div class="paragraph">
<p>The example below adds a meta property with a key of <em>date</em> and a value of <em>6/6/2017</em>
to the property with a key of <em>code</em> and a value of <em>AUS</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasValue</span><span class="tok-o">(</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;date&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;6/6/2017&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wanted to add the date to the <em>code</em> property regardless of its current value,
then you could just do this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;date&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;6/6/2017&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can retrieve all of the meta properties on a specific property, such as the <em>code</em>
property as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">()</span>

<span class="tok-n">p</span><span class="tok-o">[</span><span class="tok-n">date</span><span class="tok-o">-&gt;</span><span class="tok-mi">6</span><span class="tok-s">/6/</span><span class="tok-mi">2017</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to find all the properties associated with the AUS vertex that have a
meta property with a date of <em>6/6/2017</em> you can do that as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;date&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;6/6/2017&#39;</span><span class="tok-o">)</span>

<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">code</span><span class="tok-o">-&gt;</span><span class="tok-n">AUS</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can query for a specific meta property as follows, which will return any meta
properties that have a key of <em>date</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasValue</span><span class="tok-o">(</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;date&#39;</span><span class="tok-o">)</span>

<span class="tok-n">p</span><span class="tok-o">[</span><span class="tok-n">date</span><span class="tok-o">-&gt;</span><span class="tok-mi">6</span><span class="tok-s">/6/</span><span class="tok-mi">2017</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add multiple meta properties to a property while creating it. The following
will add a property called <em>comment</em> to vertex <em>V(3)</em> and also add two meta
properties to it representing the date the comment was made and who made it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;comment&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;I like this airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;date&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;6/6/2017&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;user&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Kelvin&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can query the graph to make sure everything worked as expected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;comment&#39;</span><span class="tok-o">)</span>

<span class="tok-n">vp</span><span class="tok-o">[</span><span class="tok-n">Comment</span><span class="tok-o">-&gt;</span><span class="tok-n">I</span> <span class="tok-n">like</span> <span class="tok-k">this</span> <span class="tok-n">airport</span><span class="tok-o">]</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;comment&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">()</span>

<span class="tok-n">p</span><span class="tok-o">[</span><span class="tok-n">date</span><span class="tok-o">-&gt;</span><span class="tok-mi">6</span><span class="tok-s">/6/</span><span class="tok-mi">2017</span><span class="tok-o">]</span>
<span class="tok-n">p</span><span class="tok-o">[</span><span class="tok-n">user</span><span class="tok-o">-&gt;</span><span class="tok-n">Kelvin</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <em>drop</em> to remove meta properties but take care when doing so.
Take a look at the query below, which looks like it might
drop the meta property <em>date</em>, but will in fact drop whole node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">hasValue</span><span class="tok-o">(</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;date&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;6/6/2017&#39;</span><span class="tok-o">).</span><span class="tok-na">drop</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To remove a single meta property we need to use drop in this way</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;date&#39;</span><span class="tok-o">).</span><span class="tok-na">drop</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you cannot chain meta properties together endlessly. The main properties on
a node are <em>VertexProperty</em> types. The meta property is a <em>Property</em> type and you
cannot add another property to those.  You can however add more than one meta
property to the same vertex property.</p>
</div>
<div class="paragraph">
<p>So as mentioned above, the meta property provides a way to attach metadata to another
property. This enables a number of important use cases including being able to attach
a date or ACL information to individual properties.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lam">4.8. Using Lambda functions</h3>
<div class="paragraph">
<p>Gremlin allows you to put a code fragment (sometimes called a Lambda function or a
closure) as part of a query. This is typically done as part of a <em>filter</em> or
<em>sideEffect</em> step but there are other places where you wll find this concept used.
This technique provides a lot of additional flexibility in how queries can be
written. However, care should be used. When processing your query, Gremlin wil try to
optimize it as best as it can. For regular traversal steps such as <em>out</em> and
<em>has</em> Gremlin will do this optimization for you. However for closures (code inside
braces <em>{}</em>) Gremlin cannot do this and will just pass the closure on to the
underlying runtime.  With people just getting started with Gremlin there is a great
temptation to over use in-line code. This is a natural thing to want to do as for
programmers it feels like the programming they are used to. However, there is often,
if not always, a pure Gremlin traversal step that can be used to do what is needed.
Of course with all rules there are exceptions.   Here is an example of a closure
being used where a <em>has</em> step could and should have been used instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// What airports are located in London?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">filter</span><span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">value</span><span class="tok-o">()</span> <span class="tok-o">==</span><span class="tok-s2">&quot;London&quot;</span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the same query just using the <em>has()</em> step. This is a case where we
should not be using a lambda function as Gremlin can handle this just fine all
by itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// What airports are located in London?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>I think you will agree that the second version is a lot simpler to read and
enables Gremlin to do its thing.</p>
</div>
<div class="paragraph">
<p>For completeness, here is an example of a query that contains a <em>sideEffect</em> step.
The main part of the query finds airports with 6 runways and counts them. That result
will still be returned but the side effect will also cause the codes of those
airports to also be printed. This is a bit of a contrived example but it shows how
<em>sideEffect</em> behaves.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Example of the &#39;sideEffect&#39; step</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">).</span><span class="tok-na">sideEffect</span><span class="tok-o">{</span><span class="tok-n">print</span> <span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()+</span><span class="tok-s2">&quot; &quot;</span><span class="tok-o">}.</span><span class="tok-na">count</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The moral here is, avoid closures unless you can genuinely find no other way to
achieve what you need. It is fair I think to observe that sometimes coming up with a
closure to do what you want is easier than figuring out the pure Gremlin way to do it
but if at all possible using just Gremlin steps is still the recommended path to
take. Lambda functions in general are discouraged.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="mapstep">4.8.1. Introducing the <em>Map</em> step</h4>
<div class="paragraph">
<p>The <em>map</em> step will be familiar to users of programming languages such as Ruby,
Python or indeed Groovy. It is often useful to be able to take a set of results, or
in the case of Gremlin, the current state of a graph traversal, and modify it in some
way before passing on those results to the next part of the traversal. This is what
the <em>map</em> step allows us to do.</p>
</div>
<div class="paragraph">
<p>Take a look at the query below. It simply returns us a list containing the IDs of the
first ten airports in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">id</span><span class="tok-o">().</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">,</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">10</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s say we wanted to write a query, similar to the one above, that will modify each
of those IDs returned in the query above by adding one to each. Take a look at the
query below. We have introduced a <em>map</em> step. The <em>map</em> step takes as a parameter a
closure (or lambda) function telling it how we want it to operate on the values
flowing in to it. The <em>it</em> is Groovy syntax for the thing that came in (in this case
a vertex. The <em>get</em> is needed to gain access to the properties of the vertex inside
of a lambda expression. Lastly we get the <em>id</em> of the vertex and add one to it. The
modified values are then passed on to the next step of the traversal where they are
made into a list by the <em>fold</em> step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">map</span><span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">id</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">}.</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">,</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">10</span><span class="tok-o">,</span><span class="tok-mi">11</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is an area where Groovy and Java have a similar but different syntax.
If you wanted to use the query above in a Java program you would need to use the
Java lambda function syntax.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>What is nice about the <em>map</em> step is that it allows us to do within the query itself
what we would otherwise have to do after the query was over using a <em>for each</em> type
of loop construct.</p>
</div>
<div class="paragraph">
<p>One other thing to note about the <em>map</em> step is that the closure provided can have
multiple steps, separated by semi-colons. The following query demonstrates this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">map</span><span class="tok-o">{</span><span class="tok-n">a</span><span class="tok-o">=</span><span class="tok-mi">1</span><span class="tok-o">;</span><span class="tok-n">b</span><span class="tok-o">=</span><span class="tok-mi">2</span><span class="tok-o">;</span><span class="tok-n">c</span><span class="tok-o">=</span><span class="tok-n">a</span><span class="tok-o">+</span><span class="tok-n">b</span><span class="tok-o">;</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">id</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-n">c</span><span class="tok-o">}.</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">,</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">10</span><span class="tok-o">,</span><span class="tok-mi">11</span><span class="tok-o">,</span><span class="tok-mi">12</span><span class="tok-o">,</span><span class="tok-mi">13</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that only the value from the last expression in the closure is returned from the
<em>map</em>. So in the example above the result of <em>c=a+b</em>, 4, is added to each ID.</p>
</div>
<div class="paragraph">
<p>In the next section we will take a look at some other cases where lambda expressions
are very useful.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_regular_expressions_to_do_fuzzy_searches">4.8.2. Using regular expressions to do fuzzy searches</h4>
<div class="paragraph">
<p>Let&#8217;s take a look at one case where use of closures might be helpful. It is a
common requirement when working with any kind of database to want to do some
sort of fuzzy text search or even to search using a regular expression. TinkerPop 3
itself does not provide direct support for this. In other words there
currently is no sophisticated text search method beyond the basic <em>has()</em> type steps
we have looked at above. However, the underlying graph store can still expose
such capabilities.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Most TinkerPop enabled graph stores that you are likely to use for any sort of
serious deployment will also be backed by an indexing technology like Solr or Elastic
Search and a graph engine like Titan. In those cases some amount of more
sophisticated search methods will likely be made available to you. You should always
check the documentation for the system you are using to see what is recommended.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When working with Tinkergraph and the Gremlin console if we want to do any
sort of text search beyond very basic things like <em>city == "Dallas"</em> then we
will have to fall back on the Lambda function concept to take advantage of
underlying Groovy and Java features. Note that even in graph
systems backed by a real index the examples we are about to look at should
still work but may not be the preferred way.</p>
</div>
<div class="paragraph">
<p>So let&#8217;s look at some examples. First of all, every airport in the air routes
graph contains a description which will be something like <em>Dallas Fort Worth
International Airport</em> in the case of DFW. If we wanted to search the nodes in
the graph for any airport that has the word <em>Dallas</em> in the description we
could take advantage of the Groovy <em>String.contains()</em> method and do it like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Airport descriptions containing the word &#39;Dallas&#39;</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">filter</span><span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">).</span><span class="tok-na">value</span><span class="tok-o">().</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s1">&#39;Dallas&#39;</span><span class="tok-o">)}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where things get even more interesting is when you want to use a regular
expression as part of a query. Note that the first example below could also be
achieved using a Gremlin <em>within()</em> step as it is still really doing exact
string comparisons but it gives us a template for how to write any query
containing a regular expression. The example that follows finds all airports
in cities with names that begin with <em>Dal</em> so it will find Dallas, Dalaman, Dalian,
Dalcahue, Dalat and Dalanzadgad!.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Using a filter to search using a regular expression</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;type&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">filter</span><span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">value</span> <span class="tok-o">==~</span><span class="tok-s">/Dallas|Austin/</span><span class="tok-o">}.</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// A regular expression to find any airport with a city name that begins with &quot;Dal&quot;</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;type&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">filter</span><span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">value</span><span class="tok-o">()==~</span><span class="tok-s">/^Dal\w*/</span><span class="tok-o">}.</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So in summary it is useful to know about closures and the way you can use them
with filters but as stated above - use them sparingly and only when a "pure
Gremlin" alternative does not present itself.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We could actually go one step further and create a custom predicate (see
next section) that handles regular expressions for us.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pred">4.9. Creating custom tests (predicates)</h3>
<div class="paragraph">
<p>TinkerPop comes with a set of built in methods that can be used for testing values.
These methods are commonly referred to as <em>predicates</em>. Examples of existing Gremlin
predicates include methods like <em>gte()</em>, <em>lte()</em> and <em>neq()</em>. Sometimes, however, it
is useful to be able to define your own custom predicate that can be passed in to a
<em>has(</em>), <em>where()</em> or <em>filter()</em> step as part of a Gremlin query.</p>
</div>
<div class="paragraph">
<p>The following example uses the Groovy closure syntax to define a custom predicate,
called <em>f</em>, that tests the two values passed in to see if <em>x</em> is greater than twice
<em>y</em>. This new predicate can then be used as part of a <em>has()</em> step by using it as a
parameter to the <em>test()</em> method.  When <em>f</em> is called, it will be passed two
parameters. The first one will be the value returned in response to asking <em>has()</em> to
return the property called <em>longest</em>.  The second parameter passed to <em>f</em> will be the
value of <em>a</em> that we provide.  This is a simple example, but shows the flexibility
that Gremlin provides for extending the basic predicates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find the average longest runway length.</span>
<span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">).</span><span class="tok-na">mean</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-c1">// Define a custom predicate</span>
<span class="tok-n">f</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-n">x</span><span class="tok-o">,</span><span class="tok-n">y</span> <span class="tok-o">-&gt;</span> <span class="tok-n">x</span> <span class="tok-o">&gt;</span> <span class="tok-n">y</span><span class="tok-o">*</span><span class="tok-mi">2</span><span class="tok-o">}</span>

<span class="tok-c1">// Find airports with runways more than twice the average maximum length.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">,</span><span class="tok-n">test</span><span class="tok-o">(</span><span class="tok-n">f</span><span class="tok-o">,</span><span class="tok-n">a</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_regular_expression_predicate">4.9.1. Creating a regular expression predicate</h4>
<div class="paragraph">
<p>In the previous section we used a closure to filter values using a regular
expression. Now that we know how to create our own predicates we could go one
step further and create a predicate that accepts regular expressions for us.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Create our method</span>
<span class="tok-n">f</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-n">x</span><span class="tok-o">,</span><span class="tok-n">y</span> <span class="tok-o">-&gt;</span> <span class="tok-n">x</span> <span class="tok-o">==~</span> <span class="tok-n">y</span><span class="tok-o">}</span>

<span class="tok-c1">// Use it to find any nodes where the description string starts with &#39;Dal&#39;</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">,</span><span class="tok-n">test</span><span class="tok-o">(</span><span class="tok-n">f</span><span class="tok-o">,</span><span class="tok-s">/^Dal.*/</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can actually go one step further and create a custom method called <em>regex</em>
rather than use the <em>test</em> method directly. If the following code seems a bit
unclear don&#8217;t worry too much. It works and that may be all you need to know.
However if you want to understand the TinkerPop API in more detail the
documentation that can be found on the Apache TinkerPop web page explains things
like <em>P</em> in detail. Also remember that Gremlin is written in Groovy/Java and we
take advantage of that here as well.</p>
</div>
<div class="paragraph">
<p>In the following example, rather than use <em>test</em> directly we use the
<em>BiPredicate</em> functional interface that is part of Java 8. <em>BiPredicate</em> is
sometimes referred to was a <em>two-arity</em> predicate as it takes two parameters. We
will create an implementation of the interface called <em>bp</em>. The interface
requires that we provide one method called <em>test</em> that does the actual
comparison between two objects and returns a simple true or false result. Like
we did in the previous section we simply perform a regular expression compare
using the <em>==~</em> operator.</p>
</div>
<div class="paragraph">
<p>We can then use our <em>bp</em> implementation to build a named closure that we will call
<em>regex</em>. TinkerPop includes a predicate class P that is an implementation of the Java
Predicate functional interface. We we can use <em>P</em> to build our new <em>regex</em> method. We
can then pass <em>regex</em> directly to steps like <em>has</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Create a new BiPredicate that handles regular expression pattern matching</span>
<span class="tok-n">bp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">util</span><span class="tok-o">.</span><span class="tok-na">function</span><span class="tok-o">.</span><span class="tok-na">BiPredicate</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;()</span> <span class="tok-o">{</span>
         <span class="tok-kt">boolean</span> <span class="tok-nf">test</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">val</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">pattern</span><span class="tok-o">)</span> <span class="tok-o">{</span>
           <span class="tok-k">return</span> <span class="tok-n">val</span> <span class="tok-o">==~</span> <span class="tok-n">pattern</span>  <span class="tok-o">}}</span>

<span class="tok-c1">// Create a new closure we can use for regular expression pattern matching.</span>
<span class="tok-n">regex</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-k">new</span> <span class="tok-n">P</span><span class="tok-o">(</span><span class="tok-n">bp</span><span class="tok-o">,</span> <span class="tok-n">it</span><span class="tok-o">)}</span>

<span class="tok-c1">// Use our new closure to find descriptions that start with &#39;Dal&#39;. As this</span>
<span class="tok-c1">// unwinds, the contents of &#39;desc&#39; are passed to the test method as the first parameter</span>
<span class="tok-c1">// and the regex pattern as the second paramter.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">,</span> <span class="tok-n">regex</span><span class="tok-o">(</span><span class="tok-s">/^Dal.*/</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="graphvars">4.10. Using graph variables to associate metadata with a graph</h3>
<div class="paragraph">
<p>TinkerPop 3 introduced the concept of graph variables. A graph variable is a
key/value pair that can be associated with the graph itself. Graph variables are not
considered part of the graph that you would process with Gremlin traversals but are
in essence a way to associate metadata with a graph. You can set and retrieve graph
variables using the <em>variables</em> method of the graph object. Let&#8217;s assume I wanted to
add some metadata that allowed me to record who the maintainer of the air-routes
graph is and when it was last updated. We could do that as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">variables</span><span class="tok-o">().</span><span class="tok-na">set</span><span class="tok-o">(</span><span class="tok-s1">&#39;maintainer&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Kelvin&#39;</span><span class="tok-o">)</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">variables</span><span class="tok-o">().</span><span class="tok-na">set</span><span class="tok-o">(</span><span class="tok-s1">&#39;updated&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;July 18th 2017&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use any string that makes sense to you when naming your graph variable keys.
We can use the <em>keys</em> method to retrieve the names of any keys currently in place as
graph variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">variables</span><span class="tok-o">().</span><span class="tok-na">keys</span><span class="tok-o">()</span>

<span class="tok-n">updated</span>
<span class="tok-n">maintainer</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>asMap</em> method will return any graph variables that are currently set as a map of
key/value pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">variables</span><span class="tok-o">().</span><span class="tok-na">asMap</span><span class="tok-o">()</span>

<span class="tok-n">updated</span><span class="tok-o">=</span><span class="tok-n">July</span> <span class="tok-mi">18</span><span class="tok-n">th</span> <span class="tok-mi">2017</span>
<span class="tok-n">maintainer</span><span class="tok-o">=</span><span class="tok-n">Kelvin</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the <em>get</em> method to retrieve the value of a particular key. Note that the
value returned is an instance of the <em>java.util.Optional</em> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">variables</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s1">&#39;updated&#39;</span><span class="tok-o">)</span>

<span class="tok-n">Optional</span><span class="tok-o">[</span><span class="tok-n">July</span> <span class="tok-mi">18</span><span class="tok-n">th</span> <span class="tok-mi">2017</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to delete a graph variable you can use the <em>remove</em> method. In this next
example we will delete the <em>maintainer</em> graph variable and re-query the variable map
to prove it has been deleted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">variables</span><span class="tok-o">().</span><span class="tok-na">remove</span><span class="tok-o">(</span><span class="tok-s1">&#39;maintainer&#39;</span><span class="tok-o">)</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">variables</span><span class="tok-o">().</span><span class="tok-na">asMap</span><span class="tok-o">()</span>

<span class="tok-n">updated</span><span class="tok-o">=</span><span class="tok-n">July</span> <span class="tok-mi">18</span><span class="tok-n">th</span> <span class="tok-mi">2017</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tre">4.11. Turning node values into trees</h3>
<div class="paragraph">
<p>TinkerPop defines a Tree API but it is not that well fleshed out and has not been
updated in a long time. The <em>tree</em> step allows you to create a tree from part of a
graph using a Gremlin traversal. The example below creates a tree, of depth 3, where
the Austin (AUS) node is the root of the tree. The next level of the tree is all
nodes directly connected to AUS. The third level is made up of all the nodes
connected by routes to the nodes in the previous level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//Generate a tree the AUS node and it&#39;s neighbors and their neighbors</span>
 <span class="tok-n">t</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">()).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">).</span><span class="tok-na">tree</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The object returned to our variable <em>t</em> will be an instance of the
<em>org.apache.tinkerpop.gremlin.process.traversal.step.util.Tree</em> class. That class
provides a set of methods that can be used when working with a Tree.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Look at part of the tree directly</span>
<span class="tok-n">t</span><span class="tok-o">[</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">][</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">]</span>

<span class="tok-c1">// You can also use the TinkerPop Tree API to work with the tree</span>
<span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">getLeafObjects</span><span class="tok-o">()</span>
<span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">getObjectsAtDepth</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)</span>
<span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">getObjectsAtDepth</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)</span>
<span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">getObjectsAtDepth</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We will see the  Tree API used again in the "<a href="#btree">Modelling an ordered binary tree as a graph</a>" section later on.</p>
</div>
</div>
<div class="sect2">
<h3 id="sub">4.12. Creating a sub graph</h3>
<div class="paragraph">
<p>You can create a sub graph which is a subset of the nodes and edges in the main
graph.  Once created, to work with a sub graph, you create a traversal specific to
that new graph and distinct from the trversal being used to process the main graph.
Subgraphs are created using the <em>subgraph</em> traversal step. Note that <em>subgraph</em> takes
edges (not nodes) as input and returns both those edges and the vertices that they
connect with.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Create a subgraph of all nodes and edges directly connected to the AUS node</span>
<span class="tok-c1">// Note that using bothE() means we get incoming and outgoing edges.</span>
<span class="tok-n">subg</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">bothE</span><span class="tok-o">().</span><span class="tok-na">subgraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;subGraph&#39;</span><span class="tok-o">).</span><span class="tok-na">cap</span><span class="tok-o">(</span><span class="tok-s1">&#39;subGraph&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-c1">// As above but only keep the outgoing edges in the subgraph.</span>
<span class="tok-n">subg</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">subgraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;subGraph&#39;</span><span class="tok-o">).</span><span class="tok-na">cap</span><span class="tok-o">(</span><span class="tok-s1">&#39;subGraph&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-c1">// Create a subgraph starting at AUS but this time going out two levels. We achieve this</span>
<span class="tok-c1">// using a repeat() method to go out from Austin 2 times.</span>
<span class="tok-n">subg</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">bothE</span><span class="tok-o">().</span><span class="tok-na">subgraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;subGraph&#39;</span><span class="tok-o">).</span><span class="tok-na">outV</span><span class="tok-o">()).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">)</span>
                              <span class="tok-o">.</span><span class="tok-na">cap</span><span class="tok-o">(</span><span class="tok-s1">&#39;subGraph&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-c1">// Get a traversal object so that we can traverse the newly created sub graph</span>
<span class="tok-n">sgt</span> <span class="tok-o">=</span> <span class="tok-n">subg</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">(</span><span class="tok-n">standard</span><span class="tok-o">())</span>

<span class="tok-c1">// Which airports ended up in the sub graph?</span>
<span class="tok-n">sgt</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this second example we create a subgraph just of airports and routes that
are inside Europe. Effectively we just made the Europe only version of the air
routes main graph. At first glance, this query looks a bit overwhelming but if
you read it slowly and look at each step you should be able to make sense of what
it is doing. It is a bit more sophisticated that the previous examples in that as
well as extracting the routes and airports into the subgraph it also extracts all
of the relevant countries as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Create a sub graph only of airports in Europe and routes between those airports</span>
<span class="tok-n">subgraph</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">).</span><span class="tok-na">subgraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;eu-air-routes&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">inE</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">).</span><span class="tok-na">subgraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;eu-air-routes&#39;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">outV</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;r&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">in</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;r&#39;</span><span class="tok-o">).</span><span class="tok-na">subgraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;eu-air-routes&#39;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">cap</span><span class="tok-o">(</span><span class="tok-s1">&#39;eu-air-routes&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-c1">// Create a traversal object for the subgraph</span>
<span class="tok-n">sg</span> <span class="tok-o">=</span> <span class="tok-n">subgraph</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">()</span>

<span class="tok-c1">// How many routes are there in the subgraph?</span>
<span class="tok-n">sg</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-c1">// How many airports?</span>
<span class="tok-n">sg</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-c1">// Now I can query the subgraph to find out where I can get to from LHR within</span>
<span class="tok-c1">// the subgraph.</span>
<span class="tok-n">sg</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">join</span><span class="tok-o">(</span><span class="tok-s1">&#39;,&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sav">4.13. Saving (serializing) a graph as GraphML (XML) or GraphSON (JSON)</h3>
<div class="paragraph">
<p>Using TinkerPop 3 you can save a graph either in GraphML or Graphson format. GraphML
is an industry standard XML format for describing a graph and is recognized by many
other applications such as Gephi.  GraphSON was defined as part of the TinkerPop
project and is less broadly supported outside of TinkerPop enabled tools and graphs.
However, whereas GraphML is considered lossee for some graphs (it does not support
all of the data types and structures used by TinkerPop 3).  GraphSON is not
considered lossee.</p>
</div>
<div class="paragraph">
<p>Saving a graph to a GraphML file can be done using the following Gremlin expression.
You might want to try it on one of your graphs and look at the output generated. You
can also take a look at the air-routes.graphml file distribued with this document if
you want to look at a well laid out (for human readability) GraphMl file. Bear in
mind that by default, TinkerPop will save your graph in a way that is not easily
human readable without using a code beautifier first. Most modern text editors can
also beautify XML files well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Save the graph as GraphML</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">(</span><span class="tok-n">graphml</span><span class="tok-o">()).</span><span class="tok-na">writeGraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;mygraph.graphml&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>TinkerPop 3 offers two flavors of JSON. The default flavor stores each vertex in a
graph and all of its edges as a single JSON document.  This is repeated for every
vertex in the graph. This is essentially what is known as <em>adjacency list</em> format. If
you serialize a graph to file using this method and look at the file afterwards you
will see that each line (which could be very wide) is a stand alone JSON obect.</p>
</div>
<div class="paragraph">
<p>The second flavor is referred to as a <em>wrapped adjacency list</em> format. In this flavor
all of the vertices and edges are stored in a single large JSON oject inside of an
enclosing <em>vertices</em> object.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The GraphSON file generated will not be easily human readable without doing
      some pretty printing on it using something like the Python json tool
      (<em>python -m json.tool mygraph.json</em>) or using a text editor that can beautify
      JSON.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Gremlin line below will create a file containing the <em>adjacency list</em> form of
GraphSON.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Save the graph as unwrapped JSON</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">(</span><span class="tok-n">graphson</span><span class="tok-o">()).</span><span class="tok-na">writeGraph</span><span class="tok-o">(</span><span class="tok-s2">&quot;graph.json&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following will create a file containing the <em>wrapped adjacency list</em> form of
GraphSON.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Create a single (wrapped) JSON file</span>
<span class="tok-n">os</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span><span class="tok-o">(</span><span class="tok-s2">&quot;mygraph.json&quot;</span><span class="tok-o">)</span>
<span class="tok-n">GraphSONWriter</span><span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">().</span><span class="tok-na">wrapAdjacencyList</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">).</span><span class="tok-na">create</span><span class="tok-o">().</span><span class="tok-na">writeGraph</span><span class="tok-o">(</span><span class="tok-n">os</span><span class="tok-o">,</span><span class="tok-n">graph</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you are ingesting large amounts of data into a TinkerPop 3 enables graph, the
unwrapped flavor of GraphSON is probably a much better choice than GraphML or wrapped
GraphSON. Using this format you can stream data into a graph one vertex at a time
rather than having to try and send the entire graph as a potentially huge JSON file
all in one go.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to learn more about the specifics of the GraphML and GraphSON formats,
they are covered in detail near the end of this document in the "<a href="#serialize">COMMON GRAPH SERIALIZATION FORMATS</a>"
section.</p>
</div>
</div>
<div class="sect2">
<h3 id="reload">4.14. Loading a graph stored as GraphML (XML) or GraphSON (JSON)</h3>
<div class="paragraph">
<p>In section 2 we saw how to load the <em>air-routes.graphml</em> file. In case you skipped
that part lets do a quick recap on loading GraphML files and also look at loading
a GraphSON JSON format file.</p>
</div>
<div class="paragraph">
<p>The only difference between loading a GraphML file or a GraphSON file is in the name
of the method from the IoCore Tinkerpop 3 class that we use. When we want to load
a graphML file we specify <em>IoCore.graphml()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Load a graphML file</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">(</span><span class="tok-n">IoCore</span><span class="tok-o">.</span><span class="tok-na">graphml</span><span class="tok-o">()).</span><span class="tok-na">readGraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;my-graph.graphml&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we are loading a GraphSON format file we instead specify <em>IoCore.graphson()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Load a grapSON file</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">(</span><span class="tok-n">IoCore</span><span class="tok-o">.</span><span class="tok-na">graphson</span><span class="tok-o">()).</span><span class="tok-na">readGraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;my-graph.json&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="msc">5. MISCELLANEOUS QUERIES AND THE RESULTS THEY GENERATE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section you will find more Gremlin queries that operate on the
air-routes graph.  All of these queries build upon the topics already covered
in the prior sections. Unlike the prior sections, in this section I have
included lots of examples of the output returned by running the query than in
the previous sections. In cases where the output is rather lengthy I have
either truncated or laid it out in columns to make it easier to read and to save
space.</p>
</div>
<div class="sect2">
<h3 id="countmore">5.1. Counting more things</h3>
<div class="paragraph">
<p>Here are a few more examples that basically just count occurrences of things but are
a little more complex than the examples we looked at earlier in the document.This
first query looks for any country nodes that have no outgoing edges.  This indicates
that there are no airports in the graph for those countries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Are there any countries that have no airports?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the results of running the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Andorra</span>
<span class="tok-n">Liechtenstein</span>
<span class="tok-n">Monaco</span>
<span class="tok-n">Montserrat</span>
<span class="tok-n">Pitcairn</span>
<span class="tok-n">San</span> <span class="tok-n">Marino</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can easily count the distribution per airport of runways. We can observe from the
results of running the query that the vast majority of airports in the graph have
either one or two runways.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// What is the distribution of runways in the graph</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-mi">2288</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">:</span><span class="tok-mi">756</span><span class="tok-o">,</span> <span class="tok-mi">3</span><span class="tok-o">:</span><span class="tok-mi">224</span><span class="tok-o">,</span> <span class="tok-mi">4</span><span class="tok-o">:</span><span class="tok-mi">51</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-mi">6</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">7</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">8</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query finds all airports that have more than 180 outgoing routes and returns
their IATA codes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Airports with more than 180 outgoing routes</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">180</span><span class="tok-o">))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">,</span><span class="tok-n">DEN</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">,</span><span class="tok-n">FRA</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-n">PEK</span><span class="tok-o">,</span><span class="tok-n">PVG</span><span class="tok-o">,</span><span class="tok-n">FCO</span><span class="tok-o">,</span><span class="tok-n">AMS</span><span class="tok-o">,</span><span class="tok-n">BCN</span><span class="tok-o">,</span><span class="tok-n">MAD</span><span class="tok-o">,</span><span class="tok-n">MUC</span><span class="tok-o">,</span><span class="tok-n">DME</span><span class="tok-o">,</span><span class="tok-n">IST</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could improve our query a bit to include the IATA code and the exact number of
outgoing routes in the returned result. There are a few different ways that we could
do this. One way that is quite convenient is to use <em>group</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Same basic query but return the airport code and the route count</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">180</span><span class="tok-o">))).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span>

<span class="tok-o">[</span><span class="tok-nl">ORD:</span><span class="tok-mi">226</span><span class="tok-o">,</span> <span class="tok-nl">DFW:</span><span class="tok-mi">216</span><span class="tok-o">,</span> <span class="tok-nl">FRA:</span><span class="tok-mi">254</span><span class="tok-o">,</span> <span class="tok-nl">CDG:</span><span class="tok-mi">253</span><span class="tok-o">,</span> <span class="tok-nl">PEK:</span><span class="tok-mi">232</span><span class="tok-o">,</span> <span class="tok-nl">AMS:</span><span class="tok-mi">257</span><span class="tok-o">,</span> <span class="tok-nl">ATL:</span><span class="tok-mi">232</span><span class="tok-o">,</span> <span class="tok-nl">MUC:</span><span class="tok-mi">219</span><span class="tok-o">,</span> <span class="tok-nl">IST:</span><span class="tok-mi">259</span><span class="tok-o">,</span> <span class="tok-nl">DME:</span><span class="tok-mi">206</span><span class="tok-o">,</span> <span class="tok-nl">DXB:</span><span class="tok-mi">225</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>How many airports are there in each of the UK regions of England, Scotland,
Wales and Northern Ireland?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;UK&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">GB</span><span class="tok-o">-</span><span class="tok-nl">ENG:</span><span class="tok-mi">27</span><span class="tok-o">,</span><span class="tok-n">GB</span><span class="tok-o">-</span><span class="tok-nl">WLS:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-n">GB</span><span class="tok-o">-</span><span class="tok-nl">NIR:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-n">GB</span><span class="tok-o">-</span><span class="tok-nl">SCT:</span><span class="tok-mi">21</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next query counts how many airports have more than 400 total routes (inbound and
outbound).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Airports with more than 400 total routes</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">both</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">400</span><span class="tok-o">))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">ATL</span>
<span class="tok-n">ORD</span>
<span class="tok-n">CDG</span>
<span class="tok-n">FRA</span>
<span class="tok-n">PEK</span>
<span class="tok-n">AMS</span>
<span class="tok-n">IST</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query counts how many airports in the graph only have one outgoing route.
There are actually a lot of airports that meet this criteria.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many airports have only one route?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">))).</span><span class="tok-na">count</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query uses <em>groupCount</em> to produce a map of key value pairs where the key is the
two character ISO country code and the value is the number of airports that country
has.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many airports does each country have in the graph?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">PR:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">PT:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">PW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">PY:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">QA:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AE:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-nl">AF:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">AG:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AM:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">AO:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">AR:</span><span class="tok-mi">36</span><span class="tok-o">,</span> <span class="tok-nl">AS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AT:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">RE:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">AU:</span><span class="tok-mi">113</span><span class="tok-o">,</span> <span class="tok-nl">AW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AZ:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">RO:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">BA:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">BB:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">RS:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">BD:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">BE:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">RU:</span><span class="tok-mi">115</span><span class="tok-o">,</span> <span class="tok-nl">BF:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">BG:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">RW:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">BH:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BJ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BN:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BO:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-nl">SA:</span><span class="tok-mi">26</span><span class="tok-o">,</span> <span class="tok-nl">BQ:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">SB:</span><span class="tok-mi">17</span><span class="tok-o">,</span> <span class="tok-nl">BR:</span><span class="tok-mi">115</span><span class="tok-o">,</span> <span class="tok-nl">SC:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">BS:</span><span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-nl">SD:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">SE:</span><span class="tok-mi">39</span><span class="tok-o">,</span> <span class="tok-nl">BT:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SG:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BW:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">SI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BY:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BZ:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">SK:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">SL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SN:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">SO:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">CA:</span><span class="tok-mi">203</span><span class="tok-o">,</span> <span class="tok-nl">SR:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CC:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CD:</span><span class="tok-mi">11</span><span class="tok-o">,</span> <span class="tok-nl">ST:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SV:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CG:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">CH:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">SX:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SY:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SZ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CK:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">CL:</span><span class="tok-mi">16</span><span class="tok-o">,</span> <span class="tok-nl">CM:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">CN:</span><span class="tok-mi">179</span><span class="tok-o">,</span> <span class="tok-nl">CO:</span><span class="tok-mi">50</span><span class="tok-o">,</span> <span class="tok-nl">CR:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">TC:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">TD:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CU:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">CV:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">TG:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TH:</span><span class="tok-mi">32</span><span class="tok-o">,</span> <span class="tok-nl">CW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CX:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CY:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">TJ:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">CZ:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">TL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TN:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">TO:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TR:</span><span class="tok-mi">44</span><span class="tok-o">,</span> <span class="tok-nl">TT:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">DE:</span><span class="tok-mi">32</span><span class="tok-o">,</span> <span class="tok-nl">TV:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TW:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-nl">TZ:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">DJ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">DK:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">DM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">DO:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">UA:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">UG:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">UK:</span><span class="tok-mi">52</span><span class="tok-o">,</span> <span class="tok-nl">DZ:</span><span class="tok-mi">29</span><span class="tok-o">,</span> <span class="tok-nl">US:</span><span class="tok-mi">566</span><span class="tok-o">,</span> <span class="tok-nl">EC:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-nl">EE:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">EG:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">EH:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">UY:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">UZ:</span><span class="tok-mi">11</span><span class="tok-o">,</span> <span class="tok-nl">ER:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">VC:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ES:</span><span class="tok-mi">41</span><span class="tok-o">,</span> <span class="tok-nl">ET:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">VE:</span><span class="tok-mi">24</span><span class="tok-o">,</span> <span class="tok-nl">VG:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">VI:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">VN:</span><span class="tok-mi">21</span><span class="tok-o">,</span> <span class="tok-nl">VU:</span><span class="tok-mi">26</span><span class="tok-o">,</span> <span class="tok-nl">FI:</span><span class="tok-mi">19</span><span class="tok-o">,</span> <span class="tok-nl">FJ:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">FM:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">FO:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">FR:</span><span class="tok-mi">54</span><span class="tok-o">,</span> <span class="tok-nl">WF:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GA:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">WS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GD:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GE:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">GF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GG:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GH:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">GI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GL:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">GM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GN:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GP:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GQ:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GR:</span><span class="tok-mi">39</span><span class="tok-o">,</span> <span class="tok-nl">GT:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GU:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GY:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">HK:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">HN:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">HR:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">HT:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">YE:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-nl">HU:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">ID:</span><span class="tok-mi">67</span><span class="tok-o">,</span> <span class="tok-nl">YT:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">IE:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">IL:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">IM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">IN:</span><span class="tok-mi">72</span><span class="tok-o">,</span> <span class="tok-nl">ZA:</span><span class="tok-mi">20</span><span class="tok-o">,</span> <span class="tok-nl">IQ:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">IR:</span><span class="tok-mi">44</span><span class="tok-o">,</span> <span class="tok-nl">IS:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">IT:</span><span class="tok-mi">36</span><span class="tok-o">,</span> <span class="tok-nl">ZM:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">JE:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ZW:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">JM:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">JO:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">JP:</span><span class="tok-mi">63</span><span class="tok-o">,</span> <span class="tok-nl">KE:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">KG:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">KH:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">KI:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">KM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KN:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">KP:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KR:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-nl">KS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KY:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">KZ:</span><span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-nl">LA:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">LB:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LC:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">LK:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">LR:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">LS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LT:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">LU:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LV:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LY:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">MA:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">MD:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ME:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MG:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">MH:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MK:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ML:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MM:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">MN:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">MO:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MP:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MQ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MR:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">MT:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MU:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MV:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">MW:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MX:</span><span class="tok-mi">57</span><span class="tok-o">,</span> <span class="tok-nl">MY:</span><span class="tok-mi">34</span><span class="tok-o">,</span> <span class="tok-nl">MZ:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">NA:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">NC:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NE:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NG:</span><span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-nl">NI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NL:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">NO:</span><span class="tok-mi">49</span><span class="tok-o">,</span> <span class="tok-nl">NP:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">NR:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NZ:</span><span class="tok-mi">25</span><span class="tok-o">,</span> <span class="tok-nl">OM:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">PA:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">PE:</span><span class="tok-mi">20</span><span class="tok-o">,</span> <span class="tok-nl">PF:</span><span class="tok-mi">30</span><span class="tok-o">,</span> <span class="tok-nl">PG:</span><span class="tok-mi">26</span><span class="tok-o">,</span> <span class="tok-nl">PH:</span><span class="tok-mi">37</span><span class="tok-o">,</span> <span class="tok-nl">PK:</span><span class="tok-mi">21</span><span class="tok-o">,</span> <span class="tok-nl">PL:</span><span class="tok-mi">12</span><span class="tok-o">,</span> <span class="tok-nl">PM:</span><span class="tok-mi">1</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the air-routes graph also has country specific nodes, we could chose to write
the previous query a different way. We could start by finding country nodes and then
see how many airport nodes each one is connected to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Another way to ask the question above, this time by counting the edges (degree) from each country</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">outE</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to sort the list in descending order we could adjust the query as
follows. Note the use of <em>local</em> to specify how the ordering is applied. If we did
not use <em>local</em> the ordering would not have the desired effect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">valueDecr</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">US:</span><span class="tok-mi">578</span><span class="tok-o">,</span> <span class="tok-nl">CA:</span><span class="tok-mi">203</span><span class="tok-o">,</span> <span class="tok-nl">CN:</span><span class="tok-mi">200</span><span class="tok-o">,</span> <span class="tok-nl">AU:</span><span class="tok-mi">118</span><span class="tok-o">,</span> <span class="tok-nl">RU:</span><span class="tok-mi">118</span><span class="tok-o">,</span> <span class="tok-nl">BR:</span><span class="tok-mi">115</span><span class="tok-o">,</span> <span class="tok-nl">IN:</span><span class="tok-mi">72</span><span class="tok-o">,</span> <span class="tok-nl">ID:</span><span class="tok-mi">67</span><span class="tok-o">,</span> <span class="tok-nl">JP:</span><span class="tok-mi">63</span><span class="tok-o">,</span> <span class="tok-nl">MX:</span><span class="tok-mi">58</span><span class="tok-o">,</span> <span class="tok-nl">FR:</span><span class="tok-mi">56</span><span class="tok-o">,</span> <span class="tok-nl">UK:</span><span class="tok-mi">54</span><span class="tok-o">,</span> <span class="tok-nl">CO:</span><span class="tok-mi">50</span><span class="tok-o">,</span> <span class="tok-nl">NO:</span><span class="tok-mi">49</span><span class="tok-o">,</span> <span class="tok-nl">TR:</span><span class="tok-mi">48</span><span class="tok-o">,</span> <span class="tok-nl">IR:</span><span class="tok-mi">44</span><span class="tok-o">,</span> <span class="tok-nl">ES:</span><span class="tok-mi">41</span><span class="tok-o">,</span> <span class="tok-nl">SE:</span><span class="tok-mi">39</span><span class="tok-o">,</span> <span class="tok-nl">GR:</span><span class="tok-mi">39</span><span class="tok-o">,</span> <span class="tok-nl">PH:</span><span class="tok-mi">38</span><span class="tok-o">,</span> <span class="tok-nl">AR:</span><span class="tok-mi">36</span><span class="tok-o">,</span> <span class="tok-nl">IT:</span><span class="tok-mi">36</span><span class="tok-o">,</span> <span class="tok-nl">MY:</span><span class="tok-mi">34</span><span class="tok-o">,</span> <span class="tok-nl">TH:</span><span class="tok-mi">32</span><span class="tok-o">,</span> <span class="tok-nl">DE:</span><span class="tok-mi">32</span><span class="tok-o">,</span> <span class="tok-nl">PF:</span><span class="tok-mi">30</span><span class="tok-o">,</span> <span class="tok-nl">DZ:</span><span class="tok-mi">29</span><span class="tok-o">,</span> <span class="tok-nl">SA:</span><span class="tok-mi">26</span><span class="tok-o">,</span> <span class="tok-nl">VU:</span><span class="tok-mi">26</span><span class="tok-o">,</span> <span class="tok-nl">PG:</span><span class="tok-mi">26</span><span class="tok-o">,</span> <span class="tok-nl">NZ:</span><span class="tok-mi">25</span><span class="tok-o">,</span> <span class="tok-nl">VE:</span><span class="tok-mi">24</span><span class="tok-o">,</span> <span class="tok-nl">VN:</span><span class="tok-mi">21</span><span class="tok-o">,</span> <span class="tok-nl">PK:</span><span class="tok-mi">21</span><span class="tok-o">,</span> <span class="tok-nl">FI:</span><span class="tok-mi">20</span><span class="tok-o">,</span> <span class="tok-nl">ZA:</span><span class="tok-mi">20</span><span class="tok-o">,</span> <span class="tok-nl">PE:</span><span class="tok-mi">20</span><span class="tok-o">,</span> <span class="tok-nl">BS:</span><span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-nl">KZ:</span><span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-nl">NG:</span><span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-nl">SB:</span><span class="tok-mi">17</span><span class="tok-o">,</span> <span class="tok-nl">CL:</span><span class="tok-mi">17</span><span class="tok-o">,</span> <span class="tok-nl">BO:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-nl">EC:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-nl">KR:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-nl">PT:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">AO:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">UA:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">ET:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">GL:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">KE:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">MA:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">MM:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">RO:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">BZ:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">CR:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">MG:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">PL:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">CU:</span><span class="tok-mi">12</span><span class="tok-o">,</span> <span class="tok-nl">CD:</span><span class="tok-mi">11</span><span class="tok-o">,</span> <span class="tok-nl">UZ:</span><span class="tok-mi">11</span><span class="tok-o">,</span> <span class="tok-nl">AE:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">EG:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">FJ:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">LY:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">MN:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">MZ:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">NP:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">TW:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-nl">YE:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-nl">TN:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">TZ:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">DK:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">HR:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">ZM:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">LA:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">MV:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">BD:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">CV:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">DO:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">IE:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">PR:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">AT:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">CK:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">HN:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">IQ:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">LK:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">AZ:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">BE:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">SD:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">SO:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">CH:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">CM:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">CZ:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">GH:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">IL:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">IS:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">NL:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">PA:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">AF:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">BA:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">BG:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">BW:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">TC:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">TJ:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">UG:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">FM:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">NA:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">BQ:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">SN:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">CG:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">CY:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">EE:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">GE:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">ZW:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">KH:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">KY:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">LT:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">MR:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">OM:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">PY:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">AM:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">RE:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">RS:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">BF:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">RW:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">SC:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">SH:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">SK:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">SY:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">TT:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">EH:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">UY:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">VG:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">VI:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">FK:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">WF:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GA:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GG:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GQ:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GT:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GY:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">HT:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">HU:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">JM:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">JO:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">KG:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">KI:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">KN:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">LC:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">LR:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">ME:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MH:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MP:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MU:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MW:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">PW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">QA:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AG:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BB:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BH:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BJ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BN:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BT:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SG:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BY:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SR:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CC:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ST:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SV:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SX:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SZ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TD:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TG:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CX:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TO:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TV:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">DJ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">DM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ER:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">VC:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">FO:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">WS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GD:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GN:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GP:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GU:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">HK:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">YT:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">IM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">JE:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KP:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LB:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LU:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LV:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MD:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MK:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ML:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MO:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MQ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MT:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NC:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NE:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NR:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">PM:</span><span class="tok-mi">1</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to sort by the country code, the <em>key</em> in other words, we could change
the query accordingly. In this case we will use <em>keyIncr</em> to get a sort in ascending
order. If we wanted to dort in descending order by key we could use <em>keyDecr</em>
instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">keyIncr</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">AE:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">AF:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">AG:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AM:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">AO:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">AR:</span><span class="tok-mi">36</span><span class="tok-o">,</span> <span class="tok-nl">AS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AT:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">AU:</span><span class="tok-mi">118</span><span class="tok-o">,</span> <span class="tok-nl">AW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">AZ:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">BA:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">BB:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BD:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">BE:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">BF:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">BG:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">BH:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BJ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BN:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BO:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-nl">BQ:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">BR:</span><span class="tok-mi">115</span><span class="tok-o">,</span> <span class="tok-nl">BS:</span><span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-nl">BT:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BW:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">BY:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">BZ:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">CA:</span><span class="tok-mi">203</span><span class="tok-o">,</span> <span class="tok-nl">CC:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CD:</span><span class="tok-mi">11</span><span class="tok-o">,</span> <span class="tok-nl">CF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CG:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">CH:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">CI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CK:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">CL:</span><span class="tok-mi">17</span><span class="tok-o">,</span> <span class="tok-nl">CM:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">CN:</span><span class="tok-mi">200</span><span class="tok-o">,</span> <span class="tok-nl">CO:</span><span class="tok-mi">50</span><span class="tok-o">,</span> <span class="tok-nl">CR:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">CU:</span><span class="tok-mi">12</span><span class="tok-o">,</span> <span class="tok-nl">CV:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">CW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CX:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">CY:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">CZ:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">DE:</span><span class="tok-mi">32</span><span class="tok-o">,</span> <span class="tok-nl">DJ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">DK:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">DM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">DO:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">DZ:</span><span class="tok-mi">29</span><span class="tok-o">,</span> <span class="tok-nl">EC:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-nl">EE:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">EG:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">EH:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">ER:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ES:</span><span class="tok-mi">41</span><span class="tok-o">,</span> <span class="tok-nl">ET:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">FI:</span><span class="tok-mi">20</span><span class="tok-o">,</span> <span class="tok-nl">FJ:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">FK:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">FM:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">FO:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">FR:</span><span class="tok-mi">56</span><span class="tok-o">,</span> <span class="tok-nl">GA:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GD:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GE:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">GF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GG:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GH:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">GI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GL:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">GM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GN:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GP:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GQ:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GR:</span><span class="tok-mi">39</span><span class="tok-o">,</span> <span class="tok-nl">GT:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">GU:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">GY:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">HK:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">HN:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">HR:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">HT:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">HU:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">ID:</span><span class="tok-mi">67</span><span class="tok-o">,</span> <span class="tok-nl">IE:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-nl">IL:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">IM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">IN:</span><span class="tok-mi">72</span><span class="tok-o">,</span> <span class="tok-nl">IQ:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">IR:</span><span class="tok-mi">44</span><span class="tok-o">,</span> <span class="tok-nl">IS:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">IT:</span><span class="tok-mi">36</span><span class="tok-o">,</span> <span class="tok-nl">JE:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">JM:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">JO:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">JP:</span><span class="tok-mi">63</span><span class="tok-o">,</span> <span class="tok-nl">KE:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">KG:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">KH:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">KI:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">KM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KN:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">KP:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KR:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-nl">KS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">KY:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">KZ:</span><span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-nl">LA:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">LB:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LC:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">LK:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">LR:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">LS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LT:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">LU:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LV:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">LY:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">MA:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">MD:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ME:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MG:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">MH:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MK:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ML:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MM:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">MN:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">MO:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MP:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MQ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MR:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">MS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MT:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">MU:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MV:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">MW:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">MX:</span><span class="tok-mi">58</span><span class="tok-o">,</span> <span class="tok-nl">MY:</span><span class="tok-mi">34</span><span class="tok-o">,</span> <span class="tok-nl">MZ:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">NA:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">NC:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NE:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NF:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NG:</span><span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-nl">NI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NL:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">NO:</span><span class="tok-mi">49</span><span class="tok-o">,</span> <span class="tok-nl">NP:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-nl">NR:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">NZ:</span><span class="tok-mi">25</span><span class="tok-o">,</span> <span class="tok-nl">OM:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">PA:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">PE:</span><span class="tok-mi">20</span><span class="tok-o">,</span> <span class="tok-nl">PF:</span><span class="tok-mi">30</span><span class="tok-o">,</span> <span class="tok-nl">PG:</span><span class="tok-mi">26</span><span class="tok-o">,</span> <span class="tok-nl">PH:</span><span class="tok-mi">38</span><span class="tok-o">,</span> <span class="tok-nl">PK:</span><span class="tok-mi">21</span><span class="tok-o">,</span> <span class="tok-nl">PL:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">PM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">PR:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-nl">PT:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">PW:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">PY:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">QA:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">RE:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">RO:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-nl">RS:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">RU:</span><span class="tok-mi">118</span><span class="tok-o">,</span> <span class="tok-nl">RW:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">SA:</span><span class="tok-mi">26</span><span class="tok-o">,</span> <span class="tok-nl">SB:</span><span class="tok-mi">17</span><span class="tok-o">,</span> <span class="tok-nl">SC:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">SD:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">SE:</span><span class="tok-mi">39</span><span class="tok-o">,</span> <span class="tok-nl">SG:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SH:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">SI:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SK:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">SL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SN:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-nl">SO:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">SR:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ST:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SV:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SX:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">SY:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">SZ:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TC:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">TD:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TG:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TH:</span><span class="tok-mi">32</span><span class="tok-o">,</span> <span class="tok-nl">TJ:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">TL:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TM:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TN:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">TO:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TR:</span><span class="tok-mi">48</span><span class="tok-o">,</span> <span class="tok-nl">TT:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">TV:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">TW:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-nl">TZ:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">UA:</span><span class="tok-mi">14</span><span class="tok-o">,</span> <span class="tok-nl">UG:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-nl">UK:</span><span class="tok-mi">54</span><span class="tok-o">,</span> <span class="tok-nl">US:</span><span class="tok-mi">578</span><span class="tok-o">,</span> <span class="tok-nl">UY:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">UZ:</span><span class="tok-mi">11</span><span class="tok-o">,</span> <span class="tok-nl">VC:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">VE:</span><span class="tok-mi">24</span><span class="tok-o">,</span> <span class="tok-nl">VG:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">VI:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">VN:</span><span class="tok-mi">21</span><span class="tok-o">,</span> <span class="tok-nl">VU:</span><span class="tok-mi">26</span><span class="tok-o">,</span> <span class="tok-nl">WF:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">WS:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">YE:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-nl">YT:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">ZA:</span><span class="tok-mi">20</span><span class="tok-o">,</span> <span class="tok-nl">ZM:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-nl">ZW:</span><span class="tok-mi">3</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we can use <em>select</em> to only return one or more of the full set of key/value
pairs returned. Here is an example of doing just that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Only return the values for Germany, China, Holland and the US.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;DE&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;CN&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;NL&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">DE:</span><span class="tok-mi">32</span><span class="tok-o">,</span> <span class="tok-nl">CN:</span><span class="tok-mi">179</span><span class="tok-o">,</span> <span class="tok-nl">NL:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">US:</span><span class="tok-mi">566</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use a similar query to the one above to find out how many airports are located in
each of the seven continents. As you can see from the output, a key/value map is again
returned where the key is the continent code and the value is the number of airports in
that continent. Note that currently  there are no airports with regular scheduled service
in Antarctica!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many airports are there in each continent?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span>

<span class="tok-o">[</span><span class="tok-nl">EU:</span><span class="tok-mi">561</span><span class="tok-o">,</span> <span class="tok-nl">AS:</span><span class="tok-mi">888</span><span class="tok-o">,</span> <span class="tok-nl">NA:</span><span class="tok-mi">959</span><span class="tok-o">,</span> <span class="tok-nl">OC:</span><span class="tok-mi">274</span><span class="tok-o">,</span> <span class="tok-nl">AF:</span><span class="tok-mi">292</span><span class="tok-o">,</span> <span class="tok-nl">AN:</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-nl">SA:</span><span class="tok-mi">300</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query will, for each airport, return a key value pair where the key is the
airport code and the value is the number of outgoing routes from that airport.
Because there are over 3,000 in the graph, this query will produce quite a lot of
results so I did not try to include them all here. The second query just picks the
results from the map for a few airports. Those results are shown.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many flights are there from each airport?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// count the routes from all the airports and then select a few.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AMS&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;JFK&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DUB&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;MEX&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">AUS:</span><span class="tok-mi">46</span><span class="tok-o">,</span><span class="tok-nl">AMS:</span><span class="tok-mi">249</span><span class="tok-o">,</span><span class="tok-nl">JFK:</span><span class="tok-mi">168</span><span class="tok-o">,</span><span class="tok-nl">DUB:</span><span class="tok-mi">150</span><span class="tok-o">,</span><span class="tok-nl">MEX:</span><span class="tok-mi">95</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query essentially asks the same question about how many outgoing routes
each airport has. However rather than return the count for each airports individually
it groups the ones with the same number of routes together.  As this query returns a
lot of data I just included a few lines from the full result below the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Same query except sorted into groups by ascending count</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-mi">77</span><span class="tok-o">:[</span><span class="tok-n">MNL</span><span class="tok-o">,</span><span class="tok-n">MLA</span><span class="tok-o">,</span><span class="tok-n">SXF</span><span class="tok-o">],</span><span class="tok-mi">79</span><span class="tok-o">:[</span><span class="tok-n">BWI</span><span class="tok-o">,</span><span class="tok-n">TLV</span><span class="tok-o">],</span><span class="tok-mi">80</span><span class="tok-o">:[</span><span class="tok-n">BUD</span><span class="tok-o">,</span><span class="tok-n">CUN</span><span class="tok-o">],</span><span class="tok-mi">81</span><span class="tok-o">:[</span><span class="tok-n">BOM</span><span class="tok-o">,</span><span class="tok-n">RUH</span><span class="tok-o">],</span><span class="tok-mi">82</span><span class="tok-o">:[</span><span class="tok-n">CAI</span><span class="tok-o">,</span><span class="tok-n">STR</span><span class="tok-o">,</span><span class="tok-n">LPA</span><span class="tok-o">,</span><span class="tok-n">LYS</span><span class="tok-o">,</span><span class="tok-n">SHJ</span><span class="tok-o">,</span><span class="tok-n">BGY</span><span class="tok-o">],</span> <span class="tok-mi">83</span><span class="tok-o">:[</span><span class="tok-n">WAW</span><span class="tok-o">],</span><span class="tok-mi">84</span><span class="tok-o">:[</span><span class="tok-n">JNB</span><span class="tok-o">,</span><span class="tok-n">CRL</span><span class="tok-o">],</span><span class="tok-mi">85</span><span class="tok-o">:[</span><span class="tok-n">PHX</span><span class="tok-o">,</span><span class="tok-n">MRS</span><span class="tok-o">,</span><span class="tok-n">TFS</span><span class="tok-o">],</span><span class="tok-mi">86</span><span class="tok-o">:[</span><span class="tok-n">SYD</span><span class="tok-o">,</span><span class="tok-n">LTN</span><span class="tok-o">,</span><span class="tok-n">CMN</span><span class="tok-o">,</span><span class="tok-n">BHX</span><span class="tok-o">],</span><span class="tok-mi">87</span><span class="tok-o">:[</span><span class="tok-n">SLC</span><span class="tok-o">,</span><span class="tok-n">YVR</span><span class="tok-o">],</span><span class="tok-mi">88</span><span class="tok-o">:[</span><span class="tok-n">SZX</span><span class="tok-o">],</span> <span class="tok-mi">89</span><span class="tok-o">:[</span><span class="tok-n">DCA</span><span class="tok-o">,</span><span class="tok-n">CKG</span><span class="tok-o">,</span><span class="tok-n">XIY</span><span class="tok-o">],</span><span class="tok-mi">90</span><span class="tok-o">:[</span><span class="tok-n">HEL</span><span class="tok-o">,</span><span class="tok-n">EDI</span><span class="tok-o">,</span><span class="tok-n">GRU</span><span class="tok-o">,</span><span class="tok-n">HAM</span><span class="tok-o">],</span><span class="tok-mi">92</span><span class="tok-o">:[</span><span class="tok-n">NCE</span><span class="tok-o">],</span><span class="tok-mi">93</span><span class="tok-o">:[</span><span class="tok-n">AUH</span><span class="tok-o">],</span><span class="tok-mi">94</span><span class="tok-o">:[</span><span class="tok-n">SEA</span><span class="tok-o">],</span><span class="tok-mi">95</span><span class="tok-o">:[</span><span class="tok-n">CGN</span><span class="tok-o">,</span><span class="tok-n">MEX</span><span class="tok-o">,</span><span class="tok-n">KMG</span><span class="tok-o">],</span> <span class="tok-mi">97</span><span class="tok-o">:[</span><span class="tok-n">YUL</span><span class="tok-o">],</span><span class="tok-mi">98</span><span class="tok-o">:[</span><span class="tok-n">ALC</span><span class="tok-o">,</span><span class="tok-n">JED</span><span class="tok-o">],</span><span class="tok-mi">99</span><span class="tok-o">:[</span><span class="tok-n">DEL</span><span class="tok-o">],</span><span class="tok-mi">100</span><span class="tok-o">:[</span><span class="tok-n">PRG</span><span class="tok-o">,</span><span class="tok-n">SAW</span><span class="tok-o">],</span><span class="tok-mi">102</span><span class="tok-o">:[</span><span class="tok-n">MCO</span><span class="tok-o">,</span><span class="tok-n">GVA</span><span class="tok-o">],</span><span class="tok-mi">103</span><span class="tok-o">:[</span><span class="tok-n">LIS</span><span class="tok-o">,</span><span class="tok-n">TPE</span><span class="tok-o">],</span><span class="tok-mi">105</span><span class="tok-o">:[</span><span class="tok-n">FLL</span><span class="tok-o">,</span><span class="tok-n">OSL</span><span class="tok-o">],</span> <span class="tok-mi">106</span><span class="tok-o">:[</span><span class="tok-n">BOS</span><span class="tok-o">,</span><span class="tok-n">ATH</span><span class="tok-o">],</span><span class="tok-mi">110</span><span class="tok-o">:[</span><span class="tok-n">NRT</span><span class="tok-o">,</span><span class="tok-n">TXL</span><span class="tok-o">,</span><span class="tok-n">CTU</span><span class="tok-o">],</span><span class="tok-mi">111</span><span class="tok-o">:[</span><span class="tok-n">SFO</span><span class="tok-o">],</span><span class="tok-mi">112</span><span class="tok-o">:[</span><span class="tok-n">KUL</span><span class="tok-o">,</span><span class="tok-n">MXP</span><span class="tok-o">],</span><span class="tok-mi">116</span><span class="tok-o">:[</span><span class="tok-n">LED</span><span class="tok-o">],</span><span class="tok-mi">117</span><span class="tok-o">:[</span><span class="tok-n">AGP</span><span class="tok-o">],</span><span class="tok-mi">120</span><span class="tok-o">:[</span><span class="tok-n">ORY</span><span class="tok-o">],</span> <span class="tok-mi">122</span><span class="tok-o">:[</span><span class="tok-n">PHL</span><span class="tok-o">,</span><span class="tok-n">BKK</span><span class="tok-o">,</span><span class="tok-n">CPH</span><span class="tok-o">],</span><span class="tok-mi">125</span><span class="tok-o">:[</span><span class="tok-n">ARN</span><span class="tok-o">],</span><span class="tok-mi">126</span><span class="tok-o">:[</span><span class="tok-n">IAD</span><span class="tok-o">],</span><span class="tok-mi">127</span><span class="tok-o">:[</span><span class="tok-n">DOH</span><span class="tok-o">],</span><span class="tok-mi">129</span><span class="tok-o">:[</span><span class="tok-n">PMI</span><span class="tok-o">],</span><span class="tok-mi">132</span><span class="tok-o">:[</span><span class="tok-n">MSP</span><span class="tok-o">,</span><span class="tok-n">SIN</span><span class="tok-o">],</span><span class="tok-mi">133</span><span class="tok-o">:[</span><span class="tok-n">DTW</span><span class="tok-o">],</span> <span class="tok-mi">134</span><span class="tok-o">:[</span><span class="tok-n">LAS</span><span class="tok-o">],</span><span class="tok-mi">136</span><span class="tok-o">:[</span><span class="tok-n">ICN</span><span class="tok-o">],</span><span class="tok-mi">140</span><span class="tok-o">:[</span><span class="tok-n">VIE</span><span class="tok-o">],</span><span class="tok-mi">142</span><span class="tok-o">:[</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-n">ZRH</span><span class="tok-o">,</span><span class="tok-n">CLT</span><span class="tok-o">],</span><span class="tok-mi">145</span><span class="tok-o">:[</span><span class="tok-n">MIA</span><span class="tok-o">],</span><span class="tok-mi">147</span><span class="tok-o">:[</span><span class="tok-n">SVO</span><span class="tok-o">],</span><span class="tok-mi">148</span><span class="tok-o">:[</span><span class="tok-n">BRU</span><span class="tok-o">,</span><span class="tok-n">MAN</span><span class="tok-o">,</span><span class="tok-n">DUS</span><span class="tok-o">],</span> <span class="tok-mi">150</span><span class="tok-o">:[</span><span class="tok-n">DUB</span><span class="tok-o">,</span><span class="tok-n">CAN</span><span class="tok-o">],</span><span class="tok-mi">155</span><span class="tok-o">:[</span><span class="tok-n">YYZ</span><span class="tok-o">],</span><span class="tok-mi">156</span><span class="tok-o">:[</span><span class="tok-n">STN</span><span class="tok-o">],</span><span class="tok-mi">157</span><span class="tok-o">:[</span><span class="tok-n">PVG</span><span class="tok-o">],</span><span class="tok-mi">159</span><span class="tok-o">:[</span><span class="tok-n">EWR</span><span class="tok-o">],</span><span class="tok-mi">160</span><span class="tok-o">:[</span><span class="tok-n">LAX</span><span class="tok-o">],</span><span class="tok-mi">163</span><span class="tok-o">:[</span><span class="tok-n">FCO</span><span class="tok-o">],</span><span class="tok-mi">164</span><span class="tok-o">:[</span><span class="tok-n">BCN</span><span class="tok-o">],</span> <span class="tok-mi">166</span><span class="tok-o">:[</span><span class="tok-n">MAD</span><span class="tok-o">],</span><span class="tok-mi">167</span><span class="tok-o">:[</span><span class="tok-n">DEN</span><span class="tok-o">],</span><span class="tok-mi">169</span><span class="tok-o">:[</span><span class="tok-n">JFK</span><span class="tok-o">],</span><span class="tok-mi">170</span><span class="tok-o">:[</span><span class="tok-n">IAH</span><span class="tok-o">],</span><span class="tok-mi">171</span><span class="tok-o">:[</span><span class="tok-n">LGW</span><span class="tok-o">],</span><span class="tok-mi">174</span><span class="tok-o">:[</span><span class="tok-n">LHR</span><span class="tok-o">],</span><span class="tok-mi">187</span><span class="tok-o">:[</span><span class="tok-n">DXB</span><span class="tok-o">],</span><span class="tok-mi">189</span><span class="tok-o">:[</span><span class="tok-n">DME</span><span class="tok-o">],</span> <span class="tok-mi">195</span><span class="tok-o">:[</span><span class="tok-n">DFW</span><span class="tok-o">],</span><span class="tok-mi">196</span><span class="tok-o">:[</span><span class="tok-n">MUC</span><span class="tok-o">],</span><span class="tok-mi">207</span><span class="tok-o">:[</span><span class="tok-n">ORD</span><span class="tok-o">],</span><span class="tok-mi">210</span><span class="tok-o">:[</span><span class="tok-n">PEK</span><span class="tok-o">],</span><span class="tok-mi">218</span><span class="tok-o">:[</span><span class="tok-n">ATL</span><span class="tok-o">],</span><span class="tok-mi">229</span><span class="tok-o">:[</span><span class="tok-n">IST</span><span class="tok-o">],</span><span class="tok-mi">236</span><span class="tok-o">:[</span><span class="tok-n">CDG</span><span class="tok-o">],</span><span class="tok-mi">240</span><span class="tok-o">:[</span><span class="tok-n">FRA</span><span class="tok-o">,</span><span class="tok-n">AMS</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As the above query returns a lot of data, we can also extract specific values we are
interested in as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Which of these airports have 110 outgoing routes?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">110L</span><span class="tok-o">)</span>

<span class="tok-n">NRT</span>
<span class="tok-n">TXL</span>
<span class="tok-n">CTU</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Currently <em>select</em> can only take a string value as the key so we have to
use the slightly awkward <em>next().get()</em> syntax to get a numeric key from a
result.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="groupvar">5.1.1. Using groupCount with a traversal variable</h4>
<div class="paragraph">
<p>So far we have just used <em>groupCount</em> with no parameters. When used in that way,
<em>groupCount</em> behaves like a <em>map</em> step in that it passes the transformed data on to
the next step. However, if you specify the name of a traversal variable as a
parameter, the results of the count will be stored in that variable and <em>groupCount</em>
will act the same way as a <em>sideEffect</em> would, nothing is passed on from <em>groupCount</em>
to the next step. We can use this capability to keep track of things during a query
while not actually changing the overall state of the traversal.</p>
</div>
<div class="paragraph">
<p>The example below starts at the vertex <em>V(3)</em> and goes <em>out</em> from there. A
<em>groupCount</em> step is then used to group the nodes we visited by a count of the number
of runways each has. We then go <em>out</em> again and count how many nodes we found and
save that result in the variable <em>b</em>. Note that the <em>groupCount</em> when used in this
way did not pass anything on to the following step. Finally we use <em>select</em> to return
our two variables as the results of the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">groupCount</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span>
       <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">:</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">:</span><span class="tok-mi">17</span><span class="tok-o">,</span><span class="tok-mi">4</span><span class="tok-o">:</span><span class="tok-mi">22</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">7</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">],</span><span class="tok-nl">b:</span><span class="tok-mi">5913</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="eu-usa">5.1.2. Analysis of routes between Europe and the USA</h4>
<div class="paragraph">
<p>The next few queries show how you can use a graph like <em>air-routes</em> do perform
analysis on a particular industry segment. The following queries analyze the
distribution and availability of routes between airports across Europe and airports
in the United States.First of all let&#8217;s just find out how many total routes there are
between airports anywhere in Europe and airports in the USA.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many routes from anywhere in Europe to the USA?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">345</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So we now know that there are 345 different routes. Remember though that the
air-routes graph does not track the number of airlines that operate any of these
routes. The graph just stores the data that at least one airline operates each of
these unique route pairs. Let&#8217;s dig a bit deeper into the 345 and find out how many
US airports have flights that arrive from Europe.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many different US airports have routes from Europe?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">38</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So we can now see that the 345 routes from European airports arrive at one of 38
airports in the United States. We can dig a bit deeper and look at the distribution
of these routes across the 38 airports. John F. Kennedy airport (JFK) in New York
appears to have the most routes from Europe with Newark (EWR) having the second most.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//What is the distribution of the routes amongst those US airports?</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">valueIncr</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">PHX:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">CVG:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">RSW:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">BDL:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">SJC:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">BWI:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">AUS:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">RDU:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">MSY:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">SAN:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">TPA:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">SLC:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">PDX:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">PIT:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">SFB:</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-nl">DEN:</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-nl">OAK:</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-nl">DTW:</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-nl">FLL:</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-nl">SWF:</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-nl">MSP:</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-nl">CLT:</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-nl">DFW:</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-nl">SEA:</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-nl">PVD:</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-nl">IAH:</span><span class="tok-mi">8</span><span class="tok-o">,</span><span class="tok-nl">MCO:</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-nl">LAS:</span><span class="tok-mi">10</span><span class="tok-o">,</span><span class="tok-nl">ATL:</span><span class="tok-mi">14</span><span class="tok-o">,</span><span class="tok-nl">SFO:</span><span class="tok-mi">15</span><span class="tok-o">,</span><span class="tok-nl">PHL:</span><span class="tok-mi">17</span><span class="tok-o">,</span><span class="tok-nl">IAD:</span><span class="tok-mi">19</span><span class="tok-o">,</span><span class="tok-nl">ORD:</span><span class="tok-mi">21</span><span class="tok-o">,</span><span class="tok-nl">BOS:</span><span class="tok-mi">22</span><span class="tok-o">,</span><span class="tok-nl">LAX:</span><span class="tok-mi">23</span><span class="tok-o">,</span><span class="tok-nl">MIA:</span><span class="tok-mi">24</span><span class="tok-o">,</span><span class="tok-nl">EWR:</span><span class="tok-mi">33</span><span class="tok-o">,</span><span class="tok-nl">JFK:</span><span class="tok-mi">40</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s repeat the process but looking at the European end of the routes. First of
all, we can calculate how many European airports have flights to the United States.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// How many European airports have service to the USA?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">53</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as we did for the airports in the US we can figure out the distribution of
routes for the European airports. It appears that London Heathrow (LHR) offers the
most US destinations and Frankfurt (FRA) the second most.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//What is the distribution of these routes amongst the European airports?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">valueIncr</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">RIX:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">TER:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">BRS:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">STN:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">NCE:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">KRK:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">ORK:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">KBP:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">PDL:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">DME:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">BEG:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">AGP:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">HAM:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">OPO:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">STR:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">VCE:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">BHX:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">ORY:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">ATH:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">MXP:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">BFS:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">BGO:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">GVA:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">VKO:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">HEL:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">WAW:</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-nl">SVO:</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-nl">GLA:</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-nl">EDI:</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-nl">SNN:</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-nl">CGN:</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-nl">TXL:</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-nl">VIE:</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-nl">LIS:</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-nl">BRU:</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-nl">ARN:</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-nl">OSL:</span><span class="tok-mi">8</span><span class="tok-o">,</span><span class="tok-nl">BCN:</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-nl">LGW:</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-nl">IST:</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-nl">MAD:</span><span class="tok-mi">11</span><span class="tok-o">,</span><span class="tok-nl">DUS:</span><span class="tok-mi">11</span><span class="tok-o">,</span><span class="tok-nl">CPH:</span><span class="tok-mi">11</span><span class="tok-o">,</span><span class="tok-nl">FCO:</span><span class="tok-mi">12</span><span class="tok-o">,</span><span class="tok-nl">ZRH:</span><span class="tok-mi">13</span><span class="tok-o">,</span><span class="tok-nl">MAN:</span><span class="tok-mi">13</span><span class="tok-o">,</span><span class="tok-nl">DUB:</span><span class="tok-mi">14</span><span class="tok-o">,</span><span class="tok-nl">MUC:</span><span class="tok-mi">16</span><span class="tok-o">,</span><span class="tok-nl">KEF:</span><span class="tok-mi">17</span><span class="tok-o">,</span><span class="tok-nl">AMS:</span><span class="tok-mi">18</span><span class="tok-o">,</span><span class="tok-nl">CDG:</span><span class="tok-mi">21</span><span class="tok-o">,</span><span class="tok-nl">FRA:</span><span class="tok-mi">24</span><span class="tok-o">,</span><span class="tok-nl">LHR:</span><span class="tok-mi">27</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, we can find out what the list of routes flown is. For this example we just
return 10 of the 345 routes. Note how the <em>path</em> step returns all parts of the
traversal including the continent code <em>EU</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// What are some of these routes?</span>
 <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">EU</span><span class="tok-o">,</span><span class="tok-n">WAW</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EU</span><span class="tok-o">,</span><span class="tok-n">WAW</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EU</span><span class="tok-o">,</span><span class="tok-n">WAW</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EU</span><span class="tok-o">,</span><span class="tok-n">WAW</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EU</span><span class="tok-o">,</span><span class="tok-n">BEG</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EU</span><span class="tok-o">,</span><span class="tok-n">IST</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EU</span><span class="tok-o">,</span><span class="tok-n">IST</span><span class="tok-o">,</span><span class="tok-n">BOS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EU</span><span class="tok-o">,</span><span class="tok-n">IST</span><span class="tok-o">,</span><span class="tok-n">IAD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EU</span><span class="tok-o">,</span><span class="tok-n">IST</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EU</span><span class="tok-o">,</span><span class="tok-n">IST</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapreduce">5.1.3. Using <em>fold</em> to do simple Map-Reduce computations</h4>
<div class="paragraph">
<p>Earlier in the document we saw examples of <em>sum</em> being used to count a
collection of values. You can also use <em>fold</em> to do something similar but in a
more <em>map-reduce</em> type of fashion.</p>
</div>
<div class="paragraph">
<p>First of all, here is a query that uses <em>fold</em> in a way that we have already
seen. We find all routes from Austin and use <em>fold</em> to return a nice list of
those names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-n">Harlingen</span><span class="tok-o">,</span><span class="tok-n">Guadalajara</span><span class="tok-o">,</span><span class="tok-n">Orlando</span><span class="tok-o">,</span><span class="tok-n">Atlanta</span><span class="tok-o">,</span><span class="tok-n">Los</span> <span class="tok-n">Angeles</span><span class="tok-o">,</span><span class="tok-n">Orlando</span><span class="tok-o">,</span> <span class="tok-n">New</span> <span class="tok-n">York</span><span class="tok-o">,</span> <span class="tok-n">Nashville</span><span class="tok-o">,</span><span class="tok-n">Boston</span><span class="tok-o">,</span><span class="tok-n">Baltimore</span><span class="tok-o">,</span><span class="tok-n">Washington</span> <span class="tok-n">D</span><span class="tok-o">.</span><span class="tok-na">C</span><span class="tok-o">.,</span><span class="tok-n">Dallas</span><span class="tok-o">,</span> <span class="tok-n">Ft</span><span class="tok-o">.</span> <span class="tok-n">Lauderdale</span><span class="tok-o">,</span> <span class="tok-n">Washington</span> <span class="tok-n">D</span><span class="tok-o">.</span><span class="tok-na">C</span><span class="tok-o">.,</span><span class="tok-n">Houston</span><span class="tok-o">,</span><span class="tok-n">Toronto</span><span class="tok-o">,</span><span class="tok-n">London</span><span class="tok-o">,</span><span class="tok-n">Frankfurt</span><span class="tok-o">,</span> <span class="tok-n">Mexico</span> <span class="tok-n">City</span><span class="tok-o">,</span><span class="tok-n">Pittsburgh</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Diego</span><span class="tok-o">,</span><span class="tok-n">Long</span> <span class="tok-n">Beach</span><span class="tok-o">,</span><span class="tok-n">Santa</span> <span class="tok-n">Ana</span><span class="tok-o">,</span><span class="tok-n">Miami</span><span class="tok-o">,</span><span class="tok-n">Minneapolis</span><span class="tok-o">,</span><span class="tok-n">Chicago</span><span class="tok-o">,</span><span class="tok-n">Phoenix</span><span class="tok-o">,</span><span class="tok-n">Seattle</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Francisco</span><span class="tok-o">,</span><span class="tok-n">San</span> <span class="tok-n">Jose</span><span class="tok-o">,</span> <span class="tok-n">Tampa</span><span class="tok-o">,</span><span class="tok-n">St</span> <span class="tok-n">Louis</span><span class="tok-o">,</span><span class="tok-n">Albuquerque</span><span class="tok-o">,</span><span class="tok-n">Chicago</span><span class="tok-o">,</span><span class="tok-n">Lubbock</span><span class="tok-o">,</span><span class="tok-n">Cleveland</span><span class="tok-o">,</span><span class="tok-n">Oakland</span><span class="tok-o">,</span><span class="tok-n">Philadelphia</span><span class="tok-o">,</span><span class="tok-n">Detroit</span><span class="tok-o">,</span><span class="tok-n">Portland</span><span class="tok-o">,</span><span class="tok-n">Charlotte</span><span class="tok-o">,</span><span class="tok-n">Cancun</span><span class="tok-o">,</span><span class="tok-n">Memphis</span><span class="tok-o">,</span><span class="tok-n">Cincinnati</span><span class="tok-o">,</span> <span class="tok-n">Dallas</span><span class="tok-o">,</span><span class="tok-n">Salt</span> <span class="tok-n">Lake</span> <span class="tok-n">City</span><span class="tok-o">,</span><span class="tok-n">Las</span> <span class="tok-n">Vegas</span><span class="tok-o">,</span><span class="tok-n">Denver</span><span class="tok-o">,</span><span class="tok-n">New</span> <span class="tok-n">Orleans</span><span class="tok-o">,</span><span class="tok-n">Newark</span><span class="tok-o">,</span><span class="tok-n">Houston</span><span class="tok-o">,</span> <span class="tok-n">El</span> <span class="tok-n">Paso</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, what if we wanted to reduce our results further? Take a look at the modified
version of our query below. It finds all routes from Austin and looks at the names of
the destination cities.  However, rather than return all the names, <em>fold</em> is used to
reduce the names to a value. That value being the total number of characters in all
of those city names. We have seen <em>fold</em> used elsewhere in the document but this time
we provide <em>fold</em> with a parameter and a closure. The parameter is passed to the
closure as the first variable and the name of the city as the second. The closure
then adds the zero and the length of each name effectively to a running total.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-n">a</span><span class="tok-o">,</span><span class="tok-n">b</span> <span class="tok-o">-&gt;</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-n">b</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()}</span>

<span class="tok-mi">449</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
While this query will work as-is on TinkerGraph within the Gremlin Console,
some graph systems are more strict about their type checking and sandboxing of Groovy
closures. To be on the safe side you can always explicitly type cast the closure as
follows.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span>
                       <span class="tok-n">fold</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-n">a</span><span class="tok-o">,</span><span class="tok-n">b</span> <span class="tok-o">-&gt;</span> <span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">)</span><span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-o">((</span><span class="tok-n">String</span><span class="tok-o">)</span><span class="tok-n">b</span><span class="tok-o">).</span><span class="tok-na">length</span><span class="tok-o">()}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="meanmode">5.1.4. Distribution of routes in the graph (mode and mean)</h4>
<div class="paragraph">
<p>An example of a common question we might want to answer with a network graph, of
which air routes are an example, is "how are the routes in my graph distributed
between airport nodes?". We can also use this same query to find the statistical
<em>mode</em> (most common number) for a set of routes.</p>
</div>
<div class="paragraph">
<p>Take a look at the next query that shows how we can do analysis on the distribution
of routes throughout the graph. We are only interested in nodes that are airports and
for those nodes we want to count how many outgoing routes each airport has.  We want
to return the results as a set of odered <em>key:value</em> pairs where the key is the
number of outgoing routes and the value is the number of airports that have that
number of outgoing routes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">valueDecr</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run the query we get back the results below. As the results are sorted in
descending order by value, we can see that the <em>mode</em> (most common) number of
outgoing routes is actually just one route and that 786 airports have just one
outgoing route. We can see that 654 airports have just two routes and so on. We can
also see at the other end of the scale that one airport has 226 outgoing routes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-mi">786</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">:</span><span class="tok-mi">654</span><span class="tok-o">,</span> <span class="tok-mi">3</span><span class="tok-o">:</span><span class="tok-mi">361</span><span class="tok-o">,</span> <span class="tok-mi">4</span><span class="tok-o">:</span><span class="tok-mi">244</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">:</span><span class="tok-mi">149</span><span class="tok-o">,</span> <span class="tok-mi">6</span><span class="tok-o">:</span><span class="tok-mi">110</span><span class="tok-o">,</span> <span class="tok-mi">7</span><span class="tok-o">:</span><span class="tok-mi">86</span><span class="tok-o">,</span> <span class="tok-mi">8</span><span class="tok-o">:</span><span class="tok-mi">80</span><span class="tok-o">,</span> <span class="tok-mi">9</span><span class="tok-o">:</span><span class="tok-mi">67</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">:</span><span class="tok-mi">54</span><span class="tok-o">,</span> <span class="tok-mi">11</span><span class="tok-o">:</span><span class="tok-mi">45</span><span class="tok-o">,</span> <span class="tok-mi">12</span><span class="tok-o">:</span><span class="tok-mi">40</span><span class="tok-o">,</span> <span class="tok-mi">13</span><span class="tok-o">:</span><span class="tok-mi">30</span><span class="tok-o">,</span> <span class="tok-mi">19</span><span class="tok-o">:</span><span class="tok-mi">30</span><span class="tok-o">,</span> <span class="tok-mi">14</span><span class="tok-o">:</span><span class="tok-mi">28</span><span class="tok-o">,</span> <span class="tok-mi">15</span><span class="tok-o">:</span><span class="tok-mi">28</span><span class="tok-o">,</span> <span class="tok-mi">17</span><span class="tok-o">:</span><span class="tok-mi">23</span><span class="tok-o">,</span> <span class="tok-mi">23</span><span class="tok-o">:</span><span class="tok-mi">19</span><span class="tok-o">,</span> <span class="tok-mi">20</span><span class="tok-o">:</span><span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-mi">16</span><span class="tok-o">:</span><span class="tok-mi">17</span><span class="tok-o">,</span> <span class="tok-mi">18</span><span class="tok-o">:</span><span class="tok-mi">17</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">:</span><span class="tok-mi">16</span><span class="tok-o">,</span> <span class="tok-mi">22</span><span class="tok-o">:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-mi">21</span><span class="tok-o">:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-mi">29</span><span class="tok-o">:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-mi">26</span><span class="tok-o">:</span><span class="tok-mi">12</span><span class="tok-o">,</span> <span class="tok-mi">30</span><span class="tok-o">:</span><span class="tok-mi">12</span><span class="tok-o">,</span> <span class="tok-mi">35</span><span class="tok-o">:</span><span class="tok-mi">11</span><span class="tok-o">,</span> <span class="tok-mi">39</span><span class="tok-o">:</span><span class="tok-mi">11</span><span class="tok-o">,</span> <span class="tok-mi">24</span><span class="tok-o">:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">32</span><span class="tok-o">:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">42</span><span class="tok-o">:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">25</span><span class="tok-o">:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-mi">33</span><span class="tok-o">:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-mi">49</span><span class="tok-o">:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-mi">28</span><span class="tok-o">:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-mi">31</span><span class="tok-o">:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-mi">34</span><span class="tok-o">:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-mi">37</span><span class="tok-o">:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-mi">27</span><span class="tok-o">:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-mi">38</span><span class="tok-o">:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-mi">41</span><span class="tok-o">:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-mi">58</span><span class="tok-o">:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-mi">60</span><span class="tok-o">:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-mi">36</span><span class="tok-o">:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-mi">50</span><span class="tok-o">:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-mi">54</span><span class="tok-o">:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-mi">59</span><span class="tok-o">:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-mi">40</span><span class="tok-o">:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-mi">47</span><span class="tok-o">:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-mi">62</span><span class="tok-o">:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-mi">43</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">44</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">51</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">52</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">53</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">56</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">57</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">64</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">65</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">66</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">83</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">84</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">92</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">46</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">69</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">72</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">76</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">78</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">81</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">86</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">97</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">103</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">134</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">142</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">45</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">48</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">55</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">63</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">67</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">70</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">74</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">77</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">82</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">85</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">91</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">93</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">99</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">108</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">115</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">119</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">128</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">174</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">176</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">183</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">191</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">232</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">254</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">257</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">259</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">61</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">71</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">75</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">79</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">80</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">87</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">88</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">89</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">94</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">95</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">96</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">101</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">102</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">104</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">105</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">106</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">109</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">110</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">111</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">112</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">117</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">118</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">121</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">123</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">125</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">127</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">129</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">132</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">140</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">141</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">146</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">148</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">149</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">153</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">154</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">155</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">157</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">158</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">159</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">166</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">172</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">178</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">182</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">184</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">186</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">197</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">206</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">216</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">219</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">225</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">226</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could change our query above, replacing <em>out()</em> with <em>__.in()</em> and we could find
out the distribution of incoming routes. Remember, in an air route network there is
not always a one to one equivalent number of outgoing to incoming routes due to the
way airlines plan their routes.</p>
</div>
<div class="paragraph">
<p>Another change we could make to our query is to change the ordering to use the key
field for each key:value pair and this time sort in ascending order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">keyIncr</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run our query again we get the results below. Looking at the data sorted
this way helps some new interesting facts stand out. The most interesting thing
we can immediately spot is that there are 16 airports that currently have no
outgoing routes at all!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">:</span><span class="tok-mi">16</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-mi">786</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">:</span><span class="tok-mi">654</span><span class="tok-o">,</span> <span class="tok-mi">3</span><span class="tok-o">:</span><span class="tok-mi">361</span><span class="tok-o">,</span> <span class="tok-mi">4</span><span class="tok-o">:</span><span class="tok-mi">244</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">:</span><span class="tok-mi">149</span><span class="tok-o">,</span> <span class="tok-mi">6</span><span class="tok-o">:</span><span class="tok-mi">110</span><span class="tok-o">,</span> <span class="tok-mi">7</span><span class="tok-o">:</span><span class="tok-mi">86</span><span class="tok-o">,</span> <span class="tok-mi">8</span><span class="tok-o">:</span><span class="tok-mi">80</span><span class="tok-o">,</span> <span class="tok-mi">9</span><span class="tok-o">:</span><span class="tok-mi">67</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">:</span><span class="tok-mi">54</span><span class="tok-o">,</span> <span class="tok-mi">11</span><span class="tok-o">:</span><span class="tok-mi">45</span><span class="tok-o">,</span> <span class="tok-mi">12</span><span class="tok-o">:</span><span class="tok-mi">40</span><span class="tok-o">,</span> <span class="tok-mi">13</span><span class="tok-o">:</span><span class="tok-mi">30</span><span class="tok-o">,</span> <span class="tok-mi">14</span><span class="tok-o">:</span><span class="tok-mi">28</span><span class="tok-o">,</span> <span class="tok-mi">15</span><span class="tok-o">:</span><span class="tok-mi">28</span><span class="tok-o">,</span> <span class="tok-mi">16</span><span class="tok-o">:</span><span class="tok-mi">17</span><span class="tok-o">,</span> <span class="tok-mi">17</span><span class="tok-o">:</span><span class="tok-mi">23</span><span class="tok-o">,</span> <span class="tok-mi">18</span><span class="tok-o">:</span><span class="tok-mi">17</span><span class="tok-o">,</span> <span class="tok-mi">19</span><span class="tok-o">:</span><span class="tok-mi">30</span><span class="tok-o">,</span> <span class="tok-mi">20</span><span class="tok-o">:</span><span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-mi">21</span><span class="tok-o">:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-mi">22</span><span class="tok-o">:</span><span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-mi">23</span><span class="tok-o">:</span><span class="tok-mi">19</span><span class="tok-o">,</span> <span class="tok-mi">24</span><span class="tok-o">:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">25</span><span class="tok-o">:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-mi">26</span><span class="tok-o">:</span><span class="tok-mi">12</span><span class="tok-o">,</span> <span class="tok-mi">27</span><span class="tok-o">:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-mi">28</span><span class="tok-o">:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-mi">29</span><span class="tok-o">:</span><span class="tok-mi">13</span><span class="tok-o">,</span> <span class="tok-mi">30</span><span class="tok-o">:</span><span class="tok-mi">12</span><span class="tok-o">,</span> <span class="tok-mi">31</span><span class="tok-o">:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-mi">32</span><span class="tok-o">:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">33</span><span class="tok-o">:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-mi">34</span><span class="tok-o">:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-mi">35</span><span class="tok-o">:</span><span class="tok-mi">11</span><span class="tok-o">,</span> <span class="tok-mi">36</span><span class="tok-o">:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-mi">37</span><span class="tok-o">:</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-mi">38</span><span class="tok-o">:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-mi">39</span><span class="tok-o">:</span><span class="tok-mi">11</span><span class="tok-o">,</span> <span class="tok-mi">40</span><span class="tok-o">:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-mi">41</span><span class="tok-o">:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-mi">42</span><span class="tok-o">:</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">43</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">44</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">45</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">46</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">47</span><span class="tok-o">:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-mi">48</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">49</span><span class="tok-o">:</span><span class="tok-mi">9</span><span class="tok-o">,</span> <span class="tok-mi">50</span><span class="tok-o">:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-mi">51</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">52</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">53</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">54</span><span class="tok-o">:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-mi">55</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">56</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">57</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">58</span><span class="tok-o">:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-mi">59</span><span class="tok-o">:</span><span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-mi">60</span><span class="tok-o">:</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-mi">61</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">62</span><span class="tok-o">:</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-mi">63</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">64</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">65</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">66</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">67</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">69</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">70</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">71</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">72</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">74</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">75</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">76</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">77</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">78</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">79</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">80</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">81</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">82</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">83</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">84</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">85</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">86</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">87</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">88</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">89</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">91</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">92</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">93</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">94</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">95</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">96</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">97</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">99</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">:</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">101</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">102</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">103</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">104</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">105</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">106</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">108</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">109</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">110</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">111</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">112</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">115</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">117</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">118</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">119</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">121</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">123</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">125</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">127</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">128</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">129</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">132</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">134</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">140</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">141</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">142</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">146</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">148</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">149</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">153</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">154</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">155</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">157</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">158</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">159</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">166</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">172</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">174</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">176</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">178</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">182</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">183</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">184</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">186</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">191</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">197</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">206</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">216</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">219</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">225</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">226</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">232</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">254</span><span class="tok-o">:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">257</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">259</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to find the statistical mean number of routes in the graph we could
easily write a query like the one below to tell us how many airports and
outgoing routes in total there are in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">union</span><span class="tok-o">(</span><span class="tok-n">count</span><span class="tok-o">(),</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-mi">3340</span><span class="tok-o">,</span><span class="tok-mi">40662</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could then use the Gremlin Console do the division for us to calculate the mean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">gremlin</span><span class="tok-o">&gt;</span> <span class="tok-mi">40662</span><span class="tok-o">/</span><span class="tok-mi">3340</span>
<span class="tok-o">==&gt;</span><span class="tok-mf">12.1742514970</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, Gremlin also has a <em>mean</em> step that we can take advantage of if we can
figure out a way to use it in this case that will do the work for us. Take a look at
the next query.  The key thing to note here is the way <em>local</em> has been used. This
will cause Gremlin to essentially do what we did a bit more manually above. If we did
not include <em>local</em> the answer would just be the total number of outgoing routes as
Gremlin would essentially calculate 40662/1. By using local we force Gremlin to in
essence create an array containing the number of routes for each airport, add those
values up and divide by the number of elements in the array (the number of airports).
I hope that makes sense. If it is confusing try the query yourself on the gremlin
console with and without local and try it without the <em>mean</em> step.  You will see all
of the interim values instead!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">local</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">mean</span><span class="tok-o">()</span>

<span class="tok-mf">12.174251497005988</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So it seems there is an average of just over 12 outgoing routes per airport in
the graph whichever way we decide to calculate it!</p>
</div>
<div class="paragraph">
<p>Now that we have a query figured out for calculating the average number of
outgoing routes per airport, we can easily tweak it to do the same for incoming
routes and combined, incoming and outgoing, routes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Average number of incoming routes</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;type&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">local</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">mean</span><span class="tok-o">()</span>

<span class="tok-mf">12.174251497005988</span>

<span class="tok-c1">// Average number of outgoing and incoming routes</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;type&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">local</span><span class="tok-o">(</span><span class="tok-n">both</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()).</span><span class="tok-na">mean</span><span class="tok-o">()</span>

<span class="tok-mf">24.348502994011977</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_many_routes_are_there_from_airports_in_london_uk">5.1.5. How many routes are there from airports in London (UK)?</h4>
<div class="paragraph">
<p>This next query can be used to figure out how many outgoing routes each of the
airports classified as being in (or near) London, England has. Note that we
first find all airports in England using <em>has('region</em>,<em>GB-ENG</em>)'. If we did
not do this we would pick up airports in other countries as well such as
London, Ontario, in Canada.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;GB-ENG&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">).</span><span class="tok-na">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span>

<span class="tok-o">[</span><span class="tok-nl">LCY:</span><span class="tok-mi">37</span><span class="tok-o">,</span> <span class="tok-nl">LHR:</span><span class="tok-mi">176</span><span class="tok-o">,</span> <span class="tok-nl">LTN:</span><span class="tok-mi">91</span><span class="tok-o">,</span> <span class="tok-nl">STN:</span><span class="tok-mi">162</span><span class="tok-o">,</span> <span class="tok-nl">LGW:</span><span class="tok-mi">179</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a twist on the above theme. How many places can I get to from London in two
hops but not including flights that end up back in London? It turns out there are
over 2,000 places!  Notice how <em>aggregate</em> is used to store the set of London
airports as a collection that can be referenced later on in the query to help with
ruling out any flights that would end up back in London.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Leave from London, fly with one stop, not ending back in London, how many places?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;GB-ENG&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">).</span><span class="tok-na">aggregate</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">without</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">2082</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could have written the previous query like this and avoided using <em>aggregate</em> but
to me, this feels more clumsy and somewhat repetetive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;GB-ENG&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">dedup</span><span class="tok-o">()</span>
                             <span class="tok-o">.</span><span class="tok-na">not</span><span class="tok-o">(</span><span class="tok-n">and</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">),</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;GB-ENG&#39;</span><span class="tok-o">))).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">2082</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="topten">5.1.6. What are the top ten airports by route count?</h4>
<div class="paragraph">
<p>These next three queries produce a table of the top ten airports in terms of
incoming, outgoing and overall routes. Note that because of the way some airlines
route flights, the number of outgoing and incoming routes to an airport will not
always be the same. For example, several KLM Airlines flights from Amsterdam to
airports in Africa continue on to other African airports before returning to
Amsterdam. As a result there are more inbound routes from than out bound routes to
these airports.</p>
</div>
<div class="paragraph">
<p>First of all, this query will find the ten airports with the most incoming routes,
sorted by descending order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find the top ten overall in terms of incoming routes</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">(),</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>
                         <span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">(</span><span class="tok-s1">&#39;ap&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;routes&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">())</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">AMS</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">249</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">FRA</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">243</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">CDG</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">239</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">IST</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">234</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">ATL</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">221</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">PEK</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">213</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">ORD</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">212</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">MUC</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">199</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">DFW</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">198</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">DME</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">190</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s do the same thing but for outgoing routes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find the top ten overall in terms of outgoing routes</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;routes&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">(),</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>
                         <span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">(</span><span class="tok-s1">&#39;ap&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;routes&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;routes&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">())</span>

<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">FRA</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">243</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">AMS</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">240</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">CDG</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">239</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">IST</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">232</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">ATL</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">221</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">PEK</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">213</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">ORD</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">212</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">MUC</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">199</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">DFW</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">198</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">DME</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">190</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, let&#8217;s find the top ten airports ordered by the total number of incoming and
outgoing routes that they have.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find the top ten overall in terms of total routes</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">both</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">(),</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">project</span><span class="tok-o">(</span><span class="tok-s1">&#39;ap&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;routes&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">both</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">())</span>

<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">AMS</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">489</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">FRA</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">486</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">CDG</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">478</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">IST</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">466</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">ATL</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">442</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">PEK</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">426</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">ORD</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">424</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">MUC</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">398</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">DFW</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">396</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">ap:</span><span class="tok-n">DME</span><span class="tok-o">,</span> <span class="tok-nl">routes:</span><span class="tok-mi">380</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="localfold">5.1.7. Using <em>local</em> while counting things</h4>
<div class="paragraph">
<p>Earlier in this document we saw examples of <em>local</em> being used. Here is another
example of how <em>local</em> can be used while counting things to achieve a desired result.</p>
</div>
<div class="paragraph">
<p>Take a look at the query below. It finds any airports that have six or more runways
and then returns the airports IATA code along with the number of runways.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">gte</span><span class="tok-o">(</span><span class="tok-mi">6</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output from running the query. As you can see what is returned is a list
of airport codes with each followed by its runway count.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">BOS</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">,</span><span class="tok-n">DEN</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-n">DTW</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-n">AMS</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While the output returned by the previous query is not bad, it might be nice to have
what is returned be a set of code and runway pairs each in it&#8217;s own list. We can
achieve this result by having the <em>fold</em> step applied to the interim or <em>local</em>
results of the query.</p>
</div>
<div class="paragraph">
<p>Take a look at the modified form of the query below. Part of the query is now wrapped
inside of a <em>local</em> step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">,</span><span class="tok-n">gte</span><span class="tok-o">(</span><span class="tok-mi">6</span><span class="tok-o">)).</span><span class="tok-na">local</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output from running our modified form of the query. Each airport code and
runway value pair is now in it&#8217;s own individual list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">BOS</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">7</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ORD</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DEN</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DTW</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AMS</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="wherefly">5.2. Where can I fly to from here?</h3>
<div class="paragraph">
<p>Here are some more examples of queries that explore different questions along
the lines of "Where can I fly to from here?".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Where in the USA or Canada can I fly to from any airport in India?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;IN&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;CA&#39;</span><span class="tok-o">)).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">IN</span><span class="tok-o">,</span><span class="tok-n">BOM</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IN</span><span class="tok-o">,</span><span class="tok-n">DEL</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IN</span><span class="tok-o">,</span><span class="tok-n">DEL</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IN</span><span class="tok-o">,</span><span class="tok-n">DEL</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IN</span><span class="tok-o">,</span><span class="tok-n">DEL</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IN</span><span class="tok-o">,</span><span class="tok-n">DEL</span><span class="tok-o">,</span><span class="tok-n">YVR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IN</span><span class="tok-o">,</span><span class="tok-n">DEL</span><span class="tok-o">,</span><span class="tok-n">YYZ</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which cities in Europe can I fly to from Ft; Lauderdale in Florida?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Where can I fly to in Europe from Ft. Lauderdale?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;FLL&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span>

<span class="tok-n">London</span>
<span class="tok-n">Paris</span>
<span class="tok-n">Oslo</span>
<span class="tok-n">Stockholm</span>
<span class="tok-n">Copenhagen</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where can I fly to from Charlotte, North Carolina to cities in Europe or South
America?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Flights from Charlotte to airports in Europe or South America</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;CLT&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SA&#39;</span><span class="tok-o">)).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">LHR</span>     <span class="tok-n">FCO</span>
<span class="tok-n">CDG</span>     <span class="tok-n">MAD</span>
<span class="tok-n">FRA</span>     <span class="tok-n">MUC</span>
<span class="tok-n">GIG</span>     <span class="tok-n">DUB</span>
<span class="tok-n">GRU</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where in the United States can I fly from to any one of the five airports in the
London area in the UK?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Where in the United States can I fly to non-stop from any of the</span>
<span class="tok-c1">// airports in and around London in the UK.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LCY&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LGW&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LTN&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;STN&#39;</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">SEA</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">RDU</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">DEN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">BWI</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">SJC</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">DTW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">BOS</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">PHL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">IAD</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">MSP</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-n">TPA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-n">FLL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">PHX</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">CLT</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-n">MCO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">SAN</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where in New York state can I fly to from any of the airports in Texas?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Where in New York state can I fly to from any airport in Texas?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-NY&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">SAT</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">SAT</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">HOU</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">LGA</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">HOU</span><span class="tok-o">,</span><span class="tok-n">LGA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">HOU</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-n">LGA</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which cities in Mexico can I fly to from Denver?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Where in Mexico can I fly to from Denver?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DEN&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;MX&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span>

<span class="tok-n">Puerto</span> <span class="tok-n">Vallarta</span>
<span class="tok-n">San</span> <span class="tok-n">Josa</span> <span class="tok-n">del</span> <span class="tok-n">Cabo</span>
<span class="tok-n">Cozumel</span>
<span class="tok-n">Mexico</span> <span class="tok-n">City</span>
<span class="tok-n">Cancun</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which cities in Europe can I fly to from Delhi in India?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Where in Europe can I fly to from Delhi?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DEL&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">in</span><span class="tok-o">(</span><span class="tok-s2">&quot;contains&quot;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;EU&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span>

<span class="tok-n">Istanbul</span>
<span class="tok-n">Helsinki</span>
<span class="tok-n">Paris</span>
<span class="tok-n">Frankfurt</span>
<span class="tok-n">London</span>
<span class="tok-n">Birmingham</span>
<span class="tok-n">Vienna</span>
<span class="tok-n">Zurich</span>
<span class="tok-n">Amsterdam</span>
<span class="tok-n">Moscow</span>
<span class="tok-n">Brussels</span>
<span class="tok-n">Munich</span>
<span class="tok-n">Rome</span></code></pre>
</div>
</div>
<div id="aggr1" class="paragraph">
<p>Find all the routes between airports in London, Munich and Paris. Notice how
by using <em>aggregate</em> to collect the results of the first <em>within</em> test that we
don&#8217;t have to repeat the names in the second <em>within</em>, we can just refer to
the aggregated collection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Munich&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Paris&#39;</span><span class="tok-o">)).</span><span class="tok-na">aggregate</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">()</span>  <span class="tok-err">\</span>
     <span class="tok-o">.</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">MUC</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">CDG</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">MUC</span><span class="tok-o">,</span><span class="tok-n">STN</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">STN</span><span class="tok-o">,</span><span class="tok-n">MUC</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">ORY</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">CDG</span><span class="tok-o">,</span><span class="tok-n">LGW</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">MUC</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">ORY</span><span class="tok-o">,</span><span class="tok-n">LCY</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">CDG</span><span class="tok-o">,</span><span class="tok-n">MUC</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">MUC</span><span class="tok-o">,</span><span class="tok-n">LGW</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">ORY</span><span class="tok-o">,</span><span class="tok-n">MUC</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-n">MUC</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">CDG</span><span class="tok-o">,</span><span class="tok-n">LCY</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">MUC</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">ORY</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">MUC</span><span class="tok-o">,</span><span class="tok-n">LTN</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">LCY</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">LTN</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">CDG</span><span class="tok-o">,</span><span class="tok-n">LTN</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">MUC</span><span class="tok-o">,</span><span class="tok-n">ORY</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">LCY</span><span class="tok-o">,</span><span class="tok-n">ORY</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">LTN</span><span class="tok-o">,</span><span class="tok-n">MUC</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_more_analysis_of_distances_between_airports">5.3. More analysis of distances between airports</h3>
<div class="paragraph">
<p>In this section you will find some more queries that examine distances between
airports.</p>
</div>
<div class="paragraph">
<p>This query returns a nice list of all the routes from Austin (AUS) along with
their distances. The results are sorted in ascending order by distance. For ease of
reading I broke the results into four columns.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Distances of all routes from AUS along with destination IATA CODE</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">incr</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">142</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">755</span><span class="tok-o">,</span><span class="tok-n">GDL</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1080</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1430</span><span class="tok-o">,</span><span class="tok-n">PHL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">152</span><span class="tok-o">,</span><span class="tok-n">HOU</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">755</span><span class="tok-o">,</span><span class="tok-n">BNA</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1080</span><span class="tok-o">,</span><span class="tok-n">SLC</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1476</span><span class="tok-o">,</span><span class="tok-n">SJC</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">183</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">768</span><span class="tok-o">,</span><span class="tok-n">DEN</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1110</span><span class="tok-o">,</span><span class="tok-n">FLL</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1493</span><span class="tok-o">,</span><span class="tok-n">OAK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">189</span><span class="tok-o">,</span><span class="tok-n">DAL</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">809</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1140</span><span class="tok-o">,</span><span class="tok-n">DTW</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1500</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">274</span><span class="tok-o">,</span><span class="tok-n">HRL</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">866</span><span class="tok-o">,</span><span class="tok-n">PHX</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1160</span><span class="tok-o">,</span><span class="tok-n">SAN</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1500</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">341</span><span class="tok-o">,</span><span class="tok-n">LBB</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">922</span><span class="tok-o">,</span><span class="tok-n">CUN</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1173</span><span class="tok-o">,</span><span class="tok-n">CLE</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1520</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">444</span><span class="tok-o">,</span><span class="tok-n">MSY</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">925</span><span class="tok-o">,</span><span class="tok-n">TPA</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1220</span><span class="tok-o">,</span><span class="tok-n">LGB</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1690</span><span class="tok-o">,</span><span class="tok-n">BOS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">527</span><span class="tok-o">,</span><span class="tok-n">ELP</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">972</span><span class="tok-o">,</span><span class="tok-n">MDW</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1230</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1712</span><span class="tok-o">,</span><span class="tok-n">PDX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">558</span><span class="tok-o">,</span><span class="tok-n">MEM</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">973</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1294</span><span class="tok-o">,</span><span class="tok-n">IAD</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1768</span><span class="tok-o">,</span><span class="tok-n">SEA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">618</span><span class="tok-o">,</span><span class="tok-n">ABQ</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">994</span><span class="tok-o">,</span><span class="tok-n">MCO</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1313</span><span class="tok-o">,</span><span class="tok-n">DCA</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">4901</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">722</span><span class="tok-o">,</span><span class="tok-n">STL</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1030</span><span class="tok-o">,</span><span class="tok-n">CLT</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1339</span><span class="tok-o">,</span><span class="tok-n">BWI</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">5294</span><span class="tok-o">,</span><span class="tok-n">FRA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">748</span><span class="tok-o">,</span><span class="tok-n">MEX</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1040</span><span class="tok-o">,</span><span class="tok-n">MSP</span><span class="tok-o">]</span>      <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1357</span><span class="tok-o">,</span><span class="tok-n">YYZ</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query finds all routes from DFW that are longer than 4,000 miles and
returns the airport codes and the distances. Notice the use of two <em>by</em>
modulators in this query to decide which values are returned from the source
node, the edge and the destination node respectively. Also note that only two
were specified but three values are returned. This works because <em>by</em> is
processed in a round robbin fashion if there are more values than <em>by</em>
modulators.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Where can I fly to from DFW that is more than 4,000 miles away?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">4000</span><span class="tok-o">)).</span><span class="tok-na">inV</span><span class="tok-o">()</span><span class="tok-err">\</span>
                       <span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8105</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8022</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">6951</span><span class="tok-o">,</span><span class="tok-n">PEK</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">6822</span><span class="tok-o">,</span><span class="tok-n">ICN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">7332</span><span class="tok-o">,</span><span class="tok-n">PVG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">5228</span><span class="tok-o">,</span><span class="tok-n">GIG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">4905</span><span class="tok-o">,</span><span class="tok-n">AMS</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">5119</span><span class="tok-o">,</span><span class="tok-n">GRU</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">4950</span><span class="tok-o">,</span><span class="tok-n">MAD</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">5299</span><span class="tok-o">,</span><span class="tok-n">EZE</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">4736</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">4884</span><span class="tok-o">,</span><span class="tok-n">SCL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">4933</span><span class="tok-o">,</span><span class="tok-n">CDG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">7914</span><span class="tok-o">,</span><span class="tok-n">DOH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">5127</span><span class="tok-o">,</span><span class="tok-n">FRA</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8053</span><span class="tok-o">,</span><span class="tok-n">AUH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">6410</span><span class="tok-o">,</span><span class="tok-n">NRT</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">5015</span><span class="tok-o">,</span><span class="tok-n">DUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8574</span><span class="tok-o">,</span><span class="tok-n">SYD</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query also finds all routes longer than 4,000 miles but this time
originating in London Gatwick.  Note also the use of <em>where</em> to query the edge
distance. The <em>has</em> form is simpler but I show <em>where</em> being used just to
demonstrate an alternative way we could do it.  Note that this query uses
three <em>by</em> modulators as each of the values returned is from a different
property of the respective nodes and edges.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Routes longer than 4,000 miles starting at LGW</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LGW&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">4000L</span><span class="tok-o">)))</span> <span class="tok-err">\</span>
     <span class="tok-o">.</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5287</span><span class="tok-o">,</span> <span class="tok-n">MalT</span><span class="tok-o">]</span>              <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4380</span><span class="tok-o">,</span> <span class="tok-n">Calgary</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4618</span><span class="tok-o">,</span> <span class="tok-n">Varadero</span><span class="tok-o">]</span>          <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5987</span><span class="tok-o">,</span> <span class="tok-n">Cape</span> <span class="tok-n">Town</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5147</span><span class="tok-o">,</span> <span class="tok-n">Tianjin</span><span class="tok-o">]</span>           <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4680</span><span class="tok-o">,</span> <span class="tok-n">Kingston</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5303</span><span class="tok-o">,</span> <span class="tok-n">Chongqing</span><span class="tok-o">]</span>         <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4953</span><span class="tok-o">,</span> <span class="tok-n">Cancun</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4410</span><span class="tok-o">,</span> <span class="tok-n">Ft</span><span class="tok-o">.</span> <span class="tok-n">Lauderdale</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5399</span><span class="tok-o">,</span> <span class="tok-n">Colombo</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5463</span><span class="tok-o">,</span> <span class="tok-n">Los</span> <span class="tok-n">Angeles</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4197</span><span class="tok-o">,</span> <span class="tok-n">Bridgetown</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4341</span><span class="tok-o">,</span> <span class="tok-n">Orlando</span><span class="tok-o">]</span>           <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4076</span><span class="tok-o">,</span> <span class="tok-n">St</span><span class="tok-o">.</span> <span class="tok-n">George</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5374</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Francisco</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4408</span><span class="tok-o">,</span> <span class="tok-n">Port</span> <span class="tok-n">of</span> <span class="tok-n">Spain</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4416</span><span class="tok-o">,</span> <span class="tok-n">Tampa</span><span class="tok-o">]</span>             <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4699</span><span class="tok-o">,</span> <span class="tok-n">Montego</span> <span class="tok-n">Bay</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5236</span><span class="tok-o">,</span> <span class="tok-n">Las</span> <span class="tok-n">Vegas</span><span class="tok-o">]</span>         <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4283</span><span class="tok-o">,</span> <span class="tok-n">Punta</span> <span class="tok-n">Cana</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5364</span><span class="tok-o">,</span> <span class="tok-n">Oakland</span><span class="tok-o">]</span>           <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5419</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Jose</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4731</span><span class="tok-o">,</span> <span class="tok-n">Vancouver</span><span class="tok-o">]</span>         <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4662</span><span class="tok-o">,</span> <span class="tok-n">Havana</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5982</span><span class="tok-o">,</span> <span class="tok-n">Hong</span> <span class="tok-n">Kong</span><span class="tok-o">]</span>         <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">6053</span><span class="tok-o">,</span> <span class="tok-n">Port</span> <span class="tok-n">Louis</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">5070</span><span class="tok-o">,</span> <span class="tok-n">Beijing</span><span class="tok-o">]</span>           <span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-mi">4222</span><span class="tok-o">,</span> <span class="tok-n">Vieux</span> <span class="tok-n">Fort</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query is similar to the previous ones. We look for any routes from DFW
that are longer than 4,500 miles. However, there are a few differences in this
query worthy of note. First of all it uses the preferred <em>has</em> technique again
to test the distance whereas in the previous query we used <em>where</em>.  Also this
time we just list the distance and the destination airport&#8217;s code and we sort
the end result using a <em>sort</em>. We also use <em>select</em> and <em>as</em> rather than the
perhaps more succinct <em>path</em> and <em>by</em> to show a different way of achieving
effectively the same results.The <em>path</em> and <em>by</em> combination were introduced
more recently into TinkerPop and I find that to be a more convenient syntax to
use most of the time but both ways work and both have their benefits. We
should also note that I show <em>sort</em> being used here but in most cases we can
re-write our query to use <em>order</em>. You will find several examples of <em>order</em>
being used throughout this document. Order is introduced in the "<a href="#sort">Sorting things</a>"
section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Routes from DFW that are over 4,500 miles in length.</span>
<span class="tok-c1">// Sorted into ascending order</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">4500</span><span class="tok-o">)).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">)</span>
                         <span class="tok-o">.</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">sort</span><span class="tok-o">(){</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">e</span><span class="tok-o">}</span>


<span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">4736</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">LHR</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">6410</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">NRT</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">4884</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">SCL</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">6822</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">ICN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">4905</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">AMS</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">6951</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">PEK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">4933</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">CDG</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">7332</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">PVG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">4950</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">MAD</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">7914</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">DOH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">5015</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">DUS</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">8022</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">5119</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">GRU</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">8053</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">AUH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">5127</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">FRA</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">8105</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">HKG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">5228</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">GIG</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">8574</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">SYD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">e:</span><span class="tok-mi">5299</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-n">EZE</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_finding_routes_longer_than_8_000_miles">5.3.1. Finding routes longer than 8,000 miles</h4>
<div class="paragraph">
<p>This next set of queries show various ways of finding and presenting all routes longer than
8,000 miles. Each query improves upon the one before by adding some additional feature or
using a step that simplifies the query. First of all let&#8217;s just find all routes longer
than 8,000 miles. This will includes routes in both directions between airport pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// All outes longer than 8,000 miles</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;src&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">8000</span><span class="tok-o">)).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;dest&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;src&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;dest&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>


<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">JNB</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">SIN</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">SYD</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DXB</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">HKG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">AUH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DXB</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">AKL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DOH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">HKG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DXB</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DOH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">AKL</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">AUH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">JED</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">RUH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">JNB</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">ATL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">SIN</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DXB</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">AUH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">HKG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">JED</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">SYD</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DFW</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">RUH</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">LAX</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s improve the query by including the distance of each route in the query results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find routes longer than 8,000 miles, include the distance in returned values.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;src&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">8000</span><span class="tok-o">)).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;dest&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;src&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;dest&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>


<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8434</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">JNB</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">SIN</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8433</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8574</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">SYD</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8022</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8022</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DXB</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8150</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8105</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">HKG</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8321</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8053</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">AUH</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8085</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8150</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DXB</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8818</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">AKL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8030</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DOH</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8105</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8054</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">HKG</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8054</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8321</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DXB</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8047</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8287</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DOH</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">AKL</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8818</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8372</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">AUH</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8030</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8314</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">JED</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8287</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8246</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">RUH</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">JNB</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8434</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">ATL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8433</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">SIN</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8053</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8085</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DXB</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8372</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8139</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">AUH</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8139</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8047</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">HKG</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">JED</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8314</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">SYD</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8574</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">DFW</span><span class="tok-o">]</span>     <span class="tok-o">[</span><span class="tok-nl">src:</span><span class="tok-n">RUH</span><span class="tok-o">,</span><span class="tok-nl">e:</span><span class="tok-mi">8246</span><span class="tok-o">,</span><span class="tok-nl">dest:</span><span class="tok-n">LAX</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next let&#8217;s simplify things a bit. While using <em>as</em> and <em>select</em> gets the job done, using
<em>path</em> and <em>by</em> shortens the query and makes it more readable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Note that this also changes the way the result is returned</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">8000</span><span class="tok-o">)).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-mi">8434</span><span class="tok-o">,</span><span class="tok-n">JNB</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8287</span><span class="tok-o">,</span><span class="tok-n">DOH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">SIN</span><span class="tok-o">,</span><span class="tok-mi">8433</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">AKL</span><span class="tok-o">,</span><span class="tok-mi">8818</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8574</span><span class="tok-o">,</span><span class="tok-n">SYD</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8372</span><span class="tok-o">,</span><span class="tok-n">AUH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8022</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-mi">8030</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8022</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8314</span><span class="tok-o">,</span><span class="tok-n">JED</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8150</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-mi">8287</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8105</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8246</span><span class="tok-o">,</span><span class="tok-n">RUH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8321</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">JNB</span><span class="tok-o">,</span><span class="tok-mi">8434</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8053</span><span class="tok-o">,</span><span class="tok-n">AUH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-mi">8433</span><span class="tok-o">,</span><span class="tok-n">SIN</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8085</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8053</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-mi">8150</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-mi">8085</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8818</span><span class="tok-o">,</span><span class="tok-n">AKL</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8372</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-mi">8030</span><span class="tok-o">,</span><span class="tok-n">DOH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-mi">8139</span><span class="tok-o">,</span><span class="tok-n">AUH</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-mi">8105</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8139</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-mi">8054</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-mi">8047</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-mi">8054</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">JED</span><span class="tok-o">,</span><span class="tok-mi">8314</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8321</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">SYD</span><span class="tok-o">,</span><span class="tok-mi">8574</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-mi">8047</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>   <span class="tok-o">[</span><span class="tok-n">RUH</span><span class="tok-o">,</span><span class="tok-mi">8246</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Our query is looking pretty good but it would be nice to not report the same route pair
twice.  In other words the distance between two airports in just one direction is all we
really want. This adds a little complexity to things as we have to find a way to <em>filter</em>
out the routes that we want to ignore. One way to do this is to filter by making sure the
code for the source airport is less than the code for the destination airport. This may
seem a bit odd but it is a way of saying we only want route pairs we have not already
seen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// We could avoid returning both directions of travel by refining our query as follows</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">8000</span><span class="tok-o">)).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">)</span> <span class="tok-err">\</span>
     <span class="tok-o">.</span><span class="tok-na">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span> <span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">))).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-mi">8434</span><span class="tok-o">,</span><span class="tok-n">JNB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8574</span><span class="tok-o">,</span><span class="tok-n">SYD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8022</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8105</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8246</span><span class="tok-o">,</span><span class="tok-n">RUH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-mi">8433</span><span class="tok-o">,</span><span class="tok-n">SIN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-mi">8047</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8150</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8321</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8085</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-mi">8054</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AKL</span><span class="tok-o">,</span><span class="tok-mi">8818</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-mi">8030</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-mi">8287</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8053</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8372</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8139</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JED</span><span class="tok-o">,</span><span class="tok-mi">8314</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, now that we have the routes we want, let&#8217;s tweak the query so that the routes are
sorted by descending order of distance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// As above but sorted by route lengths</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">8000</span><span class="tok-o">)).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">)</span> <span class="tok-err">\</span>
     <span class="tok-o">.</span><span class="tok-na">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span> <span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">))).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">AKL</span><span class="tok-o">,</span><span class="tok-mi">8818</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8574</span><span class="tok-o">,</span><span class="tok-n">SYD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-mi">8434</span><span class="tok-o">,</span><span class="tok-n">JNB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-mi">8433</span><span class="tok-o">,</span><span class="tok-n">SIN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8372</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8321</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JED</span><span class="tok-o">,</span><span class="tok-mi">8314</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-mi">8287</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8246</span><span class="tok-o">,</span><span class="tok-n">RUH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8150</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8139</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8105</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8085</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-mi">8054</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8053</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-mi">8047</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-mi">8030</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8022</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>TinkerPop 3.2.3 added additional capability to the <em>where</em> step that allows it to be
followed by a <em>by</em> modulator. This allows us, should we so desire, to simplify our query a
bit more as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//Query changed to take advantage of the where().by() construct</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">8000</span><span class="tok-o">)).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;f&#39;</span><span class="tok-o">)</span>
                             <span class="tok-o">.</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s1">&#39;f&#39;</span><span class="tok-o">,</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">)).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8818</span><span class="tok-o">,</span><span class="tok-n">AKL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SYD</span><span class="tok-o">,</span><span class="tok-mi">8574</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JNB</span><span class="tok-o">,</span><span class="tok-mi">8434</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SIN</span><span class="tok-o">,</span><span class="tok-mi">8433</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8372</span><span class="tok-o">,</span><span class="tok-n">AUH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8321</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8314</span><span class="tok-o">,</span><span class="tok-n">JED</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8287</span><span class="tok-o">,</span><span class="tok-n">DOH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">RUH</span><span class="tok-o">,</span><span class="tok-mi">8246</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-mi">8150</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-mi">8139</span><span class="tok-o">,</span><span class="tok-n">AUH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-mi">8105</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-mi">8085</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-mi">8054</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8053</span><span class="tok-o">,</span><span class="tok-n">AUH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-mi">8047</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-mi">8030</span><span class="tok-o">,</span><span class="tok-n">DOH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8022</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As an interesting sidenote, and this would be true for the queries above as well, if we
replace the <em>lt</em> with a <em>gt</em> we will get the routes returned in the reverse order. So for
example, in the prior query the first result was <em>[DXB,8818,AKL]</em>. As you will see below, our
first result is now <em>[AKL,8818,DXB]</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">8000</span><span class="tok-o">)).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;f&#39;</span><span class="tok-o">)</span> <span class="tok-err">\</span>
                    <span class="tok-o">.</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s1">&#39;f&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-s1">&#39;s&#39;</span><span class="tok-o">)).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">AKL</span><span class="tok-o">,</span><span class="tok-mi">8818</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8574</span><span class="tok-o">,</span><span class="tok-n">SYD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-mi">8434</span><span class="tok-o">,</span><span class="tok-n">JNB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-mi">8433</span><span class="tok-o">,</span><span class="tok-n">SIN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8372</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8321</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JED</span><span class="tok-o">,</span><span class="tok-mi">8314</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-mi">8287</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8246</span><span class="tok-o">,</span><span class="tok-n">RUH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8150</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8139</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8105</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8085</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-mi">8054</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8053</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-mi">8047</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-mi">8030</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8022</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_combining_em_aggregate_em_em_union_em_and_em_filter_em_to_compute_distances">5.3.2. Combining <em>aggregate</em>, <em>union</em> and <em>filter</em> to compute distances.</h4>
<div class="paragraph">
<p>This next query is similar to the one we looked <a href="#aggr1">above</a> at in the
"<a href="#wherefly">Where can I fly to from here?</a>" section.  It uses <em>aggregate</em>, <em>union</em>, <em>filter</em> and
<em>where</em> being used together to factor certain airports in and out of a query.
We find all airports in London, Munich and Paris and then count the total
distance of all routes from those airports as the first half of a <em>union</em>. The
second half of the <em>union</em> only counts the distances of routes that end up in
one of our three selected cities.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Munich&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Paris&#39;</span><span class="tok-o">)).</span><span class="tok-na">aggregate</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)</span>
     <span class="tok-o">.</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">union</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">sum</span><span class="tok-o">(),</span>
                   <span class="tok-n">filter</span><span class="tok-o">(</span><span class="tok-n">inV</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">((</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">sum</span><span class="tok-o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the results from running the query. As expected the first number is a
lot biger than the second one as it is the total distance of all routes from
the selected airports whereas the second number only reflects the total
distance of all routes between those airports.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-mi">2168462</span>
<span class="tok-mi">8950</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_more_queries_that_analyze_distances">5.3.3. More queries that analyze distances</h4>
<div class="paragraph">
<p>Here are some more queries that are based on the distance between airports.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Routes Between 100 and 200 miles in length</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;src&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">..</span><span class="tok-mi">200</span><span class="tok-o">)).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;dest&#39;</span><span class="tok-o">)</span>
     <span class="tok-o">.</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;src&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;dest&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Routes Between 100 and 200 miles in length, but only within the US.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;src&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">..</span><span class="tok-mi">200</span><span class="tok-o">)).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">)</span><span class="tok-err">\</span>
     <span class="tok-o">.</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;dest&#39;</span><span class="tok-o">)</span><span class="tok-err">\</span>
     <span class="tok-o">.</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;src&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;dest&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Return a list of routes and their distances, starting from San Antonio (SAT)</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SAT&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;src&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;dest&#39;</span><span class="tok-o">)</span>
     <span class="tok-o">.</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;src&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;dest&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Calculating the distance between two directly connected airports is very easy. All we
have to do is look at the <em>dist</em> property of the edge that connects them. We could do
this using the <em>select</em> technique or in more recent versions of TinkerPop we could
use <em>path</em> and <em>by</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Distance between the AUS and MEX airports</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;MEX&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-mi">748</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;MEX&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-mi">748</span><span class="tok-o">,</span> <span class="tok-n">MEX</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="AUSLHR-OS">5.3.4. How far is it from AUS to LHR with one stop?</h4>
<div class="paragraph">
<p>The next query begins to address the question "How far is it from AUS to LHR with one
stop?". We can quite easily come up with a query given what we now know about Gremlin
that will show us all possible options with one stop between AUS and LHR along with
the respective route distances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Return all ways of getting from AUS to LHR with one stop. Include the distances between</span>
<span class="tok-c1">// each of the airports in the query result.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output from running the query produces a nice set of data showing the starting,
intermediate and destination airports with the distances in miles between each.  It
would be nice though if we could find a way to show the total distance that I will
have to travel in each case. That is the topic of the next section!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1476</span><span class="tok-o">,</span><span class="tok-n">SJC</span><span class="tok-o">,</span><span class="tok-mi">5352</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">183</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">4736</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1500</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-mi">5350</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1339</span><span class="tok-o">,</span><span class="tok-n">BWI</span><span class="tok-o">,</span><span class="tok-mi">3622</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1768</span><span class="tok-o">,</span><span class="tok-n">SEA</span><span class="tok-o">,</span><span class="tok-mi">4783</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1500</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-mi">3453</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">866</span><span class="tok-o">,</span><span class="tok-n">PHX</span><span class="tok-o">,</span><span class="tok-mi">5255</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>        <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1690</span><span class="tok-o">,</span><span class="tok-n">BOS</span><span class="tok-o">,</span><span class="tok-mi">3254</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">973</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">,</span><span class="tok-mi">3939</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>        <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">768</span><span class="tok-o">,</span><span class="tok-n">DEN</span><span class="tok-o">,</span><span class="tok-mi">4655</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1040</span><span class="tok-o">,</span><span class="tok-n">MSP</span><span class="tok-o">,</span><span class="tok-mi">4001</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1080</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">,</span><span class="tok-mi">5213</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1230</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">5439</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">809</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-mi">4198</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1520</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-mi">3440</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1160</span><span class="tok-o">,</span><span class="tok-n">SAN</span><span class="tok-o">,</span><span class="tok-mi">5469</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1140</span><span class="tok-o">,</span><span class="tok-n">DTW</span><span class="tok-o">,</span><span class="tok-mi">3753</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1357</span><span class="tok-o">,</span><span class="tok-n">YYZ</span><span class="tok-o">,</span><span class="tok-mi">3544</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">142</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-mi">4820</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>        <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">5294</span><span class="tok-o">,</span><span class="tok-n">FRA</span><span class="tok-o">,</span><span class="tok-mi">406</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1430</span><span class="tok-o">,</span><span class="tok-n">PHL</span><span class="tok-o">,</span><span class="tok-mi">3533</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">748</span><span class="tok-o">,</span><span class="tok-n">MEX</span><span class="tok-o">,</span><span class="tok-mi">5529</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1294</span><span class="tok-o">,</span><span class="tok-n">IAD</span><span class="tok-o">,</span><span class="tok-mi">3665</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span>       <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1030</span><span class="tok-o">,</span><span class="tok-n">CLT</span><span class="tok-o">,</span><span class="tok-mi">3980</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_em_sack_em_to_calculate_the_shortest_aus_lhr_route_with_one_stop">5.3.5. Using <em>sack</em> to calculate the shortest AUS-LHR route with one stop</h4>
<div class="paragraph">
<p>Consider a typical use case for air travel. We want to calculate the shortest
distance we will have to travel to go from one airport to another with only one stop.
Let&#8217;s take a real example. What are the ten shortest distances from AUS to LHR with
one stop on the way.  Given what we know of Gremlin so far we can pretty easily come
up with a query that will give us routes from AUS to LHR with just one stop like we
did in the previous section.  However, what is not so obvious, and this is an area
where the TinkerPop documentation is weak, is working out how to keep a running total
of values as we traverse a graph. This is where the <em>sack</em> step comes in. It allows
us to define a place where we can put things as the graph traversal proceeds. You
give the sack an in initial value and can add to it during the traversal and then use
it as part of the information that your query will return. Take a look at the
following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Shortest distances from AUS to LHR with one stop</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">withSack</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">).</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span>
                  <span class="tok-n">outE</span><span class="tok-o">().</span><span class="tok-na">sack</span><span class="tok-o">(</span><span class="tok-n">sum</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span>
                  <span class="tok-n">inV</span><span class="tok-o">().</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">sack</span><span class="tok-o">(</span><span class="tok-n">sum</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span>
                  <span class="tok-n">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">sack</span><span class="tok-o">().</span>
                  <span class="tok-n">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">incr</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span>
                  <span class="tok-n">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the first line of the query, we initialize our sack with the value zero. During
the query, each time we take an outgoing edge, we add the distance value for that
edge to the sack. We filter out routes in the normal way on line 2 by only keeping
destinations that are <em>LHR</em>. On line 3 we take the values that are stored in our sack
and sort them in ascending order. Finally on  line 4 we process the paths that we
have taken. Note that the sack value is included as part of the path. Running the
query will produce the following results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-mi">1140</span><span class="tok-o">,</span> <span class="tok-n">DTW</span><span class="tok-o">,</span> <span class="tok-mi">3753</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4893</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-mi">1357</span><span class="tok-o">,</span> <span class="tok-n">YYZ</span><span class="tok-o">,</span> <span class="tok-mi">3544</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4901</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-mi">973</span><span class="tok-o">,</span> <span class="tok-n">ORD</span><span class="tok-o">,</span> <span class="tok-mi">3939</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4912</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-mi">183</span><span class="tok-o">,</span> <span class="tok-n">DFW</span><span class="tok-o">,</span> <span class="tok-mi">4736</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4919</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-mi">1690</span><span class="tok-o">,</span> <span class="tok-n">BOS</span><span class="tok-o">,</span> <span class="tok-mi">3254</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4944</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-mi">1500</span><span class="tok-o">,</span> <span class="tok-n">EWR</span><span class="tok-o">,</span> <span class="tok-mi">3453</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4953</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-mi">1294</span><span class="tok-o">,</span> <span class="tok-n">IAD</span><span class="tok-o">,</span> <span class="tok-mi">3665</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4959</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-mi">1520</span><span class="tok-o">,</span> <span class="tok-n">JFK</span><span class="tok-o">,</span> <span class="tok-mi">3440</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4960</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-mi">1339</span><span class="tok-o">,</span> <span class="tok-n">BWI</span><span class="tok-o">,</span> <span class="tok-mi">3622</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4961</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-mi">142</span><span class="tok-o">,</span> <span class="tok-n">IAH</span><span class="tok-o">,</span> <span class="tok-mi">4820</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4962</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In Tinkerpop 3.3 the syntax of <em>sack</em> was changed. Where previously you would
write something like <em>sack(sum,</em>'runways'<em>)</em> you are now required to write
<em>sack(sum).by(</em>'runways'<em>)</em>. The prior format was already deprecated in Tinkerpop
3.2.5 but is now fully removed in Tinkerpop 3.3.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We could add a little post processing to our query to only output the airport codes
and the total mileage. Given this is post processing of a small data set, using a bit
of in-line code does not feel too ugly here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">withSack</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">).</span><span class="tok-na">V</span><span class="tok-o">().</span>
  <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">outE</span><span class="tok-o">().</span><span class="tok-na">sack</span><span class="tok-o">(</span><span class="tok-n">sum</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">inV</span><span class="tok-o">().</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">sack</span><span class="tok-o">(</span><span class="tok-n">sum</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">inV</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">sack</span><span class="tok-o">().</span>
  <span class="tok-n">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">incr</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span>
  <span class="tok-n">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">().</span>
  <span class="tok-n">toList</span><span class="tok-o">().</span><span class="tok-na">each</span><span class="tok-o">(){</span><span class="tok-n">println</span> <span class="tok-s2">&quot;${it[0]} --&gt; ${it[2]} --&gt; ${it[4]} ${it[5]} miles&quot;</span><span class="tok-o">}[];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what our modified query produces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">AUS</span> <span class="tok-o">--&gt;</span> <span class="tok-n">DTW</span> <span class="tok-o">--&gt;</span> <span class="tok-n">LHR</span> <span class="tok-mi">4893</span> <span class="tok-n">miles</span>
<span class="tok-n">AUS</span> <span class="tok-o">--&gt;</span> <span class="tok-n">YYZ</span> <span class="tok-o">--&gt;</span> <span class="tok-n">LHR</span> <span class="tok-mi">4901</span> <span class="tok-n">miles</span>
<span class="tok-n">AUS</span> <span class="tok-o">--&gt;</span> <span class="tok-n">ORD</span> <span class="tok-o">--&gt;</span> <span class="tok-n">LHR</span> <span class="tok-mi">4912</span> <span class="tok-n">miles</span>
<span class="tok-n">AUS</span> <span class="tok-o">--&gt;</span> <span class="tok-n">DFW</span> <span class="tok-o">--&gt;</span> <span class="tok-n">LHR</span> <span class="tok-mi">4919</span> <span class="tok-n">miles</span>
<span class="tok-n">AUS</span> <span class="tok-o">--&gt;</span> <span class="tok-n">BOS</span> <span class="tok-o">--&gt;</span> <span class="tok-n">LHR</span> <span class="tok-mi">4944</span> <span class="tok-n">miles</span>
<span class="tok-n">AUS</span> <span class="tok-o">--&gt;</span> <span class="tok-n">EWR</span> <span class="tok-o">--&gt;</span> <span class="tok-n">LHR</span> <span class="tok-mi">4953</span> <span class="tok-n">miles</span>
<span class="tok-n">AUS</span> <span class="tok-o">--&gt;</span> <span class="tok-n">IAD</span> <span class="tok-o">--&gt;</span> <span class="tok-n">LHR</span> <span class="tok-mi">4959</span> <span class="tok-n">miles</span>
<span class="tok-n">AUS</span> <span class="tok-o">--&gt;</span> <span class="tok-n">JFK</span> <span class="tok-o">--&gt;</span> <span class="tok-n">LHR</span> <span class="tok-mi">4960</span> <span class="tok-n">miles</span>
<span class="tok-n">AUS</span> <span class="tok-o">--&gt;</span> <span class="tok-n">BWI</span> <span class="tok-o">--&gt;</span> <span class="tok-n">LHR</span> <span class="tok-mi">4961</span> <span class="tok-n">miles</span>
<span class="tok-n">AUS</span> <span class="tok-o">--&gt;</span> <span class="tok-n">IAH</span> <span class="tok-o">--&gt;</span> <span class="tok-n">LHR</span> <span class="tok-mi">4962</span> <span class="tok-n">miles</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_another_example_of_how_em_sack_em_can_be_used">5.3.6. Another example of how <em>sack</em> can be used</h4>
<div class="paragraph">
<p>The query below finds all airports with more than 200 routes and returns them as a
map of airport code and route count pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Print a table of airports with more than 200 routes and the number of routes</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">))).</span>
                          <span class="tok-n">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">outE</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span>

<span class="tok-o">[</span><span class="tok-nl">ORD:</span><span class="tok-mi">226</span><span class="tok-o">,</span> <span class="tok-nl">DFW:</span><span class="tok-mi">216</span><span class="tok-o">,</span> <span class="tok-nl">FRA:</span><span class="tok-mi">254</span><span class="tok-o">,</span> <span class="tok-nl">CDG:</span><span class="tok-mi">253</span><span class="tok-o">,</span> <span class="tok-nl">PEK:</span><span class="tok-mi">232</span><span class="tok-o">,</span> <span class="tok-nl">AMS:</span><span class="tok-mi">257</span><span class="tok-o">,</span> <span class="tok-nl">ATL:</span><span class="tok-mi">232</span><span class="tok-o">,</span> <span class="tok-nl">MUC:</span><span class="tok-mi">219</span><span class="tok-o">,</span> <span class="tok-nl">IST:</span><span class="tok-mi">259</span><span class="tok-o">,</span> <span class="tok-nl">DME:</span><span class="tok-mi">206</span><span class="tok-o">,</span> <span class="tok-nl">DXB:</span><span class="tok-mi">225</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The prevous query is a perfectly good way to achieve the desired result. Just for fun
let&#8217;s produce the same results using a <em>sack</em>. This is intended just as an example of
how <em>sack</em> works and is not the way you would actually want to perform this specific
query. That said, it is useful to have an example where the contents of the
sack is more complex than a simple integer value. At the start of the query we
initialize our sack with an empty map <em>[:]</em>. Later in the query, for each airport
that has more than 200 outgoing routes, we update the map by adding the airport code
and the route count to the map. Note that the value part of each map entry is
produced using a traversal. So while this query is overkill for the task (as
demonstrated by the much simpler query above) it does show how you can use sacks in
powerful ways to store data as your query iterates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// The same query but done using the new sack() step in TinkerPop 3</span>
<span class="tok-c1">// shown as an example only. The prior query works just fine for this.</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">withSack</span><span class="tok-o">([:]).</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">))).</span>
                <span class="tok-n">sack</span><span class="tok-o">{</span><span class="tok-n">m</span><span class="tok-o">,</span><span class="tok-n">v</span> <span class="tok-o">-&gt;</span> <span class="tok-n">m</span><span class="tok-o">[</span><span class="tok-n">v</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)]=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">v</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()}.</span>
                <span class="tok-n">fold</span><span class="tok-o">().</span><span class="tok-na">sack</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-nl">ATL:</span><span class="tok-mi">232</span><span class="tok-o">,</span> <span class="tok-nl">DFW:</span><span class="tok-mi">216</span><span class="tok-o">,</span> <span class="tok-nl">ORD:</span><span class="tok-mi">226</span><span class="tok-o">,</span> <span class="tok-nl">CDG:</span><span class="tok-mi">253</span><span class="tok-o">,</span> <span class="tok-nl">FRA:</span><span class="tok-mi">254</span><span class="tok-o">,</span> <span class="tok-nl">DXB:</span><span class="tok-mi">225</span><span class="tok-o">,</span> <span class="tok-nl">PEK:</span><span class="tok-mi">232</span><span class="tok-o">,</span> <span class="tok-nl">AMS:</span><span class="tok-mi">257</span><span class="tok-o">,</span> <span class="tok-nl">MUC:</span><span class="tok-mi">219</span><span class="tok-o">,</span> <span class="tok-nl">DME:</span><span class="tok-mi">206</span><span class="tok-o">,</span> <span class="tok-nl">IST:</span><span class="tok-mi">259</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>fold</em> step is needed in the query above to make sure that the result we get back
is returned as a map. If we left the <em>fold</em> off we would just get the values stored
in the sack returned as a list of integers. Note that while the list of airports is
the same as the previous query, the order is different. This is a result of the way
the <em>group</em> step did its work in the previous query. Order should never be relied
upon.  If you need a specific order for the results of a query it is always
recommended to perform an explicit <em>order</em> step as appropriate.</p>
</div>
<div class="paragraph">
<p>For completeness, a way of sorting the results of our original query by ascending
route count (values) is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">))).</span>
                          <span class="tok-n">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">outE</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()).</span>
                          <span class="tok-n">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">DME:</span><span class="tok-mi">213</span><span class="tok-o">,</span><span class="tok-nl">DFW:</span><span class="tok-mi">221</span><span class="tok-o">,</span><span class="tok-nl">DXB:</span><span class="tok-mi">229</span><span class="tok-o">,</span><span class="tok-nl">ORD:</span><span class="tok-mi">232</span><span class="tok-o">,</span><span class="tok-nl">PEK:</span><span class="tok-mi">232</span><span class="tok-o">,</span><span class="tok-nl">ATL:</span><span class="tok-mi">232</span><span class="tok-o">,</span><span class="tok-nl">MUC:</span><span class="tok-mi">237</span><span class="tok-o">,</span><span class="tok-nl">CDG:</span><span class="tok-mi">260</span><span class="tok-o">,</span><span class="tok-nl">FRA:</span><span class="tok-mi">266</span><span class="tok-o">,</span><span class="tok-nl">AMS:</span><span class="tok-mi">269</span><span class="tok-o">,</span><span class="tok-nl">IST:</span><span class="tok-mi">270</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wanted to sort using the airport codes you could do it as follows. This time
we will sort the results of the <em>sack</em> based query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">withSack</span><span class="tok-o">([:]).</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">))).</span>
                <span class="tok-n">sack</span><span class="tok-o">{</span><span class="tok-n">m</span><span class="tok-o">,</span><span class="tok-n">v</span> <span class="tok-o">-&gt;</span> <span class="tok-n">m</span><span class="tok-o">[</span><span class="tok-n">v</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)]=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">v</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()}.</span>
                <span class="tok-n">fold</span><span class="tok-o">().</span><span class="tok-na">sack</span><span class="tok-o">().</span><span class="tok-na">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">keys</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">AMS:</span><span class="tok-mi">269</span><span class="tok-o">,</span><span class="tok-nl">ATL:</span><span class="tok-mi">232</span><span class="tok-o">,</span><span class="tok-nl">CDG:</span><span class="tok-mi">260</span><span class="tok-o">,</span><span class="tok-nl">DFW:</span><span class="tok-mi">221</span><span class="tok-o">,</span><span class="tok-nl">DME:</span><span class="tok-mi">213</span><span class="tok-o">,</span><span class="tok-nl">DXB:</span><span class="tok-mi">229</span><span class="tok-o">,</span><span class="tok-nl">FRA:</span><span class="tok-mi">266</span><span class="tok-o">,</span><span class="tok-nl">IST:</span><span class="tok-mi">270</span><span class="tok-o">,</span><span class="tok-nl">MUC:</span><span class="tok-mi">237</span><span class="tok-o">,</span><span class="tok-nl">ORD:</span><span class="tok-mi">232</span><span class="tok-o">,</span><span class="tok-nl">PEK:</span><span class="tok-mi">232</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As well as using <em>withSack</em> to initialize a <em>sack</em> you can also use the <em>assign</em>
operator to do it. The query below uses a constant value of 0 to initialize the sack
and then uses the sack to count the number or runways that the airports you can fly
to from Austin have. At the end of the query we perform a <em>sum</em> step against the sack
which will contain a list holding number of runways for each individual airport so we
need to add all of those to get a single grand total.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">sack</span><span class="tok-o">(</span><span class="tok-n">assign</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)).</span>
      <span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">sack</span><span class="tok-o">(</span><span class="tok-n">sum</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">sack</span><span class="tok-o">().</span><span class="tok-na">sum</span><span class="tok-o">()</span>

<span class="tok-mi">212</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_latitude_longitude_and_geographical_region_in_queries">5.3.7. Using latitude, longitude and geographical region in queries</h4>
<div class="paragraph">
<p>The air-routes graph stores the geographic coordinates (latitude and longitude) of
each airport as floating point numbers.  Some graph systems such as Janus Graph have
some useful geographic coordinate and shape support built in but TinkerGraph does
not. Moreover, GraphML does not offer any specific geospatial support so to keeps
things simple and flexible, the air routes data set does not assume any specific back
end capabilities. This said, even having coordinates provided as basic floating point
numbers offers us a chance to do some interesting geospatial queries. So far in this
document we have not made us of the latitude and longitude coordinates that are
stored for each airport so in this section we will experiment a bit with some
queries that do. This first query just returns the coordinates for London Heathrow.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Query latitude and longitude for LHR</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">0.461941003799</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.4706001282</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query returns the code, latitude and longitude for all airports in London,
England. Note that because there are other cities in the world also called London,
such as London, Ontario in Canada, we have to take advantage of the region code
<em>GB-ENG</em> to only return airports in London, England.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;London&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;GB-ENG&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">)</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">0.461941003799</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.4706001282</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">0.190277993679047</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.1481018066406</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LCY</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-mf">0.055278</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.505278</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">STN</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-mf">0.234999999404</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.8849983215</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LTN</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">0.368333011865616</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.874698638916</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we know how to query the geographic coordinates, we can write a query to
find out which airports in the graph are very close to the Greenwich Meridian. In
this case we will look for any airports that have a longitude between -0.1 and 0.1</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Which airports are very close to the Greenwich Meridian ?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">,</span><span class="tok-n">between</span><span class="tok-o">(-</span><span class="tok-mf">0.1</span><span class="tok-o">,</span><span class="tok-mf">0.1</span><span class="tok-o">)).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">)</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LCY</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-mf">0.055278</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LDE</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">0.006438999902457</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LEH</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-mf">0.0880559980869293</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">CDT</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-mf">0.0261109992862</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query can be used to find out which airports are closest to the equator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Which airports are closest to the Equator ?</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">,</span><span class="tok-n">between</span><span class="tok-o">(-</span><span class="tok-mf">0.1</span><span class="tok-o">,</span><span class="tok-mf">0.1</span><span class="tok-o">)).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">)</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">EBB</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">0.0423859991133213</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">MDK</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">0.0226000007242</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">KIS</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[-</span><span class="tok-mf">0.0861390009522438</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">MCP</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">0.0506640002131</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LGQ</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">0.0930560007691</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code below will find all the airports in the geographic area defined by a one
degree box around London Heathrow. This type of thing can be done using the Geo shape
classes provided by Janus Graph but given we are not at that part of the document yet
this is the next best way!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">lat</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>
<span class="tok-n">lon</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">and</span><span class="tok-o">(</span>
                          <span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-n">lon</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-n">lon</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-o">)),</span>
                          <span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-n">lat</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-n">lat</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-o">)))).</span>
                          <span class="tok-n">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we have discussed earlier in this document, it is often possible to avoid use of
<em>and</em> step by chaining <em>has</em> steps together. The code below is equivalent to the code
above but avoids the use of <em>where</em> and <em>and</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">lat</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>
<span class="tok-n">lon</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">,</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-n">lon</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-n">lon</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-o">)).</span>
                          <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">,</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-n">lat</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-n">lat</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-o">)).</span>
                          <span class="tok-n">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output produced by running either of the snippets of code above inside
the Gremlin Console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">0.461941003799</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.4706001282</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">0.190277993679047</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.1481018066406</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LCY</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-mf">0.055278</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.505278</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">STN</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-mf">0.234999999404</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.8849983215</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LTN</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">0.368333011865616</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.874698638916</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">SOU</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">1.35679996013641</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">50.9502983093262</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the "<a href="#tranges">Testing values and ranges of values</a>" section we came up with a query (shown below) to find routes
with one stop between Austin and Las Vegas, using only airports in the United States
or Canada and avoiding PHX and LAX for plane changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;CA&#39;</span><span class="tok-o">)).</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">without</span><span class="tok-o">(</span><span class="tok-s1">&#39;PHX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAS&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we know how to use the longitude and latitude coordinates stored in the air
routes graph, we could for fun, write this query a different way. If you take a look
at the query below you will see we have added a <em>where</em> step. We still check that we
are only looking at airports in the United States or Canada but then, in the <em>where</em>
step, we further limit the airports we want to consider further by saying we are only
interested if their longitude value is less than that of Austin. In other words, we
only want to change planes at an airport that is to the West of Austin. This is
actually an improvement on the previous query that would have returned routes that
included plane changes in New York and Nashville among other places.  With our new
query, no airport that is East of Austin will be considered as a place to change
planes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// AUS to LAS with one stop but the stop has to be in the US or Canada</span>
<span class="tok-c1">// and West of Austin while avoiding PHX and LAX.</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;CA&#39;</span><span class="tok-o">)).</span>
      <span class="tok-n">where</span><span class="tok-o">(</span><span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">)).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">without</span><span class="tok-o">(</span><span class="tok-s1">&#39;PHX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAS&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Below you will find the output from running the query. If you know your airport codes
you will see that all of these airports are indeed to the West of Austin. We might
want to improve the query even more however, to factor in sensible nearby airports
that are not to the West of Austin. For example, Dallas Fort Worth (DFW) is not
included in the results as it is situated North of Austin but also a little to the
East. We will leave it as an exercise to come up with a refinement to the query so
that Dallas is also included!.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">PDX</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">ABQ</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">LBB</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">SEA</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">SJC</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">SAN</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">LGB</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">SNA</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">SLC</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">DEN</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">ELP</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">OAK</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We will revisit the topic of performing geospatial queries in the "<a href="#janusgeo">The Janus Graph geospatial API</a>"
section where we look at some additional capabilities that Janus Graph offers to us
in this area.</p>
</div>
<div class="paragraph">
<p>To finish up examples of how the geospatial and region information stored in the
graph can be used to generate interesting results, let&#8217;s look at one last query that
uses the <em>region</em> property that is present on all of the airport nodes in the graph.</p>
</div>
<div class="paragraph">
<p>The query below finds the DFW airport then looks at all routes from there to airports
within the United States. Next we group those airports by their region code and
airport code. Finally we select just a few states and unfold the results to make them
a bit more readable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">group</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;US-CA&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-FL&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-CO&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-IL&#39;</span><span class="tok-o">).</span><span class="tok-na">unfold</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Below you can see the results from running the query. Each of the states we selected
is listed along with an array of airport codes in those states that you can fly to
fro DFW.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">CA</span><span class="tok-o">=[</span><span class="tok-n">LAX</span><span class="tok-o">,</span> <span class="tok-n">SFO</span><span class="tok-o">,</span> <span class="tok-n">SJC</span><span class="tok-o">,</span> <span class="tok-n">SAN</span><span class="tok-o">,</span> <span class="tok-n">SNA</span><span class="tok-o">,</span> <span class="tok-n">OAK</span><span class="tok-o">,</span> <span class="tok-n">ONT</span><span class="tok-o">,</span> <span class="tok-n">PSP</span><span class="tok-o">,</span> <span class="tok-n">SMF</span><span class="tok-o">,</span> <span class="tok-n">FAT</span><span class="tok-o">,</span> <span class="tok-n">SBA</span><span class="tok-o">]</span>
<span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">=[</span><span class="tok-n">AUS</span><span class="tok-o">,</span> <span class="tok-n">IAH</span><span class="tok-o">,</span> <span class="tok-n">SAT</span><span class="tok-o">,</span> <span class="tok-n">HOU</span><span class="tok-o">,</span> <span class="tok-n">ELP</span><span class="tok-o">,</span> <span class="tok-n">LBB</span><span class="tok-o">,</span> <span class="tok-n">MAF</span><span class="tok-o">,</span> <span class="tok-n">CRP</span><span class="tok-o">,</span> <span class="tok-n">ABI</span><span class="tok-o">,</span> <span class="tok-n">ACT</span><span class="tok-o">,</span> <span class="tok-n">CLL</span><span class="tok-o">,</span>
       <span class="tok-n">BPT</span><span class="tok-o">,</span> <span class="tok-n">AMA</span><span class="tok-o">,</span> <span class="tok-n">BRO</span><span class="tok-o">,</span> <span class="tok-n">GGG</span><span class="tok-o">,</span> <span class="tok-n">GRK</span><span class="tok-o">,</span> <span class="tok-n">LRD</span><span class="tok-o">,</span> <span class="tok-n">MFE</span><span class="tok-o">,</span> <span class="tok-n">SJT</span><span class="tok-o">,</span> <span class="tok-n">SPS</span><span class="tok-o">,</span> <span class="tok-n">TYR</span><span class="tok-o">]</span>
<span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">FL</span><span class="tok-o">=[</span><span class="tok-n">FLL</span><span class="tok-o">,</span> <span class="tok-n">MCO</span><span class="tok-o">,</span> <span class="tok-n">MIA</span><span class="tok-o">,</span> <span class="tok-n">PBI</span><span class="tok-o">,</span> <span class="tok-n">TPA</span><span class="tok-o">,</span> <span class="tok-n">RSW</span><span class="tok-o">,</span> <span class="tok-n">TLH</span><span class="tok-o">,</span> <span class="tok-n">JAX</span><span class="tok-o">,</span> <span class="tok-n">PNS</span><span class="tok-o">,</span> <span class="tok-n">VPS</span><span class="tok-o">]</span>
<span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">CO</span><span class="tok-o">=[</span><span class="tok-n">DEN</span><span class="tok-o">,</span> <span class="tok-n">COS</span><span class="tok-o">,</span> <span class="tok-n">DRO</span><span class="tok-o">,</span> <span class="tok-n">GJT</span><span class="tok-o">,</span> <span class="tok-n">EGE</span><span class="tok-o">,</span> <span class="tok-n">HDN</span><span class="tok-o">,</span> <span class="tok-n">ASE</span><span class="tok-o">,</span> <span class="tok-n">GUC</span><span class="tok-o">,</span> <span class="tok-n">MTJ</span><span class="tok-o">]</span>
<span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">IL</span><span class="tok-o">=[</span><span class="tok-n">ORD</span><span class="tok-o">,</span> <span class="tok-n">PIA</span><span class="tok-o">,</span> <span class="tok-n">BMI</span><span class="tok-o">,</span> <span class="tok-n">CMI</span><span class="tok-o">,</span> <span class="tok-n">MLI</span><span class="tok-o">,</span> <span class="tok-n">SPI</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_em_store_em_and_a_em_sideeffect_em_to_make_a_set_of_unique_values">5.4. Using <em>store</em> and a <em>sideEffect</em> to make a set of unique values</h3>
<div class="paragraph">
<p>Take a look at the query below. All it does is return the city names for the airports
that have IDs between 1 and 200 (inclusive). The list is sorted by ascending aplhabetic
order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">201</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">fold</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And here are the names that get returned. If you look closely at the list you
will see that city names like <em>Dallas</em> and <em>London</em> appear more than once.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">Abu</span> <span class="tok-n">Dhabi</span><span class="tok-o">,</span> <span class="tok-n">Addis</span> <span class="tok-n">Ababa</span><span class="tok-o">,</span> <span class="tok-n">Albuquerque</span><span class="tok-o">,</span> <span class="tok-n">Alicante</span><span class="tok-o">,</span> <span class="tok-n">Alice</span> <span class="tok-n">Springs</span><span class="tok-o">,</span> <span class="tok-n">Amsterdam</span><span class="tok-o">,</span> <span class="tok-n">Anchorage</span><span class="tok-o">,</span> <span class="tok-n">Athens</span><span class="tok-o">,</span> <span class="tok-n">Atlanta</span><span class="tok-o">,</span> <span class="tok-n">Auckland</span><span class="tok-o">,</span> <span class="tok-n">Austin</span><span class="tok-o">,</span> <span class="tok-n">Ayers</span> <span class="tok-n">Rock</span><span class="tok-o">,</span> <span class="tok-n">Baltimore</span><span class="tok-o">,</span> <span class="tok-n">Bankok</span><span class="tok-o">,</span> <span class="tok-n">Barcelona</span><span class="tok-o">,</span> <span class="tok-n">Beijing</span><span class="tok-o">,</span> <span class="tok-n">Belgrade</span><span class="tok-o">,</span> <span class="tok-n">Bengaluru</span><span class="tok-o">,</span> <span class="tok-n">Berlin</span><span class="tok-o">,</span> <span class="tok-n">Bilbao</span><span class="tok-o">,</span> <span class="tok-n">Bologna</span><span class="tok-o">,</span> <span class="tok-n">Boston</span><span class="tok-o">,</span> <span class="tok-n">Brisbane</span><span class="tok-o">,</span> <span class="tok-n">Brussels</span><span class="tok-o">,</span> <span class="tok-n">Budapest</span><span class="tok-o">,</span> <span class="tok-n">Buenos</span> <span class="tok-n">Aires</span><span class="tok-o">,</span> <span class="tok-n">Cairns</span><span class="tok-o">,</span> <span class="tok-n">Cairo</span><span class="tok-o">,</span> <span class="tok-n">Calgary</span><span class="tok-o">,</span> <span class="tok-n">Calicut</span><span class="tok-o">,</span> <span class="tok-n">Canberra</span><span class="tok-o">,</span> <span class="tok-n">Cancun</span><span class="tok-o">,</span> <span class="tok-n">Cape</span> <span class="tok-n">Town</span><span class="tok-o">,</span> <span class="tok-n">Cedar</span> <span class="tok-n">Rapids</span><span class="tok-o">,</span> <span class="tok-n">Charlotte</span><span class="tok-o">,</span> <span class="tok-n">Chennai</span><span class="tok-o">,</span> <span class="tok-n">Chicago</span><span class="tok-o">,</span> <span class="tok-n">Chicago</span><span class="tok-o">,</span> <span class="tok-n">Christchurch</span><span class="tok-o">,</span> <span class="tok-n">Cincinnati</span><span class="tok-o">,</span> <span class="tok-n">Cleveland</span><span class="tok-o">,</span> <span class="tok-n">Cologne</span><span class="tok-o">,</span> <span class="tok-n">Copenhagen</span><span class="tok-o">,</span> <span class="tok-n">Dallas</span><span class="tok-o">,</span> <span class="tok-n">Dallas</span><span class="tok-o">,</span> <span class="tok-n">Denver</span><span class="tok-o">,</span> <span class="tok-n">Detroit</span><span class="tok-o">,</span> <span class="tok-n">Doha</span><span class="tok-o">,</span> <span class="tok-n">Dubai</span><span class="tok-o">,</span> <span class="tok-n">Dublin</span><span class="tok-o">,</span> <span class="tok-n">Durban</span><span class="tok-o">,</span> <span class="tok-n">Dusseldorf</span><span class="tok-o">,</span> <span class="tok-n">Edinburgh</span><span class="tok-o">,</span> <span class="tok-n">Edmonton</span><span class="tok-o">,</span> <span class="tok-n">El</span> <span class="tok-n">Paso</span><span class="tok-o">,</span> <span class="tok-n">Fairbanks</span><span class="tok-o">,</span> <span class="tok-n">Fort</span> <span class="tok-n">Lauderdale</span><span class="tok-o">,</span> <span class="tok-n">Fort</span> <span class="tok-n">Myers</span><span class="tok-o">,</span> <span class="tok-n">Frankfurt</span><span class="tok-o">,</span> <span class="tok-n">Geneva</span><span class="tok-o">,</span> <span class="tok-n">Genoa</span><span class="tok-o">,</span> <span class="tok-n">Glasgow</span><span class="tok-o">,</span> <span class="tok-n">Gold</span> <span class="tok-n">Coast</span><span class="tok-o">,</span> <span class="tok-n">Gothenburg</span><span class="tok-o">,</span> <span class="tok-n">Hagta</span><span class="tok-o">,</span> <span class="tok-n">Halifax</span><span class="tok-o">,</span> <span class="tok-n">Hamburg</span><span class="tok-o">,</span> <span class="tok-n">Harrison</span><span class="tok-o">,</span> <span class="tok-n">Helsinki</span><span class="tok-o">,</span> <span class="tok-n">Ho</span> <span class="tok-n">Chi</span> <span class="tok-n">Minh</span> <span class="tok-n">City</span><span class="tok-o">,</span> <span class="tok-n">Hong</span> <span class="tok-n">Kong</span><span class="tok-o">,</span> <span class="tok-n">Honolulu</span><span class="tok-o">,</span> <span class="tok-n">Houston</span><span class="tok-o">,</span> <span class="tok-n">Houston</span><span class="tok-o">,</span> <span class="tok-n">Hyderabad</span><span class="tok-o">,</span> <span class="tok-n">Ibiza</span><span class="tok-o">,</span> <span class="tok-n">Indianapolis</span><span class="tok-o">,</span> <span class="tok-n">Istanbul</span><span class="tok-o">,</span> <span class="tok-n">Johannesburg</span><span class="tok-o">,</span> <span class="tok-n">Kahului</span><span class="tok-o">,</span> <span class="tok-n">Kansas</span> <span class="tok-n">City</span><span class="tok-o">,</span> <span class="tok-n">Kingston</span><span class="tok-o">,</span> <span class="tok-n">Kolkata</span><span class="tok-o">,</span> <span class="tok-n">Kuala</span> <span class="tok-n">Lumpur</span><span class="tok-o">,</span> <span class="tok-n">Kuwait</span><span class="tok-o">,</span> <span class="tok-n">Larnaca</span><span class="tok-o">,</span> <span class="tok-n">Las</span> <span class="tok-n">Vegas</span><span class="tok-o">,</span> <span class="tok-n">Lima</span><span class="tok-o">,</span> <span class="tok-n">Liverpool</span><span class="tok-o">,</span> <span class="tok-n">London</span><span class="tok-o">,</span> <span class="tok-n">London</span><span class="tok-o">,</span> <span class="tok-n">London</span><span class="tok-o">,</span> <span class="tok-n">London</span><span class="tok-o">,</span> <span class="tok-n">Long</span> <span class="tok-n">Beach</span><span class="tok-o">,</span> <span class="tok-n">Los</span> <span class="tok-n">Angeles</span><span class="tok-o">,</span> <span class="tok-n">Luqa</span><span class="tok-o">,</span> <span class="tok-n">Luxembourg</span><span class="tok-o">,</span> <span class="tok-n">Madrid</span><span class="tok-o">,</span> <span class="tok-n">Manama</span><span class="tok-o">,</span> <span class="tok-n">Manchester</span><span class="tok-o">,</span> <span class="tok-n">Manila</span><span class="tok-o">,</span> <span class="tok-n">Maroochydore</span><span class="tok-o">,</span> <span class="tok-n">Melbourne</span><span class="tok-o">,</span> <span class="tok-n">Memphis</span><span class="tok-o">,</span> <span class="tok-n">Menorca</span><span class="tok-o">,</span> <span class="tok-n">Mexico</span> <span class="tok-n">City</span><span class="tok-o">,</span> <span class="tok-n">Miami</span><span class="tok-o">,</span> <span class="tok-n">Milan</span><span class="tok-o">,</span> <span class="tok-n">Milwaukee</span><span class="tok-o">,</span> <span class="tok-n">Minneapolis</span><span class="tok-o">,</span> <span class="tok-n">Mombasa</span><span class="tok-o">,</span> <span class="tok-n">Montevideo</span><span class="tok-o">,</span> <span class="tok-n">Montreal</span><span class="tok-o">,</span> <span class="tok-n">Moscow</span><span class="tok-o">,</span> <span class="tok-n">Moscow</span><span class="tok-o">,</span> <span class="tok-n">Mumbai</span><span class="tok-o">,</span> <span class="tok-n">Munich</span><span class="tok-o">,</span> <span class="tok-n">Nairobi</span><span class="tok-o">,</span> <span class="tok-n">Nantes</span><span class="tok-o">,</span> <span class="tok-n">Naples</span><span class="tok-o">,</span> <span class="tok-n">Nashville</span><span class="tok-o">,</span> <span class="tok-n">New</span> <span class="tok-n">Delhi</span><span class="tok-o">,</span> <span class="tok-n">New</span> <span class="tok-n">Orleans</span><span class="tok-o">,</span> <span class="tok-n">New</span> <span class="tok-n">York</span><span class="tok-o">,</span> <span class="tok-n">New</span> <span class="tok-n">York</span><span class="tok-o">,</span> <span class="tok-n">Newark</span><span class="tok-o">,</span> <span class="tok-n">Nice</span><span class="tok-o">,</span> <span class="tok-n">Nottingham</span><span class="tok-o">,</span> <span class="tok-n">Oaklahoma</span> <span class="tok-n">City</span><span class="tok-o">,</span> <span class="tok-n">Oakland</span><span class="tok-o">,</span> <span class="tok-n">Omaha</span><span class="tok-o">,</span> <span class="tok-n">Ontario</span><span class="tok-o">,</span> <span class="tok-n">Orlando</span><span class="tok-o">,</span> <span class="tok-n">Osaka</span><span class="tok-o">,</span> <span class="tok-n">Oslo</span><span class="tok-o">,</span> <span class="tok-n">Ottawa</span><span class="tok-o">,</span> <span class="tok-n">Palm</span> <span class="tok-n">Springs</span><span class="tok-o">,</span> <span class="tok-n">Paris</span><span class="tok-o">,</span> <span class="tok-n">Paris</span><span class="tok-o">,</span> <span class="tok-n">Perth</span><span class="tok-o">,</span> <span class="tok-n">Philadelphia</span><span class="tok-o">,</span> <span class="tok-n">Phnom</span> <span class="tok-n">Penh</span><span class="tok-o">,</span> <span class="tok-n">Phoenix</span><span class="tok-o">,</span> <span class="tok-n">Pisa</span><span class="tok-o">,</span> <span class="tok-n">Pittsburgh</span><span class="tok-o">,</span> <span class="tok-n">Portland</span><span class="tok-o">,</span> <span class="tok-n">Portland</span><span class="tok-o">,</span> <span class="tok-n">Prague</span><span class="tok-o">,</span> <span class="tok-n">Puerto</span> <span class="tok-n">Vallarta</span><span class="tok-o">,</span> <span class="tok-n">Raleigh</span><span class="tok-o">,</span> <span class="tok-n">Rio</span> <span class="tok-n">de</span> <span class="tok-n">Janeiro</span><span class="tok-o">,</span> <span class="tok-n">Rochester</span><span class="tok-o">,</span> <span class="tok-n">Rochester</span><span class="tok-o">,</span> <span class="tok-n">Rome</span><span class="tok-o">,</span> <span class="tok-n">Salina</span><span class="tok-o">,</span> <span class="tok-n">Salt</span> <span class="tok-n">Lake</span> <span class="tok-n">City</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Antonio</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Diego</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Francisco</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Jose</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Juan</span><span class="tok-o">,</span> <span class="tok-n">Santa</span> <span class="tok-n">Ana</span><span class="tok-o">,</span> <span class="tok-n">Santa</span> <span class="tok-n">Fe</span><span class="tok-o">,</span> <span class="tok-n">Santiago</span><span class="tok-o">,</span> <span class="tok-n">Sao</span> <span class="tok-n">Paulo</span><span class="tok-o">,</span> <span class="tok-n">Seattle</span><span class="tok-o">,</span> <span class="tok-n">Seoul</span><span class="tok-o">,</span> <span class="tok-n">Shanghai</span><span class="tok-o">,</span> <span class="tok-n">Shannon</span><span class="tok-o">,</span> <span class="tok-n">Singapore</span><span class="tok-o">,</span> <span class="tok-n">Sofia</span><span class="tok-o">,</span> <span class="tok-n">St</span> <span class="tok-n">Louis</span><span class="tok-o">,</span> <span class="tok-n">St</span><span class="tok-o">.</span> <span class="tok-n">Johns</span><span class="tok-o">,</span> <span class="tok-n">Stockholm</span><span class="tok-o">,</span> <span class="tok-n">Stuttgart</span><span class="tok-o">,</span> <span class="tok-n">Sydney</span><span class="tok-o">,</span> <span class="tok-n">Tallahassee</span><span class="tok-o">,</span> <span class="tok-n">Tampa</span><span class="tok-o">,</span> <span class="tok-n">Tel</span> <span class="tok-n">Aviv</span><span class="tok-o">,</span> <span class="tok-n">Tenerife</span><span class="tok-o">,</span> <span class="tok-n">Tokyo</span><span class="tok-o">,</span> <span class="tok-n">Tokyo</span><span class="tok-o">,</span> <span class="tok-n">Toronto</span><span class="tok-o">,</span> <span class="tok-n">Tucson</span><span class="tok-o">,</span> <span class="tok-n">Tulsa</span><span class="tok-o">,</span> <span class="tok-n">Turin</span><span class="tok-o">,</span> <span class="tok-n">Vancouver</span><span class="tok-o">,</span> <span class="tok-n">Venice</span><span class="tok-o">,</span> <span class="tok-n">Venice</span><span class="tok-o">,</span> <span class="tok-n">Verona</span><span class="tok-o">,</span> <span class="tok-n">Vienna</span><span class="tok-o">,</span> <span class="tok-n">Warsaw</span><span class="tok-o">,</span> <span class="tok-n">Washington</span> <span class="tok-n">D</span><span class="tok-o">.</span><span class="tok-na">C</span><span class="tok-o">.,</span> <span class="tok-n">Washington</span> <span class="tok-n">D</span><span class="tok-o">.</span><span class="tok-na">C</span><span class="tok-o">.,</span> <span class="tok-n">Wellington</span><span class="tok-o">,</span> <span class="tok-n">West</span> <span class="tok-n">Palm</span> <span class="tok-n">Beach</span><span class="tok-o">,</span> <span class="tok-n">White</span> <span class="tok-n">Plains</span><span class="tok-o">,</span> <span class="tok-n">Winnipeg</span><span class="tok-o">,</span> <span class="tok-n">Zagreb</span><span class="tok-o">,</span> <span class="tok-n">Zurich</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just to be sure, we can count how many city names we got back.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">201</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">200</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What would be nice is if the duplicate names only appeared once. There are other ways
we could write this query such as using <em>dedup</em> but let&#8217;s rewrite it using <em>store</em>
and a <em>Set</em> as I think doing that demonstrates a capability quite well that is
useful in more complex scenarios than this one. By starting a query using
<em>withSideEffect</em> we can setup a named place we can <em>store</em> things into later in our
query and we can also give the store a type. In this case I chose to use a <em>Set</em>.
What this query does is store the City names of the first 200 nodes in the graph into
a Set and then displays them.  As we know from our first attempt, city names, like
Dallas, appear more than once.  However if we look at the Set that we get back from
our modified query (because by default Sets do not store duplicates) we will only see the
names Dallas and London appearing once.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">withSideEffect</span><span class="tok-o">(</span><span class="tok-s2">&quot;x&quot;</span><span class="tok-o">,</span> <span class="tok-o">[]</span> <span class="tok-k">as</span> <span class="tok-n">Set</span><span class="tok-o">).</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">201</span><span class="tok-o">)).</span>
  <span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span><span class="tok-na">cap</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span><span class="tok-na">unfold</span><span class="tok-o">().</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">fold</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the city names that we get back after running our modified query. You will notice
that all of the duplicate names are now gone.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">Abu</span> <span class="tok-n">Dhabi</span><span class="tok-o">,</span> <span class="tok-n">Addis</span> <span class="tok-n">Ababa</span><span class="tok-o">,</span> <span class="tok-n">Albuquerque</span><span class="tok-o">,</span> <span class="tok-n">Alicante</span><span class="tok-o">,</span> <span class="tok-n">Alice</span> <span class="tok-n">Springs</span><span class="tok-o">,</span> <span class="tok-n">Amsterdam</span><span class="tok-o">,</span> <span class="tok-n">Anchorage</span><span class="tok-o">,</span> <span class="tok-n">Athens</span><span class="tok-o">,</span> <span class="tok-n">Atlanta</span><span class="tok-o">,</span> <span class="tok-n">Auckland</span><span class="tok-o">,</span> <span class="tok-n">Austin</span><span class="tok-o">,</span> <span class="tok-n">Ayers</span> <span class="tok-n">Rock</span><span class="tok-o">,</span> <span class="tok-n">Baltimore</span><span class="tok-o">,</span> <span class="tok-n">Bankok</span><span class="tok-o">,</span> <span class="tok-n">Barcelona</span><span class="tok-o">,</span> <span class="tok-n">Beijing</span><span class="tok-o">,</span> <span class="tok-n">Belgrade</span><span class="tok-o">,</span> <span class="tok-n">Bengaluru</span><span class="tok-o">,</span> <span class="tok-n">Berlin</span><span class="tok-o">,</span> <span class="tok-n">Bilbao</span><span class="tok-o">,</span> <span class="tok-n">Bologna</span><span class="tok-o">,</span> <span class="tok-n">Boston</span><span class="tok-o">,</span> <span class="tok-n">Brisbane</span><span class="tok-o">,</span> <span class="tok-n">Brussels</span><span class="tok-o">,</span> <span class="tok-n">Budapest</span><span class="tok-o">,</span> <span class="tok-n">Buenos</span> <span class="tok-n">Aires</span><span class="tok-o">,</span> <span class="tok-n">Cairns</span><span class="tok-o">,</span> <span class="tok-n">Cairo</span><span class="tok-o">,</span> <span class="tok-n">Calgary</span><span class="tok-o">,</span> <span class="tok-n">Calicut</span><span class="tok-o">,</span> <span class="tok-n">Canberra</span><span class="tok-o">,</span> <span class="tok-n">Cancun</span><span class="tok-o">,</span> <span class="tok-n">Cape</span> <span class="tok-n">Town</span><span class="tok-o">,</span> <span class="tok-n">Cedar</span> <span class="tok-n">Rapids</span><span class="tok-o">,</span> <span class="tok-n">Charlotte</span><span class="tok-o">,</span> <span class="tok-n">Chennai</span><span class="tok-o">,</span> <span class="tok-n">Chicago</span><span class="tok-o">,</span> <span class="tok-n">Christchurch</span><span class="tok-o">,</span> <span class="tok-n">Cincinnati</span><span class="tok-o">,</span> <span class="tok-n">Cleveland</span><span class="tok-o">,</span> <span class="tok-n">Cologne</span><span class="tok-o">,</span> <span class="tok-n">Copenhagen</span><span class="tok-o">,</span> <span class="tok-n">Dallas</span><span class="tok-o">,</span> <span class="tok-n">Denver</span><span class="tok-o">,</span> <span class="tok-n">Detroit</span><span class="tok-o">,</span> <span class="tok-n">Doha</span><span class="tok-o">,</span> <span class="tok-n">Dubai</span><span class="tok-o">,</span> <span class="tok-n">Dublin</span><span class="tok-o">,</span> <span class="tok-n">Durban</span><span class="tok-o">,</span> <span class="tok-n">Dusseldorf</span><span class="tok-o">,</span> <span class="tok-n">Edinburgh</span><span class="tok-o">,</span> <span class="tok-n">Edmonton</span><span class="tok-o">,</span> <span class="tok-n">El</span> <span class="tok-n">Paso</span><span class="tok-o">,</span> <span class="tok-n">Fairbanks</span><span class="tok-o">,</span> <span class="tok-n">Fort</span> <span class="tok-n">Lauderdale</span><span class="tok-o">,</span> <span class="tok-n">Fort</span> <span class="tok-n">Myers</span><span class="tok-o">,</span> <span class="tok-n">Frankfurt</span><span class="tok-o">,</span> <span class="tok-n">Geneva</span><span class="tok-o">,</span> <span class="tok-n">Genoa</span><span class="tok-o">,</span> <span class="tok-n">Glasgow</span><span class="tok-o">,</span> <span class="tok-n">Gold</span> <span class="tok-n">Coast</span><span class="tok-o">,</span> <span class="tok-n">Gothenburg</span><span class="tok-o">,</span> <span class="tok-n">Hagta</span><span class="tok-o">,</span> <span class="tok-n">Halifax</span><span class="tok-o">,</span> <span class="tok-n">Hamburg</span><span class="tok-o">,</span> <span class="tok-n">Harrison</span><span class="tok-o">,</span> <span class="tok-n">Helsinki</span><span class="tok-o">,</span> <span class="tok-n">Ho</span> <span class="tok-n">Chi</span> <span class="tok-n">Minh</span> <span class="tok-n">City</span><span class="tok-o">,</span> <span class="tok-n">Hong</span> <span class="tok-n">Kong</span><span class="tok-o">,</span> <span class="tok-n">Honolulu</span><span class="tok-o">,</span> <span class="tok-n">Houston</span><span class="tok-o">,</span> <span class="tok-n">Hyderabad</span><span class="tok-o">,</span> <span class="tok-n">Ibiza</span><span class="tok-o">,</span> <span class="tok-n">Indianapolis</span><span class="tok-o">,</span> <span class="tok-n">Istanbul</span><span class="tok-o">,</span> <span class="tok-n">Johannesburg</span><span class="tok-o">,</span> <span class="tok-n">Kahului</span><span class="tok-o">,</span> <span class="tok-n">Kansas</span> <span class="tok-n">City</span><span class="tok-o">,</span> <span class="tok-n">Kingston</span><span class="tok-o">,</span> <span class="tok-n">Kolkata</span><span class="tok-o">,</span> <span class="tok-n">Kuala</span> <span class="tok-n">Lumpur</span><span class="tok-o">,</span> <span class="tok-n">Kuwait</span><span class="tok-o">,</span> <span class="tok-n">Larnaca</span><span class="tok-o">,</span> <span class="tok-n">Las</span> <span class="tok-n">Vegas</span><span class="tok-o">,</span> <span class="tok-n">Lima</span><span class="tok-o">,</span> <span class="tok-n">Liverpool</span><span class="tok-o">,</span> <span class="tok-n">London</span><span class="tok-o">,</span> <span class="tok-n">Long</span> <span class="tok-n">Beach</span><span class="tok-o">,</span> <span class="tok-n">Los</span> <span class="tok-n">Angeles</span><span class="tok-o">,</span> <span class="tok-n">Luqa</span><span class="tok-o">,</span> <span class="tok-n">Luxembourg</span><span class="tok-o">,</span> <span class="tok-n">Madrid</span><span class="tok-o">,</span> <span class="tok-n">Manama</span><span class="tok-o">,</span> <span class="tok-n">Manchester</span><span class="tok-o">,</span> <span class="tok-n">Manila</span><span class="tok-o">,</span> <span class="tok-n">Maroochydore</span><span class="tok-o">,</span> <span class="tok-n">Melbourne</span><span class="tok-o">,</span> <span class="tok-n">Memphis</span><span class="tok-o">,</span> <span class="tok-n">Menorca</span><span class="tok-o">,</span> <span class="tok-n">Mexico</span> <span class="tok-n">City</span><span class="tok-o">,</span> <span class="tok-n">Miami</span><span class="tok-o">,</span> <span class="tok-n">Milan</span><span class="tok-o">,</span> <span class="tok-n">Milwaukee</span><span class="tok-o">,</span> <span class="tok-n">Minneapolis</span><span class="tok-o">,</span> <span class="tok-n">Mombasa</span><span class="tok-o">,</span> <span class="tok-n">Montevideo</span><span class="tok-o">,</span> <span class="tok-n">Montreal</span><span class="tok-o">,</span> <span class="tok-n">Moscow</span><span class="tok-o">,</span> <span class="tok-n">Mumbai</span><span class="tok-o">,</span> <span class="tok-n">Munich</span><span class="tok-o">,</span> <span class="tok-n">Nairobi</span><span class="tok-o">,</span> <span class="tok-n">Nantes</span><span class="tok-o">,</span> <span class="tok-n">Naples</span><span class="tok-o">,</span> <span class="tok-n">Nashville</span><span class="tok-o">,</span> <span class="tok-n">New</span> <span class="tok-n">Delhi</span><span class="tok-o">,</span> <span class="tok-n">New</span> <span class="tok-n">Orleans</span><span class="tok-o">,</span> <span class="tok-n">New</span> <span class="tok-n">York</span><span class="tok-o">,</span> <span class="tok-n">Newark</span><span class="tok-o">,</span> <span class="tok-n">Nice</span><span class="tok-o">,</span> <span class="tok-n">Nottingham</span><span class="tok-o">,</span> <span class="tok-n">Oaklahoma</span> <span class="tok-n">City</span><span class="tok-o">,</span> <span class="tok-n">Oakland</span><span class="tok-o">,</span> <span class="tok-n">Omaha</span><span class="tok-o">,</span> <span class="tok-n">Ontario</span><span class="tok-o">,</span> <span class="tok-n">Orlando</span><span class="tok-o">,</span> <span class="tok-n">Osaka</span><span class="tok-o">,</span> <span class="tok-n">Oslo</span><span class="tok-o">,</span> <span class="tok-n">Ottawa</span><span class="tok-o">,</span> <span class="tok-n">Palm</span> <span class="tok-n">Springs</span><span class="tok-o">,</span> <span class="tok-n">Paris</span><span class="tok-o">,</span> <span class="tok-n">Perth</span><span class="tok-o">,</span> <span class="tok-n">Philadelphia</span><span class="tok-o">,</span> <span class="tok-n">Phnom</span> <span class="tok-n">Penh</span><span class="tok-o">,</span> <span class="tok-n">Phoenix</span><span class="tok-o">,</span> <span class="tok-n">Pisa</span><span class="tok-o">,</span> <span class="tok-n">Pittsburgh</span><span class="tok-o">,</span> <span class="tok-n">Portland</span><span class="tok-o">,</span> <span class="tok-n">Prague</span><span class="tok-o">,</span> <span class="tok-n">Puerto</span> <span class="tok-n">Vallarta</span><span class="tok-o">,</span> <span class="tok-n">Raleigh</span><span class="tok-o">,</span> <span class="tok-n">Rio</span> <span class="tok-n">de</span> <span class="tok-n">Janeiro</span><span class="tok-o">,</span> <span class="tok-n">Rochester</span><span class="tok-o">,</span> <span class="tok-n">Rome</span><span class="tok-o">,</span> <span class="tok-n">Salina</span><span class="tok-o">,</span> <span class="tok-n">Salt</span> <span class="tok-n">Lake</span> <span class="tok-n">City</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Antonio</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Diego</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Francisco</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Jose</span><span class="tok-o">,</span> <span class="tok-n">San</span> <span class="tok-n">Juan</span><span class="tok-o">,</span> <span class="tok-n">Santa</span> <span class="tok-n">Ana</span><span class="tok-o">,</span> <span class="tok-n">Santa</span> <span class="tok-n">Fe</span><span class="tok-o">,</span> <span class="tok-n">Santiago</span><span class="tok-o">,</span> <span class="tok-n">Sao</span> <span class="tok-n">Paulo</span><span class="tok-o">,</span> <span class="tok-n">Seattle</span><span class="tok-o">,</span> <span class="tok-n">Seoul</span><span class="tok-o">,</span> <span class="tok-n">Shanghai</span><span class="tok-o">,</span> <span class="tok-n">Shannon</span><span class="tok-o">,</span> <span class="tok-n">Singapore</span><span class="tok-o">,</span> <span class="tok-n">Sofia</span><span class="tok-o">,</span> <span class="tok-n">St</span> <span class="tok-n">Louis</span><span class="tok-o">,</span> <span class="tok-n">St</span><span class="tok-o">.</span> <span class="tok-n">Johns</span><span class="tok-o">,</span> <span class="tok-n">Stockholm</span><span class="tok-o">,</span> <span class="tok-n">Stuttgart</span><span class="tok-o">,</span> <span class="tok-n">Sydney</span><span class="tok-o">,</span> <span class="tok-n">Tallahassee</span><span class="tok-o">,</span> <span class="tok-n">Tampa</span><span class="tok-o">,</span> <span class="tok-n">Tel</span> <span class="tok-n">Aviv</span><span class="tok-o">,</span> <span class="tok-n">Tenerife</span><span class="tok-o">,</span> <span class="tok-n">Tokyo</span><span class="tok-o">,</span> <span class="tok-n">Toronto</span><span class="tok-o">,</span> <span class="tok-n">Tucson</span><span class="tok-o">,</span> <span class="tok-n">Tulsa</span><span class="tok-o">,</span> <span class="tok-n">Turin</span><span class="tok-o">,</span> <span class="tok-n">Vancouver</span><span class="tok-o">,</span> <span class="tok-n">Venice</span><span class="tok-o">,</span> <span class="tok-n">Verona</span><span class="tok-o">,</span> <span class="tok-n">Vienna</span><span class="tok-o">,</span> <span class="tok-n">Warsaw</span><span class="tok-o">,</span> <span class="tok-n">Washington</span> <span class="tok-n">D</span><span class="tok-o">.</span><span class="tok-na">C</span><span class="tok-o">.,</span> <span class="tok-n">Wellington</span><span class="tok-o">,</span> <span class="tok-n">West</span> <span class="tok-n">Palm</span> <span class="tok-n">Beach</span><span class="tok-o">,</span> <span class="tok-n">White</span> <span class="tok-n">Plains</span><span class="tok-o">,</span> <span class="tok-n">Winnipeg</span><span class="tok-o">,</span> <span class="tok-n">Zagreb</span><span class="tok-o">,</span> <span class="tok-n">Zurich</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And just to make sure we got less names back this time let&#8217;s count them again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">withSideEffect</span><span class="tok-o">(</span><span class="tok-s2">&quot;x&quot;</span><span class="tok-o">,</span> <span class="tok-o">[]</span> <span class="tok-k">as</span> <span class="tok-n">Set</span><span class="tok-o">).</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">201</span><span class="tok-o">)).</span>
  <span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span><span class="tok-na">cap</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span><span class="tok-na">unfold</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">186</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As I mentioned at the start of this section, you could achieve this result other ways. For
example, here is a version of the query that uses <em>dedup</em> instead of <em>store</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">201</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">186</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is clearly a simpler query in this case but you will find cases where the example
that uses <em>withSideEffect</em> and <em>store</em> will come in very handy, especially in cases where
you want to store things into a Set or List from multiple parts of a traversal such as the
one below that finds and counts all the unique city names across multiple hops from a
starting airport.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">withSideEffect</span><span class="tok-o">(</span><span class="tok-s2">&quot;x&quot;</span><span class="tok-o">,</span> <span class="tok-o">[]</span> <span class="tok-k">as</span> <span class="tok-n">Set</span><span class="tok-o">).</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasId</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span>
   <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span>
   <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span><span class="tok-na">cap</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span><span class="tok-na">unfold</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">804</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly on this topic, let&#8217;s look at one more interesting use case. It is quite common
to want to get back from a query a collection of nodes and edges. This is often
because we want to examine properties on both the nodes and the edges. Imagine a
small graph that has the following relationships.</p>
</div>
<div class="paragraph">
<p>(A&#8594;B),
(A&#8594;C),
(A&#8594;D),
(C&#8594;D),
(C&#8594;E),
(D&#8594;F)</p>
</div>
<div class="paragraph">
<p>The code below can be used to create this graph using the Gremlin console and
TinkerGraph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span><span class="tok-o">=</span><span class="tok-n">TinkerGraph</span><span class="tok-o">.</span><span class="tok-na">open</span><span class="tok-o">()</span>
<span class="tok-n">g</span><span class="tok-o">=</span><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-s2">&quot;A&quot;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-s2">&quot;B&quot;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-s2">&quot;C&quot;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;c&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-s2">&quot;D&quot;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;d&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-s2">&quot;E&quot;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;e&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-s2">&quot;F&quot;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;f&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s2">&quot;knows&quot;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s2">&quot;knows&quot;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s2">&quot;c&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s2">&quot;knows&quot;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s2">&quot;d&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s2">&quot;knows&quot;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s2">&quot;c&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s2">&quot;d&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s2">&quot;knows&quot;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s2">&quot;c&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s2">&quot;e&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s2">&quot;knows&quot;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s2">&quot;d&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s2">&quot;f&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see the IDs that were allocated for each node by looking at the <em>valueMap</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-nl">id:</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-nl">label:</span><span class="tok-n">A</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">id:</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-nl">label:</span><span class="tok-n">B</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">id:</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-nl">label:</span><span class="tok-n">C</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">id:</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-nl">label:</span><span class="tok-n">D</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">id:</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-nl">label:</span><span class="tok-n">E</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">id:</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-nl">label:</span><span class="tok-n">F</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Likewise we can look at the edges to see what IDs each edge was given.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">()</span>

<span class="tok-n">e</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">-</span><span class="tok-n">knows</span><span class="tok-o">-&gt;</span><span class="tok-mi">1</span><span class="tok-o">]</span>
<span class="tok-n">e</span><span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">-</span><span class="tok-n">knows</span><span class="tok-o">-&gt;</span><span class="tok-mi">2</span><span class="tok-o">]</span>
<span class="tok-n">e</span><span class="tok-o">[</span><span class="tok-mi">8</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">-</span><span class="tok-n">knows</span><span class="tok-o">-&gt;</span><span class="tok-mi">3</span><span class="tok-o">]</span>
<span class="tok-n">e</span><span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">-</span><span class="tok-n">knows</span><span class="tok-o">-&gt;</span><span class="tok-mi">3</span><span class="tok-o">]</span>
<span class="tok-n">e</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">-</span><span class="tok-n">knows</span><span class="tok-o">-&gt;</span><span class="tok-mi">4</span><span class="tok-o">]</span>
<span class="tok-n">e</span><span class="tok-o">[</span><span class="tok-mi">11</span><span class="tok-o">][</span><span class="tok-mi">3</span><span class="tok-o">-</span><span class="tok-n">knows</span><span class="tok-o">-&gt;</span><span class="tok-mi">5</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have our test graph created let&#8217;s take a look at the query we will need
to develop. The problem we want to solve is to start from node A, find all of the
edges that go out from node A and also all of the nodes at the other ends of those
edges. Lastly we also want to find any edges between the nodes that are also
connected to A but ignore edges that connect to nodes that are not also connected to
A. In simple terms we want a query that will return all of the relationships except
(C&#8594;E) and (D-F) as A is not connected to E or F.</p>
</div>
<div class="paragraph">
<p>Using the <em>withSideEffect</em> pattern that we used earlier in this section we can again
develop a query that will collect for us the nodes and edges that we are interested
in. I added line numbers to make it easier to discuss what is going on but please,
note that these are not part of the query itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-mi">1</span><span class="tok-o">:</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">withSideEffect</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">,</span> <span class="tok-o">[]</span> <span class="tok-k">as</span> <span class="tok-n">Set</span><span class="tok-o">).</span>
<span class="tok-mi">2</span><span class="tok-o">:</span>     <span class="tok-n">V</span><span class="tok-o">(</span><span class="tok-mi">0L</span><span class="tok-o">).</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span>
<span class="tok-mi">3</span><span class="tok-o">:</span>     <span class="tok-n">bothE</span><span class="tok-o">().</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span>
<span class="tok-mi">4</span><span class="tok-o">:</span>     <span class="tok-n">otherV</span><span class="tok-o">().</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span>
<span class="tok-mi">5</span><span class="tok-o">:</span>     <span class="tok-n">aggregate</span><span class="tok-o">(</span><span class="tok-s1">&#39;tgtlist&#39;</span><span class="tok-o">).</span>
<span class="tok-mi">6</span><span class="tok-o">:</span>     <span class="tok-n">bothE</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;ref&#39;</span><span class="tok-o">).</span><span class="tok-na">otherV</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;tgtlist&#39;</span><span class="tok-o">)).</span>
<span class="tok-mi">7</span><span class="tok-o">:</span>     <span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;ref&#39;</span><span class="tok-o">).</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span><span class="tok-na">cap</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">).</span><span class="tok-na">unfold</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the query above line by line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1: Start the query and define 'x' as our, initially empty, Set.
2: Start at vertex 0 and 'store' it into our set 'x'.
3: Store all of the edges connected to 'V(0)' into our set.
4: Store the vertices connected to 'V(0)' into our set.
5: Aggregate all of these target vertices into 'tgtlist'.
6: Find more edges but only remember them if they connect to vertices also connected
to 'V(0)'.
7: Store the edges we found in 'x' and finally return the set as the overall result of the
query. The 'unfold' just makes the output a little easier to read.</pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output we get from running the query. As you can see, the nodes and edges
that we were not interested in have been correctly left out of the result set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span>
<span class="tok-n">e</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">-</span><span class="tok-n">knows</span><span class="tok-o">-&gt;</span><span class="tok-mi">1</span><span class="tok-o">]</span>
<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span>
<span class="tok-n">e</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">-</span><span class="tok-n">knows</span><span class="tok-o">-&gt;</span><span class="tok-mi">2</span><span class="tok-o">]</span>
<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span>
<span class="tok-n">e</span><span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">-</span><span class="tok-n">knows</span><span class="tok-o">-&gt;</span><span class="tok-mi">3</span><span class="tok-o">]</span>
<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">]</span>
<span class="tok-n">e</span><span class="tok-o">[</span><span class="tok-mi">8</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">-</span><span class="tok-n">knows</span><span class="tok-o">-&gt;</span><span class="tok-mi">3</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you start to work with graphs and start to do more complex querying, this pattern
of query based around <em>withSideEffect</em> is extremely useful to keep in mind.</p>
</div>
</div>
<div class="sect2">
<h3 id="emit">5.5. Using <em>emit</em> to return results during a traversal</h3>
<div class="paragraph">
<p>Sometimes it is useful to be able to return the results of a traversal as it
executes. The example below starts at the Santa Fe airport (SAF) and uses a <em>repeat</em>
to keep going out from there. By placing an <em>emit</em> right after the <em>repeat</em> we will
be able to see the paths that are taken by the traversal. If we did not put the
<em>emit</em> here this query would run for a very long time as the <em>repeat</em> has no ending
condition!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;SAF&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">()).</span><span class="tok-na">emit</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">SAF</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SAF</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SAF</span><span class="tok-o">,</span><span class="tok-n">PHX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SAF</span><span class="tok-o">,</span><span class="tok-n">DEN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SAF</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SAF</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">ANC</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SAF</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SAF</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">BNA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SAF</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">BOS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SAF</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">BWI</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another place where <em>emit</em> can be useful is when <em>repeat</em> and <em>times</em> are used
together to find paths between nodes. Ordinarily, if you use a step such as
<em>times(3)</em> then the query will only return results that are three hops out. However if we
use an <em>emit</em> we can also see results that take less hops. First of all take a look at the query
below that does not use an <em>emit</em> and the results that it generates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">()).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;MIA&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">YYZ</span><span class="tok-o">,</span><span class="tok-n">MUC</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">YYZ</span><span class="tok-o">,</span><span class="tok-n">MAN</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">YYZ</span><span class="tok-o">,</span><span class="tok-n">YUL</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">YYZ</span><span class="tok-o">,</span><span class="tok-n">SVO</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">YYZ</span><span class="tok-o">,</span><span class="tok-n">GRU</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, only routes that took three full hops were returned. Now let&#8217;s change
the query to use an <em>emit</em>. This time you can think of the query as saying "at most
three hops".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">()).</span><span class="tok-na">emit</span><span class="tok-o">().</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;MIA&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">YYZ</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">FRA</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-n">MEX</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So by adding an <em>emit</em> we got back a quite different set of results. This is a really
useful and powerful capability. Being able to express ideas such as "at most three"
provides us a way to write very clean queries in cases like this.</p>
</div>
<div class="paragraph">
<p>You will see more examples of <em>emit</em> being used in the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="btree">5.6. Modelling an ordered binary tree as a graph</h3>
<div class="paragraph">
<p>You can of course model a tree structure as a graph. The following code will create a
new graph containing an ordered binary tree. A graph like this is sometimes referred
to as a <em>connected acyclic</em> graph as there are no cycles in the graph. This means
that once you leave a node there is no other path you could take that will allow you
to get there again. By contrast the air routes graph is an example of a <em>cyclic</em>
graph as there are clearly many ways to revisit nodes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span><span class="tok-o">=</span><span class="tok-n">TinkerGraph</span><span class="tok-o">.</span><span class="tok-na">open</span><span class="tok-o">()</span>
<span class="tok-n">g</span><span class="tok-o">=</span><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">()</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;root&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">,</span><span class="tok-mi">9</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;root&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;node&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;node&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;node&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">,</span><span class="tok-mi">11</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;node&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">,</span><span class="tok-mi">15</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;node&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">,</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;f&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;node&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;g&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;node&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;h&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;node&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">,</span><span class="tok-mi">22</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;i&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;node&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">,</span><span class="tok-mi">16</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;j&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;root&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;right&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;root&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;right&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;right&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;i&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;i&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;j&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;f&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;right&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;h&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;g&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could of course use the <em>max</em> and the <em>min</em> steps to find the largest and smallest
values in the graph. However, the queries below show how we can do it using the
semantics of an ordered binary tree.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Find the largest value in the graph</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;root&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;right&#39;</span><span class="tok-o">)).</span>
                       <span class="tok-n">until</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;right&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">)</span>

<span class="tok-mi">22</span>

<span class="tok-c1">// Find the smallest value in the graph</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;root&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">)).</span>
                       <span class="tok-n">until</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">)</span>

<span class="tok-mi">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a side note, here is a different way we could have written the query using <em>not</em>
instead of <em>count</em>. As <em>not</em> is a reserved word in Groovy, as we discussed
in the "<a href="#rword">A warning about reserved word conflicts and collisions</a>" section, we have to prefix it with the <em>__.</em> notation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;root&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">)).</span>
                       <span class="tok-n">until</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">not</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to see the values that the <em>repeat</em> is encountering as it traverses the
tree we could add an <em>emit</em> step and get the values of each node the <em>repeat</em> visits.
Note that this does not include the value from the root node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;root&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">)).</span><span class="tok-na">emit</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">)</span>

<span class="tok-mi">5</span>
<span class="tok-mi">2</span>
<span class="tok-mi">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Perhaps a nicer way to look at all the values we encountered as we traversed the tree
would be to use <em>path</em> as follows. Note that this does include the root node&#8217;s value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;root&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">)).</span>
                       <span class="tok-n">until</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">not</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">(</span><span class="tok-s1">&#39;left&#39;</span><span class="tok-o">))).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see all of the possible paths through the tree by running the following query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;root&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">()).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">).</span><span class="tok-na">emit</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">11</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">11</span><span class="tok-o">,</span><span class="tok-mi">10</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">11</span><span class="tok-o">,</span><span class="tok-mi">15</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">11</span><span class="tok-o">,</span><span class="tok-mi">15</span><span class="tok-o">,</span><span class="tok-mi">22</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">11</span><span class="tok-o">,</span><span class="tok-mi">15</span><span class="tok-o">,</span><span class="tok-mi">22</span><span class="tok-o">,</span><span class="tok-mi">16</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We briefly explored the TinkerPop Tree API in the "<a href="#tre">Turning node values into trees</a>" section. We could use
what we discussed there to create a Tree object from our Binary Tree graph as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">t</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;root&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">()).</span><span class="tok-na">emit</span><span class="tok-o">().</span><span class="tok-na">tree</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;data&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just to be sure we can query what kind of object we just created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">()</span>

<span class="tok-kd">class</span> <span class="tok-nc">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">tinkerpop</span><span class="tok-o">.</span><span class="tok-na">gremlin</span><span class="tok-o">.</span><span class="tok-na">process</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">.</span><span class="tok-na">step</span><span class="tok-o">.</span><span class="tok-na">util</span><span class="tok-o">.</span><span class="tok-na">Tree</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we print the tree we can see how it has been created from our original graph. If
you study the nesting closely you will see that it does indeed represent the original
binary tree data that we used to create the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">println</span> <span class="tok-n">t</span>

<span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">:[</span><span class="tok-mi">5</span><span class="tok-o">:[</span><span class="tok-mi">2</span><span class="tok-o">:[</span><span class="tok-mi">1</span><span class="tok-o">:[:]],</span> <span class="tok-mi">8</span><span class="tok-o">:[:]],</span> <span class="tok-mi">11</span><span class="tok-o">:[</span><span class="tok-mi">10</span><span class="tok-o">:[:],</span> <span class="tok-mi">15</span><span class="tok-o">:[</span><span class="tok-mi">22</span><span class="tok-o">:[</span><span class="tok-mi">16</span><span class="tok-o">:[:]]]]]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the <em>getObjectsAtDepth</em> method to further investigate the tree structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">getObjectsAtDepth</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)</span>

<span class="tok-mi">9</span>

<span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">getObjectsAtDepth</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">)</span>

<span class="tok-mi">5</span>
<span class="tok-mi">11</span>

<span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">getObjectsAtDepth</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">)</span>

<span class="tok-mi">2</span>
<span class="tok-mi">8</span>
<span class="tok-mi">10</span>
<span class="tok-mi">15</span>

<span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">getObjectsAtDepth</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">)</span>

<span class="tok-mi">1</span>
<span class="tok-mi">22</span>

<span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">getObjectsAtDepth</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)</span>

<span class="tok-mi">16</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapstr">5.7. Using <em>map</em> to produce a concatenated result string</h3>
<div class="paragraph">
<p>In the example below we use <em>map</em> to build a string containing the airport code
concatenated with the city the airport is in for airports in England.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;GB-ENG&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span>
  <span class="tok-n">map</span><span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">value</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)+</span><span class="tok-s2">&quot; &quot;</span><span class="tok-o">+</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">value</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">)}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the results of running the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">LHR</span> <span class="tok-n">London</span>
<span class="tok-n">LGW</span> <span class="tok-n">London</span>
<span class="tok-n">MAN</span> <span class="tok-n">Manchester</span>
<span class="tok-n">LCY</span> <span class="tok-n">London</span>
<span class="tok-n">STN</span> <span class="tok-n">London</span>
<span class="tok-n">EMA</span> <span class="tok-n">Nottingham</span>
<span class="tok-n">LPL</span> <span class="tok-n">Liverpool</span>
<span class="tok-n">LTN</span> <span class="tok-n">London</span>
<span class="tok-n">SOU</span> <span class="tok-n">Southampton</span>
<span class="tok-n">LBA</span> <span class="tok-n">Leeds</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="randwalk">5.8. Randomly walking a graph</h3>
<div class="paragraph">
<p>When doing analysis of a graph sometimes you just want to randomly traverse or <em>walk</em>
parts of the graph. The example below shows a query that starts at the Austin (AUS)
node and then randomly goes to five connected nodes from there.  The <em>random walk</em> is
achieved by picking a sample of one of the possible edges connected to  vertex (node) we are
currently at and then moving to the vertex at the other end of that edge. Notice how
to get the effect that we want that the edge is picked inside of a <em>local</em> step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Random walk with five hops</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">(</span><span class="tok-n">bothE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">sample</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">otherV</span><span class="tok-o">())).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">).</span>
      <span class="tok-n">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Below are the results of running the query five times.  You can see each graph walk
starts at AUS and then goes to five places from there. The path shown displays the
names of the other airports and the distances between them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">992</span><span class="tok-o">,</span><span class="tok-n">SFB</span><span class="tok-o">,</span><span class="tok-mi">828</span><span class="tok-o">,</span><span class="tok-n">MDT</span><span class="tok-o">,</span><span class="tok-mi">592</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">,</span><span class="tok-mi">234</span><span class="tok-o">,</span><span class="tok-n">DTW</span><span class="tok-o">,</span><span class="tok-mi">500</span><span class="tok-o">,</span><span class="tok-n">LGA</span><span class="tok-o">]</span>

<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">957</span><span class="tok-o">,</span><span class="tok-n">CVG</span><span class="tok-o">,</span><span class="tok-mi">374</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-mi">1890</span><span class="tok-o">,</span><span class="tok-n">SAN</span><span class="tok-o">,</span><span class="tok-mi">2276</span><span class="tok-o">,</span><span class="tok-n">DCA</span><span class="tok-o">,</span><span class="tok-mi">204</span><span class="tok-o">,</span><span class="tok-n">PIT</span><span class="tok-o">]</span>

<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">1209</span><span class="tok-o">,</span><span class="tok-n">PIT</span><span class="tok-o">,</span><span class="tok-mi">1399</span><span class="tok-o">,</span><span class="tok-n">CUN</span><span class="tok-o">,</span><span class="tok-mi">941</span><span class="tok-o">,</span><span class="tok-n">BJX</span><span class="tok-o">,</span><span class="tok-mi">729</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-mi">1384</span><span class="tok-o">,</span><span class="tok-n">BZN</span><span class="tok-o">]</span>

<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">748</span><span class="tok-o">,</span><span class="tok-n">MEX</span><span class="tok-o">,</span><span class="tok-mi">1252</span><span class="tok-o">,</span><span class="tok-n">PHX</span><span class="tok-o">,</span><span class="tok-mi">5255</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-mi">2487</span><span class="tok-o">,</span><span class="tok-n">LXR</span><span class="tok-o">,</span><span class="tok-mi">492</span><span class="tok-o">,</span><span class="tok-n">JED</span><span class="tok-o">]</span>

<span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">,</span><span class="tok-mi">722</span><span class="tok-o">,</span><span class="tok-n">STL</span><span class="tok-o">,</span><span class="tok-mi">717</span><span class="tok-o">,</span><span class="tok-n">DCA</span><span class="tok-o">,</span><span class="tok-mi">893</span><span class="tok-o">,</span><span class="tok-n">RSW</span><span class="tok-o">,</span><span class="tok-mi">1103</span><span class="tok-o">,</span><span class="tok-n">HPN</span><span class="tok-o">,</span><span class="tok-mi">563</span><span class="tok-o">,</span><span class="tok-n">CLT</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="unwantededges">5.9. Finding unwanted parallel edges</h3>
<div class="paragraph">
<p>In general terms there are many reasons in a graph that there could be more than one edge
between the same two nodes in the same direction.  Most property graph systems allow this
and many data models take advantage of this capability. We call these parallel edges.
However, in the air-routes graph we only model the existence of a route using a single
edge from airport A to airport B. It is considered an error for there to be more than one
edge between the same two airports in the same direction. Note this does not include an
edge going the other way (from B to A).</p>
</div>
<div class="paragraph">
<p>During development of the air-routes graph, when I was still cleaning up the data, I
frequently ran into problems with parallel edges getting included in the graph by mistake.
I realized I could use Gremlin to help me detect these error cases.</p>
</div>
<div class="paragraph">
<p>Initially I tried something very basic, that still required quite a bit of manual reading
of the output. I used the following query to tell me if for a given airport there was more
than one outgoing edge to any other airport. This required me to have a hunch ahead of
time which airport nodes might have an issue. Far from ideal when there are over 3,300
airport nodes in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">valueDecr</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">().</span><span class="tok-na">max</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the answer came back greater than one I then ran the following query and manually
looked at each result to see where the duplicate edge was.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">valueDecr</span><span class="tok-o">)]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As I said this was a very manual and time consuming process. I clearly needed a
better query. Given what we know about <em>groupCount</em> I realized I could write an
arbitrary query to tell me how many times every single route in the graph exists.
However, given there are over 43,000 routes I was not going to be able to check that
manually. So as is often the best way with Gremlin I built up my query in stages.
First of all I wrote the query to count the occurrence of all routes. I have not
shown all the output from this query as it would take tens of pages but as you can
see from what we have shown, this result would still need a person studying all of
the results. Far from ideal!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-o">))</span>

<span class="tok-o">[[</span><span class="tok-nl">a:</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">],</span><span class="tok-nl">b:</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">]]:</span><span class="tok-mi">1</span><span class="tok-o">,[</span><span class="tok-nl">a:</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">],</span><span class="tok-nl">b:</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">]]:</span><span class="tok-mi">1</span><span class="tok-o">,[</span><span class="tok-nl">a:</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">],</span><span class="tok-nl">b:</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">]]:</span><span class="tok-mi">1</span> <span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>I then added a filter to only select any routes that occurred more than once. Note
that I had to use <em>unfold</em> before I applied the <em>filter</em> to turn the map back into a
stream of values that could be filtered.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-o">)).</span><span class="tok-na">unfold</span><span class="tok-o">().</span>
                            <span class="tok-n">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next I added one more step to tell me which routes contained the error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-o">)).</span><span class="tok-na">unfold</span><span class="tok-o">().</span>
                            <span class="tok-n">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">))).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-n">keys</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One of the errors I ran into was that I had erroneously added the LHR to JFK route
twice into the graph. LHR has the ID of 49 and JFK has the ID of 12. When I ran the
above query I got the following output which told me exactly which route I needed to
correct. This is clearly a much more useful query than the prior ones.  I could
happily have stopped at this point but I wanted to see if I could improve the query
some more.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">49</span><span class="tok-o">],</span><span class="tok-nl">b:</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">12</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>I was still not totally happy with my query as I really wanted it to give me back the
airport codes. So I added a few more tweaks to do the <em>groupCount</em> using the airport
codes. I have also left the <em>select(keys)</em> off the end of this query as I think it
aids understanding to see what is returned before that step is performed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">unfold</span><span class="tok-o">()</span>
                           <span class="tok-o">.</span><span class="tok-na">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So what we get back when we run that query is the airport codes as well of the number
of times they have appeared connected to each other by a parallel edge. This is
actually a key/value pair where the contents of the <em>{}</em> are the keys and the <em>=2</em>
part is the value.  You could reasonably argue that this is sufficient for me to go
and fix the mistake in the graph. However I want to add just a couple of additional
steps to demonstrate other possible refinements that you may find useful in other
circumstances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">{</span><span class="tok-n">a</span><span class="tok-o">=</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-n">b</span><span class="tok-o">=</span><span class="tok-n">JFK</span><span class="tok-o">}=</span><span class="tok-mi">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we don&#8217;t want the <em>=2</em> part returned we can just select the keys part.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">unfold</span><span class="tok-o">()</span>
                           <span class="tok-o">.</span><span class="tok-na">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">))).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-n">keys</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is what was now returned. Note that the keys themselves are returned in a map
using the <em>a</em> and <em>b</em> terms from our <em>as</em> step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-nl">b:</span><span class="tok-n">JFK</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is almost exactly what I wanted but we can add one more tiny step to clean up the
output by just selecting the values from the map returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">groupCount</span><span class="tok-o">().</span><span class="tok-na">unfold</span><span class="tok-o">()</span>
                           <span class="tok-o">.</span><span class="tok-na">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">).</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">))).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-n">keys</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So here is the final output, just the codes for the airports with parallel edges
that needed fixing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Note how I built up my Gremlin query in stages to solve this problem. I
recommend this as a sensible way to approach all but the most basic of queries that
you may need to write. Doing it this way has the advantage that you can also check
that each part of the query is working the way you intend it to before you add more
parts to it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="flr">5.10. Finding the longest flight route between two adjacent airports in the graph</h3>
<div class="paragraph">
<p>This section is in a way a case study in the good and the bad of the Gremlin query
language. I have documented here the learning steps I went through to get what I
thought was a very simple question expressed as a single Gremlin query. This
documents well the Good,the bad and the sometimes ugly aspects of working with
Gremlin. On the good side it is powerful and some things that should be easy are
easy.  On the bad side, some things that appear easy are in fact very hard to get
right especially if you want to build a single query to do a job rather than break it
up into a set of smaller programmatic steps.  Let&#8217;s look at an example of this with a
real world query.</p>
</div>
<div class="paragraph">
<p>The query we want to build is to find the route(s) in the graph that are of the
maximum length between any two airports. It turns out that this simple looking query
takes a lot of work to get right if you want to handle the case where there could be
more than one route that is of the maximum length (return flights between the same
two airports don&#8217;t count as different routes for this example).</p>
</div>
<div class="paragraph">
<p>While this (below) might seem like the way obvious and easy to do it, because of the
way that max() is implemented it will not work. Currently max() and min() cause the
prior paths that have been taken in a traverasl to be lost. There is a defect open
against TinkerPop for this that we created but until that defect gets resolved, we
need to explore other ways of achieving our desired result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">max</span><span class="tok-o">().</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First of all we could do this (below) The down side of this approach is that both
queries have to look at a lot of edges which is likely to use additional memory and
CPU to process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">r</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">max</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">r</span><span class="tok-o">).</span><span class="tok-na">bothV</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next query is more efficient as using an ID means the edges are only searched
once, but this approach would miss the case where more than one route was of the same
(max) length so it does not meet our required success criteria.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">r</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span> <span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">).</span><span class="tok-na">id</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">(</span><span class="tok-n">r</span><span class="tok-o">).</span><span class="tok-na">dist</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">(</span><span class="tok-n">r</span><span class="tok-o">).</span><span class="tok-na">bothV</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query is what Daniel Kuppitz from the TinkerPop team recommended after we
discussed this on the mailing list and it does indeed work but from where we started
our experiments to build up this query from there is a non trivial journey!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s2">&quot;route&quot;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s2">&quot;dist&quot;</span><span class="tok-o">,</span> <span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s2">&quot;d&quot;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s2">&quot;dist&quot;</span><span class="tok-o">).</span>
  <span class="tok-n">filter</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s2">&quot;dist&quot;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;cd&quot;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s2">&quot;d&quot;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">limit</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">)).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;md&quot;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s2">&quot;cd&quot;</span><span class="tok-o">,</span> <span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-s2">&quot;md&quot;</span><span class="tok-o">))).</span>
  <span class="tok-n">project</span><span class="tok-o">(</span><span class="tok-s2">&quot;from&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;to&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;dist&quot;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">outV</span><span class="tok-o">()).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">inV</span><span class="tok-o">()).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s2">&quot;dist&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, to output airport codes rather than just vertices, we can tweak the query
one more time as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">E</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s2">&quot;route&quot;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s2">&quot;dist&quot;</span><span class="tok-o">,</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">store</span><span class="tok-o">(</span><span class="tok-s2">&quot;d&quot;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s2">&quot;dist&quot;</span><span class="tok-o">).</span><span class="tok-err">\</span>
  <span class="tok-n">filter</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s2">&quot;dist&quot;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;cd&quot;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s2">&quot;d&quot;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">limit</span><span class="tok-o">(</span><span class="tok-n">local</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">)).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;md&quot;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s2">&quot;cd&quot;</span><span class="tok-o">,</span>  <span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-s2">&quot;md&quot;</span><span class="tok-o">))).</span><span class="tok-err">\</span>
  <span class="tok-n">project</span><span class="tok-o">(</span><span class="tok-s2">&quot;from&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;to&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;dist&quot;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">outV</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">inV</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s2">&quot;dist&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to run our query. This is the output from it. Notice how both routes
are between the same city pairs. We could have further refined our query to only show
such combinations once but I will leave that as an exercise for the reader!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">AKL</span><span class="tok-o">,</span><span class="tok-nl">dist:</span><span class="tok-mi">8818</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">from:</span><span class="tok-n">AKL</span><span class="tok-o">,</span><span class="tok-nl">to:</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-nl">dist:</span><span class="tok-mi">8818</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="miscq">5.11. Miscellaneous other queries</h3>
<div class="paragraph">
<p>These queries need to be moved to other sections or deleted.</p>
</div>
<div class="paragraph">
<div class="title">THIS SECTION IS YET TO BE FULLY TIDIED UP</div>
<p>Work in progress</p>
</div>
<div class="sect3">
<h4 id="_warning_about_em_path_em_being_memory_intensive">5.11.1. Warning about <em>path</em> being memory intensive</h4>
<div class="paragraph">
<p>Running a query with point of funnel first works fine but put AUS first and will
run out of memory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;PSV&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">simplePath</span><span class="tok-o">()).</span><span class="tok-na">until</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">)).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>
<span class="tok-o">[</span><span class="tok-n">PSV</span><span class="tok-o">,</span><span class="tok-n">LWK</span><span class="tok-o">,</span><span class="tok-n">FIE</span><span class="tok-o">,</span><span class="tok-n">KOI</span><span class="tok-o">,</span><span class="tok-n">EDI</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">PSV</span><span class="tok-o">,</span><span class="tok-n">LWK</span><span class="tok-o">,</span><span class="tok-n">FIE</span><span class="tok-o">,</span><span class="tok-n">KOI</span><span class="tok-o">,</span><span class="tok-n">EDI</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">PSV</span><span class="tok-o">,</span><span class="tok-n">LWK</span><span class="tok-o">,</span><span class="tok-n">FIE</span><span class="tok-o">,</span><span class="tok-n">KOI</span><span class="tok-o">,</span><span class="tok-n">EDI</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">PSV</span><span class="tok-o">,</span><span class="tok-n">LWK</span><span class="tok-o">,</span><span class="tok-n">FIE</span><span class="tok-o">,</span><span class="tok-n">KOI</span><span class="tok-o">,</span><span class="tok-n">EDI</span><span class="tok-o">,</span><span class="tok-n">FRA</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">PSV</span><span class="tok-o">,</span><span class="tok-n">LWK</span><span class="tok-o">,</span><span class="tok-n">FIE</span><span class="tok-o">,</span><span class="tok-n">KOI</span><span class="tok-o">,</span><span class="tok-n">GLA</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">PSV</span><span class="tok-o">,</span><span class="tok-n">LWK</span><span class="tok-o">,</span><span class="tok-n">FIE</span><span class="tok-o">,</span><span class="tok-n">KOI</span><span class="tok-o">,</span><span class="tok-n">GLA</span><span class="tok-o">,</span><span class="tok-n">MCO</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">PSV</span><span class="tok-o">,</span><span class="tok-n">LWK</span><span class="tok-o">,</span><span class="tok-n">FIE</span><span class="tok-o">,</span><span class="tok-n">KOI</span><span class="tok-o">,</span><span class="tok-n">GLA</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">PSV</span><span class="tok-o">,</span><span class="tok-n">LWK</span><span class="tok-o">,</span><span class="tok-n">FIE</span><span class="tok-o">,</span><span class="tok-n">KOI</span><span class="tok-o">,</span><span class="tok-n">GLA</span><span class="tok-o">,</span><span class="tok-n">PHL</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">PSV</span><span class="tok-o">,</span><span class="tok-n">LWK</span><span class="tok-o">,</span><span class="tok-n">FIE</span><span class="tok-o">,</span><span class="tok-n">KOI</span><span class="tok-o">,</span><span class="tok-n">GLA</span><span class="tok-o">,</span><span class="tok-n">YYZ</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">PSV</span><span class="tok-o">,</span><span class="tok-n">LWK</span><span class="tok-o">,</span><span class="tok-n">FIE</span><span class="tok-o">,</span><span class="tok-n">KOI</span><span class="tok-o">,</span><span class="tok-n">GLA</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">AUS</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_work_in_progress">5.11.2. Work in progress</h4>
<div class="paragraph">
<p>Using a mathematical expression inside of <em>is</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">500</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-o">))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">CDG</span>
<span class="tok-n">FRA</span>
<span class="tok-n">AMS</span>
<span class="tok-n">IST</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">500</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-o">))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">CDG</span>
<span class="tok-n">FRA</span>
<span class="tok-n">AMS</span>
<span class="tok-n">IST</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-o">))).</span>
      <span class="tok-n">project</span><span class="tok-o">(</span><span class="tok-s1">&#39;apt&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;routes&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">())</span>

<span class="tok-o">[</span><span class="tok-nl">apt:</span><span class="tok-n">CDG</span><span class="tok-o">,</span><span class="tok-nl">routes:</span><span class="tok-mi">262</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">apt:</span><span class="tok-n">FRA</span><span class="tok-o">,</span><span class="tok-nl">routes:</span><span class="tok-mi">266</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">apt:</span><span class="tok-n">AMS</span><span class="tok-o">,</span><span class="tok-nl">routes:</span><span class="tok-mi">269</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-nl">apt:</span><span class="tok-n">IST</span><span class="tok-o">,</span><span class="tok-nl">routes:</span><span class="tok-mi">270</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">dfw</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">,</span><span class="tok-n">within</span><span class="tok-o">(</span><span class="tok-s1">&#39;US&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;CA&#39;</span><span class="tok-o">)).</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">,</span><span class="tok-n">lte</span><span class="tok-o">(</span><span class="tok-n">dfw</span><span class="tok-o">)).</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">without</span><span class="tok-o">(</span><span class="tok-s1">&#39;PHX&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">)).</span><span class="tok-na">out</span><span class="tok-o">().</span>
      <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAS&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">().</span><span class="tok-na">inject</span><span class="tok-o">(</span><span class="tok-s1">&#39;ABIA&#39;</span><span class="tok-o">)</span>

<span class="tok-n">ABIA</span>
<span class="tok-n">US</span>
<span class="tok-n">AUS</span>
<span class="tok-mi">12250</span>
<span class="tok-n">Austin</span>
<span class="tok-mi">542</span>
<span class="tok-n">KAUS</span>
<span class="tok-o">-</span><span class="tok-mf">97.6698989868164</span>
<span class="tok-n">airport</span>
<span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span>
<span class="tok-mi">2</span>
<span class="tok-mf">30.1944999694824</span>
<span class="tok-n">Austin</span> <span class="tok-n">Bergstrom</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">a</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-OK&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">withIndex</span><span class="tok-o">().</span><span class="tok-na">toList</span><span class="tok-o">()</span>
<span class="tok-o">[</span><span class="tok-n">OKC</span><span class="tok-o">,</span><span class="tok-mi">0</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">TUL</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LAW</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SWO</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;to&#39;</span><span class="tok-o">).</span>
      <span class="tok-n">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;to&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">,</span><span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-s1">&#39;to&#39;</span><span class="tok-o">))).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">0L</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;v&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;val&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;v&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;p&#39;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">(</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">value</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;val2&#39;</span><span class="tok-o">).</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;p&#39;</span><span class="tok-o">).</span><span class="tok-na">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;val&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;val2&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s1">&#39;val&#39;</span><span class="tok-o">,</span><span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-s1">&#39;val2&#39;</span><span class="tok-o">)))</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">).</span><span class="tok-na">properties</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s2">&quot;c&quot;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">eq</span><span class="tok-o">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-o">)).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s2">&quot;c&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span>
                        <span class="tok-n">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">).</span><span class="tok-na">fold</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-n">ABQ</span><span class="tok-o">,</span><span class="tok-n">KABQ</span><span class="tok-o">,</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">KATL</span><span class="tok-o">,</span><span class="tok-n">BKG</span><span class="tok-o">,</span><span class="tok-n">KBBG</span><span class="tok-o">,</span><span class="tok-n">BNA</span><span class="tok-o">,</span><span class="tok-n">KBNA</span><span class="tok-o">,</span><span class="tok-n">BOS</span><span class="tok-o">,</span><span class="tok-n">KBOS</span><span class="tok-o">,</span><span class="tok-n">BWI</span><span class="tok-o">,</span><span class="tok-n">KBWI</span><span class="tok-o">,</span><span class="tok-n">CLE</span><span class="tok-o">,</span><span class="tok-n">KCLE</span><span class="tok-o">,</span><span class="tok-n">CLT</span><span class="tok-o">,</span><span class="tok-n">KCLT</span><span class="tok-o">,</span><span class="tok-n">CUN</span><span class="tok-o">,</span><span class="tok-n">MMUN</span><span class="tok-o">,</span><span class="tok-n">CVG</span><span class="tok-o">,</span><span class="tok-n">KCVG</span><span class="tok-o">,</span><span class="tok-n">DAL</span><span class="tok-o">,</span><span class="tok-n">KDAL</span><span class="tok-o">,</span><span class="tok-n">DCA</span><span class="tok-o">,</span><span class="tok-n">KDCA</span><span class="tok-o">,</span><span class="tok-n">DEN</span><span class="tok-o">,</span><span class="tok-n">KDEN</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-n">KDFW</span><span class="tok-o">,</span><span class="tok-n">DTW</span><span class="tok-o">,</span><span class="tok-n">KDTW</span><span class="tok-o">,</span><span class="tok-n">ELP</span><span class="tok-o">,</span><span class="tok-n">KELP</span><span class="tok-o">,</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-n">KEWR</span><span class="tok-o">,</span><span class="tok-n">FLL</span><span class="tok-o">,</span><span class="tok-n">KFLL</span><span class="tok-o">,</span><span class="tok-n">FRA</span><span class="tok-o">,</span><span class="tok-n">EDDF</span><span class="tok-o">,</span><span class="tok-n">GDL</span><span class="tok-o">,</span><span class="tok-n">MMGL</span><span class="tok-o">,</span><span class="tok-n">HOU</span><span class="tok-o">,</span><span class="tok-n">KHOU</span><span class="tok-o">,</span><span class="tok-n">HRL</span><span class="tok-o">,</span><span class="tok-n">KHRL</span><span class="tok-o">,</span><span class="tok-n">IAD</span><span class="tok-o">,</span><span class="tok-n">KIAD</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">,</span><span class="tok-n">KIAH</span><span class="tok-o">,</span><span class="tok-n">IND</span><span class="tok-o">,</span><span class="tok-n">KIND</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">,</span><span class="tok-n">KJFK</span><span class="tok-o">,</span><span class="tok-n">LAS</span><span class="tok-o">,</span><span class="tok-n">KLAS</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-n">KLAX</span><span class="tok-o">,</span><span class="tok-n">LBB</span><span class="tok-o">,</span><span class="tok-n">KLBB</span><span class="tok-o">,</span><span class="tok-n">LGB</span><span class="tok-o">,</span><span class="tok-n">KLGB</span><span class="tok-o">,</span><span class="tok-n">LHR</span><span class="tok-o">,</span><span class="tok-n">EGLL</span><span class="tok-o">,</span><span class="tok-n">MCI</span><span class="tok-o">,</span><span class="tok-n">KMCI</span><span class="tok-o">,</span><span class="tok-n">MCO</span><span class="tok-o">,</span><span class="tok-n">KMCO</span><span class="tok-o">,</span><span class="tok-n">MDW</span><span class="tok-o">,</span><span class="tok-n">KMDW</span><span class="tok-o">,</span><span class="tok-n">MEM</span><span class="tok-o">,</span><span class="tok-n">KMEM</span><span class="tok-o">,</span><span class="tok-n">MEX</span><span class="tok-o">,</span><span class="tok-n">MMMX</span><span class="tok-o">,</span><span class="tok-n">MIA</span><span class="tok-o">,</span><span class="tok-n">KMIA</span><span class="tok-o">,</span><span class="tok-n">MSP</span><span class="tok-o">,</span><span class="tok-n">KMSP</span><span class="tok-o">,</span><span class="tok-n">MSY</span><span class="tok-o">,</span><span class="tok-n">KMSY</span><span class="tok-o">,</span><span class="tok-n">OAK</span><span class="tok-o">,</span><span class="tok-n">KOAK</span><span class="tok-o">,</span><span class="tok-n">ORD</span><span class="tok-o">,</span><span class="tok-n">KORD</span><span class="tok-o">,</span><span class="tok-n">PDX</span><span class="tok-o">,</span><span class="tok-n">KPDX</span><span class="tok-o">,</span><span class="tok-n">PHL</span><span class="tok-o">,</span><span class="tok-n">KPHL</span><span class="tok-o">,</span><span class="tok-n">PHX</span><span class="tok-o">,</span><span class="tok-n">KPHX</span><span class="tok-o">,</span><span class="tok-n">PIE</span><span class="tok-o">,</span><span class="tok-n">KPIE</span><span class="tok-o">,</span><span class="tok-n">PIT</span><span class="tok-o">,</span><span class="tok-n">KPIT</span><span class="tok-o">,</span><span class="tok-n">PNS</span><span class="tok-o">,</span><span class="tok-n">KPNS</span><span class="tok-o">,</span><span class="tok-n">RDU</span><span class="tok-o">,</span><span class="tok-n">KRDU</span><span class="tok-o">,</span><span class="tok-n">SAN</span><span class="tok-o">,</span><span class="tok-n">KSAN</span><span class="tok-o">,</span><span class="tok-n">SEA</span><span class="tok-o">,</span><span class="tok-n">KSEA</span><span class="tok-o">,</span><span class="tok-n">SFB</span><span class="tok-o">,</span><span class="tok-n">KSFB</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-n">KSFO</span><span class="tok-o">,</span><span class="tok-n">SJC</span><span class="tok-o">,</span><span class="tok-n">KSJC</span><span class="tok-o">,</span><span class="tok-n">SLC</span><span class="tok-o">,</span><span class="tok-n">KSLC</span><span class="tok-o">,</span><span class="tok-n">SNA</span><span class="tok-o">,</span><span class="tok-n">KSNA</span><span class="tok-o">,</span><span class="tok-n">STL</span><span class="tok-o">,</span><span class="tok-n">KSTL</span><span class="tok-o">,</span><span class="tok-n">TPA</span><span class="tok-o">,</span><span class="tok-n">KTPA</span><span class="tok-o">,</span><span class="tok-n">VPS</span><span class="tok-o">,</span><span class="tok-n">KVPS</span><span class="tok-o">,</span><span class="tok-n">YYZ</span><span class="tok-o">,</span><span class="tok-n">CYYZ</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Using next to iterate through nodes</span>
<span class="tok-n">t</span><span class="tok-o">=</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">);[]</span>
<span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>
<span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>
<span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)</span>
<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span>
<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span>
<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">]</span>
<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">]</span>
<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">sack</span><span class="tok-o">(</span><span class="tok-n">assign</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">sack</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Experiments with timing and indexes</span>
<span class="tok-n">clock</span><span class="tok-o">(</span><span class="tok-mi">1000</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">12000</span><span class="tok-o">))}</span>
<span class="tok-mf">0.008413653</span>

<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">createIndex</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">,</span><span class="tok-n">Vertex</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-n">clock</span><span class="tok-o">(</span><span class="tok-mi">1000</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">12000</span><span class="tok-o">))}</span>
<span class="tok-mf">0.003952521</span>

<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">getIndexedKeys</span><span class="tok-o">(</span><span class="tok-n">Vertex</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">dropIndex</span><span class="tok-o">(</span><span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">,</span><span class="tok-n">Vertex</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">()).</span><span class="tok-na">until</span><span class="tok-o">(</span><span class="tok-n">loops</span><span class="tok-o">().</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">)).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">5894</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">()).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>

<span class="tok-mi">5894</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Experiments with how many route permutations are there based on number of hops.</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">))).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">).</span><span class="tok-na">simplePath</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>
<span class="tok-mi">1</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">))).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">).</span><span class="tok-na">simplePath</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>
<span class="tok-mi">43</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">))).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">simplePath</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>
<span class="tok-mi">2351</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">().</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-n">neq</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">))).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">).</span><span class="tok-na">simplePath</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">()</span>
<span class="tok-mi">122329</span>

<span class="tok-c1">// From Austin and back again</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">cyclicPath</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">// Ugly query! Look at every property of every node and see if it contains &quot;R.&quot;</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">().</span><span class="tok-na">filter</span><span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">().</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s1">&#39;R.&#39;</span><span class="tok-o">)}.</span><span class="tok-na">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">valueMap</span><span class="tok-o">()</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pagerank">5.11.3. Experiments with Page Rank</h4>
<div class="listingblock">
<div class="title">This is a placeholder.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Page rank based on outgoing routes</span>
<span class="tok-n">g</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">().</span><span class="tok-na">withComputer</span><span class="tok-o">()</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">pageRank</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">outE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">)).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;r&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;r&#39;</span><span class="tok-o">,</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;r&#39;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>
<span class="tok-o">[</span><span class="tok-nl">r:</span><span class="tok-o">[</span><span class="tok-mf">15.61824172032977</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">r:</span><span class="tok-o">[</span><span class="tok-mf">14.922712714789586</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">r:</span><span class="tok-o">[</span><span class="tok-mf">14.637892542166075</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">IST</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">r:</span><span class="tok-o">[</span><span class="tok-mf">14.544774102601247</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">ORD</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">r:</span><span class="tok-o">[</span><span class="tok-mf">13.82927112415382</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">DEN</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">r:</span><span class="tok-o">[</span><span class="tok-mf">13.794192182285459</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">DME</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">r:</span><span class="tok-o">[</span><span class="tok-mf">13.46824937434635</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">AMS</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">r:</span><span class="tok-o">[</span><span class="tok-mf">13.375467729773533</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">CDG</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">r:</span><span class="tok-o">[</span><span class="tok-mf">13.154068946539626</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">PEK</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">r:</span><span class="tok-o">[</span><span class="tok-mf">13.047424689334612</span><span class="tok-o">],</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">FRA</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="beyond">6. MOVING BEYOND THE CONSOLE AND TINKERGRAPH</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">This section is still under construction!</div>
<p>Most of the examples we have looked at so far were produced using the Gremlin console
and the TinkerGraph in-memory graph all running on a single machine.  However, there
are many ways to deploy and interact with a graph while still using Gremlin and
optionally the Gremlin Console, and many of them go beyond doing everything on a
single machine.  The Apache TinkerPop package for example includes a component called
Gremlin Server.  Gremlin Server allows you to host a graph database locally or
remotely and talk to it over HTTP or WebSockets. The Gremlin console supports
accessing graphs both locally or remotely or you can access them using your own code
or other tools or even command line utilities such as <em>curl</em>.</p>
</div>
<div class="paragraph">
<p>For a production environment it is likely you will use a technology such as Janus
Graph backed by something like HBase or Cassandra and an indexing technology such as
Solr or Elastic Search.  In these cases the way you work with and manage
the graph and the way that query results are retuned will vary.</p>
</div>
<div class="paragraph">
<p>In some cases data returned will be in the form of a GraphSON (JSON) in others it
might be as variables within a program. There are also ways to work with graphs using
Gremlin from a Python Notebook. You might setup your own on-premise graph system or
you might use a hosted service like IBM Graph. It&#8217;s quite possible you might still
wish to connect to a remote graph using Gremlin Server via the Gremlin Console but
you just as likely could use <em>curl</em> or some other HTTP/REST type of technology. So
that is a long winded way of saying that once you move beyond the basics and head
towards putting a system into production, there are a lot of options to consider.</p>
</div>
<div class="paragraph">
<p>In this section you will a selection of examples from these more sophisticated
environments. The purpose of this document thus far has been to teach Gremlin using
the Gremlin Console and TinkerGraph as our learning environment. However, it would be
remiss to end our discussion without at least touching on some of these other
environments, how you might configure them and why you might use them.</p>
</div>
<div class="sect2">
<h3 id="javatinker">6.1. Working with TinkerGraph from Java Application</h3>
<div class="paragraph">
<p>So far in this document we have looked at many ways of working with a TinkerGraph
from within the Gremlin Console. As you start to create more sophisticated
applications you will find that the Gremlin Console is just one to the tools you will
need to have available in your toolbox. It is very likely, if not certain, that you
will want to write stand alone applications that can work with a graph. There are a
number of different language bindings currently available for TinkerPop 3. One of the
most widely used is the Java API for TinkerPop.</p>
</div>
<div class="paragraph">
<p>In reality, for a commercial application you would not use TinkerGraph as your graph
database. However, as a first step towards writing stand alone applications that use
different graph database back ends, lets look at a few examples of how you can create
a stand alone Java application that uses Gremlin and TinkerGraph.</p>
</div>
<div class="sect3">
<h4 id="tpinterfaces">6.1.1. The Apache TinkerPop interfaces and classes</h4>
<div class="paragraph">
<p>There are a number of Java interfaces and classes, defined by the Apache TinkerPop
project, that you will want to become familiar with. The most recent JavaDoc format
API documentation is always available at <a href="http://tinkerpop.apache.org/javadocs/current/full" class="bare">http://tinkerpop.apache.org/javadocs/current/full</a></p>
</div>
<div class="paragraph">
<p>The JavaDoc is a bit lacking in terms of English prose but is still a useful source
of reference information when it comes to methods, parameters and types.</p>
</div>
<div class="paragraph">
<p>When using the Gremlin Console your environment is pre-configured for you so you do
not have to import any classes or interfaces. However, as soon as you move to the
domain of the stand alone Java application you will need to start importing the
relevant classes that your application builds upon.</p>
</div>
<div class="paragraph">
<p>By way of a reasonable start, here are some imports that will enable us to do a
number of Gremlin tasks from a Java application. As you add more capabilities to your
application you will of course need to add the appropriate import statements.</p>
</div>
<div class="paragraph">
<p>Take particular note of the rather odd import of the class called "__"
(underscore underscore) on the second line. This is required to enable calling
methods such as <em>in()</em> and <em>out()</em> in a traversal where there is no prior step
to "dot" attach them to (such as inside of a <em>repeat</em> step). If you prefer you
can statically import the "__" class it which will make explicit use of
".__" in your code unnecessary except where you are faced with reserved
word conflicts as discussed earlier in this document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.GraphTraversalSource</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.__</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.process.traversal.Path</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.process.traversal.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.structure.Edge</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.structure.Vertex</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.structure.io.IoCore</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.tinkergraph.structure.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.IOException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.List</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.ArrayList</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Map</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Set</span><span class="tok-o">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="javatp1">6.1.2. Writing our first TinkerPop Java program</h4>
<div class="paragraph">
<p>Now that we have some imports in place, we can start to craft the basic outline of a
Java application. The code below defines a class called <em>GraphTest</em>, and defines a
<em>main</em> method that creates an in memory TinkerGraph and loads the air routes GraphML
data.  Note that as we are now going to be running as a Java program we have to catch
exceptions. This is another thing that is hidden from you when you are working within
the Gremlin Console. Lastly in this initial class definition we create a
<em>GraphTraversalSource</em> and we make a Gremlin query to get the property <em>valueMap</em> for
the Austin airport node and print it. The <em>toString</em> method provided by the <em>Map</em>
should give us some useful output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">GraphTest</span>
<span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span>
  <span class="tok-o">{</span>
    <span class="tok-n">TinkerGraph</span> <span class="tok-n">tg</span> <span class="tok-o">=</span> <span class="tok-n">TinkerGraph</span><span class="tok-o">.</span><span class="tok-na">open</span><span class="tok-o">()</span> <span class="tok-o">;</span>

    <span class="tok-k">try</span>
    <span class="tok-o">{</span>
      <span class="tok-n">tg</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">(</span><span class="tok-n">IoCore</span><span class="tok-o">.</span><span class="tok-na">graphml</span><span class="tok-o">()).</span><span class="tok-na">readGraph</span><span class="tok-o">(</span><span class="tok-s">&quot;./air-routes.graphml&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">IOException</span> <span class="tok-n">e</span> <span class="tok-o">)</span>
    <span class="tok-o">{</span>
      <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;File not found&quot;</span><span class="tok-o">);</span>
      <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">exit</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-n">GraphTraversalSource</span> <span class="tok-n">g</span> <span class="tok-o">=</span> <span class="tok-n">tg</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">();</span>
    <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,?&gt;</span> <span class="tok-n">aus</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;AUS&quot;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">();</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">aus</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compiling_our_code">6.1.3. Compiling our code</h4>
<div class="paragraph">
<p>Before we can test our program we of course need to compile it. The easiest way to do
this while experimenting is to setup the Java <em>classpath</em> to include the TinkerPop JAR
files. Once you get into writing bigger solutions you will most likely be using a
tool like Apache Maven to control your build. For the purpose of our experiments
here, simple use of the <em>classpath</em> will suffice.</p>
</div>
<div class="paragraph">
<p>The following lines of Bash shell script will setup what you need to both build and
run our small test program. Note that the <em>GREMLIN</em> variable should be set to point
to the root directory of wherever your TinkerPop JAR files are. Later when we start
using Janus graph you will see that rather than TinkerGraph we will need to adjust
these settings to point to the Janus Graph JAR files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Root directory for Gremlin Console install
GREMLIN=...

# Path to Gremlin core JARs
LIBPATH=$GREMLIN/lib/*

# Path to TinkerGraph JARs
EXTPATH=$GREMLIN/ext/*

#Path to additional JARs
ADDL=$GREMLIN/ext/tinkergraph-gremlin/lib/*

# Classpath
export CP=$CLASSPATH:$LIBPATH/*:$EXTPATH/*:$ADDL


# Compile
javac -cp $CP GraphTest.java</pre>
</div>
</div>
<div class="paragraph">
<p>Assuming everything we have coded so far compiled OK, then we can run it using the
same <em>classpath</em> that we created previously.
the following output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Run
java -cp $CP GraphTest</pre>
</div>
</div>
<div class="paragraph">
<p>The output we get back should look something like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">{</span><span class="tok-n">country</span><span class="tok-o">=[</span><span class="tok-n">US</span><span class="tok-o">],</span> <span class="tok-n">code</span><span class="tok-o">=[</span><span class="tok-n">AUS</span><span class="tok-o">],</span> <span class="tok-n">longest</span><span class="tok-o">=[</span><span class="tok-mi">12250</span><span class="tok-o">],</span> <span class="tok-n">city</span><span class="tok-o">=[</span><span class="tok-n">Austin</span><span class="tok-o">],</span> <span class="tok-n">elev</span><span class="tok-o">=[</span><span class="tok-mi">542</span><span class="tok-o">],</span> <span class="tok-n">icao</span><span class="tok-o">=[</span><span class="tok-n">KAUS</span><span class="tok-o">],</span> <span class="tok-n">lon</span><span class="tok-o">=[-</span><span class="tok-mf">97.6698989868164</span><span class="tok-o">],</span> <span class="tok-n">type</span><span class="tok-o">=[</span><span class="tok-n">airport</span><span class="tok-o">],</span> <span class="tok-n">region</span><span class="tok-o">=[</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">],</span> <span class="tok-n">runways</span><span class="tok-o">=[</span><span class="tok-mi">2</span><span class="tok-o">],</span> <span class="tok-n">lat</span><span class="tok-o">=[</span><span class="tok-mf">30.1944999694824</span><span class="tok-o">],</span> <span class="tok-n">desc</span><span class="tok-o">=[</span><span class="tok-n">Austin</span> <span class="tok-n">Bergstrom</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span><span class="tok-o">]}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_to_our_java_program">6.1.4. Adding to our Java program</h4>
<div class="paragraph">
<p>Now that we have a basic skeleton application that compiles and runs, we can start to
add more experiments to it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">    <span class="tok-n">List</span> <span class="tok-n">city</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">List</span><span class="tok-o">)(</span><span class="tok-n">aus</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;city&quot;</span><span class="tok-o">));</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The AUS airport is in &quot;</span> <span class="tok-o">+</span> <span class="tok-n">city</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">));</span>

<span class="tok-n">The</span> <span class="tok-n">AUS</span> <span class="tok-n">airport</span> <span class="tok-n">is</span> <span class="tok-n">in</span> <span class="tok-n">Austin</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">aus</span><span class="tok-o">.</span><span class="tok-na">forEach</span><span class="tok-o">(</span> <span class="tok-o">(</span><span class="tok-n">k</span><span class="tok-o">,</span><span class="tok-n">v</span><span class="tok-o">)</span> <span class="tok-o">-&gt;</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Key: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">k</span> <span class="tok-o">+</span> <span class="tok-s">&quot;: Value: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">v</span><span class="tok-o">));</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nl">Key:</span> <span class="tok-n">country</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">]</span>
<span class="tok-nl">Key:</span> <span class="tok-n">code</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-nl">Key:</span> <span class="tok-n">longest</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-mi">12250</span><span class="tok-o">]</span>
<span class="tok-nl">Key:</span> <span class="tok-n">city</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-n">Austin</span><span class="tok-o">]</span>
<span class="tok-nl">Key:</span> <span class="tok-n">elev</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-mi">542</span><span class="tok-o">]</span>
<span class="tok-nl">Key:</span> <span class="tok-n">icao</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-n">KAUS</span><span class="tok-o">]</span>
<span class="tok-nl">Key:</span> <span class="tok-n">lon</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[-</span><span class="tok-mf">97.6698989868164</span><span class="tok-o">]</span>
<span class="tok-nl">Key:</span> <span class="tok-n">type</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-n">airport</span><span class="tok-o">]</span>
<span class="tok-nl">Key:</span> <span class="tok-n">region</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">]</span>
<span class="tok-nl">Key:</span> <span class="tok-n">runways</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span>
<span class="tok-nl">Key:</span> <span class="tok-n">lat</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-mf">30.1944999694824</span><span class="tok-o">]</span>
<span class="tok-nl">Key:</span> <span class="tok-n">desc</span><span class="tok-o">:</span> <span class="tok-n">Value</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-n">Austin</span> <span class="tok-n">Bergstrom</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"> <span class="tok-n">Long</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;DFW&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">();</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;There are &quot;</span> <span class="tok-o">+</span> <span class="tok-n">n</span> <span class="tok-o">+</span> <span class="tok-s">&quot; routes from Dallas&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">    <span class="tok-n">List</span> <span class="tok-n">fromAus</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;AUS&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s">&quot;code&quot;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">());</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">fromAus</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-n">FRA</span><span class="tok-o">,</span> <span class="tok-n">MEX</span><span class="tok-o">,</span> <span class="tok-n">PHX</span><span class="tok-o">,</span> <span class="tok-n">PIT</span><span class="tok-o">,</span> <span class="tok-n">RDU</span><span class="tok-o">,</span> <span class="tok-n">PDX</span><span class="tok-o">,</span> <span class="tok-n">SEA</span><span class="tok-o">,</span> <span class="tok-n">CLT</span><span class="tok-o">,</span> <span class="tok-n">SFO</span><span class="tok-o">,</span> <span class="tok-n">CUN</span><span class="tok-o">,</span> <span class="tok-n">SJC</span><span class="tok-o">,</span> <span class="tok-n">MEM</span><span class="tok-o">,</span> <span class="tok-n">JFK</span><span class="tok-o">,</span> <span class="tok-n">LAX</span><span class="tok-o">,</span> <span class="tok-n">MCO</span><span class="tok-o">,</span> <span class="tok-n">YYZ</span><span class="tok-o">,</span> <span class="tok-n">MIA</span><span class="tok-o">,</span> <span class="tok-n">MSP</span><span class="tok-o">,</span> <span class="tok-n">ORD</span><span class="tok-o">,</span> <span class="tok-n">DAL</span><span class="tok-o">,</span> <span class="tok-n">STL</span><span class="tok-o">,</span> <span class="tok-n">LAS</span><span class="tok-o">,</span> <span class="tok-n">ABQ</span><span class="tok-o">,</span> <span class="tok-n">DEN</span><span class="tok-o">,</span> <span class="tok-n">MDW</span><span class="tok-o">,</span> <span class="tok-n">MSY</span><span class="tok-o">,</span> <span class="tok-n">LBB</span><span class="tok-o">,</span> <span class="tok-n">EWR</span><span class="tok-o">,</span> <span class="tok-n">HRL</span><span class="tok-o">,</span> <span class="tok-n">HOU</span><span class="tok-o">,</span> <span class="tok-n">GDL</span><span class="tok-o">,</span> <span class="tok-n">ELP</span><span class="tok-o">,</span> <span class="tok-n">PNS</span><span class="tok-o">,</span> <span class="tok-n">MCI</span><span class="tok-o">,</span> <span class="tok-n">TPA</span><span class="tok-o">,</span> <span class="tok-n">CVG</span><span class="tok-o">,</span> <span class="tok-n">SAN</span><span class="tok-o">,</span> <span class="tok-n">IND</span><span class="tok-o">,</span> <span class="tok-n">LGB</span><span class="tok-o">,</span> <span class="tok-n">SNA</span><span class="tok-o">,</span> <span class="tok-n">SLC</span><span class="tok-o">,</span> <span class="tok-n">PIE</span><span class="tok-o">,</span> <span class="tok-n">SFB</span><span class="tok-o">,</span> <span class="tok-n">BKG</span><span class="tok-o">,</span> <span class="tok-n">CLE</span><span class="tok-o">,</span> <span class="tok-n">VPS</span><span class="tok-o">,</span> <span class="tok-n">OAK</span><span class="tok-o">,</span> <span class="tok-n">PHL</span><span class="tok-o">,</span> <span class="tok-n">DTW</span><span class="tok-o">,</span> <span class="tok-n">DFW</span><span class="tok-o">,</span> <span class="tok-n">FLL</span><span class="tok-o">,</span> <span class="tok-n">IAD</span><span class="tok-o">,</span> <span class="tok-n">IAH</span><span class="tok-o">,</span> <span class="tok-n">ATL</span><span class="tok-o">,</span> <span class="tok-n">BNA</span><span class="tok-o">,</span> <span class="tok-n">BOS</span><span class="tok-o">,</span> <span class="tok-n">BWI</span><span class="tok-o">,</span> <span class="tok-n">DCA</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">    <span class="tok-n">List</span> <span class="tok-o">&lt;</span><span class="tok-n">Path</span><span class="tok-o">&gt;</span> <span class="tok-n">lhrToUsa</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;LHR&quot;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span>
                                 <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s">&quot;country&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;US&quot;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">).</span>
                                 <span class="tok-n">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s">&quot;code&quot;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s">&quot;dist&quot;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">();</span>

    <span class="tok-n">lhrToUsa</span><span class="tok-o">.</span><span class="tok-na">forEach</span><span class="tok-o">((</span><span class="tok-n">k</span><span class="tok-o">)</span> <span class="tok-o">-&gt;</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">k</span><span class="tok-o">));</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">3860</span><span class="tok-o">,</span> <span class="tok-n">RDU</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4783</span><span class="tok-o">,</span> <span class="tok-n">SEA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">3939</span><span class="tok-o">,</span> <span class="tok-n">ORD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">5255</span><span class="tok-o">,</span> <span class="tok-n">PHX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">5350</span><span class="tok-o">,</span> <span class="tok-n">SFO</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">    <span class="tok-n">ArrayList</span> <span class="tok-o">&lt;</span><span class="tok-n">Path</span><span class="tok-o">&gt;</span> <span class="tok-n">routes</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;&gt;();</span>
    <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;SAT&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s">&quot;icao&quot;</span><span class="tok-o">).</span><span class="tok-na">fill</span><span class="tok-o">(</span><span class="tok-n">routes</span><span class="tok-o">);</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">routes</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">[[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">CYYZ</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KCLT</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KELP</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">MMMX</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KEWR</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KHOU</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KMIA</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KMSP</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KORD</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KSEA</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KSFO</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KSAN</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KLAS</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KDEN</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KSTL</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KHRL</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KMDW</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">MMGL</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">MMMY</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">MMTO</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KSFB</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KJFK</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KLAX</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KMCO</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KPHL</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KMEM</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KDTW</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">MMUN</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KATL</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KDAL</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KBNA</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KMCI</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KBWI</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KDFW</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KIAD</span><span class="tok-o">],</span> <span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KIAH</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">    <span class="tok-n">Vertex</span> <span class="tok-n">v</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;FRA&quot;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">();</span>
    <span class="tok-n">Set</span> <span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-n">v</span><span class="tok-o">.</span><span class="tok-na">keys</span><span class="tok-o">();</span>
    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">k</span> <span class="tok-o">:</span> <span class="tok-n">s</span><span class="tok-o">)</span>
    <span class="tok-o">{</span>
      <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">k</span> <span class="tok-o">+</span> <span class="tok-s">&quot;\t: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">v</span><span class="tok-o">.</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-n">k</span><span class="tok-o">).</span><span class="tok-na">value</span><span class="tok-o">());</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">country</span> <span class="tok-o">:</span> <span class="tok-n">DE</span>
<span class="tok-n">code</span>    <span class="tok-o">:</span> <span class="tok-n">FRA</span>
<span class="tok-n">longest</span> <span class="tok-o">:</span> <span class="tok-mi">13123</span>
<span class="tok-n">city</span>    <span class="tok-o">:</span> <span class="tok-n">Frankfurt</span>
<span class="tok-n">elev</span>    <span class="tok-o">:</span> <span class="tok-mi">364</span>
<span class="tok-n">icao</span>    <span class="tok-o">:</span> <span class="tok-n">EDDF</span>
<span class="tok-n">lon</span>     <span class="tok-o">:</span> <span class="tok-mf">8.54312992096</span>
<span class="tok-n">type</span>    <span class="tok-o">:</span> <span class="tok-n">airport</span>
<span class="tok-n">region</span>  <span class="tok-o">:</span> <span class="tok-n">DE</span><span class="tok-o">-</span><span class="tok-n">HE</span>
<span class="tok-n">runways</span> <span class="tok-o">:</span> <span class="tok-mi">4</span>
<span class="tok-n">lat</span>     <span class="tok-o">:</span> <span class="tok-mf">50.0264015198</span>
<span class="tok-n">desc</span>    <span class="tok-o">:</span> <span class="tok-n">Frankfurt</span> <span class="tok-n">am</span> <span class="tok-n">Main</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">List</span> <span class="tok-n">eng</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;AUS&quot;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">()).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">).</span>
               <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s">&quot;region&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;GB-ENG&quot;</span><span class="tok-o">).</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s">&quot;code&quot;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">();</span>

<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">eng</span><span class="tok-o">);</span>

<span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-n">MAN</span><span class="tok-o">,</span> <span class="tok-n">LBA</span><span class="tok-o">,</span> <span class="tok-n">NCL</span><span class="tok-o">,</span> <span class="tok-n">LCY</span><span class="tok-o">,</span> <span class="tok-n">BHX</span><span class="tok-o">,</span> <span class="tok-n">BRS</span><span class="tok-o">,</span> <span class="tok-n">STN</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="groovyapp">6.2. Working with TinkerGraph from a Groovy application</h3>
<div class="paragraph">
<p>Earlier in this document, in the "<a href="#grv">Making Gremlin even Groovier</a>" section we explored the ways that you can
use Groovy code within the Gremlin Console. However, we have not yet looked at how
you can use a stand alone Groovy application to work with a TinkerGraph.</p>
</div>
<div class="paragraph">
<p>In this section we will rewrite the application we coded in Java above in Groovy. It
is assumed that you have downloaded and installed Groovy for your environment and
have set the PATH to point to wherever the Groovy binaries are located.  Just as in
the Java example, the first thing we need to do is pull in via <em>import</em> all of the
TinkerPop 3 classes that our program will use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.GraphTraversalSource</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.__</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.process.traversal.Path</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.process.traversal.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.structure.Edge</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.structure.Vertex</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.structure.io.IoCore</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.tinkergraph.structure.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.tinkerpop.gremlin.util.Gremlin</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.IOException</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Having imported the classes we need, we can make a start on our application.
Initially we are just going to display the version of TinkerPop that we are using.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">println</span> <span class="tok-s2">&quot;Gremlin version is ${Gremlin.version()}&quot;</span>

<span class="tok-kt">def</span> <span class="tok-n">tg</span> <span class="tok-o">=</span> <span class="tok-n">TinkerGraph</span><span class="tok-o">.</span><span class="tok-na">open</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are now ready to create a new TinkerGraph instance and try to load the air routes
graph. We can do this in Groovy just like we did in the Java example.  Unlike Java,
however, Groovy does not require you to catch exceptions that may get thrown but as a
best practice it is probably a good idea to still do so when you need to take some
specific action if an exception does happen. Assuming we did not get an exception we
can go ahead and create our graph traversal object</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">println</span> <span class="tok-s2">&quot;Loading the air-routes graph...\n&quot;</span>

<span class="tok-k">try</span>
<span class="tok-o">{</span>
  <span class="tok-n">tg</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">(</span><span class="tok-n">IoCore</span><span class="tok-o">.</span><span class="tok-na">graphml</span><span class="tok-o">()).</span><span class="tok-na">readGraph</span><span class="tok-o">(</span><span class="tok-s2">&quot;/Users/kelvin/krl/code/graph/air-routes.graphml&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span>
<span class="tok-o">{</span>
  <span class="tok-n">println</span> <span class="tok-s2">&quot;Could not load the graph file&quot;</span>
  <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">exit</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">g</span> <span class="tok-o">=</span> <span class="tok-n">tg</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">()</span>

<span class="tok-kt">def</span> <span class="tok-n">aus</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-n">println</span> <span class="tok-n">aus</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that just as when we were looking at the Java application, you need to terminate
your query with a step such as <em>next</em>, <em>toList</em> or <em>fill</em> to make sure you get back
the results that you expect.</p>
</div>
<div class="sect3">
<h4 id="groovyc">6.2.1. Compiling our Groovy application</h4>
<div class="paragraph">
<p>In the Java example, included the CLASSPATH on the <em>javac</em> invokation using the <em>-cp</em>
flag. That can also be done when using Groovy, however, if you are using Microsoft
Windows as your build environment you may find that using <em>-cp</em> gives unexpected
errors.  Therefore, it is recommended to define the CLASSPATH variable in your
environment before running the Groovy compiler.</p>
</div>
<div class="paragraph">
<p>The commands below work in a Bash shell but could be easily ported to other
environments. The GREMLIN variable should point to wherever you have installed and
unzipped the Gremlin Console download</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Root directory for Gremlin Console install
GREMLIN=...

# Path to Gremlin core JARs
LIBPATH=$GREMLIN/lib/*

# Path to TinkerGraph JARs
EXTPATH=$GREMLIN/ext/*

#Path to additional JARs
ADDL=$GREMLIN/ext/tinkergraph-gremlin/lib/*

# Classpath
export CLASSPATH=$CLASSPATH:$LIBPATH/*:$EXTPATH/*:$ADDL

# Compile
groovyc GraphTest.groovy</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_our_groovy_application">6.2.2. Running our Groovy application</h4>
<div class="paragraph">
<p>Assuming everything compiled cleanly we can now run our Groovy application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">groovy</span> <span class="tok-n">GraphTest</span>

<span class="tok-n">Gremlin</span> <span class="tok-n">version</span> <span class="tok-n">is</span> <span class="tok-mf">3.2</span><span class="tok-o">.</span><span class="tok-mi">4</span>
<span class="tok-n">Loading</span> <span class="tok-n">the</span> <span class="tok-n">air</span><span class="tok-o">-</span><span class="tok-n">routes</span> <span class="tok-n">graph</span><span class="tok-o">...</span>

<span class="tok-o">[</span><span class="tok-nl">country:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">],</span> <span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">AUS</span><span class="tok-o">],</span> <span class="tok-nl">longest:</span><span class="tok-o">[</span><span class="tok-mi">12250</span><span class="tok-o">],</span> <span class="tok-nl">city:</span><span class="tok-o">[</span><span class="tok-n">Austin</span><span class="tok-o">],</span> <span class="tok-nl">elev:</span><span class="tok-o">[</span><span class="tok-mi">542</span><span class="tok-o">],</span> <span class="tok-nl">icao:</span><span class="tok-o">[</span><span class="tok-n">KAUS</span><span class="tok-o">],</span> <span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">97.6698989868164</span><span class="tok-o">],</span> <span class="tok-nl">type:</span><span class="tok-o">[</span><span class="tok-n">airport</span><span class="tok-o">],</span> <span class="tok-nl">region:</span><span class="tok-o">[</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span><span class="tok-o">],</span> <span class="tok-nl">runways:</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">],</span> <span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">30.1944999694824</span><span class="tok-o">],</span> <span class="tok-nl">desc:</span><span class="tok-o">[</span><span class="tok-n">Austin</span> <span class="tok-n">Bergstrom</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_to_our_groovy_application">6.2.3. Adding to our Groovy application</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">city</span> <span class="tok-o">=</span> <span class="tok-n">aus</span><span class="tok-o">[</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">]</span>
<span class="tok-n">println</span> <span class="tok-s2">&quot;\nThe AUS airport is in ${city[0]}\n&quot;</span>

<span class="tok-n">aus</span><span class="tok-o">.</span><span class="tok-na">each</span> <span class="tok-o">{</span><span class="tok-n">println</span> <span class="tok-s2">&quot;${it.key} : ${it.value[0]}&quot;</span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">The</span> <span class="tok-n">AUS</span> <span class="tok-n">airport</span> <span class="tok-n">is</span> <span class="tok-k">in</span> <span class="tok-n">Austin</span>

<span class="tok-n">country</span> <span class="tok-o">:</span> <span class="tok-n">US</span>
<span class="tok-n">code</span> <span class="tok-o">:</span> <span class="tok-n">AUS</span>
<span class="tok-n">longest</span> <span class="tok-o">:</span> <span class="tok-mi">12250</span>
<span class="tok-n">city</span> <span class="tok-o">:</span> <span class="tok-n">Austin</span>
<span class="tok-n">elev</span> <span class="tok-o">:</span> <span class="tok-mi">542</span>
<span class="tok-n">icao</span> <span class="tok-o">:</span> <span class="tok-n">KAUS</span>
<span class="tok-n">lon</span> <span class="tok-o">:</span> <span class="tok-o">-</span><span class="tok-mf">97.6698989868164</span>
<span class="tok-n">type</span> <span class="tok-o">:</span> <span class="tok-n">airport</span>
<span class="tok-n">region</span> <span class="tok-o">:</span> <span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span>
<span class="tok-n">runways</span> <span class="tok-o">:</span> <span class="tok-mi">2</span>
<span class="tok-n">lat</span> <span class="tok-o">:</span> <span class="tok-mf">30.1944999694824</span>
<span class="tok-n">desc</span> <span class="tok-o">:</span> <span class="tok-n">Austin</span> <span class="tok-n">Bergstrom</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;DFW&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span>
<span class="tok-n">println</span> <span class="tok-s2">&quot;\nThere are  ${n} routes from Dallas&quot;</span>

<span class="tok-n">There</span> <span class="tok-n">are</span>  <span class="tok-mi">221</span> <span class="tok-n">routes</span> <span class="tok-n">from</span> <span class="tok-n">Dallas</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">fromAus</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;AUS&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">()</span>
<span class="tok-n">println</span> <span class="tok-s2">&quot;\nHere are the places you can fly to from Austin\n&quot;</span>
<span class="tok-n">println</span> <span class="tok-n">fromAus</span>

<span class="tok-o">[</span><span class="tok-n">YYZ</span><span class="tok-o">,</span> <span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-n">FRA</span><span class="tok-o">,</span> <span class="tok-n">MEX</span><span class="tok-o">,</span> <span class="tok-n">PIT</span><span class="tok-o">,</span> <span class="tok-n">PDX</span><span class="tok-o">,</span> <span class="tok-n">CLT</span><span class="tok-o">,</span> <span class="tok-n">CUN</span><span class="tok-o">,</span> <span class="tok-n">MEM</span><span class="tok-o">,</span> <span class="tok-n">CVG</span><span class="tok-o">,</span> <span class="tok-n">IND</span><span class="tok-o">,</span> <span class="tok-n">MCI</span><span class="tok-o">,</span> <span class="tok-n">DAL</span><span class="tok-o">,</span> <span class="tok-n">STL</span><span class="tok-o">,</span> <span class="tok-n">ABQ</span><span class="tok-o">,</span> <span class="tok-n">MDW</span><span class="tok-o">,</span> <span class="tok-n">LBB</span><span class="tok-o">,</span> <span class="tok-n">HRL</span><span class="tok-o">,</span> <span class="tok-n">GDL</span><span class="tok-o">,</span> <span class="tok-n">PNS</span><span class="tok-o">,</span> <span class="tok-n">VPS</span><span class="tok-o">,</span> <span class="tok-n">SFB</span><span class="tok-o">,</span> <span class="tok-n">BKG</span><span class="tok-o">,</span> <span class="tok-n">PIE</span><span class="tok-o">,</span> <span class="tok-n">ATL</span><span class="tok-o">,</span> <span class="tok-n">BNA</span><span class="tok-o">,</span> <span class="tok-n">BOS</span><span class="tok-o">,</span> <span class="tok-n">BWI</span><span class="tok-o">,</span> <span class="tok-n">DCA</span><span class="tok-o">,</span> <span class="tok-n">DFW</span><span class="tok-o">,</span> <span class="tok-n">FLL</span><span class="tok-o">,</span> <span class="tok-n">IAD</span><span class="tok-o">,</span> <span class="tok-n">IAH</span><span class="tok-o">,</span> <span class="tok-n">JFK</span><span class="tok-o">,</span> <span class="tok-n">LAX</span><span class="tok-o">,</span> <span class="tok-n">MCO</span><span class="tok-o">,</span> <span class="tok-n">MIA</span><span class="tok-o">,</span> <span class="tok-n">MSP</span><span class="tok-o">,</span> <span class="tok-n">ORD</span><span class="tok-o">,</span> <span class="tok-n">PHX</span><span class="tok-o">,</span> <span class="tok-n">RDU</span><span class="tok-o">,</span> <span class="tok-n">SEA</span><span class="tok-o">,</span> <span class="tok-n">SFO</span><span class="tok-o">,</span> <span class="tok-n">SJC</span><span class="tok-o">,</span> <span class="tok-n">TPA</span><span class="tok-o">,</span> <span class="tok-n">SAN</span><span class="tok-o">,</span> <span class="tok-n">LGB</span><span class="tok-o">,</span> <span class="tok-n">SNA</span><span class="tok-o">,</span> <span class="tok-n">SLC</span><span class="tok-o">,</span> <span class="tok-n">LAS</span><span class="tok-o">,</span> <span class="tok-n">DEN</span><span class="tok-o">,</span> <span class="tok-n">MSY</span><span class="tok-o">,</span> <span class="tok-n">EWR</span><span class="tok-o">,</span> <span class="tok-n">HOU</span><span class="tok-o">,</span> <span class="tok-n">ELP</span><span class="tok-o">,</span> <span class="tok-n">CLE</span><span class="tok-o">,</span> <span class="tok-n">OAK</span><span class="tok-o">,</span> <span class="tok-n">PHL</span><span class="tok-o">,</span> <span class="tok-n">DTW</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">lhrToUsa</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;LHR&quot;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span>
                     <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s2">&quot;country&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;US&quot;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span>
                     <span class="tok-n">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s2">&quot;dist&quot;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">()</span>

<span class="tok-n">println</span> <span class="tok-s2">&quot;\nFrom LHR to airports in the USA (only 10 shown)\n&quot;</span>
<span class="tok-n">lhrToUsa</span><span class="tok-o">.</span><span class="tok-na">each</span> <span class="tok-o">{</span><span class="tok-n">println</span> <span class="tok-n">it</span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">From</span> <span class="tok-n">LHR</span> <span class="tok-n">to</span> <span class="tok-n">airports</span> <span class="tok-k">in</span> <span class="tok-n">the</span> <span class="tok-nf">USA</span> <span class="tok-o">(</span><span class="tok-n">only</span> <span class="tok-mi">10</span> <span class="tok-n">shown</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4896</span><span class="tok-o">,</span> <span class="tok-n">PDX</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">3980</span><span class="tok-o">,</span> <span class="tok-n">CLT</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4198</span><span class="tok-o">,</span> <span class="tok-n">ATL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4901</span><span class="tok-o">,</span> <span class="tok-n">AUS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">3254</span><span class="tok-o">,</span> <span class="tok-n">BOS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">3622</span><span class="tok-o">,</span> <span class="tok-n">BWI</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4736</span><span class="tok-o">,</span> <span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">3665</span><span class="tok-o">,</span> <span class="tok-n">IAD</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">4820</span><span class="tok-o">,</span> <span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-mi">3440</span><span class="tok-o">,</span> <span class="tok-n">JFK</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">routes</span> <span class="tok-o">=</span> <span class="tok-o">[]</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;SAT&quot;</span><span class="tok-o">).</span><span class="tok-na">out</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s2">&quot;icao&quot;</span><span class="tok-o">).</span><span class="tok-na">limit</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">fill</span><span class="tok-o">(</span><span class="tok-n">routes</span><span class="tok-o">);</span>
<span class="tok-n">println</span> <span class="tok-s2">&quot;\nRoutes from San Antonio (only 10 shown)\n&quot;</span>
<span class="tok-n">routes</span><span class="tok-o">.</span><span class="tok-na">each</span> <span class="tok-o">{</span><span class="tok-n">println</span> <span class="tok-n">it</span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Routes</span> <span class="tok-n">from</span> <span class="tok-n">San</span> <span class="tok-nf">Antonio</span> <span class="tok-o">(</span><span class="tok-n">only</span> <span class="tok-mi">10</span> <span class="tok-n">shown</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KHRL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">MMMY</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">MMGL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KATL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KSFB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KBNA</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">MMTO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KBWI</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KDFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">KSAT</span><span class="tok-o">,</span> <span class="tok-n">KIAD</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">v</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;FRA&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>
<span class="tok-n">println</span> <span class="tok-s2">&quot;\nKeys found in the FRA vertex&quot;</span>
<span class="tok-n">println</span> <span class="tok-n">v</span><span class="tok-o">.</span><span class="tok-na">keys</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Keys</span> <span class="tok-n">found</span> <span class="tok-k">in</span> <span class="tok-n">the</span> <span class="tok-n">FRA</span> <span class="tok-n">vertex</span>

<span class="tok-o">[</span><span class="tok-n">country</span><span class="tok-o">,</span> <span class="tok-n">code</span><span class="tok-o">,</span> <span class="tok-n">longest</span><span class="tok-o">,</span> <span class="tok-n">city</span><span class="tok-o">,</span> <span class="tok-n">elev</span><span class="tok-o">,</span> <span class="tok-n">icao</span><span class="tok-o">,</span> <span class="tok-n">lon</span><span class="tok-o">,</span> <span class="tok-n">type</span><span class="tok-o">,</span> <span class="tok-n">region</span><span class="tok-o">,</span> <span class="tok-n">runways</span><span class="tok-o">,</span> <span class="tok-n">lat</span><span class="tok-o">,</span> <span class="tok-n">desc</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">eng</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;AUS&quot;</span><span class="tok-o">).</span><span class="tok-na">repeat</span><span class="tok-o">(</span><span class="tok-n">__</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">()).</span><span class="tok-na">times</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">).</span>
                <span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s2">&quot;region&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;GB-ENG&quot;</span><span class="tok-o">).</span><span class="tok-na">dedup</span><span class="tok-o">().</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">();</span>

<span class="tok-n">println</span> <span class="tok-s2">&quot;\nAirports in England reachable with no more than one stop from AUS&quot;</span>
<span class="tok-n">println</span> <span class="tok-s2">&quot;\n${eng}\n&quot;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Airports</span> <span class="tok-k">in</span> <span class="tok-n">England</span> <span class="tok-n">reachable</span> <span class="tok-n">with</span> <span class="tok-n">no</span> <span class="tok-n">more</span> <span class="tok-n">than</span> <span class="tok-n">one</span> <span class="tok-n">stop</span> <span class="tok-n">from</span> <span class="tok-n">AUS</span>

<span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">,</span> <span class="tok-n">LGW</span><span class="tok-o">,</span> <span class="tok-n">MAN</span><span class="tok-o">,</span> <span class="tok-n">LBA</span><span class="tok-o">,</span> <span class="tok-n">NCL</span><span class="tok-o">,</span> <span class="tok-n">LCY</span><span class="tok-o">,</span> <span class="tok-n">BRS</span><span class="tok-o">,</span> <span class="tok-n">BHX</span><span class="tok-o">,</span> <span class="tok-n">STN</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="janusintro">6.3. Introducing Janus Graph</h3>
<div class="paragraph">
<p>So far we have been using the TinkerGraph graph that is included with Apache
TinkerPop in our examples. Once you move beyond learning about Gremlin and its
related technologies and moving towards a production deployment, you will need a
graph store that provides capabilities such as reliable persistence, the ability to
define schemas and support for ACID transactions. The Janus Graph project, which
began in 2016 as an open source fork of the popular Titan graph database, is hosted by
the Linux Foundation and provides these advanced capabilities.</p>
</div>
<div class="paragraph">
<p>Janus Graph can run on a laptop, which is useful for learning and experimenting, but
it is designed to handle very large graphs stored on distributed clusters. It can
handle graphs containing billions of nodes and edges. As we shall discuss, Janus
graph is designed to work with a variety of persistent storage options including
Apache Cassandra and Apache HBase as well as indexing technology such as Apache Solr
and Apache Elastic Search.</p>
</div>
<div class="dlist">
<div class="title">Here are some useful Janus Graph resources</div>
<dl>
<dt class="hdlist1">Runtime download (JAR files and more)</dt>
<dd>
<p><a href="http://janusgraph.org/" class="bare">http://janusgraph.org/</a></p>
</dd>
<dt class="hdlist1">Documentation</dt>
<dd>
<p><a href="http://docs.janusgraph.org/latest/" class="bare">http://docs.janusgraph.org/latest/</a>.</p>
</dd>
<dt class="hdlist1">API Documentation</dt>
<dd>
<p><a href="https://javadoc.io/doc/org.janusgraph/janusgraph-core/0.1.1" class="bare">https://javadoc.io/doc/org.janusgraph/janusgraph-core/0.1.1</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In the following sections we will take an in depth look at Janus Graph and other
technologies that, when combined, provide a way to build and deploy a massively
scalable graph database solution. We will start by quickly looking at how to install
Janus Graph and access it from the Gremlin Console before getting into more advanced
topics including how to create and manage both schemas and indexes and how to use the
transactional capabilities provided by Janus Graph.</p>
</div>
<div class="sect3">
<h4 id="janusinstall">6.3.1. Installing Janus Graph</h4>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
<div class="sect3">
<h4 id="janusconsole">6.3.2. Using Janus Graph from the Gremlin Console</h4>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
<div class="sect3">
<h4 id="janusinmemory">6.3.3. Using Janus Graph with the <em>inmemory</em> option</h4>
<div class="paragraph">
<p>For almost all production use cases, you will be using Janus Graph along with a
persistent back end store such as Apache Cassandra or Apache HBase. However while
experimenting with Janus graph it is incredibly useful to be able to get up and
running quickly without having to worry about configuring all of the back end storage
components.  This is made possible by the <em>inmemory</em> option that Janus Graph
provides. This essentially allows us to use Janus Graph in the same way as we have
been using TinkerGraph with all of our graph data stored in the memory of the
computer. The one big difference however is that Janus Graph, even while using the
<em>inmemory</em> storage model, allows us to experiment with features that TinkerGraph does
not offer, such as schemas and transactions.  We will get into those topics a bit
later on. First, let&#8217;s create an instance of Janus Graph from the Gremlin console
that uses the <em>inmemory</em> storage model.</p>
</div>
<div class="paragraph">
<p>Creating a Janus Graph instance is very similar to the way we created a TinkerGraph
instance earlier in the document. The only difference is that we use the
<em>JanusGraphFactory</em> to create the graph and in this case we specify <em>inmemory</em> as the
only parameter to tell Janus Graph that we want to use the all in memory storage
model. We create our graph traversal object <em>g</em> in just the same way as before.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span> <span class="tok-o">=</span> <span class="tok-n">JanusGraphFactory</span><span class="tok-o">.</span><span class="tok-na">open</span><span class="tok-o">(</span><span class="tok-s1">&#39;inmemory&#39;</span><span class="tok-o">)</span>
<span class="tok-n">g</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have a graph instance created, just like with TinkerGraph, we can query
which features the graph supports. Earlier in the document in the "<a href="#tgintro">Introducing TinkerGraph</a>"
section we looked at the features offered by TinkerGraph. If we compare those
features to what Janus Graph offers we can spot some key differences.</p>
</div>
<div class="paragraph">
<p>We can get the feature set back by calling the <em>features</em> method as shown below. The
first thing that stands out is that the various features that involve transactions
are now set to <em>true</em> indicating that Janus Graph supports transactions. We will take
a look at how to use these transactional capabilities in the next section. Note that
<em>Persistence</em> still shows as <em>false</em> as we are using the <em>inmemory</em> mode. Another
thing to note is that, unlike with TinkerGraph, <em>UserSuppliedIds</em> is set to false,
indicating that JanusGraph will create its own ID values and ignore any that we
provide. The list is formatted in two columns to aid readability.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>graph.features()

&gt; GraphFeatures                            &gt; VertexPropertyFeatures
&gt;-- Transactions: true                     &gt;-- AddProperty: true
&gt;-- Computer: true                         &gt;-- RemoveProperty: true
&gt;-- ConcurrentAccess: true                 &gt;-- NumericIds: false
&gt;-- ThreadedTransactions: true             &gt;-- StringIds: true
&gt;-- Persistence: false                     &gt;-- UuidIds: false
&gt; VariableFeatures                         &gt;-- CustomIds: true
&gt;-- Variables: true                        &gt;-- AnyIds: false
&gt;-- LongValues: true                       &gt;-- UserSuppliedIds: false
&gt;-- BooleanArrayValues: true               &gt;-- Properties: true
&gt;-- ByteArrayValues: true                  &gt;-- LongValues: true
&gt;-- DoubleArrayValues: true                &gt;-- BooleanArrayValues: true
&gt;-- FloatArrayValues: true                 &gt;-- ByteArrayValues: true
&gt;-- IntegerArrayValues: true               &gt;-- DoubleArrayValues: true
&gt;-- StringArrayValues: true                &gt;-- FloatArrayValues: true
&gt;-- LongArrayValues: true                  &gt;-- IntegerArrayValues: true
&gt;-- StringValues: true                     &gt;-- StringArrayValues: true
&gt;-- MapValues: true                        &gt;-- LongArrayValues: true
&gt;-- MixedListValues: false                 &gt;-- StringValues: true
&gt;-- SerializableValues: false              &gt;-- MapValues: true
&gt;-- UniformListValues: false               &gt;-- MixedListValues: false
&gt;-- BooleanValues: true                    &gt;-- SerializableValues: false
&gt;-- ByteValues: true                       &gt;-- UniformListValues: false
&gt;-- DoubleValues: true                     &gt;-- BooleanValues: true
&gt;-- FloatValues: true                      &gt;-- ByteValues: true
&gt;-- IntegerValues: true                    &gt;-- DoubleValues: true
&gt; VertexFeatures                           &gt;-- FloatValues: true
&gt;-- MetaProperties: true                   &gt;-- IntegerValues: true
&gt;-- AddVertices: true                      &gt; EdgePropertyFeatures
&gt;-- RemoveVertices: true                   &gt;-- Properties: true
&gt;-- MultiProperties: true                  &gt;-- LongValues: true
&gt;-- AddProperty: true                      &gt;-- BooleanArrayValues: true
&gt;-- RemoveProperty: true                   &gt;-- ByteArrayValues: true
&gt;-- NumericIds: true                       &gt;-- DoubleArrayValues: true
&gt;-- StringIds: false                       &gt;-- FloatArrayValues: true
&gt;-- UuidIds: false                         &gt;-- IntegerArrayValues: true
&gt;-- CustomIds: false                       &gt;-- StringArrayValues: true
&gt;-- AnyIds: false                          &gt;-- LongArrayValues: true
&gt;-- UserSuppliedIds: false                 &gt;-- StringValues: true
&gt; EdgeFeatures                             &gt;-- MapValues: true
&gt;-- RemoveEdges: true                      &gt;-- MixedListValues: false
&gt;-- AddEdges: true                         &gt;-- SerializableValues: false
&gt;-- AddProperty: true                      &gt;-- UniformListValues: false
&gt;-- RemoveProperty: true                   &gt;-- BooleanValues: true
&gt;-- NumericIds: false                      &gt;-- ByteValues: true
&gt;-- StringIds: false                       &gt;-- DoubleValues: true
&gt;-- UuidIds: false                         &gt;-- FloatValues: true
&gt;-- CustomIds: true                        &gt;-- IntegerValues: true
&gt;-- AnyIds: false
&gt;-- UserSuppliedIds: false</pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have an empty instance of an <em>inmemory</em> Janus Graph we can use it from
the Gremlin Console just as we did with TinkerGraph in our prior examples. Notice
that the ID values that Janus Graph generates look quite different (as in they don&#8217;t
start at zero) from what we might expect from TinkerGraph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;person&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;name&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Kelvin&#39;</span><span class="tok-o">)</span>
<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1466464</span><span class="tok-o">]</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;name&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Kelvin&#39;</span><span class="tok-o">)</span>
<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">1466464</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Before we experiment too much more with Janus Graph there are three important
subjects we need to discuss. One is transactions, another is defining a schema for
our nodes, edges and properties and the third is the Janus Graph management API. We
will cover each of these key subjects in the following sections.</p>
</div>
</div>
<div class="sect3">
<h4 id="janustrans">6.3.4. Janus Graph transactions</h4>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Start a new transaction</span>
<span class="tok-n">xyz</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">addVertex</span><span class="tok-o">()</span>

<span class="tok-c1">// Add a property</span>
<span class="tok-n">xyz</span><span class="tok-o">.</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s2">&quot;name&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;XYZ&quot;</span><span class="tok-o">)</span>

<span class="tok-c1">// Commit the transaction</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">tx</span><span class="tok-o">().</span><span class="tok-na">commit</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;name&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;XYZ&#39;</span><span class="tok-o">)</span>
<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">4344</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Start a new transaction</span>
<span class="tok-n">xyz</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">addVertex</span><span class="tok-o">()</span>

<span class="tok-c1">// Add a property</span>
<span class="tok-n">xyz</span><span class="tok-o">.</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s2">&quot;name&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;XYZ&quot;</span><span class="tok-o">)</span>

<span class="tok-c1">// Commit the transaction</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">tx</span><span class="tok-o">().</span><span class="tok-na">rollback</span><span class="tok-o">()</span>

<span class="tok-c1">// Nothing will be returned</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;XYZ&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loading_air_routes_into_a_janus_graph_instance">6.3.5. Loading air-routes into a Janus Graph instance</h4>
<div class="paragraph">
<p>We can use the same basic steps to load the air-routes graph into a Janus Graph
instance that we used with Tinkergraph. Note that after loading the graph from the
XML file we then call <em>commit</em> to finalize the transaction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">(</span><span class="tok-n">graphml</span><span class="tok-o">()).</span><span class="tok-na">readGraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;air-routes.graphml&#39;</span><span class="tok-o">)</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">tx</span><span class="tok-o">().</span><span class="tok-na">commit</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that as we have not defined a schema before loading the air-routes graph that
Janus Graph will create nodes, edges and properties using default types and settings.
A bit later we will look at creating a schema for air-routes and then loading it
again to see the differences. It is strongly recommended to create the schema before
loading the data but lets examine a few things before we discuss how to do that.</p>
</div>
<div class="paragraph">
<p>Unlike TinkerGraph, Janus Graph does not, by default,  guarantee to respect user
provided node and edge ID values. Instead it creates its own ID values as nodes and
edges are added to the graph. You may have noticed from earlier in the document or
from the air-routes.graphml file if you happened to look in there, that the ID
provided for Austin in the GraphML markup is 3. However, having loaded air-routes
into Janus Graph if we query the ID for the Austin node we can see that it is no
longer 3. There is a setting that can be changed to force Janus Graph to honor user
provided ID values but it is not recommended this be used as it will disable some
other useful Janus Graph features. If you are interested in learning more about this
option this please refer to the Janus Graph documentation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">id</span><span class="tok-o">()</span>

<span class="tok-mi">4240</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Having the graph system allocate its own ID values is not a big problem as we can
always query the graph to get the ID but it is a reminder that you should not get
into the habit of relying on any user provided ID values as you work with graphs.</p>
</div>
<div class="paragraph">
<p>If necessary, as we  discussed earlier in the document, we can always store important
ID values in a variable for later use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">ausid</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">id</span><span class="tok-o">().</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">ausid</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">).</span><span class="tok-na">join</span><span class="tok-o">(</span><span class="tok-s1">&#39;,&#39;</span><span class="tok-o">)</span>

<span class="tok-n">Austin</span> <span class="tok-n">Bergstrom</span> <span class="tok-n">International</span> <span class="tok-n">Airport</span><span class="tok-o">,</span><span class="tok-n">Austin</span><span class="tok-o">,</span><span class="tok-n">US</span><span class="tok-o">-</span><span class="tok-n">TX</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="janusmgmt">6.3.6. The Janus Graph management API</h4>
<div class="paragraph">
<p>Janus graph includes a management API that is made available via the ManagementSystem
class. You can use the management API to perform various important functions that
include querying metadata about the graph, defining the edge, vertex and property
schema types and creating and updating the index.</p>
</div>
<div class="paragraph">
<p>You can create an instance of the ManagementSystem object using the <em>openManagement</em>
method call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">mgmt</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">openManagement</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example below uses the Management API to get a list of all the vertex labels
currently defined by in graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">getVertexLabels</span><span class="tok-o">()</span>

<span class="tok-n">version</span>
<span class="tok-n">airport</span>
<span class="tok-n">country</span>
<span class="tok-n">continent</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query finds all of the currently defined edge labels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">getRelationTypes</span><span class="tok-o">(</span><span class="tok-n">EdgeLabel</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>

<span class="tok-n">route</span>
<span class="tok-n">contains</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query will find all of the currently defined property keys. Note that this
list will include both vertex and edge property key names</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">getRelationTypes</span><span class="tok-o">(</span><span class="tok-n">PropertyKey</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>

<span class="tok-n">dist</span>
<span class="tok-n">code</span>
<span class="tok-n">type</span>
<span class="tok-n">desc</span>
<span class="tok-n">country</span>
<span class="tok-n">longest</span>
<span class="tok-n">city</span>
<span class="tok-n">elev</span>
<span class="tok-n">icao</span>
<span class="tok-n">lon</span>
<span class="tok-n">region</span>
<span class="tok-n">runways</span>
<span class="tok-n">lat</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can query the cardinality of a property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">getPropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">()</span>

<span class="tok-n">SINGLE</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that as we have not so far defined a schema for the air-routes graph. if we
query the dataType for any of the already loaded properties we will get back
<em>Object.class</em> and by default that is what Janus will use in the absence of a schema
having been defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">getPropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">()</span>

<span class="tok-n">Object</span><span class="tok-o">.</span><span class="tok-na">class</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also test for the existence of a label definition in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">containsEdgeLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">)</span>

<span class="tok-kc">true</span>

<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">containsEdgeLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;travels&#39;</span><span class="tok-o">)</span>

<span class="tok-kc">false</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="janusschema">6.3.7. Defining a Janus Graph schema for air-routes</h4>
<div class="paragraph">
<p>You are not required to define the types and labels of your edges, vertices and
properties ahead of time but it is strongly recommended that you do so. If you do not
define anything and load the air routes data for example, it will work fine but Janus
Graph will make assumptions about various things. One thing it will do is default the
type of all property keys to Java&#8217;s <em>Object.class</em> which is not ideal if you want the
graph to help you enforce stricter type checking. Also, without a schema being
defined, Janus Graph will default the usage constraint or <em>multiplicity</em> setting on
all edges to <em>MULTI</em>. We will explain what that means in a minute but in essence it
means there is no restriction by default on how many edges with the same label that
can exist between two nodes.</p>
</div>
<div class="paragraph">
<p>You can use the Management API do define your schema. You can add additional property
types at any time but once defined you cannot change their types. The only thing you
can do once they have been created is to change the names of the keys.</p>
</div>
<div class="paragraph">
<p>A best practice when working with Janus Graph is to define your labels and property
types before you load any data into the graph. As the graph grows if you find you
need to add additional property types or labels you are allowed to do that.</p>
</div>
<div class="paragraph">
<p>Using the management API you can define the labels that will be used by nodes and
edges. These values must be unique across the graph. You can also define the type and
cardinality (SINGLE, LIST or SET) of each property key and for edges you can specify
the allowed usage of edges for any given label (MULTI, MANY2ONE, ONE2MANY, ONE2ONE or
SIMPLE). Property key names must also be unique across the graph.</p>
</div>
<div class="paragraph">
<p>Before we can define a schema for our edge labels we need to understand what each
option allows and decide on the best fit for each of our edge types.</p>
</div>
<div class="dlist">
<div class="title">The multiplicity options provide the following constraints:</div>
<dl>
<dt class="hdlist1">MULTI</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This is the default option if no multiplicity has been defined for an edge with
a given label. This setting permits multiple edges of the same label between any
pair of vertices. The air-routes graph uses a multiplicity of MULTI for the
<em>routes</em> edges between airports.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">SIMPLE</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This setting permits at most one edge of a given label between any pair of
vertices.  In the air-routes graph this setting is used for the edges between a
continent and an airport as an airport cannot be in more than one continent. The
same is used for the edges between airports and countries.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">MANY2ONE</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This setting permits at most one outgoing edge of a given label name from any vertex
in the graph but places no constraint on the number of incoming edges with this
label.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">ONE2MANY</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This setting permits at most one incoming edge of a given label to any vertex in the
graph but places no constraint on the number of outgoing edges</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">ONE2ONE</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This setting permits at most one incoming and one outgoing edge of a given label to
and from any vertex in the graph.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Let&#8217;s look at how we can use the Janus Graph Management API to specify the
multiplicty for the <em>route</em> and <em>contains</em> edges used by the air-routes graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Define edge labels and usage</span>
<span class="tok-n">mgmt</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">openManagement</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makeEdgeLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">multiplicity</span><span class="tok-o">(</span><span class="tok-n">MULTI</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makeEdgeLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;contains&#39;</span><span class="tok-o">).</span><span class="tok-na">multiplicity</span><span class="tok-o">(</span><span class="tok-n">SIMPLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">commit</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Define vertex labels</span>
<span class="tok-n">mgmt</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">openManagement</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makeVertexLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;version&#39;</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makeVertexLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makeVertexLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makeVertexLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;continent&#39;</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">commit</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Define vertex property keys</span>
<span class="tok-n">mgmt</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">openManagement</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;type&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;country&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;elev&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">commit</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Define edge property keys</span>
<span class="tok-n">mgmt</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">openManagement</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">Cardinality</span><span class="tok-o">.</span><span class="tok-na">SINGLE</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">commit</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Load the air routes graph</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">(</span><span class="tok-n">graphml</span><span class="tok-o">()).</span><span class="tok-na">readGraph</span><span class="tok-o">(</span><span class="tok-s1">&#39;air-routes.graphml&#39;</span><span class="tok-o">)</span>
<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">tx</span><span class="tok-o">().</span><span class="tok-na">commit</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Look at the properties</span>
<span class="tok-n">mgmt</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">openManagement</span><span class="tok-o">()</span>
<span class="tok-n">types</span> <span class="tok-o">=</span> <span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">getRelationTypes</span><span class="tok-o">(</span><span class="tok-n">PropertyKey</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-n">types</span><span class="tok-o">.</span><span class="tok-na">each</span><span class="tok-o">{</span><span class="tok-n">println</span> <span class="tok-s2">&quot;$it\t: &quot;</span> <span class="tok-o">+</span>
                    <span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">getPropertyKey</span><span class="tok-o">(</span><span class="tok-s2">&quot;$it&quot;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">()</span> <span class="tok-o">+</span>
                    <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">getPropertyKey</span><span class="tok-o">(</span><span class="tok-s2">&quot;$it&quot;</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">()}</span>

<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">commit</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">lat</span>     <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Double</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">lon</span>     <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Double</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">dist</span>    <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Integer</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">longest</span> <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Object</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">code</span>    <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">icao</span>    <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">type</span>    <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">city</span>    <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">country</span> <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">region</span>  <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">desc</span>    <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">runways</span> <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Integer</span> <span class="tok-n">SINGLE</span>
<span class="tok-n">elev</span>    <span class="tok-o">:</span> <span class="tok-kd">class</span> <span class="tok-nc">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Integer</span> <span class="tok-n">SINGLE</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cardlist">6.3.8. Creating a property with cardinality LIST</h4>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">mgmt</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">openManagement</span><span class="tok-o">()</span>
<span class="tok-n">maker</span> <span class="tok-o">=</span> <span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;mylist&#39;</span><span class="tok-o">)</span>
<span class="tok-n">maker</span><span class="tok-o">.</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-n">maker</span><span class="tok-o">.</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">LIST</span><span class="tok-o">)</span>
<span class="tok-n">maker</span><span class="tok-o">.</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">commit</span><span class="tok-o">()</span>

<span class="tok-n">mgmt</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">openManagement</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;anotherlist&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">LIST</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>

<span class="tok-n">mgmt</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">openManagement</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">getPropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;mylist&#39;</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">()</span>

<span class="tok-n">LIST</span>

<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">commit</span><span class="tok-o">()</span>

<span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-s1">&#39;mylist&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;one&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;mylist&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;two&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">3043568</span><span class="tok-o">]</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-n">list</span><span class="tok-o">,</span><span class="tok-s1">&#39;mylist&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;one&#39;</span><span class="tok-o">)</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>

<span class="tok-c1">// Duplicates allowed</span>
<span class="tok-o">[</span><span class="tok-nl">mylist:</span><span class="tok-o">[</span><span class="tok-n">one</span><span class="tok-o">,</span><span class="tok-n">one</span><span class="tok-o">,</span><span class="tok-n">two</span><span class="tok-o">]]</span>

<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">tx</span><span class="tok-o">().</span><span class="tok-na">commit</span><span class="tok-o">()</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cardset">6.3.9. Creating a property with cardinality SET</h4>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">mgmt</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">openManagement</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">makePropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;numbers&#39;</span><span class="tok-o">).</span><span class="tok-na">dataType</span><span class="tok-o">(</span><span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">(</span><span class="tok-n">SET</span><span class="tok-o">).</span><span class="tok-na">make</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">getPropertyKey</span><span class="tok-o">(</span><span class="tok-s1">&#39;numbers&#39;</span><span class="tok-o">).</span><span class="tok-na">cardinality</span><span class="tok-o">()</span>

<span class="tok-n">SET</span>

<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">commit</span><span class="tok-o">()</span>

<span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-s1">&#39;numbers&#39;</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-s1">&#39;numbers&#39;</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-s1">&#39;numbers&#39;</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">2846792</span><span class="tok-o">]</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-nl">numbers:</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">]]</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-n">set</span><span class="tok-o">,</span><span class="tok-s1">&#39;numbers&#39;</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">)</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>

<span class="tok-c1">// Duplicates not allowed</span>
<span class="tok-o">[</span><span class="tok-nl">numbers:</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">]]</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">).</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-n">set</span><span class="tok-o">,</span><span class="tok-s1">&#39;numbers&#39;</span><span class="tok-o">,</span><span class="tok-mi">4</span><span class="tok-o">)</span>
<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">).</span><span class="tok-na">valueMap</span><span class="tok-o">()</span>

<span class="tok-o">[</span><span class="tok-nl">numbers:</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">4</span><span class="tok-o">]]</span>

<span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">tx</span><span class="tok-o">().</span><span class="tok-na">commit</span><span class="tok-o">()</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="janusgeo">6.3.10. The Janus Graph geospatial API</h4>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">lon</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>
<span class="tok-n">lat</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LHR&#39;</span><span class="tok-o">).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">).</span><span class="tok-na">next</span><span class="tok-o">()</span>

<span class="tok-n">boundary</span> <span class="tok-o">=</span> <span class="tok-n">Geoshape</span><span class="tok-o">.</span><span class="tok-na">circle</span><span class="tok-o">(</span><span class="tok-n">lat</span><span class="tok-o">,</span><span class="tok-n">lon</span><span class="tok-o">,</span><span class="tok-mi">100</span><span class="tok-o">)</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">hasLabel</span><span class="tok-o">(</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span>
    <span class="tok-n">where</span><span class="tok-o">(</span><span class="tok-n">map</span><span class="tok-o">{</span><span class="tok-n">a</span><span class="tok-o">=</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">value</span><span class="tok-o">(</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">);</span>
              <span class="tok-n">b</span><span class="tok-o">=</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">value</span><span class="tok-o">(</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">);</span>
              <span class="tok-n">Geoshape</span><span class="tok-o">.</span><span class="tok-na">point</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">,</span><span class="tok-n">b</span><span class="tok-o">).</span><span class="tok-na">within</span><span class="tok-o">(</span><span class="tok-n">boundary</span><span class="tok-o">)}.</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">)).</span>
              <span class="tok-n">valueMap</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LGW</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">0.190277993679047</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.1481018066406</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">BZZ</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">1.58361995220184</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.749964</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">STN</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-mf">0.234999999404</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.8849983215</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LTN</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">0.368333011865616</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.874698638916</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">SOU</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">1.35679996013641</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">50.9502983093262</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LHR</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[-</span><span class="tok-mf">0.461941003799</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.4706001282</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">LCY</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-mf">0.055278</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.505278</span><span class="tok-o">]]</span>
<span class="tok-o">[</span><span class="tok-nl">code:</span><span class="tok-o">[</span><span class="tok-n">SEN</span><span class="tok-o">],</span><span class="tok-nl">lon:</span><span class="tok-o">[</span><span class="tok-mf">0.695555984973907</span><span class="tok-o">],</span><span class="tok-nl">lat:</span><span class="tok-o">[</span><span class="tok-mf">51.5713996887207</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="janusstorage">6.4. Choosing a persistent storage technology for Janus Graph</h3>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="sect3">
<h4 id="_berkley_db">6.4.1. Berkley DB</h4>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
<div class="sect3">
<h4 id="_apache_cassandra">6.4.2. Apache Cassandra</h4>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
<div class="sect3">
<h4 id="_apache_hbase">6.4.3. Apache HBase</h4>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_an_external_index_with_janus_graph">6.5. Using an external index with Janus Graph</h3>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="sect3">
<h4 id="_apache_elastic_search">6.5.1. Apache Elastic Search</h4>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
<div class="sect3">
<h4 id="_apache_solr">6.5.2. Apache Solr</h4>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_management_api_to_control_the_index">6.5.3. Using the Management API to control the index</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">mgmt</span> <span class="tok-o">=</span> <span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">openManagement</span><span class="tok-o">()</span>
<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">buildIndex</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-n">Vertex</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">vindex</span> <span class="tok-o">=</span> <span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">getGraphIndexes</span><span class="tok-o">(</span><span class="tok-n">Vertex</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>

<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">updateIndex</span><span class="tok-o">(</span><span class="tok-n">vindx</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">),</span> <span class="tok-n">SchemaAction</span><span class="tok-o">.</span><span class="tok-na">REINDEX</span><span class="tok-o">).</span><span class="tok-na">get</span><span class="tok-o">()</span>

<span class="tok-n">mgmt</span><span class="tok-o">.</span><span class="tok-na">commit</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_gremlin_server">6.6. Using Gremlin Server</h3>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="sect3">
<h4 id="_connecting_the_gremlin_console_to_a_remote_graph">6.6.1. Connecting the Gremlin Console to a remote graph</h4>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_janus_graph_and_gremlin_from_a_java_program">6.6.2. Using Janus Graph and Gremlin from a Java program</h4>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_a_gremlin_server_from_the_command_line">6.6.3. Connecting to a Gremlin Server from the command line</h4>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
<div class="sect3">
<h4 id="_examples_of_the_json_returned_from_a_gremlin_server">6.6.4. Examples of the JSON returned from a Gremlin Server</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;CDG&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-mi">40972336</span><span class="tok-o">,</span>
  <span class="tok-s1">&#39;label&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span>
  <span class="tok-s1">&#39;properties&#39;</span><span class="tok-o">:</span> <span class="tok-o">{</span><span class="tok-s1">&#39;city&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oeadi-oe6gg-745&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Paris&#39;</span><span class="tok-o">}],</span>
   <span class="tok-s1">&#39;code&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oe9l2-oe6gg-sl&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;CDG&#39;</span><span class="tok-o">}],</span>
   <span class="tok-s1">&#39;country&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oe96u-oe6gg-5j9&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;FR&#39;</span><span class="tok-o">}],</span>
   <span class="tok-s1">&#39;desc&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oedja-oe6gg-3yd&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Paris Charles de Gaulle&#39;</span><span class="tok-o">}],</span>
   <span class="tok-s1">&#39;elev&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oearq-oe6gg-7wl&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-mi">392</span><span class="tok-o">}],</span>
   <span class="tok-s1">&#39;icao&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oeb5y-oe6gg-8p1&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;LFPG&#39;</span><span class="tok-o">}],</span>
   <span class="tok-s1">&#39;lat&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oed52-oe6gg-but&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-mf">49.0127983093</span><span class="tok-o">}],</span>
   <span class="tok-s1">&#39;lon&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oebk6-oe6gg-9hh&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-mf">2.54999995232</span><span class="tok-o">}],</span>
   <span class="tok-s1">&#39;longest&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oe9za-oe6gg-6bp&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-mi">13829</span><span class="tok-o">}],</span>
   <span class="tok-s1">&#39;region&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oeccm-oe6gg-a9x&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;FR-J&#39;</span><span class="tok-o">}],</span>
   <span class="tok-s1">&#39;runways&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oecqu-oe6gg-b2d&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-mi">4</span><span class="tok-o">}],</span>
   <span class="tok-s1">&#39;type&#39;</span><span class="tok-o">:</span> <span class="tok-o">[{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;oebye-oe6gg-35x&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;value&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">}]},</span>
  <span class="tok-s1">&#39;type&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;vertex&#39;</span><span class="tok-o">}]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;type&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">).</span><span class="tok-na">or</span><span class="tok-o">(</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-TX&#39;</span><span class="tok-o">),</span><span class="tok-n">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;region&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;US-OK&#39;</span><span class="tok-o">)).</span><span class="tok-na">values</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">order</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span><span class="tok-nt">&quot;requestId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;8602665d-e1c0-488f-b8a1-3343c3a1c0b6&quot;</span>
<span class="tok-p">,</span><span class="tok-nt">&quot;status&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;message&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;&quot;</span>
          <span class="tok-p">,</span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-mi">200</span>
          <span class="tok-p">,</span><span class="tok-nt">&quot;attributes&quot;</span><span class="tok-p">:{}}</span>
<span class="tok-p">,</span><span class="tok-nt">&quot;result&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span><span class="tok-s2">&quot;ABI&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;ACT&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;AMA&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;AUS&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;BPT&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;BRO&quot;</span>
                  <span class="tok-p">,</span><span class="tok-s2">&quot;CLL&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;CRP&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;DAL&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;DFW&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;ELP&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;GGG&quot;</span>
                  <span class="tok-p">,</span><span class="tok-s2">&quot;GRK&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;HOU&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;HRL&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;IAH&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;LAW&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;LBB&quot;</span>
                  <span class="tok-p">,</span><span class="tok-s2">&quot;LRD&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;MAF&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;MFE&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;OKC&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;SAT&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;SJT&quot;</span>
                  <span class="tok-p">,</span><span class="tok-s2">&quot;SPS&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;SWO&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;TUL&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;TYR&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;VCT&quot;</span><span class="tok-p">]</span>
          <span class="tok-p">,</span><span class="tok-nt">&quot;meta&quot;</span><span class="tok-p">:{}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tweaking_queries_to_make_the_json_returned_easier_to_work_with">6.6.5. Tweaking queries to make the JSON returned easier to work with</h4>
<div class="paragraph">
<p>Below is a query that we have seen used earlier in this document. It finds all
routes longer than 8,000 miles and returns the airport pairs and the distance
between them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">8000</span><span class="tok-o">)).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">)</span> <span class="tok-err">\</span>
     <span class="tok-o">.</span><span class="tok-na">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span> <span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">))).</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run this query using the Gremlin console with TinkerGraph we get get
back results that have been to a degree <em>pretty printed</em> by the Console as
shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-n">AKL</span><span class="tok-o">,</span><span class="tok-mi">9025</span><span class="tok-o">,</span><span class="tok-n">DOH</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8150</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AKL</span><span class="tok-o">,</span><span class="tok-mi">8818</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8139</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8574</span><span class="tok-o">,</span><span class="tok-n">SYD</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8105</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-mi">8434</span><span class="tok-o">,</span><span class="tok-n">JNB</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8085</span><span class="tok-o">,</span><span class="tok-n">SFO</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">SFO</span><span class="tok-o">,</span><span class="tok-mi">8433</span><span class="tok-o">,</span><span class="tok-n">SIN</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-n">HKG</span><span class="tok-o">,</span><span class="tok-mi">8054</span><span class="tok-o">,</span><span class="tok-n">JFK</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8372</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-n">AUH</span><span class="tok-o">,</span><span class="tok-mi">8053</span><span class="tok-o">,</span><span class="tok-n">DFW</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DXB</span><span class="tok-o">,</span><span class="tok-mi">8321</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-n">EWR</span><span class="tok-o">,</span><span class="tok-mi">8047</span><span class="tok-o">,</span><span class="tok-n">HKG</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">JED</span><span class="tok-o">,</span><span class="tok-mi">8314</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-mi">8030</span><span class="tok-o">,</span><span class="tok-n">IAH</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">DOH</span><span class="tok-o">,</span><span class="tok-mi">8287</span><span class="tok-o">,</span><span class="tok-n">LAX</span><span class="tok-o">]</span>    <span class="tok-o">[</span><span class="tok-n">DFW</span><span class="tok-o">,</span><span class="tok-mi">8022</span><span class="tok-o">,</span><span class="tok-n">DXB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">LAX</span><span class="tok-o">,</span><span class="tok-mi">8246</span><span class="tok-o">,</span><span class="tok-n">RUH</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if you were to use a system that returns the full JSON response, for
example when using Gremlin Server or talking to a hosted graph like IBM Graph, and
not get the benefit of the <em>pretty printing</em> that the Gremlin Console does
using TinkerGraph you will get back something that looks a lot like this from
the exact same query as the one we used above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;AKL&#39;</span><span class="tok-o">,</span> <span class="tok-mi">9025</span><span class="tok-o">,</span> <span class="tok-s1">&#39;DOH&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;AKL&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8818</span><span class="tok-o">,</span> <span class="tok-s1">&#39;DXB&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8574</span><span class="tok-o">,</span> <span class="tok-s1">&#39;SYD&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;ATL&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8434</span><span class="tok-o">,</span> <span class="tok-s1">&#39;JNB&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;SFO&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8433</span><span class="tok-o">,</span> <span class="tok-s1">&#39;SIN&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;AUH&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8372</span><span class="tok-o">,</span> <span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;DXB&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8321</span><span class="tok-o">,</span> <span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;JED&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8314</span><span class="tok-o">,</span> <span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;DOH&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8287</span><span class="tok-o">,</span> <span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8246</span><span class="tok-o">,</span> <span class="tok-s1">&#39;RUH&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;DXB&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8150</span><span class="tok-o">,</span> <span class="tok-s1">&#39;IAH&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;AUH&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8139</span><span class="tok-o">,</span> <span class="tok-s1">&#39;SFO&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8105</span><span class="tok-o">,</span> <span class="tok-s1">&#39;HKG&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;DXB&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8085</span><span class="tok-o">,</span> <span class="tok-s1">&#39;SFO&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;HKG&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8054</span><span class="tok-o">,</span> <span class="tok-s1">&#39;JFK&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;AUH&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8053</span><span class="tok-o">,</span> <span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;EWR&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8047</span><span class="tok-o">,</span> <span class="tok-s1">&#39;HKG&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;DOH&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8030</span><span class="tok-o">,</span> <span class="tok-s1">&#39;IAH&#39;</span><span class="tok-o">]},</span>
 <span class="tok-o">{</span><span class="tok-s1">&#39;labels&#39;</span><span class="tok-o">:</span> <span class="tok-o">[[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">],</span> <span class="tok-o">[],</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]],</span> <span class="tok-s1">&#39;objects&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">,</span> <span class="tok-mi">8022</span><span class="tok-o">,</span> <span class="tok-s1">&#39;DXB&#39;</span><span class="tok-o">]}]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What is being returned is useful in some cases, for examples we can see the
<em>a</em> and <em>b</em> labels that we used in our query but in this case all we really
wanted was the last part with the airport codes and the distances. We could
decide to write code to process this JSON as-is (probably using a JSON helper
class) and that is a valid choice you could make. However by tweaking the
query slightly, we can enable Gremlin to give us back what we really wanted.
Let&#8217;s start by looking at what happens if we add <em>.toList().toString()</em> to the
end of the query. Take a look at the modified form of the query below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">8000</span><span class="tok-o">)).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">)</span> <span class="tok-err">\</span>
     <span class="tok-o">.</span><span class="tok-na">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span> <span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">)))</span> <span class="tok-err">\</span>
     <span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">().</span><span class="tok-na">toString</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run the query, we now get back something that looks a lot more like what we
got back when working with our local TinkerGraph and is certainly a bit easier to
process in your application. However this is still not an ideal result as what we now
have is a list containing  a single string with all of our routes in it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-s1">&#39;[[AKL, 9025, DOH], [AKL, 8818, DXB], [DFW, 8574, SYD], [ATL, 8434, JNB],</span>
<span class="tok-s1">[SFO, 8433, SIN], [AUH, 8372, LAX], [DXB, 8321, LAX], [JED, 8314, LAX], [DOH,</span>
<span class="tok-s1">8287, LAX], [LAX, 8246, RUH], [DXB, 8150, IAH], [AUH, 8139, SFO], [DFW, 8105,</span>
<span class="tok-s1">HKG], [DXB, 8085, SFO], [HKG, 8054, JFK], [AUH, 8053, DFW], [EWR, 8047, HKG],</span>
<span class="tok-s1">[DOH, 8030, IAH], [DFW, 8022, DXB]]&#39;</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can add a little more post processing to split up our single string into an
array of strings where each string is a single route of the form
<em>[AKL,9025,DOH]</em>. One way to do this is to trim off the unwanted characters at
each end of the string and then use split to divide it up. As there are a lot
of commas in the string I could not just do a simple <em>split(",")</em> as that
would not have returned what I wanted. To make the split work, I replaced
every occurence of <em>],</em> in the string with <em>]x</em> and then did the split using
<em>split("x")</em>. Here is the modified query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">).</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">has</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">gt</span><span class="tok-o">(</span><span class="tok-mi">8000</span><span class="tok-o">)).</span><span class="tok-na">order</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">,</span><span class="tok-n">decr</span><span class="tok-o">).</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">)</span> <span class="tok-err">\</span>
     <span class="tok-o">.</span><span class="tok-na">filter</span><span class="tok-o">(</span><span class="tok-n">select</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">where</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span> <span class="tok-n">lt</span><span class="tok-o">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">)))</span><span class="tok-err">\</span>
     <span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">().</span><span class="tok-na">toString</span><span class="tok-o">()[</span><span class="tok-mi">1</span><span class="tok-o">..-</span><span class="tok-mi">2</span><span class="tok-o">].</span><span class="tok-na">replaceAll</span><span class="tok-o">(</span><span class="tok-s2">&quot;],&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;]x&quot;</span><span class="tok-o">).</span><span class="tok-na">split</span><span class="tok-o">(</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what we now get back in the returned JSON. Each route is now a string
in an array of strings. From here it is a simple task to extract the airport
names and distances for each route.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-s1">&#39; [AKL, 9025, DOH]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [AKL, 8818, DXB]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [DFW, 8574, SYD]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [ATL, 8434, JNB]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [SFO, 8433, SIN]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [AUH, 8372, LAX]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [DXB, 8321, LAX]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [JED, 8314, LAX]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [DOH, 8287, LAX]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [LAX, 8246, RUH]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [DXB, 8150, IAH]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [AUH, 8139, SFO]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [DFW, 8105, HKG]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [DXB, 8085, SFO]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [HKG, 8054, JFK]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [AUH, 8053, DFW]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [EWR, 8047, HKG]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [DOH, 8030, IAH]&#39;</span><span class="tok-o">,</span>
 <span class="tok-s1">&#39; [DFW, 8022, DXB]&#39;</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s really a matter of personal preference whether you decide to have the
query return less data or just return the full set of data that we got back
from the initial query. One advantage to having the query limit what is
returned is that less data, potentially a lot less data, will need to be sent
back to your application and stored in memory or on disk.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_gremlin_within_a_python_notebook">6.7. Using Gremlin within a Python notebook</h3>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
<div class="sect2">
<h3 id="_putting_it_all_into_a_docker_container">6.8. Putting it all into a Docker Container</h3>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serialize">7. COMMON GRAPH SERIALIZATION FORMATS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To be written</p>
</div>
<div class="sect2">
<h3 id="_comma_separated_values_csv">7.1. Comma Separated Values (CSV)</h3>
<div class="paragraph">
<div class="title">This section is still under construction!</div>
<p>There are a number of ways that a graph can be stored using CSV files. There is no
single preferred format that I am aware of.  However, a common and convenient way,
especially when nodes contain lots of properties is to use two CSV files. One will
contain all of the node data and the other will contain all of the edge data.</p>
</div>
<div class="sect3">
<h4 id="_using_two_csv_files_to_represent_the_air_routes_data">7.1.1. Using two CSV files to represent the air-routes data</h4>
<div class="paragraph">
<p>If we were to store the airport data from the air-routes graph in CSV format we might
do something like the example below. Note that to improve readability I have not
included every property (or indeed every airport) in this example. Notice how each
node has a unique ID assigned. This is important as when we define the edges we will
need the node IDs to build the connections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"ID","LABEL","CODE","IATA","CITY","REGION","RUNWAYS","LONGEST","ELEV","COUNTRY"
"1","airport","ATL","KATL","Atlanta","US-GA","5","12390","1026","US"
"2","airport","ANC","PANC","Anchorage","US-AK","3","12400","151","US"
"3","airport","AUS","KAUS","Austin","Austin","US-TX","2","12250","542","US"
"4","airport","BNA","KBNA","Nashville","US-TN","4","11030","599","US"
"5","airport","BOS","KBOS","Boston","US-MA","6","10083","19","US"
"6","airport","BWI","KBWI","Baltimore","US-MD","3","10502","143","US"
"7","airport","DCA","KDCA","Washington D.C.","US-DC","3","7169","14","US"
"8","airport","DFW","KDFW","Dallas Ft. Worth","US-TX","7","13401","607","US"
"9","airport","FLL","KFLL","Fort Lauderdale","US-FL","2","9000","64","US"</pre>
</div>
</div>
<div class="paragraph">
<p>For the route data, the edges in our graph, we might use a format like the one below.
I did not include an edge ID as we typically let the graph system assign those. For
completeness I did include a label however when every edge is of the same type you
could choose to leave this out so long as the program ingesting the data knew what
label to assign. Most graph systems require edges to have a label even if it is
optional for nodes. This is equally true for the airport data. However, in cases
where nodes and edges within the same CSV file are of different types then clearly
for those cases it is best to always include the label for each entry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"LABEL","FROM","TO","DIST"
"route",1,3,811
"route",1,4,214
"route",2,8,3036
"route",3,4,755
"route",4,6,586
"route",5,1,945</pre>
</div>
</div>
<div class="paragraph">
<p>Some graph systems provide ingestion tools that, when presented with a CSV file like
the ones we have shown here can figure out how to process them and build a graph.
However, in many other situations you may also find yourself writing your own scripts
or small programs to do it.</p>
</div>
<div class="paragraph">
<p>I often find myself writing Ruby or Groovy scripts that can generate CSV or GraphML
files so that a graph system can ingest them. In some cases I have used scripts to
take CSV or GraphML data and generate the Gremlin statements that would create the
graph.  This is very similar to another common practice, namely, using a  script to
generate <em>INSERT</em> statements when working with SQL databases.</p>
</div>
<div class="paragraph">
<p>I have also written Java and Groovy programs that will read the CSV file and use the
TinkerPop API or the Gremlin Server REST API to insert nodes and edges into a graph.
If you work with graph systems for a while you will probably find yourself also doing
similar things.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adjacency_matrix_format">7.1.2. Adjacency matrix format</h4>
<div class="paragraph">
<p>The examples shown above of how a CSV file can be used to store data about nodes and
edges presents a convenient way to do it. However, this is by no means the only way
you could do it. For graphs that do not contain properties you could lay the graph
out using an <em>adjacency matrix</em> as shown below. The letters represent the node labels
and a 1 indicates there is an edge between them and a zero indicates no edge. This
format can be useful if your nodes and edges do not have properties and if the graph is
small but in general is not a great way to try and represent large graphs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>A,B,C,D,E,F,G
A,0,1,1,0,1,0,1
B,1,0,0,1,0,1,0
C,1,1,0,1,1,0,1
D,0,1,1,0,1,0,1
E,0,0,0,1,0,1,0
F,1,1,0,1,0,0,1
G,1,1,1,0,1,1,0</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adjacency_list_format">7.1.3. Adjacency List format</h4>
<div class="paragraph">
<p>The adjacency matrix shown above could also be represented as an <em>adjacency list</em>. In
this case, the first column of each row represents a vertex. The remaining parts of
each row represent all of the other nodes that this node is connected to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>A,C,D,F,G
B,A,D,F
C,A,B,D,E,1
D,B,C,E,G
E,D,E
F,A,B,D,G
G,A,B,C,E,F</pre>
</div>
</div>
<div class="paragraph">
<p>While this is a simple example, it is possible to represent a more complex graph such
as the air-routes graph in this way. We could build a more complex CSV file where the
node and its properties are listed first, followed by all of the other nodes it
connects to and the properties for those edges.</p>
</div>
<div class="paragraph">
<p>Some graph database systems actually store their graphs to disk using a variation of
this format. Janus Graph in fact uses a system a lot like this when storing node and
edge data to its persistent store.</p>
</div>
</div>
<div class="sect3">
<h4 id="_edge_list_format">7.1.4. Edge List format</h4>
<div class="paragraph">
<p>When using an <em>edge list</em> format, each line represents an edge. So our simple example
could be represented as follows. Only a few edges are shown.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>A,C
A,D
A,F
A,G
B,A
B,D
B,F
C,A
C,B</pre>
</div>
</div>
<div class="paragraph">
<p>There are many ways you could construct an edge list. By way of another simple
example we could represent routes in the air-routes graph in a format similar to that
shown below. In this case we also include the label of the edge between each of the
nodes. The nodes are represented by their ID value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[1,route,623]
[1,route,624]
[1,route,625]
[1,route,626]
[1,route,627]
[1,route,628]
[1,route,629]
[1,route,630]
[1,route,631]
[1,route,632]</pre>
</div>
</div>
<div class="paragraph">
<p>If you wanted to export a very simple version of the air-routes graph, using just the
airport IATA codes and the edge labels you could write a Gremlin query to do it for
you as follows. Only the first 10 results returned are shown.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">)</span>

<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">MBS</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">MCN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">MEI</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">MLB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">MSL</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">PHF</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">PIB</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">SBN</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">TRI</span><span class="tok-o">]</span>
<span class="tok-o">[</span><span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">TTN</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wanted to print the list without the containing square brackets you could take
advantage of the Java <em>forEachRemaining</em> method from the Iterator interface to add a
bit of post processing to the end of the query. Once again only the first 10 results
are shown.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">V</span><span class="tok-o">().</span><span class="tok-na">outE</span><span class="tok-o">().</span><span class="tok-na">inV</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">().</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">).</span><span class="tok-na">by</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">).</span>
      <span class="tok-n">forEachRemaining</span><span class="tok-o">{</span><span class="tok-n">println</span> <span class="tok-n">it</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;,&#39;</span> <span class="tok-o">+</span> <span class="tok-n">it</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;,&#39;</span> <span class="tok-o">+</span> <span class="tok-n">it</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]}</span>

<span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">MBS</span>
<span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">MCN</span>
<span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">MEI</span>
<span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">MLB</span>
<span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">MSL</span>
<span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">PHF</span>
<span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">PIB</span>
<span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">SBN</span>
<span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">TRI</span>
<span class="tok-n">ATL</span><span class="tok-o">,</span><span class="tok-n">route</span><span class="tok-o">,</span><span class="tok-n">TTN</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exporting_relational_database_data_to_a_graph_using_csv_format">7.1.5. Exporting relational database data to a graph using CSV format</h4>
<div class="paragraph">
<p>To be written</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_graphml">7.2. GraphML</h3>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&#39;1.0&#39; ?&gt;</span>
<span class="tok-c">&lt;!-- ******************************************************* --&gt;</span>
<span class="tok-c">&lt;!-- Small sample taken from the air-routes.graphml file.    --&gt;</span>
<span class="tok-c">&lt;!-- ******************************************************* --&gt;</span>

<span class="tok-nt">&lt;graphml</span> <span class="tok-na">xmlns=</span><span class="tok-s">&#39;http://graphml.graphdrawing.org/xmlns&#39;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;type&#39;</span>    <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;type&#39;</span>    <span class="tok-na">attr.type=</span><span class="tok-s">&#39;string&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;code&#39;</span>    <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;code&#39;</span>    <span class="tok-na">attr.type=</span><span class="tok-s">&#39;string&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;icao&#39;</span>    <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;icao&#39;</span>    <span class="tok-na">attr.type=</span><span class="tok-s">&#39;string&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;desc&#39;</span>    <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;desc&#39;</span>    <span class="tok-na">attr.type=</span><span class="tok-s">&#39;string&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;region&#39;</span>  <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;region&#39;</span>  <span class="tok-na">attr.type=</span><span class="tok-s">&#39;string&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;runways&#39;</span> <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;runways&#39;</span> <span class="tok-na">attr.type=</span><span class="tok-s">&#39;int&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;longest&#39;</span> <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;longest&#39;</span> <span class="tok-na">attr.type=</span><span class="tok-s">&#39;int&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;elev&#39;</span>    <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;elev&#39;</span>    <span class="tok-na">attr.type=</span><span class="tok-s">&#39;int&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;country&#39;</span> <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;country&#39;</span> <span class="tok-na">attr.type=</span><span class="tok-s">&#39;string&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;city&#39;</span>    <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;city&#39;</span>    <span class="tok-na">attr.type=</span><span class="tok-s">&#39;string&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;lat&#39;</span>     <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;lat&#39;</span>     <span class="tok-na">attr.type=</span><span class="tok-s">&#39;double&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;lon&#39;</span>     <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;lon&#39;</span>     <span class="tok-na">attr.type=</span><span class="tok-s">&#39;double&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;dist&#39;</span>    <span class="tok-na">for=</span><span class="tok-s">&#39;edge&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;dist&#39;</span>    <span class="tok-na">attr.type=</span><span class="tok-s">&#39;int&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;labelV&#39;</span>  <span class="tok-na">for=</span><span class="tok-s">&#39;node&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;labelV&#39;</span>  <span class="tok-na">attr.type=</span><span class="tok-s">&#39;string&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>
  <span class="tok-nt">&lt;key</span> <span class="tok-na">id=</span><span class="tok-s">&#39;labelE&#39;</span>  <span class="tok-na">for=</span><span class="tok-s">&#39;edge&#39;</span> <span class="tok-na">attr.name=</span><span class="tok-s">&#39;labelE&#39;</span>  <span class="tok-na">attr.type=</span><span class="tok-s">&#39;string&#39;</span><span class="tok-nt">&gt;&lt;/key&gt;</span>

  <span class="tok-nt">&lt;graph</span> <span class="tok-na">id=</span><span class="tok-s">&#39;routes&#39;</span> <span class="tok-na">edgedefault=</span><span class="tok-s">&#39;directed&#39;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;node</span> <span class="tok-na">id=</span><span class="tok-s">&#39;1&#39;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;labelV&#39;</span><span class="tok-nt">&gt;</span>airport<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;type&#39;</span><span class="tok-nt">&gt;</span>airport<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;code&#39;</span><span class="tok-nt">&gt;</span>ATL<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;icao&#39;</span><span class="tok-nt">&gt;</span>KATL<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;city&#39;</span><span class="tok-nt">&gt;</span>Atlanta<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;desc&#39;</span><span class="tok-nt">&gt;</span>Hartsfield - Jackson Atlanta International Airport<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;region&#39;</span><span class="tok-nt">&gt;</span>US-GA<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;runways&#39;</span><span class="tok-nt">&gt;</span>5<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;longest&#39;</span><span class="tok-nt">&gt;</span>12390<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;elev&#39;</span><span class="tok-nt">&gt;</span>1026<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;country&#39;</span><span class="tok-nt">&gt;</span>US<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;lat&#39;</span><span class="tok-nt">&gt;</span>33.6366996765137<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;lon&#39;</span><span class="tok-nt">&gt;</span>-84.4281005859375<span class="tok-nt">&lt;/data&gt;</span>
  <span class="tok-nt">&lt;/node&gt;</span>

  <span class="tok-nt">&lt;edge</span> <span class="tok-na">id=</span><span class="tok-s">&#39;3610&#39;</span> <span class="tok-na">source=</span><span class="tok-s">&#39;1&#39;</span> <span class="tok-na">target=</span><span class="tok-s">&#39;3&#39;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;labelE&#39;</span><span class="tok-nt">&gt;</span>route<span class="tok-nt">&lt;/data&gt;</span>
    <span class="tok-nt">&lt;data</span> <span class="tok-na">key=</span><span class="tok-s">&#39;dist&#39;</span><span class="tok-nt">&gt;</span>811<span class="tok-nt">&lt;/data&gt;</span>
  <span class="tok-nt">&lt;/edge&gt;</span>

  <span class="tok-nt">&lt;/graph&gt;</span>
<span class="tok-nt">&lt;/graphml&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_graphson">7.3. GraphSON</h3>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">TinkerGraph</span><span class="tok-o">.</span><span class="tok-na">open</span><span class="tok-o">()</span>
<span class="tok-n">g</span><span class="tok-o">=</span><span class="tok-n">graph</span><span class="tok-o">.</span><span class="tok-na">traversal</span><span class="tok-o">()</span>

<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;AUS&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;DFW&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;LAX&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;lax&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;JFK&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;jfk&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addV</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span><span class="tok-s1">&#39;airport&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;code&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;ATL&#39;</span><span class="tok-o">).</span><span class="tok-na">as</span><span class="tok-o">(</span><span class="tok-s1">&#39;atl&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;atl&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;atl&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;atl&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;jfk&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;jfk&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;lax&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;lax&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;jfk&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;lax&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;aus&#39;</span><span class="tok-o">).</span>
  <span class="tok-n">addE</span><span class="tok-o">(</span><span class="tok-s1">&#39;route&#39;</span><span class="tok-o">).</span><span class="tok-na">from</span><span class="tok-o">(</span><span class="tok-s1">&#39;lax&#39;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s1">&#39;dfw&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_adjacency_list_format_graphson">7.3.1. Adjacency list format GraphSON</h4>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">17</span><span class="tok-p">,</span><span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span><span class="tok-mi">4</span><span class="tok-p">}]},</span> <span class="tok-err">...</span> <span class="tok-p">}</span>
<span class="tok-p">{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">18</span><span class="tok-p">,</span><span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span><span class="tok-mi">4</span><span class="tok-p">},</span> <span class="tok-err">...</span> <span class="tok-p">]}}</span>
<span class="tok-p">{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">15</span><span class="tok-p">,</span><span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">}]},</span> <span class="tok-err">...</span> <span class="tok-p">}</span>
<span class="tok-p">{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">6</span><span class="tok-p">,</span><span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">16</span><span class="tok-p">,</span><span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span><span class="tok-mi">4</span><span class="tok-p">},</span> <span class="tok-err">...</span> <span class="tok-p">]}}</span>
<span class="tok-p">{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">8</span><span class="tok-p">,</span><span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">11</span><span class="tok-p">,</span><span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">}]},</span> <span class="tok-err">...</span> <span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
            <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">17</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">4</span>
        <span class="tok-p">}]</span>
    <span class="tok-p">},</span>
    <span class="tok-nt">&quot;outE&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
            <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">10</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2</span>
        <span class="tok-p">},</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">11</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">8</span>
        <span class="tok-p">}]</span>
    <span class="tok-p">},</span>
    <span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
            <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;AUS&quot;</span>
        <span class="tok-p">}]</span>
    <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">197</span><span class="tok-p">,</span><span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;contains&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">46566</span><span class="tok-p">,</span><span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span><span class="tok-mi">3378</span><span class="tok-p">},{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">49931</span><span class="tok-p">,</span><span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span><span class="tok-mi">3608</span><span class="tok-p">}],</span><span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">9524</span><span class="tok-p">,</span><span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span><span class="tok-mi">55</span><span class="tok-p">,</span><span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;dist&quot;</span><span class="tok-p">:</span><span class="tok-mi">520</span><span class="tok-p">}},{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">9753</span><span class="tok-p">,</span><span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span><span class="tok-mi">57</span><span class="tok-p">,</span><span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;dist&quot;</span><span class="tok-p">:</span><span class="tok-mi">903</span><span class="tok-p">}},{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">22158</span><span class="tok-p">,</span><span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span><span class="tok-mi">231</span><span class="tok-p">,</span><span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;dist&quot;</span><span class="tok-p">:</span><span class="tok-mi">1036</span><span class="tok-p">}}]},</span><span class="tok-nt">&quot;outE&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">20448</span><span class="tok-p">,</span><span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span><span class="tok-mi">231</span><span class="tok-p">,</span><span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;dist&quot;</span><span class="tok-p">:</span><span class="tok-mi">1036</span><span class="tok-p">}},{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">20446</span><span class="tok-p">,</span><span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span><span class="tok-mi">55</span><span class="tok-p">,</span><span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;dist&quot;</span><span class="tok-p">:</span><span class="tok-mi">520</span><span class="tok-p">}},{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">20447</span><span class="tok-p">,</span><span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span><span class="tok-mi">57</span><span class="tok-p">,</span><span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;dist&quot;</span><span class="tok-p">:</span><span class="tok-mi">903</span><span class="tok-p">}}]},</span><span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:{</span><span class="tok-nt">&quot;country&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2356</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;AU&quot;</span><span class="tok-p">}],</span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2357</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;MCY&quot;</span><span class="tok-p">}],</span><span class="tok-nt">&quot;longest&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2358</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">5896</span><span class="tok-p">}],</span><span class="tok-nt">&quot;city&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2359</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Maroochydore&quot;</span><span class="tok-p">}],</span><span class="tok-nt">&quot;elev&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2360</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">15</span><span class="tok-p">}],</span><span class="tok-nt">&quot;icao&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2361</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;YBSU&quot;</span><span class="tok-p">}],</span><span class="tok-nt">&quot;lon&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2362</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mf">153.091003418</span><span class="tok-p">}],</span><span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2363</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">}],</span><span class="tok-nt">&quot;region&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2364</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;AU-QLD&quot;</span><span class="tok-p">}],</span><span class="tok-nt">&quot;runways&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2365</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">}],</span><span class="tok-nt">&quot;lat&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2366</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mf">-26.6033000946</span><span class="tok-p">}],</span><span class="tok-nt">&quot;desc&quot;</span><span class="tok-p">:[{</span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-mi">2367</span><span class="tok-p">,</span><span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Sunshine Coast Airport&quot;</span><span class="tok-p">}]}}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wrapped_adjacency_list_format_graphson">7.3.2. Wrapped adjacency list format GraphSON</h4>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
    <span class="tok-nt">&quot;vertices&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
        <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">17</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">4</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">},</span>
        <span class="tok-nt">&quot;outE&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">10</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2</span>
            <span class="tok-p">},</span> <span class="tok-p">{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">11</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">8</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">},</span>
        <span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;AUS&quot;</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">}</span>
    <span class="tok-p">},</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">18</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">4</span>
            <span class="tok-p">},</span> <span class="tok-p">{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">10</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span>
            <span class="tok-p">},</span> <span class="tok-p">{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">12</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">8</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">},</span>
        <span class="tok-nt">&quot;outE&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">14</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">6</span>
            <span class="tok-p">},</span> <span class="tok-p">{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">15</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">4</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">},</span>
        <span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">3</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DFW&quot;</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">}</span>
    <span class="tok-p">},</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">4</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">15</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">},</span>
        <span class="tok-nt">&quot;outE&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">16</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">6</span>
            <span class="tok-p">},</span> <span class="tok-p">{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">17</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span>
            <span class="tok-p">},</span> <span class="tok-p">{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">18</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">},</span>
        <span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">5</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;LAX&quot;</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">}</span>
    <span class="tok-p">},</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">6</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">16</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">4</span>
            <span class="tok-p">},</span> <span class="tok-p">{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">13</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">8</span>
            <span class="tok-p">},</span> <span class="tok-p">{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">14</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">},</span>
        <span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">7</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;JFK&quot;</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">}</span>
    <span class="tok-p">},</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">8</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;label&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;airport&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;inE&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">11</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;outV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">},</span>
        <span class="tok-nt">&quot;outE&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;route&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">12</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2</span>
            <span class="tok-p">},</span> <span class="tok-p">{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">13</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;inV&quot;</span><span class="tok-p">:</span> <span class="tok-mi">6</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">},</span>
        <span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
            <span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span> <span class="tok-p">[{</span>
                <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-mi">9</span><span class="tok-p">,</span>
                <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;ATL&quot;</span>
            <span class="tok-p">}]</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}]</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_other_formats_you_may_encounter">7.4. Other formats you may encounter</h3>
<div class="paragraph">
<p>To be written</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GML</p>
</li>
<li>
<p>GEXF</p>
</li>
<li>
<p>etc</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fr">8. FURTHER READING</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">Apache TinkerPop Getting Started guide</div>
<p><a href="http://tinkerpop.apache.org/docs/current/tutorials/getting-started/" class="bare">http://tinkerpop.apache.org/docs/current/tutorials/getting-started/</a></p>
</div>
<div class="paragraph">
<div class="title">Official Apache TinkerPop home page and Gremlin downloads</div>
<p><a href="http://tinkerpop.apache.org/" class="bare">http://tinkerpop.apache.org/</a></p>
</div>
<div class="paragraph">
<div class="title">Current Apache TinkerPop documention</div>
<p><a href="http://tinkerpop.apache.org/docs/current/reference/" class="bare">http://tinkerpop.apache.org/docs/current/reference/</a></p>
</div>
<div class="paragraph">
<div class="title">Apache TinkerPop JavaDoc API reference material</div>
<p><a href="http://tinkerpop.apache.org/javadocs/current/core/" class="bare">http://tinkerpop.apache.org/javadocs/current/core/</a></p>
</div>
<div class="paragraph">
<p><a href="http://tinkerpop.apache.org/javadocs/current/full/" class="bare">http://tinkerpop.apache.org/javadocs/current/full/</a></p>
</div>
<div class="paragraph">
<div class="title">Useful Gremlin "recipies"</div>
<p><a href="http://tinkerpop.apache.org/docs/current/recipes/" class="bare">http://tinkerpop.apache.org/docs/current/recipes/</a></p>
</div>
<div class="paragraph">
<div class="title">Public mailing list for Gremlin users</div>
<p><a href="https://groups.google.com/forum/#!forum/gremlin-users" class="bare">https://groups.google.com/forum/#!forum/gremlin-users</a></p>
</div>
<div class="paragraph">
<div class="title">Places where you can experiment with graphs in a browser</div>
<p><a href="http://www.graphstory.com/" class="bare">http://www.graphstory.com/</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.graphenedb.com/" class="bare">http://www.graphenedb.com/</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.gremlinbin.com" class="bare">http://www.gremlinbin.com</a></p>
</div>
<div class="paragraph">
<div class="title">Janus Graph home page</div>
<p><a href="http://janusgraph.org/" class="bare">http://janusgraph.org/</a></p>
</div>
<div class="paragraph">
<div class="title">Janus Graph overview documentation</div>
<p><a href="http://docs.janusgraph.org/latest/" class="bare">http://docs.janusgraph.org/latest/</a></p>
</div>
<div class="paragraph">
<div class="title">Janus Graph API documentation</div>
<p><a href="https://javadoc.io/doc/org.janusgraph/janusgraph-core/0.1.1" class="bare">https://javadoc.io/doc/org.janusgraph/janusgraph-core/0.1.1</a></p>
</div>
<div class="paragraph">
<div class="title">Public mailing list for Janus Graph users</div>
<p><a href="https://groups.google.com/forum/#!forum/janusgraph-users" class="bare">https://groups.google.com/forum/#!forum/janusgraph-users</a></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 251<br>
Last updated 2017-10-09 16:52:58 CDT
</div>
</div>
</body>
</html>